<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/6.1.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 14pt;
    }
  </style>
</head>
<body>
<a name="777"/>

<div>
<span><div>Maven包含几个项目构建phase，和对应的goal</div><div>常见的goal有 compile、test、 package、install、</div><div><br/></div><div>具体关系如下：</div><div>install包含 compile、test、package</div><div><br/></div><div><br/></div><div>Maven pom.xml的名字概念:</div><div><br/></div><div>scope</div></span>
</div>
<hr>
<a name="856"/>

<div>
<span><div><h1 style="margin: 0px 0px 20px; padding: 0px; font-size: 28px; font-weight: 400; color: rgb(51, 51, 51); font-family: Verdana, Arial, Helvetica, sans-serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;"><a href="http://www.cnblogs.com/zlcxbb/p/5757245.html" style="margin: 0px; padding: 0px; color: rgb(51, 51, 51); text-decoration: none;">MyISAM和InnoDB的索引实现</a></h1><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;"><div style="margin: 0px 0px 20px; padding: 0px; word-break: break-word; color: rgb(51, 51, 51);"><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);"> 在 MySQL 中，主要有四种类型的索引，分别为：</span> <strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; color: rgb(134, 0, 164);">B-Tree 索引， Hash 索引， Fulltext 索引和 R-Tree 索引</span></strong><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);">。我们主要分析B-Tree 索引。</span></p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;">        B-Tree 索引是 MySQL 数据库中使用最为频繁的索引类型，除了 Archive 存储引擎之外的其他所有的存储引擎都支持 B-Tree 索引。Archive 引擎直到 MySQL 5.1 才支持索引，而且只支持索引单个 AUTO_INCREMENT 列。</p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;">       不仅仅在 MySQL 中是如此，实际上在其他的很多数据库管理系统中B-Tree 索引也同样是作为最主要的索引类型，这主要是因为 B-Tree 索引的存储结构在数据库的数据检索中有非常优异的表现。</p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);">     一般来说， MySQL 中的 B-Tree 索引的物理文件大多都是以 Balance Tree 的结构来存储的，也就是所有实际需要的数据都存放于 Tree 的 Leaf Node(叶子节点) ，而且</span><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; color: rgb(166, 0, 196);">到任何一个 Leaf Node 的最短路径的长度都是完全相同的</span></strong><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);">，所以我们大家都称之为 B-Tree 索引。当然，可能各种数据库（或 MySQL 的各种存储引擎）在存放自己的 B-Tree 索引的时候会对存储结构稍作改造。</span><span style="margin: 0px; padding: 0px; color: rgb(255, 0, 0);"><strong style="margin: 0px; padding: 0px;">如 Innodb 存储引擎的 B-Tree 索引实际使用的存储结构实际上是 B+Tree</strong></span><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);">，也就是在 B-Tree 数据结构的基础上做了很小的改造，在每一个Leaf Node 上面出了存放索引键的相关信息之外，还</span><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; color: rgb(134, 0, 164);">存储了指向与该 Leaf Node 相邻的后一个 LeafNode 的指针信息（增加了</span><span style="margin: 0px; padding: 0px; color: rgb(227, 0, 0);">顺序访问指针</span><span style="margin: 0px; padding: 0px; color: rgb(134, 0, 164);">），这主要是为了加快</span><span style="margin: 0px; padding: 0px; color: rgb(227, 0, 0);">检索多个相邻 Leaf Node</span> <span style="margin: 0px; padding: 0px; color: rgb(134, 0, 164);">的效率考虑</span></strong><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);">。</span></p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"> </p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"><strong style="margin: 0px; padding: 0px;">下面主要讨论MyISAM和InnoDB两个存储引擎的索引实现方式：</strong></p><h2 style="margin: 20px 0px; padding: 0px; font-size: 21px; font-weight: bold;"><a name="t4" style="margin: 0px; padding: 0px;"></a>1. MyISAM索引实现：MyISAM索引文件和数据文件是分离的，索引文件仅保存数据记录的地址。</h2><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"><strong style="margin: 0px; padding: 0px;">1）主键索引：</strong></p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;">MyISAM引擎使用B+Tree作为索引结构，<strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; color: rgb(255, 0, 0);">叶节点的data域存放的是数据记录的地址</span></strong>。下图是MyISAM主键索引的原理图：</p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"><br style="margin: 0px; padding: 0px;"/><img src="http://my.csdn.net/uploads/201208/01/1343757655_1008.png" style="margin: 0px; padding: 0px; border: none; max-width: 800px; height: auto;"></img></p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;">                                                                           （图myisam1）</p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;">这里设表一共有三列，假设我们以Col1为主键，图myisam1是一个MyISAM表的主索引（Primary key）示意。可以看出MyISAM的索引文件仅仅保存数据记录的地址。</p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"><strong style="margin: 0px; padding: 0px;">2）辅助索引（Secondary key）</strong></p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"><strong style="margin: 0px; padding: 0px;">在MyISAM中，主索引和辅助索引（Secondary key）在结构上没有任何区别，只是主索引要求<span style="margin: 0px; padding: 0px; color: rgb(255, 0, 0);">key是唯一的</span>，而辅助索引的key可以重复。</strong>如果我们在Col2上建立一个辅助索引，则此索引的结构如下图所示：<br style="margin: 0px; padding: 0px;"/>
  </p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"><img src="http://my.csdn.net/uploads/201208/01/1343757949_9784.png" style="margin: 0px; padding: 0px; border: none; max-width: 800px; height: auto;"></img></p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"> </p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;">同样也是一颗B+Tree，data域保存数据记录的地址。因此，<strong style="margin: 0px; padding: 0px;">MyISAM中索引检索的算法为首先按照B+Tree搜索算法搜索索引，如果指定的Key存在，则取出其data域的值，然后以data域的值为地址，读取相应数据记录。</strong></p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);">MyISAM的索引方式也叫做“</span><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; color: rgb(134, 0, 164);">非聚集</span></strong><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);">”的，之所以这么称呼是为了与InnoDB的聚集索引区分。</span></p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"> </p><h2 style="margin: 20px 0px; padding: 0px; font-size: 21px; font-weight: bold;"><a name="t5" style="margin: 0px; padding: 0px;"></a>2. InnoDB索引实现</h2><p style="margin: 10px auto; padding: 0px; text-indent: 0px;">然InnoDB也使用B+Tree作为索引结构，但具体实现方式却与MyISAM截然不同.</p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"><strong style="margin: 0px; padding: 0px;">1）主键索引：</strong></p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"><strong style="margin: 0px; padding: 0px;">         </strong><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);">MyISAM索引文件和数据文件是分离的，索引文件仅保存数据记录的地址。而</span><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; color: rgb(166, 0, 196);">在InnoDB中，表数据文件本身就是按B+Tree组织的一个索引结构</span></strong><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);">，这棵树的叶节点data域保存了完整的数据记录。这个</span><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; color: rgb(134, 0, 164);">索引的key是数据表的主键</span></strong><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);">，因此</span><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; color: rgb(134, 0, 164);">InnoDB表数据文件本身就是主索引</span></strong><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);">。</span></p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"><img src="http://my.csdn.net/uploads/201208/01/1343758042_8526.png" style="margin: 0px; padding: 0px; border: none; max-width: 800px; height: auto;"></img></p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;">               (图inndb主键索引）</p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"> </p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"> </p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;">(图inndb主键索引）是InnoDB主索引（同时也是数据文件）的示意图，可以看到叶节点包含了完整的数据记录。这种索引叫做<span style="margin: 0px; padding: 0px; color: rgb(255, 0, 0);"><strong style="margin: 0px; padding: 0px;">聚集索引</strong></span>。因为InnoDB的数据文件本身要按主键聚集，所以InnoDB要求表必须有主键（MyISAM可以没有），如果没有显式指定，则MySQL系统会自动选择一个可以唯一标识数据记录的列作为主键，如果不存在这种列，则MySQL自动为InnoDB表生成一个隐含字段作为主键，这个字段长度为6个字节，类型为长整形。</p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"> </p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"><strong style="margin: 0px; padding: 0px;">2）. InnoDB的辅助索引</strong></p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;">       InnoDB的所有辅助索引都引用主键作为data域。例如，下图为定义在Col3上的一个辅助索引：</p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"><img src="http://my.csdn.net/uploads/201208/01/1343758434_9462.png" style="margin: 0px; padding: 0px; border: none; max-width: 800px; height: auto;"></img></p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"> </p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;">    </p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;">       </p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"><strong style="margin: 0px; padding: 0px;">        InnoDB 表是基于<span style="margin: 0px; padding: 0px; color: rgb(255, 0, 0);">聚簇索引</span>建立的</strong><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);">。因此</span><span style="margin: 0px; padding: 0px; color: rgb(34, 34, 34);">InnoDB 的索引能提供一种非常快速的主键查找性能。不过，它的辅助索引（Secondary Index， 也就是非主键索引）也会包含主键列，所以，如果主键定义的比较大，其他索引也将很大。如果想在表上定义 、很多索引，则</span><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; color: rgb(134, 0, 164);">争取尽量把主键定义得小一些</span></strong><span style="margin: 0px; padding: 0px; color: rgb(34, 34, 34);">。InnoDB 不会压缩索引。</span></p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);">      文字符的ASCII码作为比较准则。</span><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);">聚集索引这种实现方式使得按主键的搜索十分高效，但是</span><span style="margin: 0px; padding: 0px; color: rgb(227, 0, 0);">辅助索引搜索需要检索两遍索引：首先检索辅助索引获得主键，然后用主键到主索引中检索获得记录</span><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);">。</span></strong></p><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><div><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);">      不同存储引擎的索引实现方式对于正确使用和优化索引都非常有帮助，例如知道了InnoDB的索引实现后，就很容易明白</span></div><ul><li><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; color: rgb(134, 0, 164);">1、</span></strong><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; color: rgb(134, 0, 164);">为什么不建议使用过长的字段作为主键，因为所有辅助索引都引用主索引，过长的主索引会令辅助索引变得过大。</span></strong><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);">再例如，</span></li><li><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; color: rgb(134, 0, 164);">2、用非单调的字段作为主键在InnoDB中不是个好主意，因为InnoDB数据文件本身是一颗B+Tree，非单调的主键会造成在插入新记录时数据文件为了维持B+Tree的特性而频繁的分裂调整，十分低效，而使用</span><span style="margin: 0px; padding: 0px; color: rgb(227, 0, 0);">自增字段作为主键</span><span style="margin: 0px; padding: 0px; color: rgb(134, 0, 164);">则是一个很好的选择</span></strong><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);">。</span></li></ul></div><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"> </p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"> <strong style="margin: 0px; padding: 0px;">InnoDB索引</strong>和<strong style="margin: 0px; padding: 0px;">MyISAM索引</strong>的区别：</p><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><div>一是主索引的区别，InnoDB的数据文件本身就是索引文件。而MyISAM的索引和数据是分开的。</div></div><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><div>二是辅助索引的区别：InnoDB的辅助索引data域存储相应记录主键的值而不是地址。而MyISAM的辅助索引和主索引没有多大区别，只是主索引要求列值是唯一的。</div></div></div></div></div></span>
</div>
<hr>
<a name="864"/>

<div>
<span><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;"><br/></span></div><div><img src="常见面试基础题_files/Image.png" type="image/png" data-filename="Image.png"/></div><div><span style="font-size: 16px;"><br/></span></div><div><hr/></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">Java内存模型：</span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">主内存</span></div><div><span style="font-size: 16px;">工作内存</span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;">并发编程存在的问题：</span></span></div><ol><li><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;">原子性</span></span></li><li><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;">可见性</span></span></li><li><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;">有序性</span></span></li></ol><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">在JVM内存模型层次上：也存在这三个问题：</span></div><div><span style="font-size: 16px;"><br/></span></div><ol><li><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(227, 0, 0);"><b><span style="font-size: 16px;">原子性：Java内存模型只保证了基本读取和赋值是原子性操作</span></b></span></span></li><li><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(227, 0, 0);"><b><span style="font-size: 16px;">可见性：volatile关键字保证可见性，当一个共享变量被volatile修饰时，它会保证修改的值会立即被更新到主存，当有其他线程需要读取时，它会去内存中读取新值。</span></b></span></span></li><li><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(227, 0, 0);"><b><span style="font-size: 16px;">有序性：在Java里面，可以通过volatile关键字来保证一定的“有序性”（具体原理在下一节讲述）。另外可以通过synchronized和Lock来保证有序性，很显然，synchronized和Lock保证每个时刻是有一个线程执行同步代码，相当于是让线程顺序执行同步代码，自然就保证了有序性。</span></b></span></span></li></ol><div><p style="margin: 10px auto; padding: 0px; text-indent: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198);"><span style="font-size: 16px;">另外，<span style="margin: 0px; padding: 0px; color: rgb(255, 0, 0);">Java内存模型具备一些先天的“有序性”，即不需要通过任何手段就能够得到保证的有序性，这个通常也称为 happens-before 原则。如果两个操作的执行次序无法从happens-before原则推导出来，那么它们就不能保证它们的有序性，虚拟机可以随意地对它们进行重排序。</span></span></p><p style="margin: 10px auto; padding: 0px; text-indent: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198);"><span style="font-size: 16px;">　　下面就来具体介绍下happens-before原则（先行发生原则）：</span></p><ul style="margin: 0px 0px 0px 30px; padding: 0px; word-break: break-all; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198);"><li style="margin: 0px 0px 1em; padding: 0px; list-style: disc; text-align: left;"><span style="font-size: 16px;">程序次序规则：一个线程内，按照代码顺序，书写在前面的操作先行发生于书写在后面的操作</span></li><li style="margin: 0px 0px 1em; padding: 0px; list-style: disc; text-align: left;"><span style="font-size: 16px;">锁定规则：一个unLock操作先行发生于后面对同一个锁额lock操作</span></li><li style="margin: 0px 0px 1em; padding: 0px; list-style: disc; text-align: left;"><span style="font-size: 16px;">volatile变量规则：对一个变量的写操作先行发生于后面对这个变量的读操作</span></li><li style="margin: 0px 0px 1em; padding: 0px; list-style: disc; text-align: left;"><span style="font-size: 16px;">传递规则：如果操作A先行发生于操作B，而操作B又先行发生于操作C，则可以得出操作A先行发生于操作C</span></li><li style="margin: 0px 0px 1em; padding: 0px; list-style: disc; text-align: left;"><span style="font-size: 16px;">线程启动规则：Thread对象的start()方法先行发生于此线程的每个一个动作</span></li><li style="margin: 0px 0px 1em; padding: 0px; list-style: disc; text-align: left;"><span style="font-size: 16px;">线程中断规则：对线程interrupt()方法的调用先行发生于被中断线程的代码检测到中断事件的发生</span></li><li style="margin: 0px 0px 1em; padding: 0px; list-style: disc; text-align: left;"><span style="font-size: 16px;">线程终结规则：线程中所有的操作都先行发生于线程的终止检测，我们可以通过Thread.join()方法结束、Thread.isAlive()的返回值手段检测到线程已经终止执行</span></li><li style="margin: 0px 0px 1em; padding: 0px; list-style: disc; text-align: left;"><span style="font-size: 16px;">对象终结规则：一个对象的初始化完成先行发生于他的finalize()方法的开始</span></li></ul><div style="margin: 0px 0px 1em; padding: 0px; list-style: disc; text-align: left;"><div><span style="font-size: 16px;"><br/></span></div><div><br/></div><div>深入理解volatile关键字：</div><div><br/></div><div><span style="font-size: 16px;"><b>1.volatile关键字的两层语义</b></span></div><div><br/></div><div>　　一旦一个共享变量（类的成员变量、类的静态成员变量）被volatile修饰之后，那么就具备了两层语义：</div><div><br/></div><div>　　<span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><span style="font-size: 16px;"><b>1）保证了不同线程对这个变量进行操作时的可见性，即一个线程修改了某个变量的值，这新值对其他线程来说是立即可见的。</b></span></span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><span style="font-size: 16px;"><b>　　2）禁止进行指令重排序。</b></span></span></span></div><div><br/></div><div><p style="margin: 10px auto; padding: 0px; text-indent: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">先看一段代码，假如线程1先执行，线程2后执行：</p><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;"><div style="margin: 0px; padding: 0px;"><div style="margin: 1em 0px !important; padding: 0px; width: 1195.4px; position: relative !important; overflow: auto !important; font-size: 1em !important; background-color: rgb(255, 255, 255) !important;"><table border="0" cellpadding="0" cellspacing="0" style="margin: 0px !important; padding: 0px !important; border-collapse: collapse; border-spacing: 0px; border-radius: 0px !important; background: none !important; border: 1px solid silver; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; word-break: break-word;width:1195px;"><tbody><tr style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important;"><td style="margin: 0px !important; padding: 3px; border-radius: 0px !important; background: none !important; border: 1px solid silver; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; color: rgb(175, 175, 175) !important; border-collapse: collapse;width:3.430962343096234%;"><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">1</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">2</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">3</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">4</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">5</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">6</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">7</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">8</div></td><td style="margin: 0px !important; padding: 3px; border-radius: 0px !important; background: none !important; border: 1px solid silver; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; border-collapse: collapse;width:96.48535564853556%;"><div style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: relative !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important;"><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 130, 0) !important;">//线程1</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 255) !important;">boolean</code> <code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">stop = </code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 255) !important;">false</code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">;</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 255) !important;">while</code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">(!stop){</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important;">    </code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">doSomething();</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">}</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"> </div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 130, 0) !important;">//线程2</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">stop = </code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 255) !important;">true</code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">;</code></div></div></td></tr></tbody></table></div></div></div><p style="margin: 10px auto; padding: 0px; text-indent: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;"> 　　这段代码是很典型的一段代码，很多人在中断线程时可能都会采用这种标记办法。但是事实上，这段代码会完全运行正确么？即一定会将线程中断么？不一定，也许在大多数时候，这个代码能够把线程中断，但是也有可能会导致无法中断线程（虽然这个可能性很小，但是只要一旦发生这种情况就会造成死循环了）。</p><p style="margin: 10px auto; padding: 0px; text-indent: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">　　下面解释一下这段代码为何有可能导致无法中断线程。在前面已经解释过，每个线程在运行过程中都有自己的工作内存，那么线程1在运行的时候，会将stop变量的值拷贝一份放在自己的工作内存当中。</p><p style="margin: 10px auto; padding: 0px; text-indent: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">　　那么当线程2更改了stop变量的值之后，但是还没来得及写入主存当中，线程2转去做其他事情了，那么线程1由于不知道线程2对stop变量的更改，因此还会一直循环下去。</p><p style="margin: 10px auto; padding: 0px; text-indent: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">　　但是用volatile修饰之后就变得不一样了：</p><p style="margin: 10px auto; padding: 0px; text-indent: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">　　第一：使用volatile关键字会强制将修改的值立即写入主存；</p><p style="margin: 10px auto; padding: 0px; text-indent: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">　　第二：使用volatile关键字的话，当线程2进行修改时，会导致线程1的工作内存中缓存变量stop的缓存行无效（反映到硬件层的话，就是CPU的L1或者L2缓存中对应的缓存行无效）；</p><p style="margin: 10px auto; padding: 0px; text-indent: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">　　第三：由于线程1的工作内存中缓存变量stop的缓存行无效，所以线程1再次读取变量stop的值时会去主存读取。</p><p style="margin: 10px auto; padding: 0px; text-indent: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">　　那么在线程2修改stop值时（当然这里包括2个操作，修改线程2工作内存中的值，然后将修改后的值写入内存），会使得线程1的工作内存中缓存变量stop的缓存行无效，然后线程1读取时，发现自己的缓存行无效，它会等待缓存行对应的主存地址被更新之后，然后去对应的主存读取最新的值。</p><div style="margin: 10px auto; padding: 0px; text-indent: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198);"><div>　　那么线程1读取到的就是最新的正确的值。</div></div></div><div><br/></div><div><br/></div><div><span style="font-size: 16px;"><b>2.volatile保证原子性吗？并不能</b></span></div><div><br/></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b>如何保证原子性呢？</b></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b>sychronized</b></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b>Lock</b></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b>Atomic类 使用CAS操作</b></span></span></div><div><br/></div><div><span style="font-size: 16px;"><b>3.<span style="font-family: Verdana;"> volatile能保证有序性吗？</span></b></span></div><div><b><span style="font-size: 14px;"><span style="font-family: Verdana;"><br/></span></span></b></div><div><b><span style="font-size: 14px;"><span style="font-family: Verdana;">在前面提到volatile关键字能禁止指令重排序，所以volatile能在一定程度上保证有序性。</span></span></b></div><div><b><span style="font-size: 14px;"><span style="font-family: Verdana;"><br/></span></span></b></div><div><b><span style="font-size: 14px;"><span style="font-family: Verdana;">　　volatile关键字禁止指令重排序有两层意思：</span></span></b></div><div><b><span style="font-size: 14px;"><span style="font-family: Verdana;"><br/></span></span></b></div><div><b><span style="font-size: 14px;"><span style="font-family: Verdana;">　　<span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);">1）当程序执行到volatile变量的读操作或者写操作时，在其前面的操作的更改肯定全部已经进行，且结果已经对后面的操作可见；在其后面的操作肯定还没有进行；</span></span></span></span></b></div><div><b><span style="font-size: 14px;"><span style="font-family: Verdana;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);">　　2）在进行指令优化时，不能将在对volatile变量访问的语句放在其后面执行，也不能把volatile变量后面的语句放到其前面执行</span></span>。</span></span></b></div><div><b><span style="font-size: 14px;"><span style="font-family: Verdana;"><br/></span></span></b></div><div><p style="margin: 10px auto; padding: 0px; text-indent: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">可能上面说的比较绕，举个简单的例子：</p><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;"><div style="margin: 0px; padding: 0px;"><div style="margin: 1em 0px !important; padding: 0px; width: 1195.4px; position: relative !important; overflow: auto !important; font-size: 1em !important; background-color: rgb(255, 255, 255) !important;"><table border="0" cellpadding="0" cellspacing="0" style="margin: 0px !important; padding: 0px !important; border-collapse: collapse; border-spacing: 0px; border-radius: 0px !important; background: none !important; border: 1px solid silver; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; word-break: break-word;width:1195px;"><tr style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important;"><td style="margin: 0px !important; padding: 3px; border-radius: 0px !important; background: none !important; border: 1px solid silver; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; color: rgb(175, 175, 175) !important; border-collapse: collapse;width:3.5146443514644354%;"><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">1</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">2</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">3</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">4</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">5</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">6</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">7</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">8</div></td><td style="margin: 0px !important; padding: 3px; border-radius: 0px !important; background: none !important; border: 1px solid silver; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; border-collapse: collapse;width:96.40167364016736%;"><div style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: relative !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important;"><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 130, 0) !important;">//x、y为非volatile变量</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 130, 0) !important;">//flag为volatile变量</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"> </div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">x = </code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 153, 0) !important;">2</code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">;        </code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 130, 0) !important;">//语句1</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">y = </code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 153, 0) !important;">0</code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">;        </code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 130, 0) !important;">//语句2</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">flag = </code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 255) !important;">true</code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">;  </code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 130, 0) !important;">//语句3</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">x = </code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 153, 0) !important;">4</code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">;         </code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 130, 0) !important;">//语句4</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">y = -</code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 153, 0) !important;">1</code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">;       </code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 130, 0) !important;">//语句5</code></div></div></td></tr></table></div></div></div><p style="margin: 10px auto; padding: 0px; text-indent: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;"> 　　由于flag变量为volatile变量，那么在进行指令重排序的过程的时候，不会将语句3放到语句1、语句2前面，也不会讲语句3放到语句4、语句5后面。但是要注意语句1和语句2的顺序、语句4和语句5的顺序是不作任何保证的。</p><p style="margin: 10px auto; padding: 0px; text-indent: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">　　并且volatile关键字能保证，执行到语句3时，语句1和语句2必定是执行完毕了的，且语句1和语句2的执行结果对语句3、语句4、语句5是可见的。</p><p style="margin: 10px auto; padding: 0px; text-indent: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">　　那么我们回到前面举的一个例子：</p><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;"><div style="margin: 0px; padding: 0px;"><div style="margin: 1em 0px !important; padding: 0px; width: 1195.4px; position: relative !important; overflow: auto !important; font-size: 1em !important; background-color: rgb(255, 255, 255) !important;"><table border="0" cellpadding="0" cellspacing="0" style="margin: 0px !important; padding: 0px !important; border-collapse: collapse; border-spacing: 0px; border-radius: 0px !important; background: none !important; border: 1px solid silver; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; word-break: break-word;width:1195px;"><tr style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important;"><td style="margin: 0px !important; padding: 3px; border-radius: 0px !important; background: none !important; border: 1px solid silver; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; color: rgb(175, 175, 175) !important; border-collapse: collapse;width:3.430962343096234%;"><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">1</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">2</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">3</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">4</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">5</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">6</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">7</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">8</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">9</div></td><td style="margin: 0px !important; padding: 3px; border-radius: 0px !important; background: none !important; border: 1px solid silver; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; border-collapse: collapse;width:96.48535564853556%;"><div style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: relative !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important;"><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 130, 0) !important;">//线程1:</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">context = loadContext();   </code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 130, 0) !important;">//语句1</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">inited = </code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 255) !important;">true</code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">;             </code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 130, 0) !important;">//语句2</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"> </div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 130, 0) !important;">//线程2:</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 255) !important;">while</code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">(!inited ){</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important;">  </code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">sleep()</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">}</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">doSomethingwithconfig(context);</code></div></div></td></tr></table></div></div></div><p style="margin: 10px auto; padding: 0px; text-indent: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;"> 　　前面举这个例子的时候，提到有可能语句2会在语句1之前执行，那么久可能导致context还没被初始化，而线程2中就使用未初始化的context去进行操作，导致程序出错。</p><div style="margin: 10px auto; padding: 0px; text-indent: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198);"><div>　　这里如果用volatile关键字对inited变量进行修饰，就不会出现这种问题了，因为当执行到语句2时，必定能保证context已经初始化完毕。</div></div></div><div><b><span style="font-size: 14px;"><span style="font-family: Verdana;"><br/></span></span></b></div><div><span style="font-size: 16px;"><b><span style="font-family: Verdana;">4.volatile的原理和实现机制</span></b></span></div><div><b><span style="font-size: 16px;"><span style="font-family: Verdana;"><br/></span></span></b></div><div><span style="font-size: 16px;"><span style="font-family: Verdana;">前面讲述了源于volatile关键字的一些使用，下面我们来探讨一下volatile到底如何保证可见性和禁止指令重排序的。</span></span></div><div><span style="font-size: 16px;"><span style="font-family: Verdana;">　　下面这段话摘自《深入理解Java虚拟机》：</span></span></div><div><span style="font-size: 16px;"><span style="font-family: Verdana;"><br/></span></span></div><div><b><span style="font-size: 16px;"><span style="font-family: Verdana;">　　<span style="color: rgb(255, 0, 0);">“观察加入volatile关键字和没有加入volatile关键字时所生成的汇编代码发现，加入volatile关键字时，会多出一个lock前缀指令”</span></span></span></b></div><div><span style="color: rgb(255, 0, 0);"><b><span style="font-size: 16px;"><span style="font-family: Verdana;">　　lock前缀指令实际上相当于一个内存屏障（也成内存栅栏），内存屏障会提供3个功能：</span></span></b></span></div><div><b><span style="font-size: 16px;"><span style="font-family: Verdana;">　　</span></span></b></div><div><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 16px;"><span style="font-family: Verdana;">        1）它确保指令重排序时不会把其后面的指令排到内存屏障之前的位置，也不会把前面的指令排到内存屏障的后面；即在执行到内存屏障这句指令时，在它前面的操作已经全部完成；</span></span></b></span></span></div><div><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 16px;"><span style="font-family: Verdana;">　　2）它会强制将对缓存的修改操作立即写入主存；</span></span></b></span></span></div><div><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 16px;"><span style="font-family: Verdana;">　　3）如果是写操作，它会导致其他CPU中对应的缓存行无效。</span></span></b></span></span></div><div><b><span style="font-size: 14px;"><span style="font-family: Verdana;"><br/></span></span></b></div><div>摘自：<a href="http://www.cnblogs.com/dolphin0520/p/3920373.html">http://www.cnblogs.com/dolphin0520/p/3920373.html</a></div><div><b><span style="font-size: 14px;"><span style="font-family: Verdana;"><br/></span></span></b></div></div></div></span>
</div>
<hr>
<a name="870"/>

<div>
<span><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 19px;"><b>Java7：采用分段锁+不可变Entry+volatile的方式</b></span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 19px;"><b>Java8： 摒弃分段锁，采用CAS+volatile+链表转红黑树方式</b></span></span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">size的计算采用类似LongAdder的CounterCell，一个并发累加器，这个是分段锁的思想。多个CounterCell，最后累加。</span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">put方法：采用每个桶的第一个节点作为整个桶内节点的锁：</span></div><div><span style="font-size: 16px;">当桶空的时候，采用CAS插入节点，非空的时候，申请封锁桶内的first节点，然后进行相关操作。</span></div><div><br/></div><div><span style="font-size: 16px;">get方法：是不加锁的，因为Node节点的next是volatile的，因此可以保证内存可见性和同步性。（回忆一下volatile关键字）</span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">resize方法 实际上是transfer方法，当put方法需要增加一个节点的时候，如果增加到桶上的节点数量少于2，那ok，不需要计算size来和阈值比较，不考虑扩容。如果大于等于2那么计算size并考虑扩容。</span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">扩容发生的时候，主要是transfer方法完成，可以有多个线程帮助transfer（会根据CPU的数量调整每个线程的transfer的index范围）。由于桶的容量扩容必须为2倍，因此旧桶上的链表在会根据与hash&amp;n是否等于0而被分为成两条链表</span></div><div><span style="font-size: 16px;">一条ln另有一条hn，lh在新表的位置保持不变，hn则是偏移n。</span></div><div><br/></div><div><br/></div></span>
</div>
<hr>
<a name="872"/>

<div>
<span><div>TCP报文结构：</div><div><br/></div><div><img src="常见面试基础题_files/Image [1].png" type="image/png" data-filename="Image.png" style="height: auto;" title="Attachment"/><br/></div><div><br/></div><div><span style="font-size: 19px;">TCP报文根据标志位来区分报文的意图；比如 连接报文、连接确认报文、请求断开报文等等；</span></div><div><span style="font-size: 19px;">标志位常见的有：</span></div><div><span style="font-size: 19px;"><span style="font-size: 19px; font-weight: bold;">SYN</span></span></div><div><span style="font-size: 19px;"><span style="font-size: 19px; font-weight: bold;">ACK</span></span></div><div><span style="font-size: 19px;"><span style="font-size: 19px; font-weight: bold;">FIN</span></span></div><div>PSH</div><div>RST</div><div><br/></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 19px; background-color: rgb(255, 250, 165); font-weight: bold;-evernote-highlight:true;">TCP通信分为三个阶段：</span></span></div><ol><li><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 19px; background-color: rgb(255, 250, 165); font-weight: bold;-evernote-highlight:true;">连接建立</span></span></div></li><li><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 19px; background-color: rgb(255, 250, 165); font-weight: bold;-evernote-highlight:true;">数据传输</span></span></div></li><li><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 19px; background-color: rgb(255, 250, 165); font-weight: bold;-evernote-highlight:true;">连接断开</span></span></div></li></ol><div><br/></div><div>而三次握手是发生在阶段1：</div><div>具体包含哪三次握手呢？</div><div><br/></div><ul><li><div><span style="font-size: 21px;"><span style="font-size: 21px; font-weight: bold;">三次握手</span></span></div></li></ul><div><br/></div><div>第一次握手：主机A发送一个TCP连接请求报文（seq=x, SYN=1），进入 SYN_SEND状态</div><div>第二次握手：主机B接收到A的TCP连接请求报文，发送一个TCP连接确认报文（seq = y, ack=x+1,SYN=1, ACK=1） B进入SYN_RECV状态</div><div>第三次握手：主机A发送一个TCP确认报文（seq = x+1, ack = y+1, ACK=1）A发送便进入ESTABLISHED状态，B收到该报文后也进入ESTABLISHED状态</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>见如下图：</div><div><img src="常见面试基础题_files/Image [2].png" type="image/png" data-filename="Image.png" style="height: auto;" title="Attachment"/><br/></div><div><br/></div><div><br/></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><span style="background-color: rgb(255, 250, 165); font-size: 16px; font-weight: bold;-evernote-highlight:true;">注意区分ack和ACK不是一回事；ack是序号，ACK是标志位</span></span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><span style="background-color: rgb(255, 250, 165); font-size: 16px; font-weight: bold;-evernote-highlight:true;">ack是将当前收到的报文的seq加1；（也就是说希望下一次接受到seq号）</span></span></span></div><div><br/></div><div>ack：确认序号；</div><div>seq：发送序号；</div><div><br/></div><div>为什么是三次握手，因为两次会出现下面的问题，而四次有点多余。</div><div><br/></div><div><span style="font-size: 16px;"><span style="letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); float: none; font-size: 16px; color: rgb(0, 0, 0); font-family: verdana, &quot;ms song&quot;, 宋体, Arial, 微软雅黑, Helvetica, sans-serif; font-style: normal; font-weight: 400;">谢希仁版《计算机网络》中的例子是这样的，已失效的连接请求报文段的产生在这样一种情况下：client发出的第一个连接请求报文段并没有丢失，而是在某个网络结点长时间的滞留了，以致延误到连接释放以后的某个时间才到达server。本来这是一个早已失效的报文段。但server收到此失效的连接请求报文段后，就误认为是client再次发出的一个新的连接请求。于是就向client发出确认报文段，同意建立连接。假设不采用三次握手，那么只要server发出确认，新的连接就建立了。由于现在client并没有发出建立连接的请求，因此不会理睬server的确认，也不会向server发送数据。但server却以为新的运输连接已经建立，并一直等待client发来数据。这样，server的很多资源就白白浪费掉了。采用三次握手的办法可以防止上述现象发生。例如刚才那种情况，client不会向server的确认发出确认。server由于收不到确认，就知道client并没有要求建立连接。</span></span></div><div><br/></div><ul><li><div><span style="font-size: 21px;"><span style="font-size: 21px; font-weight: bold;">四次挥手</span></span></div></li></ul><div><br/></div><div><img src="常见面试基础题_files/Image [3].png" type="image/png" data-filename="Image.png" style="height: auto;" title="Attachment"/><br/></div><div><br/></div><div><br/></div><div>四次挥手的过程：</div><div><br/></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><span style="background-color: rgb(255, 250, 165); font-size: 16px; font-weight: bold;-evernote-highlight:true;">第一次：主机A发送一个TCP请求关闭的报文（FIN=1, seq = u），随后A进入FIN-WAIT-1状态，</span></span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><span style="background-color: rgb(255, 250, 165); font-size: 16px; font-weight: bold;-evernote-highlight:true;">第二次：主机B收到该报文后，会对该报文进行一次确认，发送一个确认报文（seq=v, ack=u+1, ACK=1），随机进入CLOSE-WAIT状态；由于主机B可能还有数据</span></span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><span style="background-color: rgb(255, 250, 165); font-size: 16px; font-weight: bold;-evernote-highlight:true;">没有发送完，随后B就发送主机的数据；主机A收到TCP请求关闭确认报文后，进入FIN-WAIT-2状态</span></span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><span style="background-color: rgb(255, 250, 165); font-size: 16px; font-weight: bold;-evernote-highlight:true;">第三次：主机B数据发送完毕后，发送一个TCP请求关闭确认报文（FIN=1, ACK=1, ack=u+1, seq = w），随机B进入LAST-ACK状态</span></span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><span style="background-color: rgb(255, 250, 165); font-size: 16px; font-weight: bold;-evernote-highlight:true;">第四次：A收到报文后，发送一个确认报文(ACK=1, seq=u+1，ack=w+1），随机进入TIME-WAIT状态，随后主机A等待2MSL时间，如果期间主机B没有发来任何报文，进入CLOSED状态；主机B收到确认报文后，进入CLOSED状态；</span></span></span></div><div><br/></div><div style="margin: 10px auto; padding: 0px; text-indent: 0px; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198);"><span style="font-size: 16px; color: rgb(0, 0, 0); font-family: verdana, &quot;ms song&quot;, 宋体, Arial, 微软雅黑, Helvetica, sans-serif; font-style: normal; font-weight: 400;">A为什么等待2MSL，从TIME_WAIT到CLOSE？</span></div><div style="margin: 10px auto; padding: 0px; text-indent: 0px; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198);"><div><span style="font-size: 16px; color: rgb(0, 0, 0); font-family: verdana, &quot;ms song&quot;, 宋体, Arial, 微软雅黑, Helvetica, sans-serif; font-style: normal; font-weight: 400;"> 在Client发送出最后的ACK回复，但该ACK可能丢失。Server如果没有收到ACK，将不断重复发送FIN片段。所以Client不能立即关闭，它必须确认Server接收到了该ACK。Client会在发送出ACK之后进入到TIME_WAIT状态。Client会设置一个计时器，等待2MSL的时间。如果在该时间内再次收到FIN，那么Client会重发ACK并再次等待2MSL。所谓的2MSL是两倍的MSL(Maximum Segment Lifetime)。MSL指一个片段在网络中最大的存活时间，2MSL就是一个发送和一个回复所需的最大时间。如果直到2MSL，Client都没有再次收到FIN，那么Client推断ACK已经被成功接收，则结束TCP连接。</span></div></div><div><br/></div><div><br/></div><div><br/></div><div><hr/></div><div><br/></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><span style="background-color: rgb(255, 250, 165); color: rgb(255, 0, 0); font-size: 16px; font-weight: bold;-evernote-highlight:true;">TCP流量控制机制</span></span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><span style="background-color: rgb(255, 250, 165); color: rgb(255, 0, 0); font-size: 16px; font-weight: bold;-evernote-highlight:true;">滑动窗口</span></span></span></div><div><ul><li><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><span style="background-color: rgb(255, 250, 165); color: rgb(255, 0, 0); font-size: 16px; font-weight: bold;-evernote-highlight:true;">接收端的接收窗口</span></span></span></div></li><li><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><span style="background-color: rgb(255, 250, 165); color: rgb(255, 0, 0); font-size: 16px; font-weight: bold;-evernote-highlight:true;">发送端的发送端口</span></span></span></div></li></ul><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><span style="background-color: rgb(255, 250, 165); color: rgb(255, 0, 0); font-size: 16px; font-weight: bold;-evernote-highlight:true;">接收端返回的ACK包里面含有自己的窗口大小，因此发送端会根据接受端的窗口大小和ack包的ack号来决定当前的数据是否发送。</span></span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><span style="background-color: rgb(255, 250, 165); color: rgb(255, 0, 0); font-size: 16px; font-weight: bold;-evernote-highlight:true;">从而达到流量控制的目的。</span></span></span></div><div><br/></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><span style="background-color: rgb(255, 250, 165); color: rgb(255, 0, 0); font-size: 16px; font-weight: bold;-evernote-highlight:true;">TCP拥塞控制</span></span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><span style="background-color: rgb(255, 250, 165); color: rgb(255, 0, 0); font-size: 16px; font-weight: bold;-evernote-highlight:true;">拥塞窗口 cwnd</span></span></span></div><div><br/></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><span style="background-color: rgb(255, 250, 165); color: rgb(255, 0, 0); font-size: 16px; font-weight: bold;-evernote-highlight:true;">几种机制</span></span></span></div><div><ul><li><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><span style="background-color: rgb(255, 250, 165); color: rgb(255, 0, 0); font-size: 16px; font-weight: bold;-evernote-highlight:true;">慢启动：cwnd先是double增加，超过阈值ssthresh后，cwnd开始缓慢增加，进入拥塞控制算法，发现拥塞时，阈值降为一半，cwnd=1，启用慢启动算法。</span></span></span></div></li><li><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><span style="background-color: rgb(255, 250, 165); color: rgb(255, 0, 0); font-size: 16px; font-weight: bold;-evernote-highlight:true;">拥塞避免：</span></span></span></div></li><li><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><span style="background-color: rgb(255, 250, 165); color: rgb(255, 0, 0); font-size: 16px; font-weight: bold;-evernote-highlight:true;">快重传：当接受方收到乱序的报文时，立刻对前面收到的正确的最后一个报文进行重复确认，发送方收到连续三个同样的ack后，不用等到重传倒计时timeout，直接快速重新传送丢失的报文。</span></span></span></div></li></ul><div><br/></div><div><br/></div></div></div><div><img src="常见面试基础题_files/ink-image.png" type="image/png" data-filename="ink-image.png" title="Attachment" width="750"/><br/></div><div><br/></div></span>
</div>
<hr>
<a name="880"/>

<div>
<span><div>一：AOP的概念</div><div><br/></div><div>AOP全称 Aspect Oriented Programming 面向切面编程，是一种新的编程范式，实际的使用是作为OO编程的一种补充。</div><div>AOP通过分离交叉的关注点（cross-cutting concerns）来增加程序的模块化程度。</div><div>AOP为原有的代码增加一些行为（Advice），AOP并不不修改原有代码本身，而是通过声明切入点（PointCut）来指明哪些代码需要被增加新的行为。</div><div>例如，在所有函数名以set开头的方法调用的前都要执行log操作。</div><div>这里“以set开头的函数”是切入点（Point Cut），它指明或限定了哪些代码需要需要增加新行为，而“log操作”则是增加的新行为（Advice）。</div><div><br/></div><div>AOP编程范式将程序逻辑拆分成不同的部分（关注点Concern），几乎所有的编程方式都支持不同程度对关注点封装成不同的抽象的实体（例如函数，过程，模块，类和方法等），这些不同的实体能够通过组合来完成具体的功能。然而，不同的抽象实体包含的关注点可能是互相有交叉和重复。这些跨多个抽象实体的关注点被称为cross-cutting concerns或者horizontal concern，常用来举例的便是日志功能这个关注点，在典型的三层架构中，它既存在于Web层，也存在于Business层和Data层，显然这个不能再按照垂直方向进行划分了，而是一个水平方向上的关注点。这个就叫做cross-cutting concerns（横切关注点），就比较适合采用AOP来实现。</div><div><br/></div><div><br/></div><div>这个允许一些共性的代码或者功能能够在不修改源代码的情况下，被增加到现有的代码中，做到非侵入式修改代码。</div><div><br/></div><div>AOP编程的概念（术语）：</div><div><br/></div><div>Cross-cutting concern:（横切关注点）</div><div><br/></div><div>Advice</div><div><br/></div><div>需要被如的额外的代码，例如实现log的代码；</div><div><br/></div><div>Pointcut（切入点）</div><div>指明了程序中的横切关注点需要被应用到哪些地方。（或者是说从哪儿开始切，切成横切关注点，相当于在定义横切关注点的位置）。</div><div>例如：“所有已set开头的方法”，“所有xxxUserName的方法”等等，都在指定Pointcut；</div><div><br/></div><div>Aspect（方面）</div><div>PonitCut和Advice组合构成了一个Aspect。例如我们通过定义了一个Ponitcut和一个正确的advice，为我们的程序增加了一个log aspect。</div><div><br/></div><div><br/></div><div>Joinpoint（连接点）</div><div><br/></div><div>Aspect在应用程序执行时加入业务流程的点或时机称之为Joinpoint，具体来说，就是Advice在应用程序中被呼叫执行的时机，这个时机可能是某个方法被呼叫之前或之后（或两者都有），或是某个例外发生的时候。</div><div>例如：在xxxUserName方法之前或者之后（亦或者两者均可）执行。这种类似的说明便是Jointpoint。</div><div><br/></div><div>Target</div><div>一个Advice被应用的对象或目标对象</div><div><br/></div><div>Weave</div><div>Advice被应用至对象之上的过程称之为缝合（Weave），在AOP中缝合的方式有几个时间点：编译时期（Compile time）、类别加载时期（Classload time）、执行时期（Runtime）。</div><div><br/></div><div><br/></div><div><br/></div><div>示例：</div><div><br/></div><div>原来的业务流程划分：</div><div><br/></div><div><br/></div><div><img src="常见面试基础题_files/Image [4].png" type="image/png" data-filename="Image.png" style="height: auto;"/></div><div><br/></div><div><br/></div><div>现在需要加入logging和security等服务，</div><div><br/></div><div><br/></div><div><img src="常见面试基础题_files/Image [5].png" type="image/png" data-filename="Image.png" style="height: auto;"/></div><div><br/></div><div><br/></div><div><br/></div><div><img src="常见面试基础题_files/Image [6].png" type="image/png" data-filename="Image.png" style="height: auto;"/></div><div><br/></div><div>二：Spring中的AOP实现原理</div><div><br/></div><div>5种：</div><div><strong style="border: 0px; margin: 0px; padding: 0px; font-size: 14px; font-weight: bold; color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;, 宋体, &quot;Myriad Pro&quot;, Lato, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">前置增强</strong></div><div><b><span style="font-size: 14px;"><span style="font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif;"><span style="background-color: rgb(193, 230, 198);"><br/></span></span></span></b></div><div><b><span style="font-size: 14px;"><span style="font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif;"><span style="background-color: rgb(193, 230, 198);"><br/></span></span></span></b></div><div><b><span style="font-size: 14px;"><span style="font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif;"><span style="background-color: rgb(193, 230, 198);"><br/></span></span></span></b></div><div><strong style="border: 0px; margin: 0px; padding: 0px; font-size: 14px; font-weight: bold; color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;, 宋体, &quot;Myriad Pro&quot;, Lato, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">后置增强</strong></div><div><b><span style="font-size: 14px;"><span style="font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif;"><span style="background-color: rgb(193, 230, 198);"><br/></span></span></span></b></div><div><b><span style="font-size: 14px;"><span style="font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif;"><span style="background-color: rgb(193, 230, 198);"><br/></span></span></span></b></div><div><b><span style="font-size: 14px;"><span style="font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif;"><span style="background-color: rgb(193, 230, 198);"><br/></span></span></span></b></div><div><strong style="border: 0px; margin: 0px; padding: 0px; font-size: 14px; font-weight: bold; color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;, 宋体, &quot;Myriad Pro&quot;, Lato, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">环绕增强</strong></div><div><b><span style="font-size: 14px;"><span style="font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif;"><span style="background-color: rgb(193, 230, 198);"><br/></span></span></span></b></div><div><b><span style="font-size: 14px;"><span style="font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif;"><span style="background-color: rgb(193, 230, 198);"><br/></span></span></span></b></div><div><strong style="border: 0px; margin: 0px; padding: 0px; font-size: 14px; font-weight: bold; color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;, 宋体, &quot;Myriad Pro&quot;, Lato, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">抛出增强：</strong></div><div><span style="color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;, 宋体, &quot;Myriad Pro&quot;, Lato, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;">程序报错，抛出异常了，一般的做法是打印到控制台或日志文件中，这样很多地方都得去处理，有没有一个一劳永逸的方法呢？那就是 </span><strong style="border: 0px; margin: 0px; padding: 0px; font-size: 14px; font-weight: bold; color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;, 宋体, &quot;Myriad Pro&quot;, Lato, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">Throws Advice（抛出增强）</strong></div><div><b><span style="font-size: 14px;"><span style="font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif;"><span style="background-color: rgb(193, 230, 198);"><br/></span></span></span></b></div><div><strong style="border: 0px; margin: 0px; padding: 0px; font-size: 14px; font-weight: bold; color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;, 宋体, &quot;Myriad Pro&quot;, Lato, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">引入增强：</strong> <span style="color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;, 宋体, &quot;Myriad Pro&quot;, Lato, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;">以上提到的都是对方法的增强，那能否对类进行增强呢？用 AOP 的行话来讲，对方法的增强叫做 </span><strong style="border: 0px; margin: 0px; padding: 0px; font-size: 14px; font-weight: bold; color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;, 宋体, &quot;Myriad Pro&quot;, Lato, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">Weaving（织入）</strong><span style="color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;, 宋体, &quot;Myriad Pro&quot;, Lato, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;">，而对类的增强叫做 </span><strong style="border: 0px; margin: 0px; padding: 0px; font-size: 14px; font-weight: bold; color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;, 宋体, &quot;Myriad Pro&quot;, Lato, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">Introduction（引入）</strong><span style="color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;, 宋体, &quot;Myriad Pro&quot;, Lato, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;">。而 </span><strong style="border: 0px; margin: 0px; padding: 0px; font-size: 14px; font-weight: bold; color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;, 宋体, &quot;Myriad Pro&quot;, Lato, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">Introduction Advice（引入增强）</strong><span style="color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;, 宋体, &quot;Myriad Pro&quot;, Lato, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;">就是对类的功能增强，它也是 Spring AOP 提供的最后一种增强。</span></div><div><br/></div><div>动态代理：</div><div>- JDK提供的Proxy（只能代理了声明了接口的类）</div><div>- CGLib字节码生成（可以代理没有声明接口的类，可以为任何类做增强）</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div>
<hr>
<a name="882"/>

<div>
<span><div><h2 style="box-sizing: border-box; font-size: 1.75em; position: relative; margin-top: 1rem; margin-bottom: 1rem; font-weight: bold; cursor: text; padding-bottom: 0.3em; border-bottom: 1px solid rgb(238, 238, 238); width: inherit; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">Collections类简介</h2><p style="box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; margin: 0.8em 0px; white-space: normal; width: inherit; position: relative; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">Collections</code>类是java集合框架的一个类，其主要是一些通用的作用于<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">Collection</code>的 算法，如排序，求极值，混淆(shuffle)等。 引用<a href="http://docs.oracle.com/javase/tutorial/collections/algorithms/index.html" style="box-sizing: border-box; cursor: pointer; color: rgb(65, 131, 196);">Java官方文档</a>的介绍</p><blockquote style="box-sizing: border-box; margin: 0.8em 0px; border-left: 4px solid rgb(221, 221, 221); padding: 0px 15px; color: rgb(119, 119, 119); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><p style="box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; margin: 0px; white-space: normal; width: inherit; position: relative;">The polymorphic algorithms described here are pieces of reusable functionality provided by the Java platform. All of them come from the Collections class, and all take the form of static methods whose first argument is the collection on which the operation is to be performed. The great majority of the algorithms provided by the Java platform operate on List instances, but a few of them operate on arbitrary Collection instances.</p></blockquote><p style="box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; margin: 0.8em 0px; white-space: normal; width: inherit; position: relative; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">Collections</code>类的方法都是静态方法，每一种方法都对应一种集合算法的实现，且每一种实现都有两种，一种是适用于实现了<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">RandomAccess</code>接口的集合类（例如<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">ArrayList</code>），另一种是适用于序列存储的，例如（<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">LinkedList</code>）。</p><p style="box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; margin: 0.8em 0px; white-space: normal; width: inherit; position: relative; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">Collections</code>类包含的算法实现大致如下：</p><ul style="box-sizing: border-box; margin: 0.8em 0px; padding-left: 30px; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><li style="box-sizing: border-box; margin: 0px; position: relative;">排序<br style="box-sizing: border-box;"/>
排序采用归并排序，所以排序算法是稳定的，时间复杂度是确定的。</li><li style="box-sizing: border-box; margin: 0px; position: relative;">混淆</li><li style="box-sizing: border-box; margin: 0px; position: relative;">常规的集合数据操作（适用于<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">List</code>） 包括<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">reverse</code>、<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">fill</code>、<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">copy</code>、<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">swap</code>、<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">addAll</code>等</li><li style="box-sizing: border-box; margin: 0px; position: relative;">搜索（适用于<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">List</code>） <code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">binarySearch</code></li><li style="box-sizing: border-box; margin: 0px; position: relative;">极值 求集合的最大元素、最小元素</li></ul><p style="box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; margin: 0.8em 0px; white-space: normal; width: inherit; position: relative; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">Collections</code>中的大多数算法都只是适用于<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">List</code>，接下来讨论的<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">Rotate</code>方法就是只适用于<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">List</code>的。 使用与<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">List</code>的算法主要有：</p><ul style="box-sizing: border-box; margin: 0.8em 0px; padding-left: 30px; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><li style="box-sizing: border-box; margin: 0px; position: relative;">sort</li><li style="box-sizing: border-box; margin: 0px; position: relative;">shuffle</li><li style="box-sizing: border-box; margin: 0px; position: relative;">reverse</li><li style="box-sizing: border-box; margin: 0px; position: relative;">rotate</li><li style="box-sizing: border-box; margin: 0px; position: relative;">swap</li><li style="box-sizing: border-box; margin: 0px; position: relative;">replaceAll</li><li style="box-sizing: border-box; margin: 0px; position: relative;">fill</li><li style="box-sizing: border-box; margin: 0px; position: relative;">copy</li><li style="box-sizing: border-box; margin: 0px; position: relative;">binarySearch</li><li style="box-sizing: border-box; margin: 0px; position: relative;">indexOfSubList</li><li style="box-sizing: border-box; margin: 0px; position: relative;">lastIndexofSubList</li></ul><h2 style="box-sizing: border-box; font-size: 1.75em; position: relative; margin-top: 1rem; margin-bottom: 1rem; font-weight: bold; cursor: text; padding-bottom: 0.3em; border-bottom: 1px solid rgb(238, 238, 238); width: inherit; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><a name="header-n70" style="box-sizing: border-box; cursor: pointer; color: rgb(65, 131, 196);"></a>Rotate方法使用</h2><p style="box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; margin: 0.8em 0px; white-space: normal; width: inherit; position: relative; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">Rotate</code>方法需要一个参数<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">distance</code>，该方法将一个<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">List</code>旋转多少长度为<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">distance</code>。假如有个序列列<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">list</code>是<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">[a,b,c,d]</code>，调用方法<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">Collections.rotate(list, 1)</code>后，得到的<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">list</code>就变为了<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">[d,a,b,c]</code>。 调用此方法后，位置<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">i</code>上的元素将变为位置<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">(i - distance) mod list.size()</code>的元素，<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">0 &lt;= i &lt; list.size()</code>。<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">distance</code>可以为正数、0、负数。正数代表向前（下标值变大的方向）旋转，负数代表向后旋转。调用方法<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">Collections.rotate(list, -1)</code>后，得到的<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">list</code>就变为了<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">[b,c,d,a]</code>。</p><p style="box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; margin: 0.8em 0px; white-space: normal; width: inherit; position: relative; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">这个方法常常和<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">List</code>的<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">subList</code>方法结合使用，用于将一个<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">list</code>的某个或多个元素进行移动，而不破坏其余元素的顺序。例如为了将某个<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">list</code>的位置<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">j</code>的元素向前移动到<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">k</code>的位置。（设移动的距离为<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">d</code>（<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">d &gt;= 0</code>），<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">k = j + d + 1</code>）。</p><pre lang="java" style="box-sizing: border-box; white-space: pre; font-size: 0.9em; display: block; break-inside: avoid; text-align: left; overflow: visible; background-image: ; background-position: var(--code-block-bg-color); background-size: ; background-repeat: var(--code-block-bg-color); background-attachment: ; background-origin: ; background-clip: ; background-color: rgb(248, 248, 248); position: relative !important; border: 1px solid rgb(221, 221, 221); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 8px 1em 6px; margin-bottom: 15px; margin-top: 15px; width: inherit; color: rgb(51, 51, 51); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;">
 
</pre><div style="box-sizing: border-box; height: auto; position: relative; overflow: hidden; text-align: left; top: -1.6em; margin-bottom: -1.6em; width: inherit;"><div style="box-sizing: content-box; overflow: hidden; margin-bottom: -30px; margin-right: -30px; padding-bottom: 30px; padding-right: 30px; height: 23px; outline: none; position: relative; width: inherit;"><div style="box-sizing: border-box; position: relative; width: inherit; margin-left: 0px; margin-bottom: 0px; border-right-width: 30px; padding-right: 0px; padding-bottom: 0px;"><div style="box-sizing: border-box; width: inherit; position: relative; top: 0px;"><div style="box-sizing: border-box; padding: 0px; cursor: text; width: inherit;"><div style="box-sizing: border-box; width: inherit; position: relative; outline: none;"><div style="box-sizing: border-box; position: absolute; width: inherit; height: 0px; overflow: hidden; visibility: hidden;"><pre style="box-sizing: border-box; white-space: pre-wrap; border-radius: 0px; border-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: static; overflow: visible; word-break: normal; padding: 0px 4px; width: inherit;"></pre></div><div style="box-sizing: border-box; width: inherit;"><div style="box-sizing: border-box; width: inherit; position: relative;"><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;"><span style="box-sizing: border-box; color: black;">Collections</span>.<span style="box-sizing: border-box; color: black;">rotate</span>(<span style="box-sizing: border-box; color: black;">list</span>.<span style="box-sizing: border-box; color: black;">subList</span>(<span style="box-sizing: border-box; color: black;">j</span>, <span style="box-sizing: border-box; color: black;">k</span><span style="box-sizing: border-box; color: rgb(152, 26, 26);">+</span><span style="box-sizing: border-box; color: rgb(17, 102, 68);">1</span>), <span style="box-sizing: border-box; color: rgb(152, 26, 26);">-</span><span style="box-sizing: border-box; color: rgb(17, 102, 68);">1</span>);</span></pre></div></div></div></div></div></div></div></div><p style="box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; margin: 0.8em 0px; white-space: normal; width: inherit; position: relative; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">举个栗子，例如<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">[a,b,c,d,e]</code>，将<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">b</code>元素向前移动三个位置</p><pre lang="java" style="box-sizing: border-box; white-space: pre; font-size: 0.9em; display: block; break-inside: avoid; text-align: left; overflow: visible; background-image: ; background-position: var(--code-block-bg-color); background-size: ; background-repeat: var(--code-block-bg-color); background-attachment: ; background-origin: ; background-clip: ; background-color: rgb(248, 248, 248); position: relative !important; border: 1px solid rgb(221, 221, 221); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 8px 1em 6px; margin-bottom: 15px; margin-top: 15px; width: inherit; color: rgb(51, 51, 51); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;">
 
</pre><div style="box-sizing: border-box; height: auto; position: relative; overflow: hidden; text-align: left; top: -1.6em; margin-bottom: -1.6em; width: inherit;"><div style="box-sizing: content-box; overflow: hidden; margin-bottom: -30px; margin-right: -30px; padding-bottom: 30px; padding-right: 30px; height: 23px; outline: none; position: relative; width: inherit;"><div style="box-sizing: border-box; position: relative; width: inherit; margin-left: 0px; margin-bottom: 0px; border-right-width: 30px; padding-right: 0px; padding-bottom: 0px;"><div style="box-sizing: border-box; width: inherit; position: relative; top: 0px;"><div style="box-sizing: border-box; padding: 0px; cursor: text; width: inherit;"><div style="box-sizing: border-box; width: inherit; position: relative; outline: none;"><div style="box-sizing: border-box; position: absolute; width: inherit; height: 0px; overflow: hidden; visibility: hidden;"><pre style="box-sizing: border-box; white-space: pre-wrap; border-radius: 0px; border-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: static; overflow: visible; word-break: normal; padding: 0px 4px; width: inherit;"></pre></div><div style="box-sizing: border-box; width: inherit;"><div style="box-sizing: border-box; width: inherit; position: relative;"><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;"><span style="box-sizing: border-box; color: black;">Collections</span>.<span style="box-sizing: border-box; color: black;">rotate</span>(<span style="box-sizing: border-box; color: black;">list</span>.<span style="box-sizing: border-box; color: black;">subList</span>(<span style="box-sizing: border-box; color: rgb(17, 102, 68);">1</span>, <span style="box-sizing: border-box; color: rgb(17, 102, 68);">5</span>), <span style="box-sizing: border-box; color: rgb(152, 26, 26);">-</span><span style="box-sizing: border-box; color: rgb(17, 102, 68);">1</span>);</span></pre></div></div></div></div></div></div></div></div><p style="box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; margin: 0.8em 0px; white-space: normal; width: inherit; position: relative; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">调用后得到<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">list</code>为<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">[a,c,d,e,b]</code>。</p><h2 style="box-sizing: border-box; font-size: 1.75em; position: relative; margin-top: 1rem; margin-bottom: 1rem; font-weight: bold; cursor: text; padding-bottom: 0.3em; border-bottom: 1px solid rgb(238, 238, 238); width: inherit; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><a name="header-n82" style="box-sizing: border-box; cursor: pointer; color: rgb(65, 131, 196);"></a>Rotate方法源码分析</h2><p style="box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; margin: 0.8em 0px; white-space: normal; width: inherit; position: relative; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">Rotate</code>方法的方法原型为</p><pre lang="java" style="box-sizing: border-box; white-space: pre; font-size: 0.9em; display: block; break-inside: avoid; text-align: left; overflow: visible; background-image: ; background-position: var(--code-block-bg-color); background-size: ; background-repeat: var(--code-block-bg-color); background-attachment: ; background-origin: ; background-clip: ; background-color: rgb(248, 248, 248); position: relative !important; border: 1px solid rgb(221, 221, 221); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 8px 1em 6px; margin-bottom: 15px; margin-top: 15px; width: inherit; color: rgb(51, 51, 51); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;">
 
</pre><div style="box-sizing: border-box; height: auto; position: relative; overflow: hidden; text-align: left; top: -1.6em; margin-bottom: -1.6em; width: inherit;"><div style="box-sizing: content-box; overflow: hidden; margin-bottom: -30px; margin-right: -30px; padding-bottom: 30px; padding-right: 30px; height: 23px; outline: none; position: relative; width: inherit;"><div style="box-sizing: border-box; position: relative; width: inherit; margin-left: 0px; margin-bottom: 0px; border-right-width: 30px; padding-right: 0px; padding-bottom: 0px;"><div style="box-sizing: border-box; width: inherit; position: relative; top: 0px;"><div style="box-sizing: border-box; padding: 0px; cursor: text; width: inherit;"><div style="box-sizing: border-box; width: inherit; position: relative; outline: none;"><div style="box-sizing: border-box; position: absolute; width: inherit; height: 0px; overflow: hidden; visibility: hidden;"><pre style="box-sizing: border-box; white-space: pre-wrap; border-radius: 0px; border-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: static; overflow: visible; word-break: normal; padding: 0px 4px; width: inherit;"></pre></div><div style="box-sizing: border-box; width: inherit;"><div style="box-sizing: border-box; width: inherit; position: relative;"><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;"><span style="box-sizing: border-box; color: rgb(119, 0, 136);">public</span> <span style="box-sizing: border-box; color: rgb(119, 0, 136);">static</span> <span style="box-sizing: border-box; color: rgb(0, 136, 85);">void</span> <span style="box-sizing: border-box; color: rgb(0, 0, 255);">rotate</span>(<span style="box-sizing: border-box; color: black;">List</span><span style="box-sizing: border-box; color: rgb(152, 26, 26);">&lt;?&gt;</span> <span style="box-sizing: border-box; color: black;">list</span>, <span style="box-sizing: border-box; color: rgb(0, 136, 85);">int</span> <span style="box-sizing: border-box; color: black;">distance</span>) </span></pre></div></div></div></div></div></div></div></div><p style="box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; margin: 0.8em 0px; white-space: normal; width: inherit; position: relative; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">Rotate</code>方法有两种实现，一种适用于实现了<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">RandomAccess</code>接口的<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">List</code>（类似数组的随机访问性质）或者<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">size</code>小于阈值的序列存储的<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">List</code>，另一种是<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">size</code>大于阈值的序列存储（通常是指链表的形式存储的）的<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">List</code>。<br style="box-sizing: border-box;"/></p><p style="box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; margin: 0.8em 0px; white-space: normal; width: inherit; position: relative; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">关于该方法的源码为</p><pre lang="java" style="box-sizing: border-box; white-space: pre; font-size: 0.9em; display: block; break-inside: avoid; text-align: left; overflow: visible; background-image: ; background-position: var(--code-block-bg-color); background-size: ; background-repeat: var(--code-block-bg-color); background-attachment: ; background-origin: ; background-clip: ; background-color: rgb(248, 248, 248); position: relative !important; border: 1px solid rgb(221, 221, 221); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 8px 1em 6px; margin-bottom: 15px; margin-top: 15px; width: inherit; color: rgb(51, 51, 51); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;">
 
</pre><div style="box-sizing: border-box; height: auto; position: relative; overflow: hidden; text-align: left; top: -1.6em; margin-bottom: -1.6em; width: inherit;"><div style="box-sizing: content-box; overflow: hidden; margin-bottom: -30px; margin-right: -30px; padding-bottom: 30px; padding-right: 30px; height: 138px; outline: none; position: relative; width: inherit;"><div style="box-sizing: border-box; position: relative; width: inherit; margin-left: 0px; margin-bottom: 0px; border-right-width: 30px; padding-right: 0px; padding-bottom: 0px;"><div style="box-sizing: border-box; width: inherit; position: relative; top: 0px;"><div style="box-sizing: border-box; padding: 0px; cursor: text; width: inherit;"><div style="box-sizing: border-box; width: inherit; position: relative; outline: none;"><div style="box-sizing: border-box; position: absolute; width: inherit; height: 0px; overflow: hidden; visibility: hidden;"><pre style="box-sizing: border-box; white-space: pre-wrap; border-radius: 0px; border-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: static; overflow: visible; word-break: normal; padding: 0px 4px; width: inherit;"></pre></div><div style="box-sizing: border-box; width: inherit;"><div style="box-sizing: border-box; width: inherit; position: relative;"><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">  <span style="box-sizing: border-box; color: rgb(119, 0, 136);">public</span> <span style="box-sizing: border-box; color: rgb(119, 0, 136);">static</span> <span style="box-sizing: border-box; color: rgb(0, 136, 85);">void</span> <span style="box-sizing: border-box; color: rgb(0, 0, 255);">rotate</span>(<span style="box-sizing: border-box; color: black;">List</span><span style="box-sizing: border-box; color: rgb(152, 26, 26);">&lt;?&gt;</span> <span style="box-sizing: border-box; color: black;">list</span>, <span style="box-sizing: border-box; color: rgb(0, 136, 85);">int</span> <span style="box-sizing: border-box; color: black;">distance</span>) {</span></pre></div><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">        <span style="box-sizing: border-box; color: rgb(119, 0, 136);">if</span> (<span style="box-sizing: border-box; color: black;">list</span> <span style="box-sizing: border-box; color: rgb(119, 0, 136);">instanceof</span> <span style="box-sizing: border-box; color: black;">RandomAccess</span> <span style="box-sizing: border-box; color: rgb(152, 26, 26);">||</span> <span style="box-sizing: border-box; color: black;">list</span>.<span style="box-sizing: border-box; color: black;">size</span>() <span style="box-sizing: border-box; color: rgb(152, 26, 26);">&lt;</span> <span style="box-sizing: border-box; color: black;">ROTATE_THRESHOLD</span>)</span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">            <span style="box-sizing: border-box; color: black;">rotate1</span>(<span style="box-sizing: border-box; color: black;">list</span>, <span style="box-sizing: border-box; color: black;">distance</span>);</span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">        <span style="box-sizing: border-box; color: rgb(119, 0, 136);">else</span></span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">            <span style="box-sizing: border-box; color: black;">rotate2</span>(<span style="box-sizing: border-box; color: black;">list</span>, <span style="box-sizing: border-box; color: black;">distance</span>);</span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">    }</span></pre></div></div></div></div></div></div></div><p style="box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; margin: 0.8em 0px; white-space: normal; width: inherit; position: relative; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">其中<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">rotate1</code>对应于第一种的实现，<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">rotate2</code>对应于第二种的实现。<br style="box-sizing: border-box;"/></p><p style="box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; margin: 0.8em 0px; white-space: normal; width: inherit; position: relative; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">对于<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">rotate1</code>的实现具体的做法是，将序列的第一个元素交换至正确的位置<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">i</code>，此时原来在位置<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">i</code>的元素就是一个错误放置的元素<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">displaced</code>，然后计算该元素正确放置的位置<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">i</code>，并将其放置到位置<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">i</code>，此时又得到一个错误放置的元素<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">displaced</code>，重复此过程直到错误放置的元素<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">displaced</code>被放置到了第一个位置。（即<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">i == 0</code>）。</p><pre lang="java" style="box-sizing: border-box; white-space: pre; font-size: 0.9em; display: block; break-inside: unset; text-align: left; overflow: visible; background-image: ; background-position: var(--code-block-bg-color); background-size: ; background-repeat: var(--code-block-bg-color); background-attachment: ; background-origin: ; background-clip: ; background-color: rgb(248, 248, 248); position: relative !important; border: 1px solid rgb(221, 221, 221); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 8px 1em 6px; margin-bottom: 15px; margin-top: 15px; width: inherit; color: rgb(51, 51, 51); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;">
 
</pre><div style="box-sizing: border-box; height: auto; position: relative; overflow: hidden; text-align: left; top: -1.6em; margin-bottom: -1.6em; width: inherit;"><div style="box-sizing: content-box; overflow: hidden; margin-bottom: -30px; margin-right: -30px; padding-bottom: 30px; padding-right: 30px; height: 759px; outline: none; position: relative; width: inherit;"><div style="box-sizing: border-box; position: relative; width: inherit; margin-left: 0px; margin-bottom: 0px; border-right-width: 30px; padding-right: 0px; padding-bottom: 0px;"><div style="box-sizing: border-box; width: inherit; position: relative; top: 0px;"><div style="box-sizing: border-box; padding: 0px; cursor: text; width: inherit;"><div style="box-sizing: border-box; width: inherit; position: relative; outline: none;"><div style="box-sizing: border-box; position: absolute; width: inherit; height: 0px; overflow: hidden; visibility: hidden;"><pre style="box-sizing: border-box; white-space: pre-wrap; border-radius: 0px; border-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: static; overflow: visible; word-break: normal; padding: 0px 4px; width: inherit;"></pre></div><div style="box-sizing: border-box; width: inherit;"><div style="box-sizing: border-box; width: inherit; position: relative;"><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;"><span style="box-sizing: border-box;">​</span></span></pre></div><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">    <span style="box-sizing: border-box; color: rgb(119, 0, 136);">private</span> <span style="box-sizing: border-box; color: rgb(119, 0, 136);">static</span> <span style="box-sizing: border-box; color: rgb(152, 26, 26);">&lt;</span><span style="box-sizing: border-box; color: black;">T</span><span style="box-sizing: border-box; color: rgb(152, 26, 26);">&gt;</span> <span style="box-sizing: border-box; color: rgb(0, 136, 85);">void</span> <span style="box-sizing: border-box; color: rgb(0, 0, 255);">rotate1</span>(<span style="box-sizing: border-box; color: black;">List</span><span style="box-sizing: border-box; color: rgb(152, 26, 26);">&lt;</span><span style="box-sizing: border-box; color: black;">T</span><span style="box-sizing: border-box; color: rgb(152, 26, 26);">&gt;</span> <span style="box-sizing: border-box; color: black;">list</span>, <span style="box-sizing: border-box; color: rgb(0, 136, 85);">int</span> <span style="box-sizing: border-box; color: black;">distance</span>) {</span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">        <span style="box-sizing: border-box; color: rgb(0, 136, 85);">int</span> <span style="box-sizing: border-box; color: black;">size</span> <span style="box-sizing: border-box; color: rgb(152, 26, 26);">=</span> <span style="box-sizing: border-box; color: black;">list</span>.<span style="box-sizing: border-box; color: black;">size</span>();</span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">        <span style="box-sizing: border-box; color: rgb(119, 0, 136);">if</span> (<span style="box-sizing: border-box; color: black;">size</span> <span style="box-sizing: border-box; color: rgb(152, 26, 26);">==</span> <span style="box-sizing: border-box; color: rgb(17, 102, 68);">0</span>)</span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">            <span style="box-sizing: border-box; color: rgb(119, 0, 136);">return</span>;</span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">        <span style="box-sizing: border-box; color: black;">distance</span> <span style="box-sizing: border-box; color: rgb(152, 26, 26);">=</span> <span style="box-sizing: border-box; color: black;">distance</span> <span style="box-sizing: border-box; color: rgb(152, 26, 26);">%</span> <span style="box-sizing: border-box; color: black;">size</span>;</span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">        <span style="box-sizing: border-box; color: rgb(119, 0, 136);">if</span> (<span style="box-sizing: border-box; color: black;">distance</span> <span style="box-sizing: border-box; color: rgb(152, 26, 26);">&lt;</span> <span style="box-sizing: border-box; color: rgb(17, 102, 68);">0</span>)</span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">            <span style="box-sizing: border-box; color: black;">distance</span> <span style="box-sizing: border-box; color: rgb(152, 26, 26);">+=</span> <span style="box-sizing: border-box; color: black;">size</span>;<span style="box-sizing: border-box; color: rgb(170, 85, 0);">//将distance化为到范围为0到size - 1的区间</span></span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">        <span style="box-sizing: border-box; color: rgb(119, 0, 136);">if</span> (<span style="box-sizing: border-box; color: black;">distance</span> <span style="box-sizing: border-box; color: rgb(152, 26, 26);">==</span> <span style="box-sizing: border-box; color: rgb(17, 102, 68);">0</span>)</span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">            <span style="box-sizing: border-box; color: rgb(119, 0, 136);">return</span>;</span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;"><span style="box-sizing: border-box;">​</span></span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">        <span style="box-sizing: border-box; color: rgb(119, 0, 136);">for</span> (<span style="box-sizing: border-box; color: rgb(0, 136, 85);">int</span> <span style="box-sizing: border-box; color: black;">cycleStart</span> <span style="box-sizing: border-box; color: rgb(152, 26, 26);">=</span> <span style="box-sizing: border-box; color: rgb(17, 102, 68);">0</span>, <span style="box-sizing: border-box; color: black;">nMoved</span> <span style="box-sizing: border-box; color: rgb(152, 26, 26);">=</span> <span style="box-sizing: border-box; color: rgb(17, 102, 68);">0</span>; <span style="box-sizing: border-box; color: black;">nMoved</span> <span style="box-sizing: border-box; color: rgb(152, 26, 26);">!=</span> <span style="box-sizing: border-box; color: black;">size</span>; <span style="box-sizing: border-box; color: black;">cycleStart</span><span style="box-sizing: border-box; color: rgb(152, 26, 26);">++</span>) {</span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">            <span style="box-sizing: border-box; color: black;">T</span> <span style="box-sizing: border-box; color: black;">displaced</span> <span style="box-sizing: border-box; color: rgb(152, 26, 26);">=</span> <span style="box-sizing: border-box; color: black;">list</span>.<span style="box-sizing: border-box; color: black;">get</span>(<span style="box-sizing: border-box; color: black;">cycleStart</span>);</span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">            <span style="box-sizing: border-box; color: rgb(0, 136, 85);">int</span> <span style="box-sizing: border-box; color: black;">i</span> <span style="box-sizing: border-box; color: rgb(152, 26, 26);">=</span> <span style="box-sizing: border-box; color: black;">cycleStart</span>;</span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">            <span style="box-sizing: border-box; color: rgb(170, 85, 0);">//从cycleStart开始，迭代式的将错误放置的元素放置到正确的位置，直到某个元素被放置到了cycleStart</span></span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">            <span style="box-sizing: border-box; color: rgb(170, 85, 0);">//此时，应该结束do...while循环，因为如果继续循环得到的结果就是啥也没干，因为上一轮的循环已经</span></span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">            <span style="box-sizing: border-box; color: rgb(170, 85, 0);">//将此次循环访问到的位置的元素放正确了，此时应该换下一个位置作为起点cycleStart，继续执行直到</span></span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">            <span style="box-sizing: border-box; color: rgb(170, 85, 0);">//被正确放置的元素的个数nMoved达到了size个</span></span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">            <span style="box-sizing: border-box; color: rgb(119, 0, 136);">do</span> {</span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">                <span style="box-sizing: border-box; color: black;">i</span> <span style="box-sizing: border-box; color: rgb(152, 26, 26);">+=</span> <span style="box-sizing: border-box; color: black;">distance</span>;</span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;"><span style="box-sizing: border-box; display: inline-block; font-family: monospace; position: relative;">    </span>             <span style="box-sizing: border-box; color: rgb(170, 85, 0);">//此处i的范围是 0 ~ 2*size</span></span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;"><span style="box-sizing: border-box; display: inline-block; font-family: monospace; position: relative;">    </span>             <span style="box-sizing: border-box; color: rgb(170, 85, 0);">//当i大于size且小于2 * size的时候，此时i= i mod size 等价于 i = i - size</span></span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">                <span style="box-sizing: border-box; color: rgb(119, 0, 136);">if</span> (<span style="box-sizing: border-box; color: black;">i</span> <span style="box-sizing: border-box; color: rgb(152, 26, 26);">&gt;=</span> <span style="box-sizing: border-box; color: black;">size</span>)</span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">                    <span style="box-sizing: border-box; color: black;">i</span> <span style="box-sizing: border-box; color: rgb(152, 26, 26);">-=</span> <span style="box-sizing: border-box; color: black;">size</span>;</span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">                <span style="box-sizing: border-box; color: rgb(170, 85, 0);">//此时i的范围为0 ~ size - 1</span></span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">                <span style="box-sizing: border-box; color: black;">displaced</span> <span style="box-sizing: border-box; color: rgb(152, 26, 26);">=</span> <span style="box-sizing: border-box; color: black;">list</span>.<span style="box-sizing: border-box; color: black;">set</span>(<span style="box-sizing: border-box; color: black;">i</span>, <span style="box-sizing: border-box; color: black;">displaced</span>);</span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">                <span style="box-sizing: border-box; color: black;">nMoved</span> <span style="box-sizing: border-box; color: rgb(152, 26, 26);">++</span>;<span style="box-sizing: border-box; color: rgb(170, 85, 0);">//记录已经被正确放置的元素的个数</span></span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">            } <span style="box-sizing: border-box; color: rgb(119, 0, 136);">while</span> (<span style="box-sizing: border-box; color: black;">i</span> <span style="box-sizing: border-box; color: rgb(152, 26, 26);">!=</span> <span style="box-sizing: border-box; color: black;">cycleStart</span>);<span style="box-sizing: border-box; color: rgb(170, 85, 0);">//当i回到起点后，退出本次循环</span></span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">        }</span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">    }</span></pre></div></div></div></div></div></div></div><p style="box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; margin: 0.8em 0px; white-space: normal; width: inherit; position: relative; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">对于<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">rotate2</code>的实现与上面的实现完全不一样，因为考虑到<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">rotate2</code>适用于的是类似于采用链表存储的<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">List</code>，因此不具有随机访问的特性。因此该实现采用的是将原<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">list</code>在<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">-distance mod size</code>处使用<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">subList</code>方法拆分为两个子列表<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">s1</code>，<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">s2</code>，并分别反转俩链表<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">revese(s1)</code>，<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">reverse(s2)</code>，最后再将整个链表反转，<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">reverse(list)</code>。</p><pre lang="java" style="box-sizing: border-box; white-space: pre; font-size: 0.9em; display: block; break-inside: unset; text-align: left; overflow: visible; background-image: ; background-position: var(--code-block-bg-color); background-size: ; background-repeat: var(--code-block-bg-color); background-attachment: ; background-origin: ; background-clip: ; background-color: rgb(248, 248, 248); position: relative !important; border: 1px solid rgb(221, 221, 221); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 8px 1em 6px; margin-bottom: 15px; margin-top: 15px; width: inherit; color: rgb(51, 51, 51); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;">
 
</pre><div style="box-sizing: border-box; height: auto; position: relative; overflow: hidden; text-align: left; top: -1.6em; margin-bottom: -1.6em; width: inherit;"><div style="box-sizing: content-box; overflow: hidden; margin-bottom: -30px; margin-right: -30px; padding-bottom: 30px; padding-right: 30px; height: 345px; outline: none; position: relative; width: inherit;"><div style="box-sizing: border-box; position: relative; width: inherit; margin-left: 0px; margin-bottom: 0px; border-right-width: 30px; padding-right: 0px; padding-bottom: 0px;"><div style="box-sizing: border-box; width: inherit; position: relative; top: 0px;"><div style="box-sizing: border-box; padding: 0px; cursor: text; width: inherit;"><div style="box-sizing: border-box; width: inherit; position: relative; outline: none;"><div style="box-sizing: border-box; position: absolute; width: inherit; height: 0px; overflow: hidden; visibility: hidden;"><pre style="box-sizing: border-box; white-space: pre-wrap; border-radius: 0px; border-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: static; overflow: visible; word-break: normal; padding: 0px 4px; width: inherit;"></pre></div><div style="box-sizing: border-box; width: inherit;"><div style="box-sizing: border-box; width: inherit; position: relative;"><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">    <span style="box-sizing: border-box; color: rgb(119, 0, 136);">private</span> <span style="box-sizing: border-box; color: rgb(119, 0, 136);">static</span> <span style="box-sizing: border-box; color: rgb(0, 136, 85);">void</span> <span style="box-sizing: border-box; color: rgb(0, 0, 255);">rotate2</span>(<span style="box-sizing: border-box; color: black;">List</span><span style="box-sizing: border-box; color: rgb(152, 26, 26);">&lt;?&gt;</span> <span style="box-sizing: border-box; color: black;">list</span>, <span style="box-sizing: border-box; color: rgb(0, 136, 85);">int</span> <span style="box-sizing: border-box; color: black;">distance</span>) {</span></pre></div><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">        <span style="box-sizing: border-box; color: rgb(0, 136, 85);">int</span> <span style="box-sizing: border-box; color: black;">size</span> <span style="box-sizing: border-box; color: rgb(152, 26, 26);">=</span> <span style="box-sizing: border-box; color: black;">list</span>.<span style="box-sizing: border-box; color: black;">size</span>();</span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">        <span style="box-sizing: border-box; color: rgb(119, 0, 136);">if</span> (<span style="box-sizing: border-box; color: black;">size</span> <span style="box-sizing: border-box; color: rgb(152, 26, 26);">==</span> <span style="box-sizing: border-box; color: rgb(17, 102, 68);">0</span>)</span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">            <span style="box-sizing: border-box; color: rgb(119, 0, 136);">return</span>;</span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">        <span style="box-sizing: border-box; color: rgb(0, 136, 85);">int</span> <span style="box-sizing: border-box; color: black;">mid</span> <span style="box-sizing: border-box; color: rgb(152, 26, 26);">=</span>  <span style="box-sizing: border-box; color: rgb(152, 26, 26);">-</span><span style="box-sizing: border-box; color: black;">distance</span> <span style="box-sizing: border-box; color: rgb(152, 26, 26);">%</span> <span style="box-sizing: border-box; color: black;">size</span>;</span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">        <span style="box-sizing: border-box; color: rgb(119, 0, 136);">if</span> (<span style="box-sizing: border-box; color: black;">mid</span> <span style="box-sizing: border-box; color: rgb(152, 26, 26);">&lt;</span> <span style="box-sizing: border-box; color: rgb(17, 102, 68);">0</span>)</span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">            <span style="box-sizing: border-box; color: black;">mid</span> <span style="box-sizing: border-box; color: rgb(152, 26, 26);">+=</span> <span style="box-sizing: border-box; color: black;">size</span>;<span style="box-sizing: border-box; color: rgb(170, 85, 0);">//确保mid位于0 ~ size的区间</span></span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">        <span style="box-sizing: border-box; color: rgb(119, 0, 136);">if</span> (<span style="box-sizing: border-box; color: black;">mid</span> <span style="box-sizing: border-box; color: rgb(152, 26, 26);">==</span> <span style="box-sizing: border-box; color: rgb(17, 102, 68);">0</span>)</span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">            <span style="box-sizing: border-box; color: rgb(119, 0, 136);">return</span>;</span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;"><span style="box-sizing: border-box; display: inline-block; font-family: monospace; position: relative;">    </span><span style="box-sizing: border-box; display: inline-block; font-family: monospace; position: relative;">    </span><span style="box-sizing: border-box; color: rgb(170, 85, 0);">//分别反转两个子链表</span></span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">        <span style="box-sizing: border-box; color: black;">reverse</span>(<span style="box-sizing: border-box; color: black;">list</span>.<span style="box-sizing: border-box; color: black;">subList</span>(<span style="box-sizing: border-box; color: rgb(17, 102, 68);">0</span>, <span style="box-sizing: border-box; color: black;">mid</span>));</span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">        <span style="box-sizing: border-box; color: black;">reverse</span>(<span style="box-sizing: border-box; color: black;">list</span>.<span style="box-sizing: border-box; color: black;">subList</span>(<span style="box-sizing: border-box; color: black;">mid</span>, <span style="box-sizing: border-box; color: black;">size</span>));</span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">        <span style="box-sizing: border-box; color: rgb(170, 85, 0);">//最后反转整个链表 两次反转确保俩子链表的元素的的相对位置不变</span></span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">        <span style="box-sizing: border-box; color: black;">reverse</span>(<span style="box-sizing: border-box; color: black;">list</span>);</span></pre><pre style="box-sizing: border-box; white-space: pre-wrap; break-inside: avoid; border-radius: 0px; border-top-width: 0px; border-right: none; border-bottom-width: 0px; border-left-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; word-wrap: break-word; color: inherit; z-index: 2; position: relative; overflow: visible; word-break: normal; width: inherit; padding: 0px 4px;"><span style="box-sizing: border-box; padding-right: 0.1px;">    }</span></pre></div></div></div></div></div></div></div><p style="box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; margin: 0.8em 0px; white-space: normal; width: inherit; position: relative; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><img src="常见面试基础题_files/Image.jpg" type="image/jpeg" data-filename="Image.jpg" alt="示意图" style="box-sizing: border-box; max-width: 100%; vertical-align: middle;"/><br style="box-sizing: border-box;"/></p><p style="box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; margin: 0.8em 0px; white-space: normal; width: inherit; position: relative; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">示意图中<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">(1) (2) (3)</code>分别对应三次链表反转。由示意图中大致可以看出，前两次反转子链表的目的是为了将原链表的首末连在一起，并将<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">mid</code>指向的的元素和其逆时针方向的旁边的元素断开。最后整个链表的反转是为了恢复俩子链表的元素的原始相对顺序。</p><p style="box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; margin: 0.8em 0px; white-space: normal; width: inherit; position: relative; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">链表的反转通常采用<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">头插法</code>反转。</p><h2 style="box-sizing: border-box; font-size: 1.75em; position: relative; margin-top: 1rem; margin-bottom: 1rem; font-weight: bold; cursor: text; padding-bottom: 0.3em; border-bottom: 1px solid rgb(238, 238, 238); width: inherit; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><a name="header-n105" style="box-sizing: border-box; cursor: pointer; color: rgb(65, 131, 196);"></a>小结</h2><div style="box-sizing: border-box; margin: 0.8em 0px 0px; padding-left: 30px; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><div style="box-sizing: border-box; margin: 0px; position: relative;"><code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">rotate</code>方法是将链表旋转一定的<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">distance</code>，该方法常常与<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">subList</code>方法结合用户在<code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">List</code>中移动某个元素到指定的位置，而不影响其他元素的顺序</div><div style="box-sizing: border-box; margin: 0px; position: relative;"><code style="box-sizing: border-box; text-align: left; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, &quot;Liberation Mono&quot;, Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em;">rotate</code>有两种实现，一种针对于随机存取的，另一种针对链表式存取的。</div><div style="box-sizing: border-box; margin: 0px; position: relative;">两种实现的思想也不一样，一种是通过迭代式的交换，另一种是通过链表的反转实现的。</div></div></div></span>
</div>
<hr>
<a name="886"/>

<div>
<span><a href="常见面试基础题_files/虚拟IP与ARP协议.md"><img src="常见面试基础题_files/105ec51c83c0592937861877b46a8f1f.png" alt="虚拟IP与ARP协议.md"></a>
</span>
</div>
<hr>
<a name="889"/>

<div>
<span><div><h1 style="font-size: 22px; margin: 0px; padding: 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; color: rgb(85, 85, 85); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">1. 并发控制和锁</h1><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">在多处理器的时代，程序设计中经常采用多线程以充分利用处理器的性能。在多线程环境下，由于存在共享变量、共享资源等情况，因此有时候需要对多线程的并发访问进行控制。</p><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">同很多并发控制的问题类似（例如数据库的并发控制），程序中的并发控制也会使用到例如加<strong style="font-weight: bold;">悲观锁、乐观锁、多版本视图</strong>等技术来完成并发控制（或者称为多线程同步）。因此谈到并发控制，基本上会涉及到锁的概念，而涉及到锁的问题也基本是属于并发控制问题的范畴。</p><h1 style="font-size: 22px; margin: 0px; padding: 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; color: rgb(85, 85, 85); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><a href="https://spground.github.io/2018/02/03/JAVA%E9%94%81/#2-Java%E4%B8%AD%E7%9A%84%E9%94%81" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="2. Java中的锁"></a>2. Java中的锁</h1><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">Java中涉及到很多锁的概念，而涉及到的使用层次也不同，因此这里做一个简单的总结。</p><ol style="color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><li><p style="margin: 0px 0px 20px;"><strong style="font-weight: bold;">内置锁/隐式锁</strong></p><p style="margin: 0px 0px 20px;">Java的每一个对象都有一个<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">monitor</code>，且这个<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">monitor</code>每一次仅能被一个线程所拥有，这就是内置锁或者叫隐式锁。内置锁的获取、释放通常是如下的范式写的：</p><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; border: none; font-size: 14px; table-layout: fixed;width:468px;"><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;width:7.478632478632479%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/><span style="height: 20px;">2</span><br/><span style="height: 20px;">3</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;width:92.99488210564796%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 421px;"><span style="height: 20px;"><span style="color: rgb(178, 148, 187);">synchronized</span>(obj) {</span><br/><span style="height: 20px;">  <span style="color: rgb(150, 152, 150);">//当线程获取到obj的内置锁--monitor时，线程会进入到此代码块</span></span><br/><span style="height: 20px;">}</span><br/></pre></td></tr></table><p style="margin: 0px 0px 20px;">释放内置锁：</p><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; width: auto; border: none; font-size: 14px; table-layout: fixed;"><tbody><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 304px;"><span style="height: 20px;">obj.wait();<span style="color: rgb(150, 152, 150);">//当前线程放弃obj对象上的内置锁</span></span><br/></pre></td></tr></tbody></table><p style="margin: 0px 0px 20px;">或者退出<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">synchronized</code>代码块，也会自动释放获取的内置锁。</p></li><li><p style="margin: 0px 0px 20px;"><strong style="font-weight: bold;">显式锁</strong></p><p style="margin: 0px 0px 20px;">顾名思义，显式锁是显式定义的锁。例如并发工具包的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Lock</code>接口下的一些实现类。</p><p style="margin: 0px 0px 20px;">内置锁在<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Java</code>的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">synchronized</code>关键字的配合下使用起来十分的简单，但是简答的预定义的东西往往缺乏灵活性，因此为了补充内置锁，显示锁提供了一些额外的特性例如：<strong style="font-weight: bold;">可轮询</strong>、<strong style="font-weight: bold;">可超时</strong>、<strong style="font-weight: bold;">可中断锁</strong>等。这些特性在实际的编程中提供着很大的灵活性。</p><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Lock</code>类的实现类常见的主要是<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">ReentrantLock</code>类。</p><p style="margin: 0px 0px 20px;">该类提供了几个重要的方法：</p><ul><li style="list-style: circle;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">lock()</code> 语义同<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">synchronized</code></li><li style="list-style: circle;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">tryLock()</code> 提供了可超时的特性，在某些情况下可以通过该特性<strong style="font-weight: bold;">避免死锁</strong>的发生</li><li style="list-style: circle;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">lockInterruptibly() throws InterruptedException</code> 在获取锁失败被阻塞的时候可被<strong style="font-weight: bold;">中断</strong>，而采用<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">synchronized</code>获取内置锁的时候，无法被中断</li></ul></li><li><p style="margin: 0px 0px 20px;">​</p></li><li><p style="margin: 0px 0px 20px;"><strong style="font-weight: bold;">可重入锁</strong>(Reentrant Lock)</p><p style="margin: 0px 0px 20px;">可重入锁指的是已经获取了某个锁的线程去尝试再一次该锁的时候，是可以直接获取到的，而不会阻塞。</p><p style="margin: 0px 0px 20px;">可重入锁避免了如下的死锁情况的产生:</p><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; width: auto; border: none; font-size: 14px; table-layout: fixed;"><tbody><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/><span style="height: 20px;">2</span><br/><span style="height: 20px;">3</span><br/><span style="height: 20px;">4</span><br/><span style="height: 20px;">5</span><br/><span style="height: 20px;">6</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 199px;"><span style="height: 20px;"><span style="color: rgb(129, 162, 190);"><span style="color: rgb(178, 148, 187);">synchronized</span> <span style="color: rgb(178, 148, 187);">void</span> <span style="color: rgb(138, 190, 183);">get</span><span style="color: rgb(222, 147, 95);">()</span> </span>{</span><br/><span style="height: 20px;">  set();</span><br/><span style="height: 20px;">}</span><br/><span style="height: 20px;"><span style="color: rgb(129, 162, 190);"><span style="color: rgb(178, 148, 187);">synchronized</span> <span style="color: rgb(178, 148, 187);">void</span> <span style="color: rgb(138, 190, 183);">set</span><span style="color: rgb(222, 147, 95);">()</span> </span>{</span><br/><span style="height: 20px;">  </span><br/><span style="height: 20px;">}</span><br/></pre></td></tr></tbody></table><p style="margin: 0px 0px 20px;">如果锁不可重入，那么当线程A获取到了“保护”get方法的锁时，那么再进入set方法的时候，会无限期阻塞。而此时，除了线程A，没有任何线程拥有该锁，因此线程A相相等于握着锁去等锁，首尾相连形成死锁了。</p></li><li><p style="margin: 0px 0px 20px;"><strong style="font-weight: bold;">读写锁</strong>(Read Write Lock)</p><p style="margin: 0px 0px 20px;">通常的锁都为互斥锁，大多数被共享的变量都是由这种互斥锁保护。一个时刻只能有一个线程在访问该变量。这个在该变量<strong style="font-weight: bold;">读多写少</strong>的情况下显然效率不高。因为<strong style="font-weight: bold;">读读</strong>不需要并发控制，而<strong style="font-weight: bold;">读写、 写写</strong>才需要并发控制。那么显然应该同数据库的并发控制加锁的策略一样，应该提供两种锁，一个是共享锁（读锁）、另一个是互斥锁（写锁），当读取变量的时候，主需要获取共享锁，而写变量的时候才去获取互斥锁。</p><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Java</code>并发包中提供了常用的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">ReentrantReadWriteLock</code>锁，该锁提供了<strong style="font-weight: bold;">读锁、写锁、以及锁降级</strong>等特性。</p><ul><li style="list-style: circle;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">readLock()</code> 返回该读写锁对应的读锁</li><li style="list-style: circle;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">writeLock()</code> 返回该读写锁对应的写锁</li></ul></li><li><p style="margin: 0px 0px 20px;">​</p><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; border: none; font-size: 14px; table-layout: fixed;width:518px;"><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;width:6.756756756756757%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/><span style="height: 20px;">2</span><br/><span style="height: 20px;">3</span><br/><span style="height: 20px;">4</span><br/><span style="height: 20px;">5</span><br/><span style="height: 20px;">6</span><br/><span style="height: 20px;">7</span><br/><span style="height: 20px;">8</span><br/><span style="height: 20px;">9</span><br/><span style="height: 20px;">10</span><br/><span style="height: 20px;">11</span><br/><span style="height: 20px;">12</span><br/><span style="height: 20px;">13</span><br/><span style="height: 20px;">14</span><br/><span style="height: 20px;">15</span><br/><span style="height: 20px;">16</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;width:94.00820392616465%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 464px;"><span style="height: 20px;"><span style="color: rgb(178, 148, 187);">private</span> ReadWriteLock lock = <span style="color: rgb(178, 148, 187);">new</span> ReentrantReadWriteLock(<span style="color: rgb(178, 148, 187);">true</span>);</span><br/><span style="height: 20px;"><span style="color: rgb(178, 148, 187);">private</span> Lock r = lock.readLock(), w = lock.writeLock();</span><br/><span style="height: 20px;">...</span><br/><span style="height: 20px;">w.lock();</span><br/><span style="height: 20px;"><span style="color: rgb(178, 148, 187);">try</span> {</span><br/><span style="height: 20px;">  sb.append(append); <span style="color: rgb(150, 152, 150);">//降级为read lock</span></span><br/><span style="height: 20px;">  r.lock();</span><br/><span style="height: 20px;">} <span style="color: rgb(178, 148, 187);">finally</span> {</span><br/><span style="height: 20px;">  w.unlock();<span style="color: rgb(150, 152, 150);">//still hold read lock</span></span><br/><span style="height: 20px;">}</span><br/><span style="height: 20px;"><span style="color: rgb(178, 148, 187);">try</span> {</span><br/><span style="height: 20px;">...</span><br/><span style="height: 20px;">} <span style="color: rgb(178, 148, 187);">finally</span> {</span><br/><span style="height: 20px;">  r.unlock();</span><br/><span style="height: 20px;">}</span><br/><span style="height: 20px;">...</span><br/></pre></td></tr></table><p style="margin: 0px 0px 20px;">读写所允许<strong style="font-weight: bold;">锁降级</strong>：当一个线程持有写锁的时候，可以直接降级为读锁，而<strong style="font-weight: bold;">不支持锁升级</strong>，因为锁升级会可能会引发死锁（当两个持有读锁的线程，同时进行锁升级，那么这两个线程都不会释放自己的读锁，从而发生死锁）</p><p style="margin: 0px 0px 20px;">当线程获取读锁的时候，如果没有线程持有写锁，则获取读锁成功；否则，获取读锁失败；</p><p style="margin: 0px 0px 20px;">当线程获取写锁的时候，如果该读写锁的读锁、写锁被其他线程占有，则该线程获取锁失败；</p></li><li><p style="margin: 0px 0px 20px;"><strong style="font-weight: bold;">偏向锁</strong>(Biased Lock)</p><p style="margin: 0px 0px 20px;">偏向锁是<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">JDK1.6</code>引入的一项锁优化，指的是偏向锁会偏向第一个获得它的线程，如果在接下来的执行过程中，该锁没有被其他的线程获取，则持有偏向锁的线程将永远不需要同步。在某些情况下，锁不存在多线程竞争的情况，而总是由同一线程在获取、释放、获取、释放。因此，引入了偏向锁，让此种情况下的锁获取的代价变小，偏向锁可以提高<strong style="font-weight: bold;">带有同步但无竞争</strong>的程序性能。</p><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; border: none; font-size: 14px; table-layout: fixed;width:780px;"><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;width:4.487179487179487%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/><span style="height: 20px;">2</span><br/><span style="height: 20px;">3</span><br/><span style="height: 20px;">4</span><br/><span style="height: 20px;">5</span><br/><span style="height: 20px;">6</span><br/><span style="height: 20px;">7</span><br/><span style="height: 20px;">8</span><br/><span style="height: 20px;">9</span><br/><span style="height: 20px;">10</span><br/><span style="height: 20px;">11</span><br/><span style="height: 20px;">12</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;width:96.00515463917526%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 726px;"><span style="height: 20px;"><span style="color: rgb(178, 148, 187);">public</span> <span style="color: rgb(178, 148, 187);">class</span> <span style="color: rgb(138, 190, 183);">BiasLockDemo</span> {</span><br/><br/><span style="height: 20px;">      <span style="color: rgb(129, 162, 190);"><span style="color: rgb(178, 148, 187);">public</span> <span style="color: rgb(178, 148, 187);">static</span> <span style="color: rgb(178, 148, 187);">void</span> <span style="color: rgb(138, 190, 183);">main</span><span style="color: rgb(222, 147, 95);">(String[] args)</span> </span>{</span><br/><span style="height: 20px;">               <span style="color: rgb(150, 152, 150);">// TODO Auto-generated method stub</span></span><br/><span style="height: 20px;">          <span style="color: rgb(178, 148, 187);">long</span> t = System.currentTimeMillis();</span><br/><span style="height: 20px;">                List&lt;Integer&gt; list = <span style="color: rgb(178, 148, 187);">new</span> Vector&lt;&gt;();<span style="color: rgb(150, 152, 150);">//选择Vector是由于其add方法是synchronized修饰的；</span></span><br/><span style="height: 20px;">                <span style="color: rgb(178, 148, 187);">for</span> (<span style="color: rgb(178, 148, 187);">int</span> i = <span style="color: rgb(181, 189, 104);">0</span>; i &lt; <span style="color: rgb(181, 189, 104);">1000_0000</span>; i++) {</span><br/><span style="height: 20px;">                      list.add(i);</span><br/><span style="height: 20px;">                }</span><br/><span style="height: 20px;">           System.out.println(<span style="color: rgb(181, 189, 104);">&quot;cost: &quot;</span> + (System.currentTimeMillis() - t) + <span style="color: rgb(181, 189, 104);">&quot;ms&quot;</span>);</span><br/><span style="height: 20px;">       }</span><br/><span style="height: 20px;">}</span><br/></pre></td></tr></table><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">-XX:+UseBiasedLocking -XX:BiasedLockingStartupDelay=0</code>开启偏向锁后，运行时间：</p><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; width: auto; border: none; font-size: 14px; table-layout: fixed;"><tbody><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 99px;"><span style="height: 20px;">cost: 340ms</span><br/></pre></td></tr></tbody></table><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">-XX:-UseBiasedLocking</code>禁用偏向锁后，运行时间：</p><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; width: auto; border: none; font-size: 14px; table-layout: fixed;"><tbody><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 99px;"><span style="height: 20px;">cost: 519ms</span><br/></pre></td></tr></tbody></table></li><li><p style="margin: 0px 0px 20px;"><strong style="font-weight: bold;">公平锁/非公平锁</strong></p><p style="margin: 0px 0px 20px;">公平锁是指多个线程在等待同一个锁时，必须按照申请锁的先后顺序来获得锁。</p><p style="margin: 0px 0px 20px;">非公平锁是指多个线程在等待同一个锁时，是按按照不确定的顺序来选择某一个线程获取锁。</p><p style="margin: 0px 0px 20px;">通常来讲，<strong style="font-weight: bold;">公平锁的性能低于非公平锁，但是公平锁可以解决线程饥饿的问题</strong>。</p><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Java</code>中可以使用<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">new ReentrantLock(true)</code>构造得到公平锁，而<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">synchronized</code>则提供的内置锁是非公平的。</p><p style="margin: 0px 0px 20px;">ps: <code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Java</code>中提供的显式锁一般都提供Fair和Non-Fair模式，但是即便是公平模式也会提供一些允许<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">插队(barging)</code>的方法允许线程先于等待在前面的线程得到锁。</p></li><li><p style="margin: 0px 0px 20px;"><strong style="font-weight: bold;">悲观锁/乐观锁</strong></p><p style="margin: 0px 0px 20px;">悲观锁：主要的并发控制策略之一，假设冲突总是发生，如果不采取同步措施，例如对共享的变量或者资源加锁，那么肯定会出现问题，类似于<strong style="font-weight: bold;">事前预防</strong>。因此无论共享的数据无论是是否出现竞争冲突，都会对它进行正确的同步。</p><p style="margin: 0px 0px 20px;">乐观锁：和悲观锁不一样，乐观并发控制策略先进行操作，如果操作的数据没出现竞争，那么操作成功；如果操作的数据出现竞争，那么再进行一些后续的弥补操作（常见的就是不断的重试、或者重试数次返回失败信息），类似<strong style="font-weight: bold;">事后弥补</strong>，实现乐观并发控制策略有多种常见的方式：</p><ul><li style="list-style: circle;">CAS</li><li style="list-style: circle;">时间戳</li><li style="list-style: circle;">版本号</li></ul></li><li><p style="margin: 0px 0px 20px;">存在即合理，悲观锁和乐观锁都有其应用的场景，当数据争用、冲突发生频繁的场景，悲观锁较适合；而数据争用、冲突不频繁的场景，乐观锁则更适合。</p></li><li><p style="margin: 0px 0px 20px;"><strong style="font-weight: bold;">自旋锁</strong>(Spinning Lock)</p><p style="margin: 0px 0px 20px;">互斥同步的时候，当线程获取锁失败的时候，通常会进入阻塞状态，<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">java</code>线程和操作系统线程是一一对应的，挂起和恢复线程操作需要由<strong style="font-weight: bold;">用户态转入核心态</strong>完成，这些操作<strong style="font-weight: bold;">耗时、耗资源</strong>。但是某些情况下，某一个线程只会将锁独占很短时间，或者是说很快 便完成了同步代码块的执行，因此其它线程为了这点时间选择将自己挂起、恢复十分没有必要。因此，特别是在多处理环境下，可以让后面请求独占锁失败的线程，进行<strong style="font-weight: bold;">自旋</strong>（忙循环）一会儿，而不是阻塞挂起线程。</p><p style="margin: 0px 0px 20px;">自旋锁的引入是为了解决锁被独占的时间很短的情况下，避免线程被挂起-恢复带来的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">overhead</code>，因此当锁独占的时间本来就很长的，这种锁便没有存在的意义了。</p><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">JVM</code>中可以通过参数：</p><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">-XX:+UseSpinning</code>开启自旋锁功能；<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">JDK1.6</code>默认是开启的。</p><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">-XX:PreBlockSpin</code>配置每次自旋的次数，默认是10次；</p><p style="margin: 0px 0px 20px;">​</p></li></ol><h1 style="font-size: 22px; margin: 0px; padding: 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; color: rgb(85, 85, 85); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><a href="https://spground.github.io/2018/02/03/JAVA%E9%94%81/#3-%E6%AD%BB%E9%94%81%E5%92%8C%E6%B4%BB%E9%94%81" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="3. 死锁和活锁"></a>3. 死锁和活锁</h1><h2 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px; color: rgb(85, 85, 85); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><a href="https://spground.github.io/2018/02/03/JAVA%E9%94%81/#3-1-%E6%AD%BB%E9%94%81" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="3.1 死锁"></a>3.1 死锁</h2><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">并发中问题中的死锁最经典莫过于<a href="https://en.wikipedia.org/wiki/Dining_philosophers_problem" rel="noopener" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" target="_blank"><strong style="font-weight: bold;">哲学家就餐</strong></a>问题，死锁常常发生在系统高负载环境下，多线程竞争某一共享数据的情况下。当线程A持有锁L的时候同时，线程B持有锁M并尝试获得L，那么这两个线程将永远等待下去。这种情况就是最简单的死锁形式，多个线程由于存在环路的依赖关系而永远的等待下去。</p><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><a href="https://upload.wikimedia.org/wikipedia/commons/thumb/7/7b/An_illustration_of_the_dining_philosophers_problem.png/463px-An_illustration_of_the_dining_philosophers_problem.png" rel="group" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;"><img src="常见面试基础题_files/Image [7].png" type="image/png" data-filename="Image.png" style="border: 1px solid rgb(221, 221, 221); display: block !important; margin: 0px auto; max-width: 100%; height: auto; cursor: -webkit-zoom-in; box-sizing: border-box; padding: 3px;"/></a></p><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">死锁发生最常见的的根本原因就是：<strong style="font-weight: bold;">多个线程存在环路的依赖关系</strong>。</p><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">比如<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">A</code>等待B，B等待C，C等待D, …, Z等待A，则A间接的等待A，形成环路，发生死锁。</p><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">环路的产生具体有如下几种情况：</p><ul style="color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><li style="list-style: circle;"><strong style="font-weight: bold;">锁顺序死锁</strong>：加锁的顺序不一致导致的死锁；</li><li style="list-style: circle;"><strong style="font-weight: bold;">动态的锁顺序死锁</strong>：方法内部加锁顺序是一致的，但是由于锁被参数化了，因此调用该方法时，锁的顺序取决于方法调用者传来的参数，因此也会动态的产生锁顺序死锁。</li><li style="list-style: circle;"><strong style="font-weight: bold;">协作对象之间发生的死锁</strong></li><li style="list-style: circle;"><strong style="font-weight: bold;">资源死锁</strong> 例如：线程A持有数据库连接D1并等待D2，而线程B持有数据库连接D2，等待D1则A、B之间出现死锁</li></ul><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">解决死锁问题通常有两个角度来解决，<strong style="font-weight: bold;">死锁避免和死锁解除</strong>，一个属于事前预防，另一个是事后弥补；</p><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">数据库系统中，为避免死锁，有一个著名的<strong style="font-weight: bold;">两阶段加锁协议</strong>，同时，事务管理器可以通过环路判断死锁的存在，并取消一个代价小的事务以达到死锁的解除。</p><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Java</code>没有数据库事务管理器那么强大，<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Java</code>中也有一些方法可以避免死锁，但是当死锁发生的时候，除了重启应用别无他法。</p><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Java</code>中的死锁避免：</p><ul style="color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><li style="list-style: circle;"><strong style="font-weight: bold;">加锁顺序保持相同</strong>（synchronized提供的内置锁只能通过此种方式来避免死锁的发生）</li><li style="list-style: circle;"><strong style="font-weight: bold;">采用可轮询的、可超时的锁</strong>(显式锁Lock提供<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">tryLock(long timeout)</code>轮询和超时的特性，因此不会无限的等待下去，当超时的时候，程序可以简单的重试，或者放弃获取该锁，释放已有的锁。同时这种方式通过引入<strong style="font-weight: bold;">随机因素</strong>也可以有限的解决<strong style="font-weight: bold;">活锁的问题</strong>)</li></ul><h2 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px; color: rgb(85, 85, 85); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><a href="https://spground.github.io/2018/02/03/JAVA%E9%94%81/#3-2-%E6%B4%BB%E9%94%81" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="3.2 活锁"></a>3.2 活锁</h2><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">死锁是形成死锁的线程全部处于无限等待状态，而<strong style="font-weight: bold;">活锁则是线程不断的重复执行相同的操作，而且总是失败</strong>。就相当于线程在执行一个循环的操作序列，周而复始，无穷无尽，导致系统的状态整体停滞不前。</p><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">最形象的例子便是：</p><blockquote style="margin: 0px; padding: 0px 15px; color: rgb(102, 102, 102); border-left: 4px solid rgb(221, 221, 221); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><p style="margin: 0px 0px 20px;">两个过于礼貌的人甲乙，相向走在一个狭窄的巷子里面，甲和乙同时让对方先走，然后甲乙同时准备接受对方的谦让自己先走，然后两人又同时让对方先走…，如此循环往复，两人没有等待，始终处于活动状态，但是两人始终都无法通过巷子。</p></blockquote><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">同样的类似活锁的例子就是，以太网的共享介质传输信息时，也会出现活锁的问题，以太网技术采用了一种叫做<strong style="font-weight: bold;">载波多路访问-冲突检测（CSMA-CD）</strong>的技术，该技术引入了一些<strong style="font-weight: bold;">随机因素</strong>来避免活锁。</p><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">同样的，解决活锁的问题，可以在<strong style="font-weight: bold;">重试机制中以引入随机性</strong>，这样可以有效的避免活锁问题。</p><h1 style="font-size: 22px; margin: 0px; padding: 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; color: rgb(85, 85, 85); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><a href="https://spground.github.io/2018/02/03/JAVA%E9%94%81/#4-reference" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="4.reference"></a>4.reference</h1><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">[1]. Java并发编程实践</p><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">[2]. 深入理解JVM虚拟机</p><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">[3]. <a href="http://www.importnew.com/19472.html" rel="noopener" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" target="_blank">http://www.importnew.com/19472.html</a></p><div style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif; font-size: 16px; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div>[4]. <a href="https://www.cnblogs.com/qifengshi/p/6831055.html" rel="noopener" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" target="_blank">https://www.cnblogs.com/qifengshi/p/6831055.html</a></div></div></div></span>
</div>
<hr>
<a name="893"/>

<div>
<span><div><h1 style="font-size: 26px; margin: 0px; padding: 0px; font-weight: 400; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; text-align: center; word-break: break-word;">数据库索引</h1><div style="margin: 3px 0px 60px; color: rgb(153, 153, 153); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 12px; text-align: center;"><span style="margin-right: 3px;"> </span>发表于 2018-01-09 <span style="margin: 0px 0.5em;">|</span> <span style="margin-right: 3px;"> </span>分类于 <a href="https://spground.github.io/categories/MySQL/" rel="index" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;">MySQL </a><span style="margin: 0px 0.5em;">|</span> <span style="margin-right: 3px;"> </span>阅读次数 10</div><div style="font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; text-align: justify; color: rgb(85, 85, 85); font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><h1 style="font-size: 22px; margin: 0px; padding: 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;"><a href="https://spground.github.io/2018/01/09/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#1-%E6%A6%82%E8%BF%B0" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="1.概述"></a>1.概述</h1><p style="margin: 0px 0px 20px;">大量的结构化数据通常被存储在数据库中，通过简单的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">SQL</code>语句，我们可以方便的查询、修改、插入、删除这些数据。例如当我们执行：</p><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; width: auto; border: none; font-size: 14px; table-layout: fixed;"><tbody><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 306px;"><span style="height: 20px;"><span style="color: rgb(178, 148, 187);">SELECT</span> * <span style="color: rgb(178, 148, 187);">FROM</span> <span style="color: rgb(178, 148, 187);">USER</span> <span style="color: rgb(178, 148, 187);">WHERE</span> userName = <span style="color: rgb(181, 189, 104);">'A'</span>;</span><br/></pre></td></tr></tbody></table><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">DBMS</code>会将表中所有用户名等于<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">A</code>的用户的记录返回给我们，但随着表中的记录越来越多，比如说从<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">10000</code>增加到<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">1000万</code>，这时候我们往往会发现查询的速度会变慢很多。这时候，通常的做法就是在<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">userName</code>列上面创建<strong style="font-weight: bold;">索引</strong>，以加快数据的查询。</p><p style="margin: 0px 0px 20px;">那么<strong style="font-weight: bold;">什么是数据库索引</strong>、<strong style="font-weight: bold;">为什么数据库索引可以加快查询</strong>以及<strong style="font-weight: bold;">如何正确的使用数据库索引</strong>呢？以下将从这个几个方面做一下简单的总结。</p><h1 style="font-size: 22px; margin: 0px; padding: 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;"><a href="https://spground.github.io/2018/01/09/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#2-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="2. 数据库索引"></a>2. 数据库索引</h1><h2 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="https://spground.github.io/2018/01/09/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#2-1-%E6%94%B9%E5%96%84%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9F%A5%E8%AF%A2" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="2.1 改善数据库查询"></a>2.1 改善数据库查询</h2><h3 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 18px;"><a href="https://spground.github.io/2018/01/09/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#2-1-1-%E7%94%A8%E6%A0%91%E5%BD%A2%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E8%BF%9B%E8%A1%8C%E6%9F%A5%E6%89%BE" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="2.1.1 用树形数据结构进行查找"></a>2.1.1 用树形数据结构进行查找</h3><p style="margin: 0px 0px 20px;">通常来讲，我们在对数据库中数据最频繁的操作便是查询，比如我们给定一定的查询条件将某个表的数据记录查询出来，因此这实际就是一个<strong style="font-weight: bold;">查找问题</strong>。</p><p style="margin: 0px 0px 20px;">查找问题最简单直接的就是<strong style="font-weight: bold;">顺序查找</strong>，其时间复杂度为<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">O(N)</code>。</p><p style="margin: 0px 0px 20px;">例如第1节中的：</p><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; width: auto; border: none; font-size: 14px; table-layout: fixed;"><tbody><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 306px;"><span style="height: 20px;"><span style="color: rgb(178, 148, 187);">SELECT</span> * <span style="color: rgb(178, 148, 187);">FROM</span> <span style="color: rgb(178, 148, 187);">USER</span> <span style="color: rgb(178, 148, 187);">WHERE</span> userName = <span style="color: rgb(181, 189, 104);">'A'</span>;</span><br/></pre></td></tr></tbody></table><ul><li style="list-style: circle;">假设<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">userName</code>列中不存在重复值，很显然我们在查找这条记录的时候需要对数据表中数据记录一行一行的扫描，然后直到找到我们需要的那条记录，这种方式的平均时间复杂度是<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">O(N/2)</code></li><li style="list-style: circle;">假设<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">userName</code>列中存在重复值，这时情况更加糟糕，我们需要进行所谓的<strong style="font-weight: bold;">全表扫描</strong>找到所有的记录，这种方式的时间复杂度是<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">O(N)</code></li></ul><p style="margin: 0px 0px 20px;">即便是在<strong style="font-weight: bold;">内存</strong>中对大量数据进行<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">O(N)</code>的查询我们也很难接受，更何况是这些数据是存在<strong style="font-weight: bold;">外部存储</strong>设备上（常见便是<strong style="font-weight: bold;">磁盘</strong>）。磁盘的一次访问时间大约是<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">8ms</code>，而内存的一次访问约<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">50ns</code>。</p><p style="margin: 0px 0px 20px;">因此当数据量特别大的时候，数据库用<strong style="font-weight: bold;">顺序查找</strong>的方式进行数据查找几乎是不可接受的。</p><p style="margin: 0px 0px 20px;">在众多的用于查找的数据结构中，<strong style="font-weight: bold;">平衡的树形结构</strong>是十分合适被用来进行查找，其查找的时间复杂度可以降到<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">O(logN)</code>，当然某些<strong style="font-weight: bold;">数据库索引</strong>便是采用树形结构来组织的。</p><p style="margin: 0px 0px 20px;">到现在，我们总结了为什么要使用数据库索引的原因，并且我们总结了数据库索引可以使用树形数据结构来加快数据的查询。下面给出<a href="https://en.wikipedia.org/wiki/Database_index" rel="noopener" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" target="_blank">维基百科</a>的定义:</p><blockquote style="margin: 0px; padding: 0px 15px; color: rgb(102, 102, 102); border-left: 4px solid rgb(221, 221, 221);"><p style="margin: 0px 0px 20px;">数据库索引是一种花费额外存储空间以加快数据库数据检索的数据结构。</p></blockquote><p style="margin: 0px 0px 20px;">我们知道我们可以采用<strong style="font-weight: bold;">平衡二叉排序树</strong>来组织数据库索引，每个节点存储关键字和其对应的数据（或者数据所在的磁盘地址）。这样在进行查询的时候，我们可以将时间复杂度降低到我们需要的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">O(logN)</code>。但是实际上数据库索引并不是采用这种二叉树的数据结构，而是采用<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">B-Tree</code>来实现数据库索引以加快数据查询。关于为什么不使用二叉搜索树的原因以及<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">B-Tree</code>是什么，2.1.2会进行总结。</p><h3 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 18px;"><a href="https://spground.github.io/2018/01/09/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#2-1-2-B-Tree" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="2.1.2 B-Tree"></a>2.1.2 B-Tree</h3><p style="margin: 0px 0px 20px;"><a href="http://img.blog.csdn.net/20161215230141403?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveW9uZ2hlbmdfMTk5OQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" rel="group" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;"><img src="常见面试基础题_files/Image [8].png" type="image/png" data-filename="Image.png" style="border: 1px solid rgb(221, 221, 221); display: block !important; margin: 0px auto; max-width: 100%; height: auto; cursor: -webkit-zoom-in; box-sizing: border-box; padding: 3px;"/></a></p><p style="margin: 0px 0px 20px;">上图为磁盘的某个盘面的解剖示意图，由于一次寻道操作很慢，为了数据读取的有效性，磁盘是按扇区为单位存储和访问数据的。关于磁盘的工作原理，参见这篇<a href="http://blog.csdn.net/yongheng_1999/article/details/53678814" rel="noopener" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" target="_blank">博文</a>。</p><ol><li>如果我们用二叉搜索树组织<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">10000</code>个关键字，那么我们的树的高度约为：14。因此如果我们要查询叶节点上的关键字则需要14次磁盘访问，大约耗时:<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">8ms*14=112ms</code>。虽然这个结果对于顺序查找好了不少，但实际上为了降低磁盘访问次数，我们可以进一步将树变得矮一点便可以<strong style="font-weight: bold;">降低磁盘访问次数</strong>，从而提高查询速度。</li><li>为了降低树的高度，我们将二叉树中的每个节点最多<strong style="font-weight: bold;">俩孩子变为多个孩子</strong>，便可以将树的高度大大降低。</li></ol><p style="margin: 0px 0px 20px;"><a href="https://techdifferences.com/wp-content/uploads/2017/10/Untitled-7.jpg" rel="group" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;"><img src="常见面试基础题_files/Image [1].jpg" type="image/jpeg" data-filename="Image.jpg" style="border: 1px solid rgb(221, 221, 221); display: block !important; margin: 0px auto; max-width: 100%; height: auto; cursor: -webkit-zoom-in; box-sizing: border-box; padding: 3px;"/></a></p><p style="margin: 0px 0px 20px;">而这种平衡的、每个节点多与2个孩子节点的树形数据结构便是<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">B-Tree</code>。上图是一个简单的对比图，从图中我们可以看出<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">B Tree</code>相比二叉树，其每一个结点里面含有<strong style="font-weight: bold;">多个关键字</strong>，从而大大降低了树的高度。当每个结点允许存放100个关键字的时候，<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">10000</code>个关键字的B Tree树高大约为2，因此仅需要2次磁盘访问便可以访问到数据，大约耗时<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">8ms*2=16ms</code>，相比于前面的二叉树来讲，性能又提升了不少。<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">B Tree</code>的结点的大小通常被设置为一个扇区的大小（假如说是<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">4KB</code>），这样一次磁盘访问便可以读取到该节点所有关键字。</p><p style="margin: 0px 0px 20px;">简单总结一下：<strong style="font-weight: bold;">由于数据存储在磁盘上，考虑到磁盘的特性，因此通过将结点的大小增加到一个扇区的大小，从而降低查找树的高度以减少耗时的磁盘访问次数，这就是<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">B Tree</code>适合用来查找基于外部存储数据的主要原因。</strong></p><p style="margin: 0px 0px 20px;">到这里我们总结了数据库索引为什么不采用二叉搜索树实现的原因。接下来我们稍微简单的总结下<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">B Tree</code>相关的内容。</p><p style="margin: 0px 0px 20px;">来自<a href="https://en.wikipedia.org/wiki/B-tree" rel="noopener" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" target="_blank">维基</a>的定义：</p><blockquote style="margin: 0px; padding: 0px 15px; color: rgb(102, 102, 102); border-left: 4px solid rgb(221, 221, 221);"><p style="margin: 0px 0px 20px;">在计算机科学中，<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">B</code>树是一棵自平衡树，它允许在<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">logN</code>的时间内完成查找、顺序访问、插入和删除。B树是一种泛化的二叉搜索树，其结点可以拥有超过2个孩子结点。</p></blockquote><p style="margin: 0px 0px 20px;">一棵5阶的B树大概长这样（5阶指的是孩子节点数量最多为5）：</p><p style="margin: 0px 0px 20px;"><a href="https://upload.wikimedia.org/wikipedia/commons/thumb/6/65/B-tree.svg/600px-B-tree.svg.png" rel="group" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;"><img src="常见面试基础题_files/Image [9].png" type="image/png" data-filename="Image.png" style="border: 1px solid rgb(221, 221, 221); display: block !important; margin: 0px auto; max-width: 100%; height: auto; cursor: -webkit-zoom-in; box-sizing: border-box; padding: 3px;"/></a></p><p style="margin: 0px 0px 20px;">B树中的结点通常分为<strong style="font-weight: bold;">三类</strong>：</p><ul><li style="list-style: circle;">根结点：包含关键字，包含关键字的个数<strong style="font-weight: bold;">有上界无下界</strong>，有孩子结点，包含指向孩子结点的指针</li><li style="list-style: circle;">内部结点：包含关键字，且包含关键字的个数<strong style="font-weight: bold;">有上下界</strong>，有孩子结点，包含指向孩子结点的指针</li><li style="list-style: circle;">叶子结点：包含关键字，且包含关键字的个数<strong style="font-weight: bold;">有上下界</strong>，没有孩子结点，不包含指向孩子结点的指针</li></ul><p style="margin: 0px 0px 20px;">关于B树的性质的描写有很多种，以下是从《算法导论》总结出来的：</p><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">B</code>树应该满足的性质：</p><ol><li>每个叶结点具有相同的深度，即树的高度<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">h</code></li><li>每个结点所包含的关键字个数都有个下界（根节点没有下界）和上界，上下界通过一个被称为<strong style="font-weight: bold;">B树的最小度数</strong>的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">t&gt;=2</code>来表示
<ul><li style="list-style: circle;">除了根节点以外，每个结点至少含有<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">t-1</code>个关键字；因此除了根节点以外的每个内部结点至少含有<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">t</code>个孩子。如果树非空，根节点至少能含有1个关键字以保证树的最小度<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">t&gt;=2</code></li><li style="list-style: circle;">每个结点最多包含<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">2t-1</code>个关键字。因此一个内部结点最多有<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">2t</code>个孩子，当一个结点恰好有<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">2t-1</code>个关键字的时候，称该结点是<strong style="font-weight: bold;">满的</strong></li></ul></li></ol><p style="margin: 0px 0px 20px;">另外，有的地方存在<strong style="font-weight: bold;">阶</strong>的概念，指的是B树允许非叶子结点的最大孩子结点个数，关于<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">B Tree</code>的基本操作<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Search</code>、<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Insertion</code>、<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Delete</code>等将在下一篇博文介绍，这里不做介绍。</p><p style="margin: 0px 0px 20px;">数据库索引中的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">B</code>树中，每个结点包含如下内容：</p><ul><li style="list-style: circle;">存储代表被索引数据库列的关键字</li><li style="list-style: circle;">指向孩子结点的指针</li><li style="list-style: circle;">指向数据库记录的指针</li></ul><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">B Tree</code>虽然能很好的帮助我们改善诸如<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">WHERE userName = 'A'</code>之类的查询，但是<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">B</code>树还存在以下两个缺点：</p><ol><li>但是对于一些常见的<strong style="font-weight: bold;">范围查询</strong>，例如<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">WHERE age &gt; 10</code>等，我们就需要中序遍历<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">B</code>树，这会增加缓存miss率，从而增加我们的磁盘访问次数。</li><li>与此同时，由于我们在结点中不仅仅存储了指向孩子结点的指针，而且还存储了指向数据库记录的指针，因此每个结点的<strong style="font-weight: bold;">大小就会较大</strong>，又由于扇区的大小通常是固定的，因此每个结点包含的关键字的个数就会<strong style="font-weight: bold;">减少</strong>，也就是说<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">B</code>的阶会<strong style="font-weight: bold;">降低</strong>（树会变高）。</li></ol><p style="margin: 0px 0px 20px;">因此为避免上述两个缺点，<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">B</code>树的变体<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">B+</code>树便应运而生。</p><h3 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 18px;"><a href="https://spground.github.io/2018/01/09/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#2-1-3-B-%E6%A0%91" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="2.1.3 B+树"></a>2.1.3 B+树</h3><p style="margin: 0px 0px 20px;">同B树不同，B+树主要有如下不同：</p><ul><li style="list-style: circle;">B+树中关键字和指向数据记录的指针仅仅存放在<strong style="font-weight: bold;">叶子结点</strong>；</li><li style="list-style: circle;">B+树中<strong style="font-weight: bold;">同一关键字可能出现在多个结点中</strong>，但是仅仅叶子结点还有指向数据记录的指正；而B树<strong style="font-weight: bold;">同一关键字仅仅可能出现在一个结点中</strong>；</li><li style="list-style: circle;">由于B+树的关键字和数据记录的信息仅仅保存在叶子结点中，因此无论查找是否成功，都会深入到B+树的叶子结点，因此<strong style="font-weight: bold;">查询时间基本上是稳定</strong>的；而B树的查询时间和关键字在树中的位置有关，因此<strong style="font-weight: bold;">查询时间不是稳定的</strong>；</li></ul><p style="margin: 0px 0px 20px;">除此之外，<strong style="font-weight: bold;">B+树将叶结点通过链表的形式连接起来</strong>，这样避免了<strong style="font-weight: bold;">范围查询</strong>或者<strong style="font-weight: bold;">全表扫描</strong>的时候，对B树的中序遍历。</p><p style="margin: 0px 0px 20px;">下图是B树和B+树的对比图：</p><p style="margin: 0px 0px 20px;"><a href="https://i.stack.imgur.com/l6UyF.png" rel="group" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;"><img src="常见面试基础题_files/Image [10].png" type="image/png" data-filename="Image.png" style="border: 1px solid rgb(221, 221, 221); display: block !important; margin: 0px auto; max-width: 100%; height: auto; cursor: -webkit-zoom-in; box-sizing: border-box; padding: 3px;"/></a></p><h2 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="https://spground.github.io/2018/01/09/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#2-2-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95%E7%9A%84%E7%B1%BB%E5%9E%8B" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="2.2 数据库索引的类型"></a>2.2 数据库索引的类型</h2><p style="margin: 0px 0px 20px;">由于不同数据库提供的索引分类不同，因此很多时候索引分类是混乱的。但是常见的数据库索引主要有如下几种：</p><ol><li><strong style="font-weight: bold;">聚集索引（Clustered Index）</strong>：数据表中的记录的物理顺序和索引关键字的逻辑顺序是一致的。由于这个特性，聚集索引能够大大加快类似顺序检索、反序检索和范围查询。由于聚集索引的逻辑顺序和记录的物理顺序是一致的，显然一张数据表聚集索引<strong style="font-weight: bold;">只能有一个</strong>，<strong style="font-weight: bold;">通常建立在主键上</strong>。</li><li><strong style="font-weight: bold;">非聚集索引（Non-Clustered Index）</strong>：和聚集索引相反，记录的物理顺序和索引关键字的逻辑顺序不是一致的。因此一个数据表可以有<strong style="font-weight: bold;">0个或者多个</strong>非聚集索引。</li><li><strong style="font-weight: bold;">唯一索引（Unique Index）</strong>：唯一索引是不允许其中任何两行具有相同索引值的索引。</li><li><strong style="font-weight: bold;">非唯一索引（Non-Unique Index）</strong>：允许任何两行具有相同索引值的索引，仅仅是用来加快查询。</li><li><strong style="font-weight: bold;">主键索引（Primary Index）</strong>：建立在主键上的索引，由于主键具有<strong style="font-weight: bold;">唯一性</strong>，因此从某种意义上来讲，<strong style="font-weight: bold;">主键索引</strong>也是<strong style="font-weight: bold;">唯一索引</strong>，又因为主键列具有<strong style="font-weight: bold;">不经常修改</strong>等特性，因此主键索引通常也设置为<strong style="font-weight: bold;">聚集索引</strong>。由于主键索引的特殊性，大多数数据库都会默认在主键上自动创建主键索引。</li></ol><h1 style="font-size: 22px; margin: 0px; padding: 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;"><a href="https://spground.github.io/2018/01/09/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#3-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="3. 创建数据库索引"></a>3. 创建数据库索引</h1><p style="margin: 0px 0px 20px;">虽然索引会加快数据的查询，但是维护索引需要<strong style="font-weight: bold;">额外的空间和时间</strong>。因此需要在<strong style="font-weight: bold;">合适的列上创建合适的索引</strong>的，否则只会盲目的创建索引只会适得其反。</p><p style="margin: 0px 0px 20px;"><strong style="font-weight: bold;">适合创建索引</strong>的列具有如下特点：</p><ul><li style="list-style: circle;">对于经常处于WHERE、JOIN、OrderBy字句中的列应该创建索引，以加快查询</li><li style="list-style: circle;">对于需要<strong style="font-weight: bold;">保持唯一性</strong>的列，需要在创建<strong style="font-weight: bold;">唯一索引</strong></li><li style="list-style: circle;">主键列默认是创建<strong style="font-weight: bold;">主键索引</strong></li><li style="list-style: circle;"><strong style="font-weight: bold;">聚集索引</strong>应该创建在<strong style="font-weight: bold;">很少修改</strong>的列</li></ul><p style="margin: 0px 0px 20px;"><strong style="font-weight: bold;">不适合创建索引</strong>的列具有如下特点：</p><ul><li style="list-style: circle;"><p style="margin: 0px 0px 20px;">查询中很少使用或者参考的列不应该创建索引；</p></li><li style="list-style: circle;"><p style="margin: 0px 0px 20px;">对于取值很少的列，例如性别列没必要创建索引；</p></li><li style="list-style: circle;"><p style="margin: 0px 0px 20px;">定义为text、image、bit的列不适和创建索引；</p></li><li style="list-style: circle;"><p style="margin: 0px 0px 20px;">频繁修改的列不适合创建索引，维护索引的代价会很大；</p><p style="margin: 0px 0px 20px;">​</p></li></ul><p style="margin: 0px 0px 20px;">因为物理顺序和逻辑顺序是一致的，如果被索引的列频繁更新，为了维护逻辑顺序很物理顺序的一致性，会付出很大的代价，因此聚集索引应该建立在<strong style="font-weight: bold;">很少和不更新的列</strong>上面，</p><h1 style="font-size: 22px; margin: 0px; padding: 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;"><a href="https://spground.github.io/2018/01/09/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#4-References" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="4. References"></a>4. References</h1><ol><li><a href="https://stackoverflow.com/questions/1108/how-does-database-indexing-work" rel="noopener" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" target="_blank">https://stackoverflow.com/questions/1108/how-does-database-indexing-work</a></li><li><a href="https://stackoverflow.com/questions/107132/what-columns-generally-make-good-indexes/8937872#8937872" rel="noopener" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" target="_blank">https://stackoverflow.com/questions/107132/what-columns-generally-make-good-indexes/8937872#8937872</a></li><li><a href="https://stackoverflow.com/questions/870218/differences-between-b-trees-and-b-trees" rel="noopener" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" target="_blank">https://stackoverflow.com/questions/870218/differences-between-b-trees-and-b-trees</a></li><li><a href="http://blog.csdn.net/yongheng_1999/article/details/53678814" rel="noopener" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" target="_blank">http://blog.csdn.net/yongheng_1999/article/details/53678814</a></li><li><a href="http://blog.csdn.net/kennyrose/article/details/7532032" rel="noopener" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" target="_blank">http://blog.csdn.net/kennyrose/article/details/7532032</a></li></ol></div></div></span>
</div>
<hr>
<a name="900"/>

<div>
<span><div><h1 style="font-size: 26px; margin: 0px; padding: 0px; font-weight: 400; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; text-align: center; word-break: break-word;">数据库事务隔离级别</h1><div style="margin: 3px 0px 60px; color: rgb(153, 153, 153); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 12px; text-align: center;"><span style="margin-right: 3px;"> </span>发表于 2018-01-04 <span style="margin: 0px 0.5em;">|</span> <span style="margin-right: 3px;"> </span>分类于 <a href="https://spground.github.io/categories/MySQL/" rel="index" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;">MySQL </a><span style="margin: 0px 0.5em;">|</span> <span style="margin-right: 3px;"> </span>阅读次数 21</div><div style="font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; text-align: justify; color: rgb(85, 85, 85); font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><h2 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="https://spground.github.io/2018/01/04/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB/#1-%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="1.数据库事务"></a>1.数据库事务</h2><blockquote style="margin: 0px; padding: 0px 15px; color: rgb(102, 102, 102); border-left: 4px solid rgb(221, 221, 221);"><p style="margin: 0px 0px 20px;">事务是用户定义的一个数据库操作系列，这些操作要么全做要么全不做，是一个不可分割的工作单位。</p></blockquote><p style="margin: 0px 0px 20px;">事务是数据库中重要的概念，通常以<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">BEGIN TRANSACTION</code>开始，以<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">COMMIT</code>或者<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">ROLLBACK</code>结束。数据库事务具有四个著名的特性：<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">ACID</code>。</p><ul><li style="list-style: circle;"><p style="margin: 0px 0px 20px;">Automatic</p><p style="margin: 0px 0px 20px;">原子性：即事务中的操作要么都做，要么都不做。</p></li><li style="list-style: circle;"><p style="margin: 0px 0px 20px;">Consistency</p><p style="margin: 0px 0px 20px;">一致性：事务的执行的结果必须是使数据库从一个<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">一致性状态</code>到另一个<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">一致性状态</code>。这里的一致性状态指的是物理和逻辑上的数据库一致性状态。</p><p style="margin: 0px 0px 20px;">比如一个银行系统内部各个用户直接互相转账，无论如何转账，系统内部的金额的总数总是恒定不变的。</p></li><li style="list-style: circle;"><p style="margin: 0px 0px 20px;">Isolation</p><p style="margin: 0px 0px 20px;">隔离性：一个事务的执行不能被其他事务干扰。即一个事务内部的操作及使用的数据对其他并发事务是隔离的，并发执行的各个事务之间不能相互干扰。</p></li><li style="list-style: circle;"><p style="margin: 0px 0px 20px;">Duration</p><p style="margin: 0px 0px 20px;">持久性：一个事务一旦提交，它对数据库中数据的改变就该是永久性的。</p><p style="margin: 0px 0px 20px;">事务的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">ACID</code>特性需要数据库管理系统保证，同时事务也是数据库管理系统<strong style="font-weight: bold;">恢复</strong>和<strong style="font-weight: bold;">并发控制</strong>的基本单位。</p></li></ul><h2 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="https://spground.github.io/2018/01/04/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB/#2-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="2. 数据库并发控制"></a>2. 数据库并发控制</h2><h3 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 18px;"><a href="https://spground.github.io/2018/01/04/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB/#2-1-%E6%95%B0%E6%8D%AE%E4%B8%8D%E4%B8%80%E8%87%B4%E6%80%A7" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="2.1 数据不一致性"></a>2.1 数据不一致性</h3><p style="margin: 0px 0px 20px;">第1节提到了事务是并发控制的基本单位，由于并发控制可能会导致事务的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">ACID</code>特性遭到破坏，从而带来了数据库的数据不一致性。具体来讲，由于并发操作，多个事务的并发执行会带来如下四个典型的数据不一致性问题，而这几种问题主要是由于并发操作破坏了事务的<strong style="font-weight: bold;">隔离性</strong>（<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Isolation</code>）导致的，第3节会介绍<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">MySQL</code>数据库中并发控制机制下不同的事务隔离级别。</p><ol><li><p style="margin: 0px 0px 20px;"><strong style="font-weight: bold;">丢失修改</strong></p><p style="margin: 0px 0px 20px;">这种问题是最直观，最不应该发生的，例如两个事务<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>和<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T2</code>都读入同一数据进行修改，这样<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>提交修改结果后，随即<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T2</code>也提交了结果。这样，<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T2</code>便将<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>对数据的修改给覆盖了，这样就出现了丢失修改的问题了。</p><p style="margin: 0px 0px 20px;">这种问题发生的最主要原因是：<strong style="font-weight: bold;">两个或多个事务都在对同一数据项进行写操作</strong>。</p></li><li><p style="margin: 0px 0px 20px;"><strong style="font-weight: bold;">不可重复读</strong></p><p style="margin: 0px 0px 20px;">不可重复读指的是：事务<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>读取了某个数据项<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">A</code>，在事务<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>运行期间又有其他事务例如<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T2</code>对数据项<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">A</code>进行了修改并提交了，这样事务<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>再次读取数据项<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">A</code>的时候，发现结果不一致了。</p><p style="margin: 0px 0px 20px;">这种问题发生的最主要原因是：<strong style="font-weight: bold;">一个事务在对某一个数据项进行读操作，而另外的其他事务对该数据项进行了写操作。</strong></p></li><li><p style="margin: 0px 0px 20px;"><strong style="font-weight: bold;">读脏数据</strong></p><p style="margin: 0px 0px 20px;">读脏数据指的是：事务<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>正在修改某个数据项<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">A</code>，事务还未提交，而事务<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T2</code>读取了数据项<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">A</code>，但是随后事务<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>由于某种原因回滚了事务（并未提交事务），此时事务<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T2</code>读取到的数据项<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">A</code>的值和数据库中的值是不一致的，称事务<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T2</code>读了脏数据（<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Read Dirty</code>）。</p><p style="margin: 0px 0px 20px;">这种问题发生的最主要原因是：<strong style="font-weight: bold;">一个事务在对某一个数据项进行写操作，而另外的其他事务对该数据项进行了读操作。</strong></p></li><li><p style="margin: 0px 0px 20px;"><strong style="font-weight: bold;">幻读</strong></p><p style="margin: 0px 0px 20px;">幻读指的是：事务<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>按照某些条件从数据库中查询了一些数据记录，但是在事务<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>执行过程中，事务<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T2</code>插入或者删除了某些数据记录，这样当事务<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>再一次按照同样的条件从数据库查询的时候，发现多了或者少了某些记录。<strong style="font-weight: bold;">幻读本质上属于不可重复读</strong>，这里为了和第3节的隔离级别作对照，所以将其单独划出来作为幻读。</p><p style="margin: 0px 0px 20px;">产生的原因同不可重复读类似：<strong style="font-weight: bold;">由于事务<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>按条件对数据表中的很多数据项查询的时候，这时候其他事务<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T2</code>对数据表进行了其他数据项的写操作（插入、修改或者删除）。</strong></p><p style="margin: 0px 0px 20px;">为解决并发带来的一系列问题，主要有<strong style="font-weight: bold;">封锁、时间戳和乐观控制法</strong>来进行并发机制的设计。而<strong style="font-weight: bold;">封锁</strong>是最常用的数据库管理系统并发机制采用的方法。</p></li></ol><h3 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 18px;"><a href="https://spground.github.io/2018/01/04/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB/#2-2-%E5%B0%81%E9%94%81%E5%92%8C%E5%B9%B6%E5%8F%91%E5%BA%A6" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="2.2 封锁和并发度"></a>2.2 封锁和并发度</h3><p style="margin: 0px 0px 20px;">封锁是实现并发控制的一个非常重要的技术。所谓封锁就是在事务对某个数据对象例如表、记录等进行操作的时候（读或写），先向系统请求对其加锁，成功加锁后，该事务才可以继续对其进行操作；否则，只能等待直到加锁成功。</p><p style="margin: 0px 0px 20px;">具体来说：基本的锁分为两种：</p><ul><li style="list-style: circle;">排他锁（Exclusive Locks）又称写锁，X锁；</li><li style="list-style: circle;"><p style="margin: 0px 0px 20px;">共享锁（Share Locks）又称读锁，S锁；</p><p style="margin: 0px 0px 20px;">采用封锁确实能来保证并发下的数据库事务的特性，但是封锁带来了额外的系统开销，进而影响到系统的并发度。</p><p style="margin: 0px 0px 20px;">例如1：当事务<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>对某个数据项<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">A</code>进行写操作的时候，为避免<strong style="font-weight: bold;">读脏数据</strong>， 那么所有的其他向对数据项<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">A</code>进行读取的事务都得进行等待，那么系统此刻的并发度就大大降低了。</p><p style="margin: 0px 0px 20px;">例如2：为避免<strong style="font-weight: bold;">幻读</strong>的产生，当事务<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>对某一表<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Table</code>中的某几行记录进项查询的时候，由于封锁了整个表<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Table</code>，此时所有其他想对该表<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Table</code>进项增加删除记录的事务都得进行等待，由于封锁的<strong style="font-weight: bold;">数据对象粒度太大</strong>，导致并发度大大降低。</p><p style="margin: 0px 0px 20px;">综上可以看出：<strong style="font-weight: bold;">封锁和并发度本来就是一种矛盾，一方面我们想要尽可能的保证事务的隔离性进而避免2.1节中的问题；另一方面我们有希望系统的并发度不要下降。</strong></p><p style="margin: 0px 0px 20px;">既然是矛盾，那就只能妥协，为了充分满足不同的应用场景，<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">MySQL</code>数据库<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">InnoDB</code>支持4种不同的事务隔离级别。</p><p style="margin: 0px 0px 20px;">第3节将结合两种不同的封锁类型来理解这四种不同的事务隔离级别。</p></li></ul><h2 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="https://spground.github.io/2018/01/04/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB/#3-%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="3. 事务隔离级别"></a>3. 事务隔离级别</h2><p style="margin: 0px 0px 20px;">考虑到封锁和并发度的权衡，<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">MySQL</code>为用户提供了四种不同的事务隔离性级别。并发度从低到高（数据一致性强度从高到低）分别是：</p><ul><li style="list-style: circle;">SERIALIZABLE（可串行化）可避免脏读、不可重复读、幻读情况的发生。</li><li style="list-style: circle;">REPEATABLE READ（可重复读）可避免脏读、不可重复读情况的发生。</li><li style="list-style: circle;">READ COMMITTED（读已提交）可避免脏读情况发生。</li><li style="list-style: circle;">READ UNCOMMITTED（读未提交）最低级别，以上情况均无法保证。</li></ul><p style="margin: 0px 0px 20px;">通过2.1节我们知道了几种数据不一致产生的主要原因，即写写和读写同时发生在多个事务对同一数据对象的情况下，另外还介绍了两种锁类型：X锁和S锁。</p><p style="margin: 0px 0px 20px;">两个事务的X锁和S锁可以构成一个相容矩阵：如下：</p><table style="border-collapse: collapse; border-spacing: 0px; margin: 20px 0px; width: 899px; border: 1px solid rgb(221, 221, 221); font-size: 14px; table-layout: fixed;"><thead><tr><th style="padding: 8px 8px 10px; text-align: left; vertical-align: middle; font-weight: 700; border-bottom: 3px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);"><strong style="font-weight: bold;">T1 / T2</strong></th><th style="padding: 8px 8px 10px; text-align: left; vertical-align: middle; font-weight: 700; border-bottom: 3px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);"><strong style="font-weight: bold;">X锁</strong></th><th style="padding: 8px 8px 10px; text-align: left; vertical-align: middle; font-weight: 700; border-bottom: 3px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);"><strong style="font-weight: bold;">S锁</strong></th></tr></thead><tbody><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);"><strong style="font-weight: bold;">X锁</strong></td><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">No</td><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">No</td></tr><tr><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);"><strong style="font-weight: bold;">S锁</strong></td><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">No</td><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">Yes</td></tr></tbody></table><p style="margin: 0px 0px 20px;">含义就是：<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>对数据项加了<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">X</code>锁，则<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T2</code>不能对其加<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">S</code>和<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">X</code>锁，<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T2</code>对数据项加了<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">S</code>锁，则<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>可以对其加<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">S</code>锁而不能加<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">X</code>锁。（<strong style="font-weight: bold;">相容矩阵的加锁顺序都是是T1先加锁，T2后加锁</strong>）</p><ul><li style="list-style: circle;"><strong style="font-weight: bold;">READ UNCOMMITTED（读未提交）</strong>最低级别，以上情况均无法保证。</li></ul><p style="margin: 0px 0px 20px;">官网给出建议：该隔离级别仅仅能做查询</p><blockquote style="margin: 0px; padding: 0px 15px; color: rgb(102, 102, 102); border-left: 4px solid rgb(221, 221, 221);"><p style="margin: 0px 0px 20px;">The <strong style="font-weight: bold;">isolation level</strong> that provides the least amount of protection between transactions. Queries employ a <strong style="font-weight: bold;">locking</strong> strategy that allows them to proceed in situations where they would normally wait for another transaction. However, this extra performance comes at the cost of less reliable results, including data that has been changed by other transactions and not committed yet (known as <strong style="font-weight: bold;">dirty read</strong>). Use this isolation level with great caution, and be aware that the results might not be consistent or reproducible, depending on what other transactions are doing at the same time. Typically, transactions with this isolation level only do queries, not insert, update, or delete operations.</p></blockquote><p style="margin: 0px 0px 20px;">由于其不能保证<strong style="font-weight: bold;">读脏数据</strong>，因此S锁和X是相容的；因此可能如下：</p><table style="border-collapse: collapse; border-spacing: 0px; margin: 20px 0px; width: 899px; border: 1px solid rgb(221, 221, 221); font-size: 14px; table-layout: fixed;"><thead><tr><th style="padding: 8px 8px 10px; text-align: left; vertical-align: middle; font-weight: 700; border-bottom: 3px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">T1 / T2</th><th style="padding: 8px 8px 10px; text-align: left; vertical-align: middle; font-weight: 700; border-bottom: 3px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">X锁</th><th style="padding: 8px 8px 10px; text-align: left; vertical-align: middle; font-weight: 700; border-bottom: 3px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">S锁</th></tr></thead><tbody><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);"><strong style="font-weight: bold;">X锁</strong></td><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">No(?待考证)</td><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">Yes</td></tr><tr><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);"><strong style="font-weight: bold;">S锁</strong></td><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">Yes</td><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">Yes</td></tr></tbody></table><ul><li style="list-style: circle;"><strong style="font-weight: bold;">READ COMMITTED（读已提交）</strong>可避免脏读情况发生。</li></ul><p style="margin: 0px 0px 20px;">读已提交，避免脏读，但是不能保证可重复读；说明<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">X</code>锁和<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T2</code>的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">S</code>锁不相容；而<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">S</code>锁和<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">X</code>锁相容的。<strong style="font-weight: bold;">也就是保证了某个事务在写数据项的时候，其他事务是不能读写该数据项的。</strong></p><table style="border-collapse: collapse; border-spacing: 0px; margin: 20px 0px; width: 899px; border: 1px solid rgb(221, 221, 221); font-size: 14px; table-layout: fixed;"><thead><tr><th style="padding: 8px 8px 10px; text-align: left; vertical-align: middle; font-weight: 700; border-bottom: 3px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">T1 / T2</th><th style="padding: 8px 8px 10px; text-align: left; vertical-align: middle; font-weight: 700; border-bottom: 3px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">X锁</th><th style="padding: 8px 8px 10px; text-align: left; vertical-align: middle; font-weight: 700; border-bottom: 3px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">S锁</th></tr></thead><tbody><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);"><strong style="font-weight: bold;">X锁</strong></td><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">No</td><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">No</td></tr><tr><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);"><strong style="font-weight: bold;">S锁</strong></td><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">Yes</td><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">Yes</td></tr></tbody></table><ul><li style="list-style: circle;"><strong style="font-weight: bold;">REPEATABLE READ（可重复读）</strong>可避免脏读、不可重复读情况的发生。</li></ul><p style="margin: 0px 0px 20px;">可重复读，避免了脏读和不可重复读；说明<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">X</code>锁和<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T2</code>的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">S</code>锁、<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">S</code>锁和<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T2</code>的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">X</code>锁都不相容。<strong style="font-weight: bold;">也就是保证了某个事务在写某个数据项的时候，其他事务不能读写该数据项；且在读某个数据项时，其他事务只能读该数据项。</strong></p><table style="border-collapse: collapse; border-spacing: 0px; margin: 20px 0px; width: 899px; border: 1px solid rgb(221, 221, 221); font-size: 14px; table-layout: fixed;"><thead><tr><th style="padding: 8px 8px 10px; text-align: left; vertical-align: middle; font-weight: 700; border-bottom: 3px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">T1 / T2</th><th style="padding: 8px 8px 10px; text-align: left; vertical-align: middle; font-weight: 700; border-bottom: 3px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">X锁</th><th style="padding: 8px 8px 10px; text-align: left; vertical-align: middle; font-weight: 700; border-bottom: 3px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">S锁</th></tr></thead><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">X锁</td><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">No</td><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">No</td></tr><tr><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">S锁</td><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">No</td><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">Yes</td></tr></table><ul><li style="list-style: circle;"><strong style="font-weight: bold;">SERIALIZABLE（可串行化）</strong>可避免脏读、不可重复读、幻读情况的发生。</li></ul><p style="margin: 0px 0px 20px;">为了避免幻读、不可重复读、脏读、丢失修改等产生，将并发事务的<strong style="font-weight: bold;">事务调度策略</strong>设置为为<strong style="font-weight: bold;">可串行化调度</strong>，这能保证该事务调度策略的运行结果同<strong style="font-weight: bold;">某一种串行调度</strong>结果一致，但是这会极大的降低并发度；同时，这也是<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">MySQL</code>的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">InnoDB</code>提供的最高的事务隔离级别，这里的相容矩阵同3。</p><blockquote style="margin: 0px; padding: 0px 15px; color: rgb(102, 102, 102); border-left: 4px solid rgb(221, 221, 221);"><p style="margin: 0px 0px 20px;">The <strong style="font-weight: bold;">isolation level</strong> that uses the most conservative locking strategy, to prevent any other <strong style="font-weight: bold;">transactions</strong> from inserting or changing data that was read by this transaction, until it is finished. This way, the same query can be run over and over within a transaction, and be certain to retrieve the same set of results each time. Any attempt to change data that was committed by another transaction since the start of the current transaction, cause the current transaction to wait.</p><p style="margin: 0px 0px 20px;">This is the default isolation level specified by the SQL standard. In practice, this degree of strictness is rarely needed, so the default isolation level for <code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">InnoDB</code> is the next most strict, <strong style="font-weight: bold;">REPEATABLE READ</strong>.</p></blockquote><h2 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="https://spground.github.io/2018/01/04/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB/#4-References" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="4. References"></a>4. References</h2><p style="margin: 0px 0px 20px;"><a href="https://dev.mysql.com/doc/refman/5.7/en/glossary.html#glos_isolation_level" rel="noopener" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" target="_blank">https://dev.mysql.com/doc/refman/5.7/en/glossary.html#glos_isolation_level</a></p><p style="margin: 0px 0px 20px;"><a href="http://www.cnblogs.com/xdp-gacl/p/3984001.html" rel="noopener" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" target="_blank">http://www.cnblogs.com/xdp-gacl/p/3984001.html</a></p><div style="margin: 0px 0px 20px;"><div><a href="https://spground.github.io/2018/01/04/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB/" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;">《数据库系统概论》王珊，萨师煊</a></div></div></div></div></span>
</div>
<hr>
<a name="902"/>

<div>
<span><div><h1 style="font-size: 26px; margin: 0px; padding: 0px; font-weight: 400; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; text-align: center; word-break: break-word;">HashMap工作原理和扩容机制</h1><div style="margin: 3px 0px 60px; color: rgb(153, 153, 153); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 12px; text-align: center;"><span style="margin-right: 3px;"> </span>发表于 2017-12-30 <span style="margin: 0px 0.5em;">|</span> <span style="margin-right: 3px;"> </span>分类于 <a href="https://spground.github.io/categories/Java%E6%BA%90%E7%A0%81/" rel="index" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;">Java源码 </a><span style="margin: 0px 0.5em;">|</span> <span style="margin-right: 3px;"> </span>阅读次数 13</div><div style="font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; text-align: justify; color: rgb(85, 85, 85); font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><h2 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="https://spground.github.io/2017/12/30/HashMap%E7%9A%84%E6%89%A9%E5%AE%B9/#1-HashMap%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="1. HashMap工作原理"></a>1. HashMap工作原理</h2><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>作为优秀的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Java</code>集合框架中的一个重要的成员，在很多编程场景下为我们所用。<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>作为数据结构散列表的一种实现，就其工作原理来讲单独列出一篇博客来讲都是不过分的。由于本文主要是简单总结其扩容机制，因此对于<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>的实现原理仅做简单的概述。</p><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>内部实现是一个<strong style="font-weight: bold;">桶数组</strong>，每个桶中存放着一个<strong style="font-weight: bold;">单链表</strong>的头结点。其中每个结点存储的是一个<strong style="font-weight: bold;">键值对</strong>整体（<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Entry</code>），<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>采用<strong style="font-weight: bold;">拉链法</strong>解决<strong style="font-weight: bold;">哈希冲突</strong>（关于哈希冲突后面会介绍）。</p><p style="margin: 0px 0px 20px;"><em>由于<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Java8</code>对<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>的某些地方进行了优化，以下的总结和源码分析都是基于<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Java7</code>。</em></p><p style="margin: 0px 0px 20px;">示意图如下：</p><p style="margin: 0px 0px 20px;"><a href="http://img.blog.csdn.net/20171119123859600?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxNDUzMjkwMQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" rel="group" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;"><img src="常见面试基础题_files/Image [11].png" type="image/png" data-filename="Image.png" style="border: 1px solid rgb(221, 221, 221); margin: 0px auto; max-width: 100%; height: auto; cursor: -webkit-zoom-in; box-sizing: border-box; padding: 3px; display: block !important;"/></a></p><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>提供两个重要的基本操作，<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">put(K, V)</code>和<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">get(K)</code>。</p><ul><li style="list-style: circle;">当调用<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">put</code>操作时，<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>计算键值K的哈希值，然后将其对应到<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>的某一个桶(<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">bucket</code>)上；此时找到以这个桶为头结点的一个单链表，然后顺序遍历该单链表找到某个节点的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Entry</code>中的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Key</code>是<strong style="font-weight: bold;">等于</strong>给定的参数K；若找到，则将其的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">old V</code>替换为参数指定的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">V</code>；否则直接在链表尾部插入一个新的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Entry</code>节点。</li><li style="list-style: circle;">对于<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">get(K)</code>操作类似于<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">put</code>操作，<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>通过计算键的哈希值，先找到对应的桶，然后遍历桶存放的单链表通过比照<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Entry</code>的键来找到对应的值。</li></ul><p style="margin: 0px 0px 20px;">以上就是<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>的基本工作原理，但是问题总是比我们看到的要复杂。由于哈希是一种压缩映射，换句话说就是每一个<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Entry</code>节点无法对应到一个<strong style="font-weight: bold;">只属于</strong>自己的桶，那么必然会存在多个<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Entry</code>共用一个桶，拉成一条链表的情况，这种情况叫做<strong style="font-weight: bold;">哈希冲突</strong>。当哈希冲突产生严重的情况，某一个桶后面挂着的链表就会特别长，我们知道<strong style="font-weight: bold;">查找</strong>最怕看见的就是顺序查找，那几乎就是无脑查找。</p><p style="margin: 0px 0px 20px;"><strong style="font-weight: bold;">哈希冲突</strong>无法完全避免，因此为了提高<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>的性能，<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>不得尽量<strong style="font-weight: bold;">缓解</strong>哈希冲突以<strong style="font-weight: bold;">缩短</strong>每个桶的外挂链表长度。</p><p style="margin: 0px 0px 20px;">频繁产生哈希冲突最重要的原因就像是<strong style="font-weight: bold;">要存储的Entry太多，而桶不够</strong>，这和供不应求的矛盾类似。因此，当<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>中的存储的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Entry</code>较多的时候，我们就要考虑<strong style="font-weight: bold;">增加桶的数量</strong>，这样对于后续要存储的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Entry</code>来讲，就会大大缓解哈希冲突。</p><p style="margin: 0px 0px 20px;">因此就涉及到<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>的扩容，上面算是回答了为什么扩容，那么什么时候扩容？扩容多少？怎么扩容？便是第二部分要总结的了。</p><h2 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="https://spground.github.io/2017/12/30/HashMap%E7%9A%84%E6%89%A9%E5%AE%B9/#2-HashMap%E6%89%A9%E5%AE%B9" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="2. HashMap扩容"></a>2. HashMap扩容</h2><h3 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 18px;"><a href="https://spground.github.io/2017/12/30/HashMap%E7%9A%84%E6%89%A9%E5%AE%B9/#2-1-HashMap%E7%9A%84%E6%89%A9%E5%AE%B9%E6%97%B6%E6%9C%BA" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="2.1 HashMap的扩容时机"></a>2.1 HashMap的扩容时机</h3><p style="margin: 0px 0px 20px;">在使用<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>的过程中，我们经常会遇到这样一个带参数的构造方法。</p><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; border: none; font-size: 14px; table-layout: fixed;width:416.7px;"><tbody><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;width:8.399328053755701%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;width:91.99568763330372%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 414px;"><span style="height: 20px;"><span style="color: rgb(129, 162, 190);"><span style="color: rgb(178, 148, 187);">public</span> <span style="color: rgb(138, 190, 183);">HashMap</span><span style="color: rgb(222, 147, 95);">(<span style="color: rgb(178, 148, 187);">int</span> initialCapacity, <span style="color: rgb(178, 148, 187);">float</span> loadFactor)</span> </span>;</span><br/></pre></td></tr></tbody></table><ul><li style="list-style: circle;">第一个参数：初始容量，指明初始的桶的个数；相当于桶数组的大小。</li><li style="list-style: circle;">第二个参数：装载因子，是一个0-1之间的系数，根据它来确定需要扩容的阈值，默认值是0.75。</li></ul><p style="margin: 0px 0px 20px;">现在开始通过源码来寻找扩容的时机：</p><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">put(K, V)</code>操作</p><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; border: none; font-size: 14px; table-layout: fixed;width:830.7px;"><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;width:4.213314072469002%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/><span style="height: 20px;">2</span><br/><span style="height: 20px;">3</span><br/><span style="height: 20px;">4</span><br/><span style="height: 20px;">5</span><br/><span style="height: 20px;">6</span><br/><span style="height: 20px;">7</span><br/><span style="height: 20px;">8</span><br/><span style="height: 20px;">9</span><br/><span style="height: 20px;">10</span><br/><span style="height: 20px;">11</span><br/><span style="height: 20px;">12</span><br/><span style="height: 20px;">13</span><br/><span style="height: 20px;">14</span><br/><span style="height: 20px;">15</span><br/><span style="height: 20px;">16</span><br/><span style="height: 20px;">17</span><br/><span style="height: 20px;">18</span><br/><span style="height: 20px;">19</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;width:96.00000000000001%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 866px;"><span style="height: 20px;"><span style="color: rgb(129, 162, 190);"><span style="color: rgb(178, 148, 187);">public</span> V <span style="color: rgb(138, 190, 183);">put</span><span style="color: rgb(222, 147, 95);">(K key, V value)</span> </span>{</span><br/><span style="height: 20px;">        <span style="color: rgb(178, 148, 187);">if</span> (key == <span style="color: rgb(178, 148, 187);">null</span>)</span><br/><span style="height: 20px;">            <span style="color: rgb(178, 148, 187);">return</span> putForNullKey(value);</span><br/><span style="height: 20px;">        <span style="color: rgb(178, 148, 187);">int</span> hash = hash(key);<span style="color: rgb(150, 152, 150);">//计算键的hash值</span></span><br/><span style="height: 20px;">        <span style="color: rgb(178, 148, 187);">int</span> i = indexFor(hash, table.length);<span style="color: rgb(150, 152, 150);">//通过hash值对应到桶位置</span></span><br/><span style="height: 20px;">        <span style="color: rgb(178, 148, 187);">for</span> (Entry&lt;K,V&gt; e = table[i]; e != <span style="color: rgb(178, 148, 187);">null</span>; e = e.next) {<span style="color: rgb(150, 152, 150);">//顺序遍历桶外挂的单链表</span></span><br/><span style="height: 20px;">            Object k;</span><br/><span style="height: 20px;">            <span style="color: rgb(178, 148, 187);">if</span> (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) {<span style="color: rgb(150, 152, 150);">//注意这里的键的比较方式== 或者 equals()</span></span><br/><span style="height: 20px;">                V oldValue = e.value;</span><br/><span style="height: 20px;">                e.value = value;</span><br/><span style="height: 20px;">                e.recordAccess(<span style="color: rgb(178, 148, 187);">this</span>);</span><br/><span style="height: 20px;">                <span style="color: rgb(178, 148, 187);">return</span> oldValue;</span><br/><span style="height: 20px;">            }</span><br/><span style="height: 20px;">        }</span><br/><br/><span style="height: 20px;">        modCount++;</span><br/><span style="height: 20px;">        addEntry(hash, key, value, i);<span style="color: rgb(150, 152, 150);">//遍历单链表完毕，没有找到与键相对的Entry，需要新建一个Entry换句话说就是桶i是一个空桶；</span></span><br/><span style="height: 20px;">        <span style="color: rgb(178, 148, 187);">return</span> <span style="color: rgb(178, 148, 187);">null</span>;</span><br/><span style="height: 20px;">    }</span><br/></pre></td></tr></table><p style="margin: 0px 0px 20px;">既然找到一个空桶，那么新建的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Entry</code>必然会是这个桶外挂单链表的第一个结点。通过<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">addEntry</code>，找到了扩容的时机。</p><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; border: none; font-size: 14px; table-layout: fixed;width:1444.5px;"><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;width:2.4229837313949463%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/><span style="height: 20px;">2</span><br/><span style="height: 20px;">3</span><br/><span style="height: 20px;">4</span><br/><span style="height: 20px;">5</span><br/><span style="height: 20px;">6</span><br/><span style="height: 20px;">7</span><br/><span style="height: 20px;">8</span><br/><span style="height: 20px;">9</span><br/><span style="height: 20px;">10</span><br/><span style="height: 20px;">11</span><br/><span style="height: 20px;">12</span><br/><span style="height: 20px;">13</span><br/><span style="height: 20px;">14</span><br/><span style="height: 20px;">15</span><br/><span style="height: 20px;">16</span><br/><span style="height: 20px;">17</span><br/><span style="height: 20px;">18</span><br/><span style="height: 20px;">19</span><br/><span style="height: 20px;">20</span><br/><span style="height: 20px;">21</span><br/><span style="height: 20px;">22</span><br/><span style="height: 20px;">23</span><br/><span style="height: 20px;">24</span><br/><span style="height: 20px;">25</span><br/><span style="height: 20px;">26</span><br/><span style="height: 20px;">27</span><br/><span style="height: 20px;">28</span><br/><span style="height: 20px;">29</span><br/><span style="height: 20px;">30</span><br/><span style="height: 20px;">31</span><br/><span style="height: 20px;">32</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;width:98.00437975563688%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 1548px;"><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">/**</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> * Adds a new entry with the specified key, value and hash code to</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> * the specified bucket.  It is the responsibility of this</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> * method to resize the table if appropriate.</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> *</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> * Subclass overrides this to alter the behavior of put method.</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> */</span></span><br/><span style="height: 20px;"><span style="color: rgb(129, 162, 190);"><span style="color: rgb(178, 148, 187);">void</span> <span style="color: rgb(138, 190, 183);">addEntry</span><span style="color: rgb(222, 147, 95);">(<span style="color: rgb(178, 148, 187);">int</span> hash, K key, V value, <span style="color: rgb(178, 148, 187);">int</span> bucketIndex)</span> </span>{</span><br/><span style="height: 20px;">    <span style="color: rgb(178, 148, 187);">if</span> ((size &gt;= threshold) &amp;&amp; (<span style="color: rgb(178, 148, 187);">null</span> != table[bucketIndex])) {<span style="color: rgb(150, 152, 150);">//当size大于等于某一个阈值thresholdde时候且该桶并不是一个空桶；</span></span><br/><span style="height: 20px;">      <span style="color: rgb(150, 152, 150);">/*这个这样说明比较好理解：因为size 已经大于等于阈值了，说明Entry数量较多，哈希冲突严重，那么若该Entry对应的桶不是一个空桶，这个Entry的加入必然会把原来的链表拉得更长，因此需要扩容；若对应的桶是一个空桶，那么此时没有必要扩容。*/</span></span><br/><span style="height: 20px;">        resize(<span style="color: rgb(181, 189, 104);">2</span> * table.length);<span style="color: rgb(150, 152, 150);">//将容量扩容为原来的2倍</span></span><br/><span style="height: 20px;">        hash = (<span style="color: rgb(178, 148, 187);">null</span> != key) ? hash(key) : <span style="color: rgb(181, 189, 104);">0</span>;</span><br/><span style="height: 20px;">        bucketIndex = indexFor(hash, table.length);<span style="color: rgb(150, 152, 150);">//扩容后的，该hash值对应的新的桶位置</span></span><br/><span style="height: 20px;">    }</span><br/><br/><span style="height: 20px;">    createEntry(hash, key, value, bucketIndex);<span style="color: rgb(150, 152, 150);">//在指定的桶位置上，创建一个新的Entry</span></span><br/><span style="height: 20px;">}</span><br/><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">/**</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> * Like addEntry except that this version is used when creating entries</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> * as part of Map construction or &quot;pseudo-construction&quot; (cloning,</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> * deserialization).  This version needn't worry about resizing the table.</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> *</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> * Subclass overrides this to alter the behavior of HashMap(Map),</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> * clone, and readObject.</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> */</span></span><br/><span style="height: 20px;"><span style="color: rgb(129, 162, 190);"><span style="color: rgb(178, 148, 187);">void</span> <span style="color: rgb(138, 190, 183);">createEntry</span><span style="color: rgb(222, 147, 95);">(<span style="color: rgb(178, 148, 187);">int</span> hash, K key, V value, <span style="color: rgb(178, 148, 187);">int</span> bucketIndex)</span> </span>{</span><br/><span style="height: 20px;">    Entry&lt;K,V&gt; e = table[bucketIndex];</span><br/><span style="height: 20px;">    table[bucketIndex] = <span style="color: rgb(178, 148, 187);">new</span> Entry&lt;&gt;(hash, key, value, e);<span style="color: rgb(150, 152, 150);">//链表的头插法插入新建的Entry</span></span><br/><span style="height: 20px;">    size++;<span style="color: rgb(150, 152, 150);">//更新size</span></span><br/><span style="height: 20px;">}</span><br/></pre></td></tr></table><p style="margin: 0px 0px 20px;">上面有几个重要成员变量：</p><ul><li style="list-style: circle;">size</li><li style="list-style: circle;">threshold</li></ul><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; border: none; font-size: 14px; table-layout: fixed;width:507.6px;"><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;width:6.895193065405832%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/><span style="height: 20px;">2</span><br/><span style="height: 20px;">3</span><br/><span style="height: 20px;">4</span><br/><span style="height: 20px;">5</span><br/><span style="height: 20px;">6</span><br/><span style="height: 20px;">7</span><br/><span style="height: 20px;">8</span><br/><span style="height: 20px;">9</span><br/><span style="height: 20px;">10</span><br/><span style="height: 20px;">11</span><br/><span style="height: 20px;">12</span><br/><span style="height: 20px;">13</span><br/><span style="height: 20px;">14</span><br/><span style="height: 20px;">15</span><br/><span style="height: 20px;">16</span><br/><span style="height: 20px;">17</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;width:94.0097192871382%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 507px;"><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">/**</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">  * The number of key-value mappings contained in this map.</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">  */</span>    </span><br/><span style="height: 20px;"><span style="color: rgb(178, 148, 187);">transient</span> <span style="color: rgb(178, 148, 187);">int</span> size;</span><br/><br/><span style="height: 20px;"> <span style="color: rgb(150, 152, 150);">/**</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">  * The next size value at which to resize (capacity * load factor).</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">  * @serial</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">  */</span></span><br/><span style="height: 20px;"> <span style="color: rgb(178, 148, 187);">int</span> threshold;</span><br/><br/><span style="height: 20px;"> <span style="color: rgb(150, 152, 150);">/**</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">  * The load factor for the hash table.</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">  *</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">  * @serial</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">  */</span></span><br/><span style="height: 20px;"> <span style="color: rgb(178, 148, 187);">final</span> <span style="color: rgb(178, 148, 187);">float</span> loadFactor;</span><br/></pre></td></tr></table><p style="margin: 0px 0px 20px;">由注释可以知道：</p><ul><li style="list-style: circle;"><p style="margin: 0px 0px 20px;">size记录的是map中包含的Entry的数量</p></li><li style="list-style: circle;"><p style="margin: 0px 0px 20px;">而threshold记录的是需要resize的阈值 且 <code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">threshold = loadFactor * capacity</code></p></li><li style="list-style: circle;"><p style="margin: 0px 0px 20px;">capacity 其实就是桶的长度</p><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; border: none; font-size: 14px; table-layout: fixed;width:539.1px;"><tbody><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;width:6.4923019847894645%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;width:93.99479087952486%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 549px;"><span style="height: 20px;">threshold = (<span style="color: rgb(178, 148, 187);">int</span>)Math.min(newCapacity * loadFactor, MAXIMUM_CAPACITY + <span style="color: rgb(181, 189, 104);">1</span>);</span><br/></pre></td></tr></tbody></table></li></ul><p style="margin: 0px 0px 20px;">因此现在总结出扩容的时机：</p><p style="margin: 0px 0px 20px;"><strong style="font-weight: bold;">当<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">map</code>中包含的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Entry</code>的数量大于等于<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">threshold = loadFactor * capacity</code>的时候，且新建的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Entry</code>刚好落在一个非空的桶上，此刻触发扩容机制，将其容量扩大为2倍。</strong>（为什么2倍，而不是1.5倍，3倍，10倍；解释见最后的补充）</p><p style="margin: 0px 0px 20px;">当<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">size</code>大于等于<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">threshold</code>的时候，并不一定会触发扩容机制，但是会很可能就触发扩容机制，只要有一个新建的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Entry</code>出现哈希冲突，则立刻<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">resize</code>。</p><p style="margin: 0px 0px 20px;">直到这里我们回答了什么时候扩容和扩容多少的问题，那么下面回答如何扩容的问题。</p><h3 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 18px;"><a href="https://spground.github.io/2017/12/30/HashMap%E7%9A%84%E6%89%A9%E5%AE%B9/#2-2-HashMap%E7%9A%84%E6%89%A9%E5%AE%B9%E8%BF%87%E7%A8%8B" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="2.2 HashMap的扩容过程"></a>2.2 HashMap的扩容过程</h3><p style="margin: 0px 0px 20px;">上面有一个很重要的方法，包含了几乎属于的扩容过程，这就是<br/></p><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; border: none; font-size: 14px; table-layout: fixed;width:114.3px;"><tbody><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;width:30.621172353455815%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;width:69.9430705261108%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 78px;"><span style="height: 20px;">resize()</span><br/></pre></td></tr></tbody></table><p style="margin: 0px 0px 20px;"></p><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; border: none; font-size: 14px; table-layout: fixed;width:688.5px;"><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;width:5.083514887436456%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/><span style="height: 20px;">2</span><br/><span style="height: 20px;">3</span><br/><span style="height: 20px;">4</span><br/><span style="height: 20px;">5</span><br/><span style="height: 20px;">6</span><br/><span style="height: 20px;">7</span><br/><span style="height: 20px;">8</span><br/><span style="height: 20px;">9</span><br/><span style="height: 20px;">10</span><br/><span style="height: 20px;">11</span><br/><span style="height: 20px;">12</span><br/><span style="height: 20px;">13</span><br/><span style="height: 20px;">14</span><br/><span style="height: 20px;">15</span><br/><span style="height: 20px;">16</span><br/><span style="height: 20px;">17</span><br/><span style="height: 20px;">18</span><br/><span style="height: 20px;">19</span><br/><span style="height: 20px;">20</span><br/><span style="height: 20px;">21</span><br/><span style="height: 20px;">22</span><br/><span style="height: 20px;">23</span><br/><span style="height: 20px;">24</span><br/><span style="height: 20px;">25</span><br/><span style="height: 20px;">26</span><br/><span style="height: 20px;">27</span><br/><span style="height: 20px;">28</span><br/><span style="height: 20px;">29</span><br/><span style="height: 20px;">30</span><br/><span style="height: 20px;">31</span><br/><span style="height: 20px;">32</span><br/><span style="height: 20px;">33</span><br/><span style="height: 20px;">34</span><br/><span style="height: 20px;">35</span><br/><span style="height: 20px;">36</span><br/><span style="height: 20px;">37</span><br/><span style="height: 20px;">38</span><br/><span style="height: 20px;">39</span><br/><span style="height: 20px;">40</span><br/><span style="height: 20px;">41</span><br/><span style="height: 20px;">42</span><br/><span style="height: 20px;">43</span><br/><span style="height: 20px;">44</span><br/><span style="height: 20px;">45</span><br/><span style="height: 20px;">46</span><br/><span style="height: 20px;">47</span><br/><span style="height: 20px;">48</span><br/><span style="height: 20px;">49</span><br/><span style="height: 20px;">50</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;width:95.00983494398359%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 1111px;"><span style="height: 20px;"> <span style="color: rgb(150, 152, 150);">/**</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> * Rehashes the contents of this map into a new array with a</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> * larger capacity.  This method is called automatically when the</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> * number of keys in this map reaches its threshold.</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> *</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> * If current capacity is MAXIMUM_CAPACITY, this method does not</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> * resize the map, but sets threshold to Integer.MAX_VALUE.</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> * This has the effect of preventing future calls.</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> *</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> * @param newCapacity the new capacity, MUST be a power of two;</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> *        must be greater than current capacity unless current</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> *        capacity is MAXIMUM_CAPACITY (in which case value</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> *        is irrelevant).</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> */</span></span><br/><span style="height: 20px;"><span style="color: rgb(129, 162, 190);"><span style="color: rgb(178, 148, 187);">void</span> <span style="color: rgb(138, 190, 183);">resize</span><span style="color: rgb(222, 147, 95);">(<span style="color: rgb(178, 148, 187);">int</span> newCapacity)</span> </span>{</span><br/><span style="height: 20px;">    Entry[] oldTable = table;</span><br/><span style="height: 20px;">    <span style="color: rgb(178, 148, 187);">int</span> oldCapacity = oldTable.length;</span><br/><span style="height: 20px;">    <span style="color: rgb(178, 148, 187);">if</span> (oldCapacity == MAXIMUM_CAPACITY) {<span style="color: rgb(150, 152, 150);">//最大容量为 1 &lt;&lt; 30</span></span><br/><span style="height: 20px;">        threshold = Integer.MAX_VALUE;</span><br/><span style="height: 20px;">        <span style="color: rgb(178, 148, 187);">return</span>;</span><br/><span style="height: 20px;">    }</span><br/><br/><span style="height: 20px;">    Entry[] newTable = <span style="color: rgb(178, 148, 187);">new</span> Entry[newCapacity];<span style="color: rgb(150, 152, 150);">//新建一个新表</span></span><br/><span style="height: 20px;">    <span style="color: rgb(178, 148, 187);">boolean</span> oldAltHashing = useAltHashing;</span><br/><span style="height: 20px;">    useAltHashing |= sun.misc.VM.isBooted() &amp;&amp;</span><br/><span style="height: 20px;">            (newCapacity &gt;= Holder.ALTERNATIVE_HASHING_THRESHOLD);</span><br/><span style="height: 20px;">    <span style="color: rgb(178, 148, 187);">boolean</span> rehash = oldAltHashing ^ useAltHashing;<span style="color: rgb(150, 152, 150);">//是否再hash</span></span><br/><span style="height: 20px;">    transfer(newTable, rehash);<span style="color: rgb(150, 152, 150);">//完成旧表到新表的转移</span></span><br/><span style="height: 20px;">    table = newTable;</span><br/><span style="height: 20px;">    threshold = (<span style="color: rgb(178, 148, 187);">int</span>)Math.min(newCapacity * loadFactor, MAXIMUM_CAPACITY + <span style="color: rgb(181, 189, 104);">1</span>);</span><br/><span style="height: 20px;">}</span><br/><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">/**</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> * Transfers all entries from current table to newTable.</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> */</span></span><br/><span style="height: 20px;"><span style="color: rgb(129, 162, 190);"><span style="color: rgb(178, 148, 187);">void</span> <span style="color: rgb(138, 190, 183);">transfer</span><span style="color: rgb(222, 147, 95);">(Entry[] newTable, <span style="color: rgb(178, 148, 187);">boolean</span> rehash)</span> </span>{</span><br/><span style="height: 20px;">    <span style="color: rgb(178, 148, 187);">int</span> newCapacity = newTable.length;</span><br/><span style="height: 20px;">    <span style="color: rgb(178, 148, 187);">for</span> (Entry&lt;K,V&gt; e : table) {<span style="color: rgb(150, 152, 150);">//遍历同桶数组中的每一个桶</span></span><br/><span style="height: 20px;">        <span style="color: rgb(178, 148, 187);">while</span>(<span style="color: rgb(178, 148, 187);">null</span> != e) {<span style="color: rgb(150, 152, 150);">//顺序遍历某个桶的外挂链表</span></span><br/><span style="height: 20px;">            Entry&lt;K,V&gt; next = e.next;<span style="color: rgb(150, 152, 150);">//引用next</span></span><br/><span style="height: 20px;">            <span style="color: rgb(178, 148, 187);">if</span> (rehash) {</span><br/><span style="height: 20px;">                e.hash = <span style="color: rgb(178, 148, 187);">null</span> == e.key ? <span style="color: rgb(181, 189, 104);">0</span> : hash(e.key);</span><br/><span style="height: 20px;">            }</span><br/><span style="height: 20px;">            <span style="color: rgb(178, 148, 187);">int</span> i = indexFor(e.hash, newCapacity);<span style="color: rgb(150, 152, 150);">//找到新表的桶位置;原桶数组中的某个桶上的同一链表中的Entry此刻可能被分散到不同的桶中去了，有效的缓解了哈希冲突。</span></span><br/><span style="height: 20px;">            e.next = newTable[i];<span style="color: rgb(150, 152, 150);">//头插法插入新表中</span></span><br/><span style="height: 20px;">            newTable[i] = e;</span><br/><span style="height: 20px;">            e = next;</span><br/><span style="height: 20px;">        }</span><br/><span style="height: 20px;">    }</span><br/><span style="height: 20px;">}</span><br/></pre></td></tr></table><p style="margin: 0px 0px 20px;">对于<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">resize</code>的过程，相对来讲是比较简单清晰易于理解的。<strong style="font-weight: bold;">旧桶数组中的某个桶的外挂单链表是通过头插法插入新桶数组中的，并且原链表中的Entry结点并不一定仍然在新桶数组的同一链表</strong>。</p><p style="margin: 0px 0px 20px;">示意图如下：</p><p style="margin: 0px 0px 20px;"><a href="http://tech.meituan.com/img/java-hashmap/jdk1.8%20hashMap%E6%89%A9%E5%AE%B9%E4%BE%8B%E5%9B%BE.png" rel="group" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;"><img src="http://tech.meituan.com/img/java-hashmap/jdk1.8%20hashMap%E6%89%A9%E5%AE%B9%E4%BE%8B%E5%9B%BE.png" style="border: 1px solid rgb(221, 221, 221); margin: 0px auto; max-width: 100%; height: auto; cursor: -webkit-zoom-in; box-sizing: border-box; padding: 3px; display: block !important;"></img></a></p><p style="margin: 0px 0px 20px;">这里很容易就想到多线程情况下，隐约感觉这个<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">transfer</code>方法在多线程环境下会乱套。事实上也是这样的，由于<strong style="font-weight: bold;">缺乏同步机制</strong>，当多个线程同时<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">resize</code>的时候，某个线程<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">t</code>所持有的引用<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">next</code>（参考上面代码<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">next</code>指向原桶数组中某个桶外挂单链表的下一个需要转移的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Entry</code>），可能已经被转移到了新桶数组中，那么最后该线程<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">t</code>实际上在对新的桶数组进行<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">transfer</code>操作。</p><p style="margin: 0px 0px 20px;">如果有更多的线程出现这种情况，那很可能出现大量线程都在对<strong style="font-weight: bold;">新桶数组</strong>进行<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">transfer</code>，那么就会出现多个线程对同一链表<strong style="font-weight: bold;">无限进行链表反转</strong>的操作，极易造成死循环，数据丢失等等，因此<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>不是线程安全的，考虑在多线程环境下使用并发工具包下的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">ConcurrentHashMap</code>。</p><h2 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="https://spground.github.io/2017/12/30/HashMap%E7%9A%84%E6%89%A9%E5%AE%B9/#3-%E8%A1%A5%E5%85%85" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="3. 补充"></a>3. 补充</h2><h3 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 18px;"><a href="https://spground.github.io/2017/12/30/HashMap%E7%9A%84%E6%89%A9%E5%AE%B9/#3-1-%E5%AE%B9%E9%87%8F%E5%BF%85%E9%A1%BB%E6%98%AF2%E7%9A%84%E5%B9%82" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="3.1 容量必须是2的幂"></a>3.1 容量必须是2的幂</h3><p style="margin: 0px 0px 20px;">在<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">resize()</code>，为什么容量需要时2倍这样扩张，而不是1.5倍，3倍，10倍，另外在<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>中有如下的代码：</p><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; border: none; font-size: 14px; table-layout: fixed;width:430.2px;"><tbody><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;width:8.135750813575083%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/><span style="height: 20px;">2</span><br/><span style="height: 20px;">3</span><br/><span style="height: 20px;">4</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;width:91.99710750760269%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 428px;"><span style="height: 20px;"> <span style="color: rgb(150, 152, 150);">/**</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> * The default initial capacity - MUST be a power of two.</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> */</span></span><br/><span style="height: 20px;"><span style="color: rgb(178, 148, 187);">static</span> <span style="color: rgb(178, 148, 187);">final</span> <span style="color: rgb(178, 148, 187);">int</span> DEFAULT_INITIAL_CAPACITY = <span style="color: rgb(181, 189, 104);">16</span>;</span><br/></pre></td></tr></tbody></table><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; border: none; font-size: 14px; table-layout: fixed;width:444.6px;"><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;width:7.872244714349977%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/><span style="height: 20px;">2</span><br/><span style="height: 20px;">3</span><br/><span style="height: 20px;">4</span><br/><span style="height: 20px;">5</span><br/><span style="height: 20px;">6</span><br/><span style="height: 20px;">7</span><br/><span style="height: 20px;">8</span><br/><span style="height: 20px;">9</span><br/><span style="height: 20px;">10</span><br/><span style="height: 20px;">11</span><br/><span style="height: 20px;">12</span><br/><span style="height: 20px;">13</span><br/><span style="height: 20px;">14</span><br/><span style="height: 20px;">15</span><br/><span style="height: 20px;">16</span><br/><span style="height: 20px;">17</span><br/><span style="height: 20px;">18</span><br/><span style="height: 20px;">19</span><br/><span style="height: 20px;">20</span><br/><span style="height: 20px;">21</span><br/><span style="height: 20px;">22</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;width:93.10620583885633%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 696px;"><span style="height: 20px;"><span style="color: rgb(129, 162, 190);"><span style="color: rgb(178, 148, 187);">public</span> <span style="color: rgb(138, 190, 183);">HashMap</span><span style="color: rgb(222, 147, 95);">(<span style="color: rgb(178, 148, 187);">int</span> initialCapacity, <span style="color: rgb(178, 148, 187);">float</span> loadFactor)</span> </span>{</span><br/><span style="height: 20px;">        <span style="color: rgb(178, 148, 187);">if</span> (initialCapacity &lt; <span style="color: rgb(181, 189, 104);">0</span>)</span><br/><span style="height: 20px;">            <span style="color: rgb(178, 148, 187);">throw</span> <span style="color: rgb(178, 148, 187);">new</span> IllegalArgumentException(<span style="color: rgb(181, 189, 104);">&quot;Illegal initial capacity: &quot;</span> +</span><br/><span style="height: 20px;">                                               initialCapacity);</span><br/><span style="height: 20px;">        <span style="color: rgb(178, 148, 187);">if</span> (initialCapacity &gt; MAXIMUM_CAPACITY)</span><br/><span style="height: 20px;">            initialCapacity = MAXIMUM_CAPACITY;</span><br/><span style="height: 20px;">        <span style="color: rgb(178, 148, 187);">if</span> (loadFactor &lt;= <span style="color: rgb(181, 189, 104);">0</span> || Float.isNaN(loadFactor))</span><br/><span style="height: 20px;">            <span style="color: rgb(178, 148, 187);">throw</span> <span style="color: rgb(178, 148, 187);">new</span> IllegalArgumentException(<span style="color: rgb(181, 189, 104);">&quot;Illegal load factor: &quot;</span> +</span><br/><span style="height: 20px;">                                               loadFactor);</span><br/><br/><span style="height: 20px;">        <span style="color: rgb(150, 152, 150);">// Find a power of 2 &gt;= initialCapacity 找到一个大于等于初始容量的且是2的幂的数作为实际容量</span></span><br/><span style="height: 20px;">        <span style="color: rgb(178, 148, 187);">int</span> capacity = <span style="color: rgb(181, 189, 104);">1</span>;</span><br/><span style="height: 20px;">        <span style="color: rgb(178, 148, 187);">while</span> (capacity &lt; initialCapacity)</span><br/><span style="height: 20px;">            capacity &lt;&lt;= <span style="color: rgb(181, 189, 104);">1</span>;</span><br/><br/><span style="height: 20px;">        <span style="color: rgb(178, 148, 187);">this</span>.loadFactor = loadFactor;</span><br/><span style="height: 20px;">        threshold = (<span style="color: rgb(178, 148, 187);">int</span>)Math.min(capacity * loadFactor, MAXIMUM_CAPACITY + <span style="color: rgb(181, 189, 104);">1</span>);</span><br/><span style="height: 20px;">        table = <span style="color: rgb(178, 148, 187);">new</span> Entry[capacity];</span><br/><span style="height: 20px;">        useAltHashing = sun.misc.VM.isBooted() &amp;&amp;</span><br/><span style="height: 20px;">                (capacity &gt;= Holder.ALTERNATIVE_HASHING_THRESHOLD);</span><br/><span style="height: 20px;">        init();</span><br/><span style="height: 20px;">    }</span><br/></pre></td></tr></table><p style="margin: 0px 0px 20px;">通过以上我们知道<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>的容量必须是2的幂，那么为什么要这么设计呢？答案当然是为了性能。在<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>通过键的哈希值进行定位桶位置的时候，调用了一个<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">indexFor(hash, table.length);</code>方法。</p><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; border: none; font-size: 14px; table-layout: fixed;width:340.2px;"><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;width:10.2880658436214%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/><span style="height: 20px;">2</span><br/><span style="height: 20px;">3</span><br/><span style="height: 20px;">4</span><br/><span style="height: 20px;">5</span><br/><span style="height: 20px;">6</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;width:89.99371802925603%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 328px;"><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">/**</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">    * Returns index for hash code h.</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">    */</span></span><br/><span style="height: 20px;">   <span style="color: rgb(129, 162, 190);"><span style="color: rgb(178, 148, 187);">static</span> <span style="color: rgb(178, 148, 187);">int</span> <span style="color: rgb(138, 190, 183);">indexFor</span><span style="color: rgb(222, 147, 95);">(<span style="color: rgb(178, 148, 187);">int</span> h, <span style="color: rgb(178, 148, 187);">int</span> length)</span> </span>{</span><br/><span style="height: 20px;">       <span style="color: rgb(178, 148, 187);">return</span> h &amp; (length-<span style="color: rgb(181, 189, 104);">1</span>);</span><br/><span style="height: 20px;">   }</span><br/></pre></td></tr></table><p style="margin: 0px 0px 20px;">可以看到这里是将哈希值<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">h</code>与桶数组的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">length-1</code>（实际上也是<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">map</code>的容量-1）进行了一个与操作得出了对应的桶的位置，<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">h &amp; (length-1)</code>。</p><p style="margin: 0px 0px 20px;">但是为什么不采用<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">h % length</code>这种计算方式呢？</p><p style="margin: 0px 0px 20px;"><a href="https://bugs.java.com/bugdatabase/view_bug.do?bug_id=4631373" rel="noopener" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" target="_blank">https://bugs.java.com/bugdatabase/view_bug.do?bug_id=4631373</a>中提出<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Java</code>的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">%</code>、<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">/</code>操作比<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">&amp;</code>慢10倍左右，因此采用<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">&amp;</code>运算会提高性能。</p><p style="margin: 0px 0px 20px;"><strong style="font-weight: bold;">通过限制<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">length</code>是一个<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">2的幂</code>数，<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">h &amp; (length-1)</code>和<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">h % length</code>结果是一致的。</strong>这就是为什么要限制容量必须是一个<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">2</code>的幂的原因。</p><p style="margin: 0px 0px 20px;">举个简单的例子说明这两个操作的结果一致性：</p><p style="margin: 0px 0px 20px;">假设有个<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">hashcode</code>是311，对应的二进制是(1 0011 0111)</p><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">length</code>为16，对应的二进制位(1 0000)</p><ul><li style="list-style: circle;"><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">%</code>操作：311 = 16*19 + 7；所以结果为7，二进制位(0111)；</p></li><li style="list-style: circle;"><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">&amp;</code>操作：(1 0011 0111) &amp; (0111) = 0111 = 7, 二进制位(0111)</p><p style="margin: 0px 0px 20px;">1 0011 0111 = (1 0011 0000) + (0111) = (1*2^4 + 1* 2^5 + 0*2^6 + 0*2^7 + 1*2^8 ) + 7 = <strong style="font-weight: bold;">2^4</strong>*(1 + 2 + 0 + 0 + 16) + 7 = <strong style="font-weight: bold;">16</strong> * 19 + 7; 和<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">%</code>操作一致。</p><p style="margin: 0px 0px 20px;">如果<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">length</code>是一个2的幂的数，那么<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">length-1</code>就会变成一个<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">mask</code>, 它会将<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">hashcode</code>低位取出来，<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">hashcode</code>的<strong style="font-weight: bold;">低位实际就是余数</strong>，和取余操作相比，与操作会将性能提升很多。</p></li></ul><h3 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 18px;"><a href="https://spground.github.io/2017/12/30/HashMap%E7%9A%84%E6%89%A9%E5%AE%B9/#3-2-rehash" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="3.2 rehash"></a>3.2 rehash</h3><p style="margin: 0px 0px 20px;">通过上面的分析可以看出，不同的键的的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">hashcode</code>仅仅只能通过<strong style="font-weight: bold;">低位</strong>来区分。<strong style="font-weight: bold;">高位的信息</strong>没有被充分利用，举个例子：</p><p style="margin: 0px 0px 20px;">假设容量为为<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">16</code>， 二进制位(<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">10000</code>)。</p><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">key1</code>的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">hashcode</code>为<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">11111 10101</code>，另一个<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">key2</code>的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">hashcode</code>为<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">00000 10101</code>，很明显这两个<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">hashcode</code>不是一样的，甚至连相似性（例如海明距离）也是很远的。但是直接进行<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">&amp;</code>操作得出的桶位置是同一个桶，这直接就产生了<strong style="font-weight: bold;">哈希冲突</strong>。</p><p style="margin: 0px 0px 20px;">由于键的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">hashCode</code>是<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>的使用者来设计的，主要也就是我们这群程序员，由于设计一个良好的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">hashcode</code>分布，是比较困难的，因此会容易出现分布质量差的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">hashcode</code>分布，<strong style="font-weight: bold;">极端情况就是：所有的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">hashCode</code>低位全相等，而高位不相等</strong>，这大大加大了哈希冲突，降低了<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>的性能。</p><p style="margin: 0px 0px 20px;">为了防止这种情况的出现，<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>它使用一个<strong style="font-weight: bold;">supplemental hash function</strong>对键的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">hashCode</code>再进行了一个<strong style="font-weight: bold;">supplemental hash</strong> ，将最终的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">hash</code>值作为键的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">hash</code>值来进行桶的位置映射（也就是说<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">JDK</code>团队在为我们这群程序员加性能保险<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Orz</code>）。这个过程叫做再哈希(<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">rehash</code>)。</p><p style="margin: 0px 0px 20px;">经过一个<strong style="font-weight: bold;">supplemental hash</strong>过程后，能保证<strong style="font-weight: bold;">海明距离为常数</strong>的不同的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">hashcode</code>有一个<strong style="font-weight: bold;">哈希冲突次数上界</strong>（装载因子为0.75的时候，大约是8次）。</p><p style="margin: 0px 0px 20px;">参见下段代码：<br/></p><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; border: none; font-size: 14px; table-layout: fixed;width:577.8000000000001px;"><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;width:6.057459328487365%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/><span style="height: 20px;">2</span><br/><span style="height: 20px;">3</span><br/><span style="height: 20px;">4</span><br/><span style="height: 20px;">5</span><br/><span style="height: 20px;">6</span><br/><span style="height: 20px;">7</span><br/><span style="height: 20px;">8</span><br/><span style="height: 20px;">9</span><br/><span style="height: 20px;">10</span><br/><span style="height: 20px;">11</span><br/><span style="height: 20px;">12</span><br/><span style="height: 20px;">13</span><br/><span style="height: 20px;">14</span><br/><span style="height: 20px;">15</span><br/><span style="height: 20px;">16</span><br/><span style="height: 20px;">17</span><br/><span style="height: 20px;">18</span><br/><span style="height: 20px;">19</span><br/><span style="height: 20px;">20</span><br/><span style="height: 20px;">21</span><br/><span style="height: 20px;">22</span><br/><span style="height: 20px;">23</span><br/><span style="height: 20px;">24</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;width:94%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 585px;"><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">/**</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">    * Retrieve object hash code and applies a supplemental hash function to the</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">    * result hash, which defends against poor quality hash functions.  This is</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">    * critical because HashMap uses power-of-two length hash tables, that</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">    * otherwise encounter collisions for hashCodes that do not differ</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">    * in lower bits. Note: Null keys always map to hash 0, thus index 0.</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">    */</span></span><br/><span style="height: 20px;">   <span style="color: rgb(129, 162, 190);"><span style="color: rgb(178, 148, 187);">final</span> <span style="color: rgb(178, 148, 187);">int</span> <span style="color: rgb(138, 190, 183);">hash</span><span style="color: rgb(222, 147, 95);">(Object k)</span> </span>{</span><br/><span style="height: 20px;">       <span style="color: rgb(178, 148, 187);">int</span> h = <span style="color: rgb(181, 189, 104);">0</span>;</span><br/><span style="height: 20px;">       <span style="color: rgb(178, 148, 187);">if</span> (useAltHashing) {</span><br/><span style="height: 20px;">           <span style="color: rgb(178, 148, 187);">if</span> (k <span style="color: rgb(178, 148, 187);">instanceof</span> String) {</span><br/><span style="height: 20px;">               <span style="color: rgb(178, 148, 187);">return</span> sun.misc.Hashing.stringHash32((String) k);</span><br/><span style="height: 20px;">           }</span><br/><span style="height: 20px;">           h = hashSeed;</span><br/><span style="height: 20px;">       }</span><br/><span style="height: 20px;">   </span><br/><span style="height: 20px;">       h ^= k.hashCode();</span><br/><span style="height: 20px;">   </span><br/><span style="height: 20px;">       <span style="color: rgb(150, 152, 150);">// This function ensures that hashCodes that differ only by</span></span><br/><span style="height: 20px;">       <span style="color: rgb(150, 152, 150);">// constant multiples at each bit position have a bounded</span></span><br/><span style="height: 20px;">       <span style="color: rgb(150, 152, 150);">// number of collisions (approximately 8 at default load factor).</span></span><br/><span style="height: 20px;">       h ^= (h &gt;&gt;&gt; <span style="color: rgb(181, 189, 104);">20</span>) ^ (h &gt;&gt;&gt; <span style="color: rgb(181, 189, 104);">12</span>);</span><br/><span style="height: 20px;">       <span style="color: rgb(178, 148, 187);">return</span> h ^ (h &gt;&gt;&gt; <span style="color: rgb(181, 189, 104);">7</span>) ^ (h &gt;&gt;&gt; <span style="color: rgb(181, 189, 104);">4</span>);</span><br/><span style="height: 20px;">   }</span><br/></pre></td></tr></table><p style="margin: 0px 0px 20px;"></p><h2 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="https://spground.github.io/2017/12/30/HashMap%E7%9A%84%E6%89%A9%E5%AE%B9/#4-References" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="4 References"></a>4 References</h2><ol><li><a href="http://www.javarticles.com/2012/11/hashmap-faq.html" rel="noopener" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" target="_blank">http://www.javarticles.com/2012/11/hashmap-faq.html</a></li><li><a href="http://blog.csdn.net/u014532901/article/details/78573740" rel="noopener" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" target="_blank">http://blog.csdn.net/u014532901/article/details/78573740</a></li><li><a href="https://bugs.java.com/bugdatabase/view_bug.do?bug_id=4631373" rel="noopener" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" target="_blank">https://bugs.java.com/bugdatabase/view_bug.do?bug_id=4631373</a></li></ol></div></div></span>
</div>
<hr>
<a name="908"/>

<div>
<span><div><span style="font-size: 19px;"><br/></span></div><div><span style="font-size: 19px;"><b>1.闭包</b>：各种专业文献的闭包定义都非常抽象，我的理解是: 闭包就是能够读取其他函数内部变量的函数。</span></div><div><span style="font-size: 19px;">由于在javascript中，只有函数内部的子函数才能读取局部变量，所以说，闭包可以简单理解成“定义在一个函数内部的函数“。</span></div><div><span style="font-size: 19px;">所以，在本质上，闭包是将函数内部和函数外部连接起来的桥梁。</span></div><div><span style="font-size: 19px;"><br/></span></div><div><b><span style="font-size: 19px;">2.匿名内部类也是内部类</span></b></div><div><span style="font-size: 19px;"><br/></span></div><div><span style="font-size: 19px;"><b>3.内部类实例中包含外围对象的引用，这也是可能引发内存泄露的地方之一。</b>（<span style="font-size: 16px;">比如观察者模式中的监听器Listener，通常是传入一个匿名内部类实例给监听者，而这个实例会包含外围对象（观察者）的引用，因此相当于监听者通过监听器间接引用着观察者，如果监听者的生命周期特别长，那么观察者就看出现内存泄露，迟迟得不到GC）</span></span></div><div><span style="font-size: 19px;"><br/></span></div><div><b><span style="font-size: 19px;">4.内部类可以声明在：</span><span style="font-size: 19px;">类中，方法中。</span></b></div><div><span style="font-size: 19px;"><br/></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 16px;">在外围类Enclosing的方法中：</span></b></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 16px;">匿名内部类实例a引用外围类方法f的局部变量var的时候，这个局部变量var必须是final的，这是java处理闭包问题的方式。Java通过将局部变量var做一份copy var_copy到匿名内部类，成为其一个私有域。</span></b></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 16px;">因为f运行结束后var便不存在了（栈被清空了），但是此时匿名内部类实例a仍然存在内存在中，因此需要将其声明为final，保证var和var_copy的一致。</span></b></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 16px;"><br/></span></b></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 16px;">但是引用外围类Enclosing的实例的域和静态域，却不需要声明为final，这是因为当引用的域存在的时候，那么外围类实例肯定存在内存中。</span></b></span></div><div><br/></div><div><br/></div><div><span style="font-size: 19px;"><br/></span></div><div><span style="font-size: 19px;"><br/></span></div><div><br/></div><div><br/></div><div><br/></div></span>
</div>
<hr>
<a name="922"/>

<div>
<span><div><span style="font-size: 19px;"><b>一 、依赖注入</b></span></div><div><span style="font-size: 15px;"><br/></span></div><div><span style="font-size: 15px;">DI和Factory Pattern：都是关于对象创建的过程。</span></div><div><br/></div><div>区别在于：</div><div>工厂模式虽然让类实例的创建和依赖解耦，但是却和Factory耦合在一起了，每一个类的实例的创建都需要调用XxxFactory.getInstance()，这是一种新的强依赖；</div><div><br/></div><div>DI模式通过将<span style="font-size: 16px;"><b>依赖获取的职责反转</b></span>（IoC），原来是类的实例的创建，需要使用者自己去获取先关依赖的实例，而控制反转却让程序的外部去获取这些依赖实例，而内部程序直接使用。</div><div>这种由内到外的控制权的转移，就是控制反转的意思，被反转的是获取依赖的职责，以前是使用者的职责，现在是使用者的外部（第三方，IoC容器）的职责。</div><div><span style="font-size: 15px;"><br/></span></div><div>1.工厂模式耦合了对象和工厂，对象需要一个工厂对象，然而通过DI，对象仅仅知道依赖是什么，不需要知道其他东西（例如Factory实例）的存在就可以得到相应的依赖的实例。</div><div><br/></div><div>2.和工厂模式相比，DI让单元测试更加简单</div><div><br/></div><div>3.和工厂模式相比DI的一个缺点就是需要一个IoC容器，并且需要配置依赖注入（对象之间的依赖关系，Spring中就是基于XML或者基于注解的方式），而这些工厂模式是不需要的。</div><div><br/></div><div>4. 因为低耦合，DI写出来的代码看起来比工厂模式简洁。对象看起来就像POJO，通过观察对象使用的哪种方式进行的依赖注入，也可以看到那些依赖是必须的，而哪些确实可选的。</div><div><br/></div><div>如果一个依赖通过Setter方式注入进来，这意味着这是可选的，并且任何时候都可以被注入进来；然而使用构造器注入的依赖确实必须的，仅仅是按照构造器参数被声明的顺序被注入。</div><div><span style="font-size: 15px;"><br/></span></div><div><img src="常见面试基础题_files/Image [12].png" type="image/png" data-filename="Image.png" style="height: auto;"/></div><div><span style="font-size: 15px;"><br/></span></div><div><span style="font-size: 15px;">DI里面最重要的便是IoC容器，它负责管理这些依赖关系，并根据这些依赖关系正确的将依赖注入到我们的实例中，常见的IoC容器有：Spring、Google Guice等</span></div><div><span style="font-size: 15px;"><br/></span></div><div><span style="font-size: 15px;"><br/></span></div><div><span style="font-size: 19px;"><b>二、Sping IoC容器的初始化过程：</b></span></div><div><span style="font-size: 15px;"><br/></span></div><div>Spring可以算是业界的IoC容器的标准了，因此看看Spring的 IoC容器的实现原理。</div><div><br/></div><div>IoC容器的一般过程大致分为：</div><div><br/></div><div><b>获取依赖关系的定义 ----&gt; 反射实例化对象 --&gt; 通过依赖关系将依赖注入到对象中</b></div><div><br/></div><div>先看看Spring 中依赖注入的用法：</div><div><br/></div><div>Spring IoC容器将管理的对象实例称之为Bean，依赖关系的声明有哪几种方式：</div><div><br/></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>- 基于XML文件显示配置</b></span></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>- Java代码中显示配置</b></span></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>- 隐式的Bean发现机制和自动装配（@Component和@Autowire）</b></span></span></span></div><div><br/></div><div><br/></div><div>另外依赖注入的方式有如下几种：</div><div><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b>- set注入</b></span></span></div><div><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b>- 构造器注入</b></span></span></div><div><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b>- 静态工厂方法注入</b></span></span></div><div><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b>- 实例工厂方法注入</b></span></span></div><div><br/></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>Set注入和构造器注入的区别：</b></span></span></div><div><br/></div><div><span style="font-size: 16px;"><b>使用构造函数依赖注入时，Spring保证所有一个对象所有依赖的对象先实例化后，才实例化这个对象。（没有他们就没有我原则）</b></span><span style="font-size: 16px;"><b>使用set方法依赖注入时，Spring首先实例化对象，然后才实例化所有依赖的对象。</b></span></div><div><br/></div><div>示例1：</div><div>基于XML的依赖关系的声明：</div><div><br/></div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div>&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</div><div>       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div>       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</div><div>       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans</div><div>http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</div><div>http://www.springframework.org/schema/context</div><div>http://www.springframework.org/schema/context/spring-context-3.0.xsd&quot;&gt;</div><div>   &lt;!-- set方法注入 --&gt;</div><div>    &lt;bean id=&quot;car&quot; class=&quot;dlut.springdemo.Car&quot;&gt;</div><div>        &lt;property name=&quot;tire&quot; ref=&quot;tire&quot;&gt;&lt;/property&gt;</div><div>    &lt;/bean&gt;</div><div><br/></div><div>    &lt;bean id=&quot;tire&quot; class=&quot;dlut.springdemo.Tire&quot;&gt;</div><div>     &lt;constructor-arg name=&quot;size&quot; value=&quot;50&quot;&gt;&lt;/constructor-arg&gt;</div><div>    &lt;/bean&gt;</div><div><br/></div><div>    &lt;!-- 构造器注入 --&gt;</div><div>    &lt;bean id = &quot;truck&quot; class = &quot;dlut.springdemo.Truck&quot;&gt;</div><div>     &lt;constructor-arg name=&quot;tire&quot; ref=&quot;tire&quot;&gt;&lt;/constructor-arg&gt;</div><div>    &lt;/bean&gt;</div><div>&lt;/beans&gt;</div></div><div><br/></div><div>示例2：</div><div>自动装配</div><div><br/></div><div><ul style="list-style: none; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><li style="list-style: circle;">组建扫描（component scanning）：Spring会自动发现应用上下文中锁创建的bean</li><li style="list-style: circle;">自动装载（autowiring）：Spring自动满足bean之间的依赖</li></ul><div style="list-style: circle;"><div><br/></div><div><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">这两个分别对应了注解@Component和@Autowiring</p><ul style="list-style: none; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><li style="list-style: circle;">@Component：这个注解表明该类会作为组件类，并告知Spring要为这个类创建bean</li><li style="list-style: circle;">@AutoWiring：可以用在构造方法或set方法上，表明注入一个依赖</li></ul><div style="list-style: circle;"><div><br/></div><div><br/></div></div></div></div></div><div>set注入：</div><div><br/></div><div align="left" style="min-height: 14pt;"><font color="#646464" face="Consolas"><span style="font-size:12pt">@Component</span></font><font face="Consolas"><span style="font-size:12pt">(</span></font><font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;house&quot;</span></font><font face="Consolas"><span style="font-size:12pt">)</span></font></div><div align="left" style="min-height: 14pt;"><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>class</b></span></font> <font face="Consolas"><span style="font-size:12pt">House {</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#646464" face="Consolas"><span style="font-size:12pt">@Autowired</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>private</b></span></font> <font face="Consolas"><span style="font-size:12pt">Person</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">owner</span></font><font face="Consolas"><span style="font-size:12pt">;</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#646464" face="Consolas"><span style="font-size:12pt">@</span><span style="font-size:12pt; background:#d4d4d4">Override</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font face="Consolas"><span style="font-size:12pt">String toString() {</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">           </span></font><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//</span></font> <font color="#7F9FBF" face="Consolas"><span style="font-size:12pt"><b>TODO</b></span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">Auto-generated method stub</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">           </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>return</b></span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;House : &quot;</span></font> <font face="Consolas"><span style="font-size:12pt">+</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>this</b></span></font><font face="Consolas"><span style="font-size:12pt">.</span></font><font color="#0000C0" face="Consolas"><span style="font-size:12pt">owner</span></font><font face="Consolas"><span style="font-size:12pt">;</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font></div><div align="left" style="min-height: 14pt;"><div><font face="Consolas"><span style="font-size:12pt">}</span></font></div><div><span style="font-size: 12pt;"><span style="font-family: Consolas;"><br/></span></span></div><div align="left" style="min-height: 14pt;"><font color="#646464" face="Consolas"><span style="font-size:12pt">@Component</span></font><font face="Consolas"><span style="font-size:12pt">(</span></font><font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;house&quot;</span></font><font face="Consolas"><span style="font-size:12pt">)</span></font></div><div align="left" style="min-height: 14pt;"><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>class</b></span></font> <font face="Consolas"><span style="font-size:12pt">House {</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>private</b></span></font> <font face="Consolas"><span style="font-size:12pt">Person</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">owner</span></font><font face="Consolas"><span style="font-size:12pt">;</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#646464" face="Consolas"><span style="font-size:12pt">@Autowired</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">setPerson(Person</span></font> <font color="#6A3E3E" face="Consolas"><span style="font-size:12pt">owner</span></font><font face="Consolas"><span style="font-size:12pt">) {</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">           </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>this</b></span></font><font face="Consolas"><span style="font-size:12pt">.</span></font><font color="#0000C0" face="Consolas"><span style="font-size:12pt">owner</span></font> <font face="Consolas"><span style="font-size:12pt">=</span></font> <font color="#6A3E3E" face="Consolas"><span style="font-size:12pt">owner</span></font><font face="Consolas"><span style="font-size:12pt">;</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#646464" face="Consolas"><span style="font-size:12pt">@Override</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font face="Consolas"><span style="font-size:12pt">String toString() {</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">           </span></font><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//</span></font> <font color="#7F9FBF" face="Consolas"><span style="font-size:12pt"><b>TODO</b></span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">Auto-generated method stub</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">           </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>return</b></span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;House : &quot;</span></font> <font face="Consolas"><span style="font-size:12pt">+</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>this</b></span></font><font face="Consolas"><span style="font-size:12pt">.</span></font><font color="#0000C0" face="Consolas"><span style="font-size:12pt">owner</span></font><font face="Consolas"><span style="font-size:12pt">;</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font></div><div align="left" style="min-height: 14pt;"><div><font face="Consolas"><span style="font-size:12pt">}</span></font></div></div><div><span style="font-size: 12pt;"><span style="font-family: Consolas;"><br/></span></span></div></div><div>构造器注入：</div><div><br/></div><div align="left" style="min-height: 14pt;"><font color="#646464" face="Consolas"><span style="font-size:12pt">@Component</span></font><font face="Consolas"><span style="font-size:12pt">(</span></font><font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;house&quot;</span></font><font face="Consolas"><span style="font-size:12pt">)</span></font></div><div align="left" style="min-height: 14pt;"><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>class</b></span></font> <font face="Consolas"><span style="font-size:12pt">House {</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>private</b></span></font> <font face="Consolas"><span style="font-size:12pt">Person</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">owner</span></font><font face="Consolas"><span style="font-size:12pt">;</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#646464" face="Consolas"><span style="font-size:12pt">@</span><span style="font-size:12pt; background:#d4d4d4">Autowired</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font face="Consolas"><span style="font-size:12pt">House(Person</span></font> <font color="#6A3E3E" face="Consolas"><span style="font-size:12pt">owner</span></font><font face="Consolas"><span style="font-size:12pt">) {</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">           </span></font><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//</span></font> <font color="#7F9FBF" face="Consolas"><span style="font-size:12pt"><b>TODO</b></span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">Auto-generated constructor stub</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">           </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>this</b></span></font><font face="Consolas"><span style="font-size:12pt">.</span></font><font color="#0000C0" face="Consolas"><span style="font-size:12pt">owner</span></font> <font face="Consolas"><span style="font-size:12pt">=</span></font> <font color="#6A3E3E" face="Consolas"><span style="font-size:12pt">owner</span></font><font face="Consolas"><span style="font-size:12pt">;</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#646464" face="Consolas"><span style="font-size:12pt">@Override</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font face="Consolas"><span style="font-size:12pt">String toString() {</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">           </span></font><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//</span></font> <font color="#7F9FBF" face="Consolas"><span style="font-size:12pt"><b>TODO</b></span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">Auto-generated method stub</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">           </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>return</b></span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;House : &quot;</span></font> <font face="Consolas"><span style="font-size:12pt">+</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>this</b></span></font><font face="Consolas"><span style="font-size:12pt">.</span></font><font color="#0000C0" face="Consolas"><span style="font-size:12pt">owner</span></font><font face="Consolas"><span style="font-size:12pt">;</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font></div><div align="left" style="min-height: 14pt;"><div><font face="Consolas"><span style="font-size:12pt">}</span></font></div><div><span style="font-size: 12pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px; color: rgb(85, 85, 85); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">@Component,@Service,@Controller,@Repository</h3><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">Spring 2.5 中除了提供 @Component 注释外，还定义了几个拥有特殊语义的注释，它们分别是：</p><ul style="list-style: none; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><li style="list-style: circle;">@Repository</li><li style="list-style: circle;">@Service</li><li style="list-style: circle;">@Controller。</li></ul><div style="margin: 0px 0px 25px; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><span style="color: rgb(85, 85, 85);"><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;">在目前的 Spring 版本中，这 3 个注释和 @Component 是等效的，但是从注释类的命名上，很容易看出这 3 个注释分别和持久层、业务层和控制层（Web 层）相对应。</span></span></span></div><div><span style="color: rgb(85, 85, 85);"><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><br/></span></span></span></div><div><span style="color: rgb(85, 85, 85);"><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><br/></span></span></span></div><div><span style="color: rgb(85, 85, 85);"><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><br/></span></span></span></div><div><span style="color: rgb(85, 85, 85);"><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;">-------------------</span></span></span></div><div><span style="color: rgb(85, 85, 85);"><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><br/></span></span></span></div><div><span style="color: rgb(85, 85, 85);"><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;">依赖注入的时机：</span></span></span></div><div><span style="color: rgb(85, 85, 85);"><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><br/></span></span></span></div><div><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">在IOC容器中依赖注入的触发有两种情况</p><ul style="list-style: none; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><li style="list-style: circle;">用户第一次调用getBean方法时触发</li><li style="list-style: circle;">通过设置lazy-init属性设置让容器在初始化阶段完成预实例化</li></ul><div style="list-style: circle;"><div><br/></div><div><br/></div><div>---------------------------</div><div><br/></div><div><div style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif; font-size: 22px; color: rgb(85, 85, 85); font-style: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><br/></div><div>启动步骤</div></div><ol style="color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><li><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#Bean%E7%9A%84%E5%BB%BA%E7%AB%8B" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="Bean的建立"></a>Bean的建立</h3><p style="margin: 0px 0px 25px;">容器寻找Bean的定义信息并将其实例化。看过源码都知道，容器首先将Bean的定义信息以BeanDefinition的形式存储，等第一次getBean的时候再将其实例化并完成下面的依赖注入过程。</p></li><li><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#%E5%B1%9E%E6%80%A7%E6%B3%A8%E5%85%A5" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="属性注入"></a>属性注入</h3><p style="margin: 0px 0px 25px;">使用依赖注入，Spring将值和bean的引用注入到bean对应的属性中。</p></li><li><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#BeanNameAware%E7%9A%84setBeanName-%EF%BC%9A" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="BeanNameAware的setBeanName()："></a>BeanNameAware的setBeanName()：</h3><p style="margin: 0px 0px 25px;">如果bean实现了org.springframework.beans.BeanNameAware接口，Spring将bean的ID传递给setBeanName()方法。</p></li><li><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#BeanFactoryAware%E7%9A%84setBeanFactory-%EF%BC%9A" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="BeanFactoryAware的setBeanFactory()："></a>BeanFactoryAware的setBeanFactory()：</h3><p style="margin: 0px 0px 25px;">如果bean实现了org.springframework.beans.factory.BeanFactoryAware接口，Spring将调用setBeanName()方法，将BeanFactory容器实例传入。</p></li><li><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#BeanPostProcessors%E7%9A%84ProcessBeforeInitialization" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="BeanPostProcessors的ProcessBeforeInitialization()"></a>BeanPostProcessors的ProcessBeforeInitialization()</h3><p style="margin: 0px 0px 25px;">如果有org.springframework.beans.factory.config.BeanPostProcessors和Bean关联，那么其postProcessBeforeInitialization()方法将被将被调用。</p></li><li><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#InitializingBean%E7%9A%84afterPropertiesSet" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="InitializingBean的afterPropertiesSet()"></a>InitializingBean的afterPropertiesSet()</h3><p style="margin: 0px 0px 25px;">如果Bean类已实现org.springframework.beans.factory.InitializingBean接口，则执行他的afterProPertiesSet()方法。</p></li><li><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#Bean%E5%AE%9A%E4%B9%89%E6%96%87%E4%BB%B6%E4%B8%AD%E5%AE%9A%E4%B9%89init-method%EF%BC%9A" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="Bean定义文件中定义init-method："></a>Bean定义文件中定义init-method：</h3><p style="margin: 0px 0px 25px;">如果bean使用init-method生命了初始化方法，该方法也会被调用</p></li><li><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#BeanPostProcessors%E7%9A%84ProcessaAfterInitialization" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="BeanPostProcessors的ProcessaAfterInitialization()"></a>BeanPostProcessors的ProcessaAfterInitialization()</h3><p style="margin: 0px 0px 25px;">如果有任何的BeanPostProcessors实例与Bean实例关联，则执行BeanPostProcessors实例的ProcessaAfterInitialization()方法</p></li><li><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#%E5%B0%B1%E7%BB%AA" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="就绪"></a>就绪</h3><p style="margin: 0px 0px 25px;">此时，Bean已准备就绪，可以被应用程序使用了，它们将一直驻留在容器中，直到该容器被销毁。</p></li><li><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#DisposableBean%E7%9A%84destroy" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="DisposableBean的destroy()"></a>DisposableBean的destroy()</h3><p style="margin: 0px 0px 25px;">在容器关闭时，如果Bean类有实现org.springframework.beans.factory.DisposableBean接口，Spring将调用他的destroy()方法。</p></li><li><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#Bean%E5%AE%9A%E4%B9%89%E6%96%87%E4%BB%B6%E4%B8%AD%E5%AE%9A%E4%B9%89destroy-method" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="Bean定义文件中定义destroy-method"></a>Bean定义文件中定义destroy-method</h3><div style="margin: 0px 0px 25px;">如果bean使用destroy-method生命了初始化方法，该方法也会被调用</div></li></ol></div><div><h2 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 22px; color: rgb(85, 85, 85); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">3、总结</h2><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">这个生命周期是在是太复杂了，需要很长时间才能理清他们之间的逻辑关系。</p><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px; color: rgb(85, 85, 85); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#BeanNameAware%E3%80%81ApplicationContextAware%E5%92%8CBeanFactoryAware" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="BeanNameAware、ApplicationContextAware和BeanFactoryAware"></a><strong style="font-weight: bold;">BeanNameAware、ApplicationContextAware和BeanFactoryAware</strong></h3><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">这三个接口放在一起写，是因为它们是一组的，作用相似。</p><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">“Aware”的意思是”感知到的”，那么这三个接口的意思也不难理解：</p><ol style="color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><li>实现BeanNameAware接口的Bean，在Bean加载的过程中可以获取到该Bean的id</li><li>实现ApplicationContextAware接口的Bean，在Bean加载的过程中可以获取到Spring的ApplicationContext，这个尤其重要，ApplicationContext是Spring应用上下文，从ApplicationContext中可以获取包括任意的Bean在内的大量Spring容器内容和信息</li><li>实现BeanFactoryAware接口的Bean，在Bean加载的过程中可以获取到加载该Bean的BeanFactory</li></ol><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">从上面的调用顺序可以看出，在bean实例化并设置属性之后，紧接着就是先调用这三个接口相关的方法。</p><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px; color: rgb(85, 85, 85); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#InitialingBean%E5%92%8CDisposableBean" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="InitialingBean和DisposableBean"></a><strong style="font-weight: bold;">InitialingBean和DisposableBean</strong></h3><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">InitialingBean是一个接口，提供了一个唯一的方法afterPropertiesSet()。</p><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">DisposableBean也是一个接口，提供了一个唯一的方法destory()。</p><div style="margin: 0px 0px 25px; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><span style="color: rgb(85, 85, 85);"><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;">这两个接口是一组的，功能类似，因此放在一起：前者顾名思义在Bean属性都设置完毕后调用afterPropertiesSet()方法做一些初始化的工作，后者在Bean生命周期结束前调用destory()方法做一些收尾工作。</span></span></span></div><div><span style="color: rgb(85, 85, 85);"><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><br/></span></span></span></div><div>------------------------------</div><div><br/></div><div style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-style: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">现在bean的生命周期各个阶段应该就很清晰了，上面的步骤对应一下几个大的阶段</p><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px; color: rgb(85, 85, 85); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#%E5%AE%9E%E4%BE%8B%E5%8C%96%E4%B8%8E%E5%B1%9E%E6%80%A7" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="实例化与属性"></a>实例化与属性</h3><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">对应步骤1和2</p><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px; color: rgb(85, 85, 85); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#Aware%E7%9B%B8%E5%85%B3%E7%9A%84%E4%B8%89%E4%B8%AA%E6%96%B9%E6%B3%95" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="Aware相关的三个方法"></a>Aware相关的三个方法</h3><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">BeanNameAware、ApplicationContextAware和BeanFactoryAware三个接口的方法，对应上面的步骤3和4，应该还有一个的里面没有写上</p><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px; color: rgb(85, 85, 85); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#BeanPostProcessor%E5%90%8E%E7%BD%AE%E5%A4%84%E7%90%86%E5%99%A8" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="BeanPostProcessor后置处理器"></a>BeanPostProcessor后置处理器</h3><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">这个接口是容器级别的，对所有的bean都起作用，也就是说每个bean初始化的时候都会检测实现这个接口的bean。</p><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">而这个接口对应两个方法，postProcessBeforeInitialization和postProcessAfterInitialization，分别对应上面的步骤5和8，因为一个是before一个是after，而中间的步骤6和7就是下面的各个bean自己实现的接口或者方法</p><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px; color: rgb(85, 85, 85); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#InitializingBean%E6%8E%A5%E5%8F%A3%E5%92%8Cinit-method" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="InitializingBean接口和init-method"></a>InitializingBean接口和init-method</h3><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">InitializingBean接口可以和init-method配合使用，接口执行顺序优先于配置，也就是上面的步骤6和步骤7他们的区别上面已经介绍过。</p><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px; color: rgb(85, 85, 85); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#%E5%87%86%E5%A4%87%E5%B0%B1%E7%BB%AA" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="准备就绪"></a>准备就绪</h3><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">至此bean已经可以使用，可以看出大体分为上面的四个阶段</p><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px; color: rgb(85, 85, 85); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#%E9%94%80%E6%AF%81" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="销毁"></a>销毁</h3><div style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif; font-size: 16px; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div>销毁阶段相对简单，因为没有上面的后置处理器，就是Disposable接口的方法和destory-method，两者的顺序和左右与InitializingBean接口和init-method都很类似，对应上面的步骤10和步骤11.</div></div></div></div></div></div></div></div><div><h1 style="font-size: 24px; margin: 20px 0px 10px; padding: 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; color: rgb(85, 85, 85); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">Bean的作用域</h1><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">当通过Spring容器创建一个Bean实例时，不仅可以完成Bean实例的实例化，还可以为Bean指定特定的作用域。<strong style="font-weight: bold;">Spring支持如下5种作用域：</strong></p><ul style="list-style: none; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><li style="list-style: circle;"><strong style="font-weight: bold;">singleton</strong>：单例模式，在整个Spring IoC容器中，使用singleton定义的Bean将只有一个实例</li><li style="list-style: circle;"><strong style="font-weight: bold;">prototype</strong>：原型模式，每次通过容器的getBean方法获取prototype定义的Bean时，都将产生一个新的Bean实例</li><li style="list-style: circle;"><strong style="font-weight: bold;">request</strong>：对于每次HTTP请求，使用request定义的Bean都将产生一个新实例，即每次HTTP请求将会产生不同的Bean实例。只有在Web应用中使用Spring时，该作用域才有效</li><li style="list-style: circle;"><strong style="font-weight: bold;">session</strong>：对于每次HTTP Session，使用session定义的Bean豆浆产生一个新实例。同样只有在Web应用中使用Spring时，该作用域才有效</li><li style="list-style: circle;"><strong style="font-weight: bold;">globalsession</strong>：每个全局的HTTP Session，使用session定义的Bean都将产生一个新实例。典型情况下，仅在使用portlet context的时候有效。同样只有在Web应用中使用Spring时，该作用域才有效</li></ul></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><br/></span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">-----------------</span></span></span></div><div><span style="font-size: 19px;"><b><font color="#555555" face="Lato, PingFang SC, Microsoft YaHei, sans-serif"><span>Spring IOC容器对Bean定义资源的定位、读入和解析过程，然后对Bean进行初始化和依赖注入。</span></font></b></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><br/></span></span></span></div><div><b><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">Spring IOC容器的高级特性：</span></span></span></b></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">lazy-init对Bean初始化</span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">后置处理器</span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">Autowire自动装配</span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><br/></span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><br/></span></span></span></div><div><span style="color: rgb(85, 85, 85);"><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><br/></span></span></span></div></div></div></div><div><br/></div><div><br/></div><div><br/></div></span>
</div>
<hr>
<a name="924"/>

<div>
<span></span>
</div>
<hr>
<a name="928"/>

<div>
<span><div><h2 style="color: rgb(0, 0, 0); font-family: &quot;Trebuchet MS&quot;, Verdana, Arial, sans-serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;"><span style="font-size: 19px;"><u>15 Java Thread Interview Questions and answers</u></span></h2></div><div><span style="font-size: 19px;"><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">Anyway, without any further ado, here is my list of some of the frequently asked Java multithreading and concurrency questions from Java developer Interviews on Investment banks e.g. Barclays, Morgan Stanley, Citibank etc.</span></span></div><div><span style="font-size: 19px;">投资银行Java开发者遇到的Java多线程常见面试题型</span></div><div><span style="font-size: 19px;"><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/></span></div><div><span style="font-size: 19px;"><b style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">1) You have thread T1, T2, and T3, how will you ensure that thread T2 run after T1 and thread T3 run after T2?</b></span></div><div><b><span style="font-size: 19px;"><span style="font-family: 'Trebuchet MS', Verdana, Arial, sans-serif;">1）你有三个下线程T1 T2 T3，你如何确保T1运行完毕，运行T2,T2运行完毕，运行T3?</span></span></b></div><div><span style="font-size: 19px;"><span style="font-family: 'Trebuchet MS', Verdana, Arial, sans-serif;"><span style="background-color: rgb(255, 255, 255);"><br/></span></span></span></div><div><span style="font-size: 19px;"><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">This thread interview question is mostly asked in the first round or phone screening round of interview and purpose of this multi-threading question is to check whether the candidate is familiar with the concept of &quot;join&quot; method or not. The answer to this multi-threading questions is simple it can be achieved by using join method of Thread class.</span></span></div><div><font face="Trebuchet MS, Verdana, Arial, sans-serif"><span style="font-size: 19px;">主要考察多线程的joint方法，能够使用join方法完成。</span></font></div><div><span style="font-size: 19px;"><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><b style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">2) What is the advantage of new Lock interface over a synchronized block in Java? You need to implement a high-performance cache which allows multiple readers but the single writer to keep the integrity how will you implement it?</b><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">The major advantage of lock interfaces on multi-threaded and concurrent programming is they provide two separate lock for reading and writing which enables you to write high-performance data structure like </span><a href="http://javarevisited.posterous.com/difference-between-concurrenthashmap-and-coll" style="color: rgb(102, 0, 153); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">ConcurrentHashMap</a><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;"> and </span><a href="http://javarevisited.blogspot.sg/2012/02/what-is-blocking-methods-in-java-and.html" style="color: rgb(102, 0, 153); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">conditional blocking</a><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">.</span><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">This java threads interview question is getting increasingly popular and more and more follow-up questions come based on the answer of the interviewee.</span><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/></span></div><div><span style="font-size: 19px;"><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">I would strongly suggest reading Locks before appearing for any Java multi-threading interview because nowadays It's heavily used to build cache for an electronic trading system on client and exchange connectivity space.</span></span></div><div><span style="font-size: 19px;">2）Java里面新的Lock接口提供的显示锁和synchronized内置锁的优势是什么？你如果实现一个高性能缓存，允许多个读者读，但是仅仅一个写者写，为了保证完整性，你将如何实现这个高性能缓存？</span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 19px;">答：主要的优势是：显示锁可以提供（中断、轮询的显示锁）同时也提供读写锁，读锁和写锁的分离允许开发者实现高性能的数据结构像ConcurrentHashMap和条件阻塞。</span></b></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 19px;">Java线程面试题现在越来越常见了，并且就此可以展开问很多问题。</span></b></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 19px;">参见面试之前，我建议你了解学习下Lock接口提供的显式锁，因为当下它经常被用来实现缓存。</span></b></span></span></div><div><span style="font-size: 19px;"><br/></span></div><div><span style="font-size: 19px;"><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><b style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">3) What are differences between wait and sleep method in Java?</b></span></div><div><span style="font-size: 19px;"><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">Another frequently asked thread interview question in Java mostly appear in a phone interview. The only major difference is to wait for release the lock or monitor while sleep doesn't release any lock or monitor while waiting. The wait is used for inter-thread communication while sleep is used to introduce pause on execution. See my post </span><a href="http://javarevisited.blogspot.sg/2011/12/difference-between-wait-sleep-yield.html" style="color: rgb(102, 0, 153); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">wait vs sleep in Java</a><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;"> for more differences</span></span></div><div><span style="font-size: 19px;"><b><span style="background-color: rgb(255, 255, 255);">3）wait方法和sleep方法的区别？</span></b></span></div><div><span style="font-size: 19px;"><span style="color: rgb(255, 70, 53);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b>wait方法释放锁，让出cpu进入等待。而sleep方法不释放锁，让出cpu进入等待。</b></span></span></span></div><div style="font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; clear: both; text-align: center;"><div><span style="font-size: 19px;"><b style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></b></span></div></div><div><span style="font-size: 19px;"><b style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">4) Write code to implement blocking queue in Java?</b></span></div><div><span style="font-size: 19px;"><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">This is relatively tough java multi-threading interview question which serves many purposes, it checks whether a candidate can actually write Java code using </span><a href="http://javarevisited.blogspot.sg/2011/02/how-to-implement-thread-in-java.html" style="color: rgb(102, 0, 153); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">thread</a><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;"> or not, it sees how good candidate is on understanding concurrent scenarios and you can ask a lot of follow-up question based upon his code. If he uses </span><a href="http://javarevisited.blogspot.sg/2011/05/wait-notify-and-notifyall-in-java.html" style="color: rgb(102, 0, 153); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">wait() and notify() method</a><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;"> to implement blocking queue, Once candidate successfully writes it you can ask him to write it again using new Java 5 concurrent classes etc.</span></span></div><div><span style="font-size: 19px;">4）写代码实现一个阻塞队列？</span></div><div><span style="font-size: 19px;">略</span></div><div><span style="font-size: 19px;"><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><b style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">5) Write code to solve the Produce consumer problem in Java? </b><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">(</span><a href="http://www.java67.com/2015/12/producer-consumer-solution-using-blocking-queue-java.html" style="color: rgb(102, 0, 153); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;" target="_blank">solution</a><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">)</span></span></div><div><span style="font-size: 19px;"><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">Similar to above questions on the thread but more classic in nature, some time interviewer ask follow up questions  How do you solve producer consumer problem in Java, well it can be solved in a multiple ways, I have shared one way to solve producer consumer problem using BlockingQueue in Java, so be prepared for surprises. Sometimes they even ask to implement a solution of dining philosopher problem as well.</span></span></div><div><span style="font-size: 19px;">5）写代码解决生产者消费者问题？</span></div><div><span style="font-size: 19px; line-height: 27px;">略</span></div><div><span style="font-size: 19px;"><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><b style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">6) Write a program which will result in deadlock? How will you fix deadlock in Java?</b></span></div><div><span style="font-size: 19px;"><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">This is my favorite java thread interview question because even though deadlock is quite common while writing multi-threaded concurrent program many candidates not able to write deadlock free code and they simply struggle.</span></span></div><div><br/></div><div><span style="font-size: 19px;"><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">Just ask them you have N resources and N threads and to complete an operation you require all resources.</span><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/></span></div><div><span style="font-size: 19px;"><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">Here N can be replaced with 2 for the simplest case and higher number to make the question more intimidating. see </span><a href="http://javarevisited.blogspot.com/2010/10/what-is-deadlock-in-java-how-to-fix-it.html" style="color: rgb(102, 0, 153); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">How to avoid deadlock in java</a><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;"> for more information on the deadlock in Java.</span></span></div><div><span style="font-size: 19px;"><b><span style="background-color: rgb(255, 255, 255);">6） 写一段能导致死锁的代码？你怎么解决死锁问题？</span></b></span></div><div><span style="font-size: 19px;"><b>这是我最喜欢的java线程面试题们因为即使死锁在多线程环境下是十分常见的，但是 要求直接写出死锁的代码确实很让人纠结的。</b></span></div><div><b><span style="font-size: 19px;">N个线程去竞争N个资源，每个线程都需要获得N个资源才可以完成任务。</span></b></div><div><b><span style="font-size: 19px;">这里N=2，死锁就是多个线程握着其他线程需要的锁，而去等待其它线程释放锁，形成互相等待。</span></b></div><div><span style="font-size: 19px;"><br/></span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 19px;">避免死锁的常用方式就是：</span></b></span></span></div><ol><li><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 19px;">按着相同的顺序去获取锁。</span></b></span></span></li><li><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 19px;">轮询锁（可超时）tryLock（long timeout）</span></b></span></span></li><li><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 19px;">采用无锁非阻塞算法，例如CAS</span></b></span></span></li></ol><div><span style="font-size: 19px;"><br/></span></div><div><span style="font-size: 19px;"><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><b style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">7) What is an atomic operation? What are atomic operations in Java?</b></span></div><div><span style="font-size: 19px;"><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">Simple java thread interview questions, another follow-up is do you need to synchronize an atomic operation? :) You can read more about </span><a href="http://javarevisited.blogspot.com/2011/04/synchronization-in-java-synchronized.html" style="color: rgb(102, 0, 153); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">java synchronization</a><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;"> here.</span></span></div><div><span style="font-size: 19px;">7）原子操作是什么？Java里面的原子操作呢？</span></div><div><span style="font-size: 19px;">简单的Java线程面试题，另一个扩展的问题就是 你需要对一个原子操作进行同步吗?(应该是不需要吧)</span></div><div><span style="font-size: 19px;"><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><b style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">8) What is a volatile keyword in Java? How to use it? How is it different from the synchronized method in Java?</b></span></div><div><span style="font-size: 19px;"><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">Thread questions based on a </span><a href="http://javarevisited.blogspot.com/2011/06/volatile-keyword-java-example-tutorial.html" style="color: rgb(102, 0, 153); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">volatile keyword in Java</a><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;"> has become more popular after changes made on it on Java 5 and Java memory model. It’s good to prepare well about how volatile variables ensures visibility, ordering, and consistency in a concurrent environment.</span></span></div><div><span style="font-size: 19px;"><span style="font-family: 'Trebuchet MS', Verdana, Arial, sans-serif;"><span style="background-color: rgb(255, 255, 255);">8) volatile关键字是什么？如何使用它？它和synchronized方法有什么区别？</span></span></span></div><div><span style="font-size: 19px;"><span style="font-family: 'Trebuchet MS', Verdana, Arial, sans-serif;"><span style="background-color: rgb(255, 255, 255);"><br/></span></span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(227, 0, 0);"><b><span style="font-size: 19px;"><span style="font-family: 'Trebuchet MS', Verdana, Arial, sans-serif;"><span style="background-color: rgb(255, 255, 255);">1.5后引入的，在新的内存模型下（接下来就会让你介绍下内存模型），volatile保证可见性、顺序性和一致性在并发环境下。</span></span></span></b></span></span></div><div><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 19px;">volatile指令对应内存屏障，是一种轻量级的synchronized。</span></b></span></span></div><div><span style="font-size: 19px;"><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><b style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">9) What is a race condition? How will you find and solve race condition?</b></span></div><div><span style="font-size: 19px;"><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">Another multi-threading question in Java which appear mostly on senior-level interviews. Most interviewer grill on recent race condition you have faced and how did you solve it and sometime they will write sample code and ask you detect race condition. See my post on the </span><a href="http://javarevisited.blogspot.sg/2012/02/what-is-race-condition-in.html" style="color: rgb(102, 0, 153); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Race condition in Java</a><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;"> for more information. In my opinion, this is one of the best java thread interview questions and can really test the candidate's experience on solving race condition or writing code which is free of data race or any other race condition. Best book to get the mastery of this topic is &quot;Concurrency practices in Java'&quot;.</span></span></div><div><span style="font-size: 19px;">9) 竞态条件是什么意思？你如何发现并且解决这些竞态条件？</span></div><div><span style="font-size: 19px;">这种面试题通常出现在高级别的面试中（真的吗？）。略。</span></div><div><span style="font-size: 19px;"><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><b style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">10) How will you take thread dump in Java? How will you analyze Thread dump?</b><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">In UNIX you can use </span><span style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: 'courier new', courier, monospace;">kill -3</span><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;"> and then thread dump will print on log on windows you can use </span><span style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: 'courier new', courier, monospace;">&quot;CTRL+Break&quot;</span><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">. Rather simple and focus thread interview question but can get tricky if he asks how you analyze it. A thread dump can be useful to analyze deadlock situations as well.</span><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/>
略<br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><b style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">11) Why we call start() method which in turns calls run() method, why not we directly call run() method?</b><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">Another classic java multi-threading interview question This was my original doubt when I started programming in the thread. Now days mostly asked in a phone interview or first round of interview at mid and junior level java interviews.</span><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">The answer to this question is that when you call start() method it creates new Thread and executes code declared in the run() while directly calling run() method doesn’t create any new thread and execute code on the same calling thread. Read my post </span><a href="http://javarevisited.blogspot.sg/2012/03/difference-between-start-and-run-method.html" style="color: rgb(102, 0, 153); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Difference between start and run method in Thread</a><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;"> for more details.</span></span></div><div><span style="font-size: 19px;"><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/></span></div><div><span style="font-size: 19px;"><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><b style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">12) How will you awake a blocked thread in Java?</b><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">This is tricky question on threading, blocking can result in many ways, if thread is blocked on IO then I don't think there is a way to interrupt the thread, let me know if there is any, on the other hand, if thread is blocked due to result of calling</span><span style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: 'courier new', courier, monospace;"> wait()</span><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">, </span><span style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: 'courier new', courier, monospace;">sleep(),</span><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;"> or </span><span style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: 'courier new', courier, monospace;">join()</span><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;"> method you can interrupt the thread and it will awake by throwing InterruptedException. See my post </span><a href="http://javarevisited.blogspot.sg/2012/02/what-is-blocking-methods-in-java-and.html" style="color: rgb(102, 0, 153); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">How to deal with blocking methods in Java</a><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;"> for more information on handling blocked thread.</span></span></div><div><span style="font-size: 19px;">12）你如何唤醒一个阻塞的线程？</span></div><div><span style="font-size: 19px;">interrupt一个阻塞在wait方法、sleep()、或者join方法上的线程。</span></div><div><span style="font-size: 19px;"><br/></span></div><div><span style="font-size: 19px;"><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><b style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">13) What is the difference between CyclicBarriar and CountdownLatch in Java? </b><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">(</span><a href="http://www.java67.com/2012/08/difference-between-countdownlatch-and-cyclicbarrier-java.html" style="color: rgb(102, 0, 153); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;" target="_blank">answer</a><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">)</span></span></div><div><span style="font-size: 19px;"><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">New Java thread interview questions mostly to check familiarity with JDK 5 concurrent packages. One difference is that you can reuse CyclicBarrier once the barrier is broken but you can not reuse CountDownLatch. If you want to learn more see </span><a href="https://click.linksynergy.com/fs-bin/click?id=JVFxdTr9V80&amp;subid=0&amp;offerid=323058.1&amp;type=10&amp;tmpid=14538&amp;RD_PARM1=https%3A%2F%2Fwww.udemy.com%2Fmultithreading-and-parallel-computing-in-java%2F" rel="nofollow" style="color: rgb(102, 0, 153); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;" target="_blank">Multithreading and Parallel Computing in Java</a><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;"> course on Udemy.</span></span></div><div><span style="font-size: 19px;">13）CycleBarriar和CountdownLatch的区别是什么？</span></div><div><span style="font-size: 19px;">CycleBarriar可以重用，而CountDownLatch不可以重用。</span></div><div><span style="font-size: 19px;"><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><b style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></b><b style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">14) What is an immutable object? How does it help in writing a concurrent application?</b><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">Another classic interview questions on multi-threading, not directly related to the thread but indirectly helps a lot. This java interview question can become more tricky if ask you to write an immutable class or ask you </span><a href="http://javarevisited.blogspot.com/2010/10/why-string-is-immutable-in-java.html" style="color: rgb(102, 0, 153); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Why String is immutable in Java</a><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;"> as a follow-up.</span></span></div><div><span style="font-size: 19px;">14）不可变对象是什么？并发编程中它是怎么样起作用的？</span></div><div><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 19px;">（不可变对象是一经创建，状态不会再发改变的对象，这样的不可变对象是线程安全的，在多线程环境下不需要同步，因此可以提高多线程的性能，</span></b></span></span></div><div><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 19px;">Java里面不可变对象通常是满足如下条件：</span></b></span></span></div><ol><li><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b>对象创建以后状态不能修改。</b></span></span></li><li><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b>对象所有的域都是final的。</b></span></span></li><li><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b>对象是正确被构造的（在构造的时候，this没有被提前逸出）。</b></span></span></li></ol><div><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 19px;">）</span></b></span></span></div><div><span style="font-size: 19px;"><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/></span></div><div><span style="font-size: 19px;"><b style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">15) What are some common problems you have faced in multi-threading environment? How did you resolve it?</b></span></div><div><span style="font-size: 19px;"><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">Memory-interference, race conditions, deadlock, livelock, and starvation are an example of some problems comes in multi-threading and concurrent programming. There is no end of a problem if you get it wrong and they will be hard to detect and debug.</span><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">This is mostly experienced based interview question on java thread instead of fact-based. You can further see </span><a href="https://learning.javaspecialists.eu/courses/concurrency-in-practice-bundle?affcode=92815_johrd7r8" rel="nofollow" style="color: rgb(102, 0, 153); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;" target="_blank">Java Concurrency in Practice Course by Heinz Kabutz</a><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;"> for some real-world problems faced in actual high-performance multi-threaded applications.</span></span></div><div><span style="font-size: 19px;"><br/></span></div><div><span style="font-size: 19px;">15）多线程环境下有哪些常见的问题？如何解决的？</span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 19px; line-height: 27px;">内存干涉、竞态条件、死锁、活锁和饥饿。</span></b></span></span></div><div><div style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; clear: both; text-align: center;"><div><br/></div></div><span style="font-size: 19px;"><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">These were some of my favorite J</span><i style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">ava thread interview questions and mostly asked on Investment banks</i><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">. This list is by no means complete so please contribute some of interesting java thread questions you have faced during the interview.  Purpose of this article is to collect and share great interview questions on multi-threading concept which not only helps in the interview but opens the door for learning a new threading concept.</span><span style="font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-family: 'Trebuchet MS', Verdana, Arial, sans-serif;"><br/><br/></span></span></span></div><div><span style="font-size: 19px;"><span style="font-family: 'Trebuchet MS', Verdana, Arial, sans-serif;">Read more: <a href="http://javarevisited.blogspot.com/2011/07/java-multi-threading-interview.html#ixzz58phRyQZ5" style="color: rgb(0, 51, 153);">http://javarevisited.blogspot.com/2011/07/java-multi-threading-interview.html#ixzz58phRyQZ5</a></span></span></div></span>
</div>
<hr>
<a name="930"/>

<div>
<span><div><br/></div><div style="font-size: 24px; margin: 20px 0px 10px; padding: 0px; font-weight: bold; font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif; color: rgb(85, 85, 85); font-style: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div>一、核心类</div></div><ol><li><span style="color: rgb(255, 0, 0);"><span style="font-size: 19px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><b><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">Resource</span></b><br/></span></span></span></span></li></ol><div><b><span style="font-size: 19px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><br/></span></span></span></span></b></div><div><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">在Spring内部，针对于资源文件有一个统一的接口Resource表示。其主要实现类有ClassPathResource、FileSystemResource、UrlResource、ByteArrayResource、ServletContextResource和InputStreamResource。Resource接口中主要定义有以下方法：</p><ul style="list-style: none; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><li style="list-style: circle;">exists()：用于判断对应的资源是否真的存在。</li><li style="list-style: circle;">isReadable()：用于判断对应资源的内容是否可读。需要注意的是当其结果为true的时候，其内容未必真的可读，但如果返回false，则其内容必定不可读。</li><li style="list-style: circle;">isOpen()：用于判断当前资源是否代表一个已打开的输入流，如果结果为true，则表示当前资源的输入流不可多次读取，而且在读取以后需要对它进行关闭，以防止内存泄露。该方法主要针对于InputStreamResource，实现类中只有它的返回结果为true，其他都为false。</li><li style="list-style: circle;">getURL()：返回当前资源对应的URL。如果当前资源不能解析为一个URL则会抛出异常。如ByteArrayResource就不能解析为一个URL。</li><li style="list-style: circle;">getFile()：返回当前资源对应的File。如果当前资源不能以绝对路径解析为一个File则会抛出异常。如ByteArrayResource就不能解析为一个File。</li><li style="list-style: circle;"><strong style="font-weight: bold;">getInputStream()：获取当前资源代表的输入流。除了InputStreamResource以外，其它Resource实现类每次调用getInputStream()方法都将返回一个全新的InputStream。</strong></li></ul><div style="list-style: circle;"><div><b><br/></b></div><div><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">实现类：</p><ul style="list-style: none; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><li style="list-style: circle;"><strong style="font-weight: bold;">ClassPathResource</strong>可用来获取类路径下的资源文件。假设我们有一个资源文件test.txt在类路径下，我们就可以通过给定对应资源文件在类路径下的路径path来获取它，new ClassPathResource(“test.txt”)。</li><li style="list-style: circle;"><strong style="font-weight: bold;">FileSystemResource</strong>可用来获取文件系统里面的资源。我们可以通过对应资源文件的文件路径来构建一个FileSystemResource。FileSystemResource还可以往对应的资源文件里面写内容，当然前提是当前资源文件是可写的，这可以通过其isWritable()方法来判断。FileSystemResource对外开放了对应资源文件的输出流，可以通过getOutputStream()方法获取到。</li><li style="list-style: circle;"><strong style="font-weight: bold;">UrlResource</strong>可用来代表URL对应的资源，它对URL做了一个简单的封装。通过给定一个URL地址，我们就能构建一个UrlResource。</li><li style="list-style: circle;"><strong style="font-weight: bold;">ByteArrayResource</strong>是针对于字节数组封装的资源，它的构建需要一个字节数组。</li><li style="list-style: circle;"><strong style="font-weight: bold;">ServletContextResource</strong>是针对于ServletContext封装的资源，用于访问ServletContext环境下的资源。ServletContextResource持有一个ServletContext的引用，其底层是通过ServletContext的getResource()方法和getResourceAsStream()方法来获取资源的。</li><li style="list-style: circle;"><strong style="font-weight: bold;">InputStreamResource</strong>是针对于输入流封装的资源，它的构建需要一个输入流。</li></ul></div></div></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);"><br/></span></span></span></span></div><ol start="2"><li><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 19px;"><b><span style="font-family: Lato;">ResourceLoader</span></b></span></span></span></li></ol><div><span style="color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;">IoC容器的初始化过程就是含有BeanDefinition的信息的Resource的定位、载入、解析、注册的四个过程，最终配置的bean以BeanDefinition的数据与结构存在于IOC容器之中，这个过程不涉及bean的依赖注入，也不产生任何bean。</span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);"><br/></span></span></span></span></div><ol start="3"><li><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);">BeanDefinition</span></span></span></span></li></ol><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);"><br/></span></span></span></span></div><div><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">一个BeanDefinition描述了一个bean的实例，包括属性值，构造方法参数值和继承自它的类的更多信息。</p><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">作用：持有bean数据结构，是注入的bean在IoC容器中的抽象，方法列表如下</p></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);">getBeanClassName;</span></span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);">getFactoryBeanName;</span></span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);">getScope;</span></span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);">isLazyInit;</span></span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);">isSingleton;</span></span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);">isPrototype;</span></span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);">isAbstract;</span></span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);">isPrimary;</span></span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);">isAutowireCandidate;</span></span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);">getDescription;</span></span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);">相关的类与接口：</span></span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);"><br/></span></span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);">- AbstractBeanDefinition：是BeanDefinition的一个完整实现</span></span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);">- BeanDefinitionReader：用于读取bean的信息的接口。AbstractBeanDefinitionReader实现了该接口，XmlBeanDefinitionReader继承了AbstractBeanDefinitionReader。</span></span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);"><br/></span></span></span></span></div><ol start="4"><li><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><b>ApplicationContext</b></span></span></span></span></span></span></li></ol><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);">     </span></span></span></span></div><div><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">高级IoC容器，除了基本的IoC容器功能外，支持不同信息源、访问资源、支持事件发布等功能。</p><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">继承了以下接口：</p><ul style="list-style: none; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><li style="list-style: circle;">ListableBeanFactory：继承自BeanFactory，在此基础上，添加了containsBeanDefinition、getBeanDefinitionCount、getBeanDefinitionNames等方法。</li><li style="list-style: circle;">HierarchicalBeanFactory：继承自BeanFactory，在此基础之上，添加了getParentBeanFactory、containsLocalBean这两个方法。</li><li style="list-style: circle;">AutoWireCapableBeanFactory：继承自BeanFactory</li><li style="list-style: circle;">MessageSource：用于获取国际化信息</li><li style="list-style: circle;">ApplicationEventPublisher：因为ApplicationContext实现了该接口，因此spring的ApplicationContext实例具有发布事件的功能。</li></ul></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);"><br/></span></span></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 19px;"><b>二、容器的初始化过程</b></span></span></span></div><div><br/></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 19px;"><b>IoC容器的初始化过程就是含有BeanDefinition的信息的Resource的定位、载入、解析、注册的四个过程，最终配置的bean以BeanDifinition的类存在于IoC容器中，这个过程不涉及Bean的依赖注入，也不产生任何Bean?</b></span></span></span></div><div><br/></div><div>String filePath ---&gt; Resource对象 ---&gt;(XML解析 JAXP方式，另外两种解析方式：SAX和DOM)Document对象 ---&gt; BeanDifinition</div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);"><br/></span></span></span></span></div></span>
</div>
<hr>
<a name="932"/>

<div>
<span><ul><li><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 19px;"><b>一、Spring 请求处理流程和关键类</b></span></span></span></li></ul><div><br/></div><div><img src="常见面试基础题_files/Image [13].png" type="image/png" data-filename="Image.png" style="height: auto;"/></div><div><br/></div><div><br/></div><div><hr/></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>DispatchServlet初始化后，会生成HandlerMapping，这样收到请求后，可以将请求和能够处理该请求的Handler对应起来。</b></span></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b><br/></b></span></span></span></div><ol><li><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>首先用户发送请求，DispatchServlet(以下简称DS)收到请求后，获取得到HandlerMapping（以下简称HM）</b></span></span></span></li><li><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>DS通过HM将请求映射为HandlerExecutionChain(简称HEC)，HEC包含一个Handler处理器（也就是常见的页面控制器Controller，多个相关的HandlerInterceptor）</b></span></span></span></li><li><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>然后DS根据获得的HEC生成对应的HandlerAdapter(简称HA)，从而支持多种类型的处理器。</b></span></span></span></li><li><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>HA然后调用Handler的请求处理方法</b></span></span></span></li><li><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>Handler执行完毕后，返回一个ModelAndView(简称MAV)对象（包含模型数据、逻辑视图名）</b></span></span></span></li><li><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>MAV通过ViewResolver将逻辑视图名解析为具体的View对象，通过这种方式，Spring MVC支持多种试图渲染技术</b></span></span></span></li><li><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>DS将视图渲染的工作委托给View对象，View根据传进来的Model模型数据进行数据渲染，此处的Model实际是一个Map数据结构</b></span></span></span></li><li><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>然后控制权给DS，由DS将Response返回给用户，到此一个流程结束</b></span></span></span></li></ol><div><br/></div><div><hr/></div><div>核心类：</div><div><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b><br/></b></span></span></span></div><ol><li><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>DispatchServlet</b></span></span></span></li><li><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>HandlerMapping</b></span></span></span></li><li><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>HandlerExecutionChain</b></span></span></span></li><li><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>HandlerInterceptor</b></span></span></span></li><li><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>HandlerAdapter</b></span></span></span></li></ol><div><br/></div><div><hr/></div><div><br/></div><div><br/></div><div><br/></div><ul><li><br/></li></ul></span>
</div>
<hr>
<a name="936"/>

<div>
<span><div>主内存</div><div><br/></div><div>工作内存</div><div><br/></div></span>
</div>
<hr>
<a name="938"/>

<div>
<span><div><span style="font-size: 19px;"><b>一、概述</b></span></div><div><br/></div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>Java与C++之间有一堵内存动态分配和垃圾收集技术所围成的“高墙”，墙外面的人想进去，墙里面的人想进来。</div></div><div><br/></div><div>GC需要回答的三个问题？</div><ul><li>哪些内存需要被回收？（哪些是垃圾？）</li><li>什么时候回收？（如何找到这些垃圾，可达性分析、引用计数）</li><li>如何回收？（垃圾回收算法）</li></ul><div><br/></div><div>JVM运行时内存区域大致分为 <span style="font-size: 15px;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><b>：程序计算器、栈内存（虚拟机栈、本地方法栈）、堆内存、方法区（包含运行时常量池）</b></span></span></span>，</div><div>而程序计数器、栈内存都是随线程而生，随线程而灭，这些区域的内存在方法结束或者线程结束，内存自然被回收。</div><div><br/></div><div>因此需要GC的内存区域就是：<span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><span style="font-size: 19px;"><b>堆内存和方法区。</b></span></span></span></div><div><br/></div><div><br/></div><div><span style="font-size: 19px;"><b>二、判断对象的存活</b></span></div><div><br/></div><ol><li><span style="font-size: 16px;"><b>引用计数</b></span></li></ol><div>  </div><div>问题：很难解决循环引用的问题；</div><div><br/></div><ol start="2"><li><span style="font-size: 16px;"><b>可达性分析</b></span></li></ol><div>  </div><div>可达性分析算法：</div><div><br/></div><div><b><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><span style="font-size: 16px;">通过一系列“GC Roots”的对象作为起始点，从这些节点开始向下搜索，搜索走过的路径成为“引用链”，如果一个对象（或者多个彼此有联系的对象组成的对象组）到GC Roots没有任何引用链相连（不可达），则证明此对象或者对象组是不可用的，会被判定为可回收的对象。</span></span></span></b></div><div><br/></div><div><span style="font-size: 16px;"><span style="color: rgb(0, 0, 0); font-family: Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">GC ROOT: A garbage collection root is an object that is accessible from outside the heap.</span></span></div><div><span style="font-size: 19px;"><b>GC Root是从堆外访问的对象。（比如从栈内存、方法区）</b></span></div><div><br/></div><div><br/></div><div>适合作为Java GC Roots的对象包括如下几种：</div><ul><li><b>虚拟机栈中（栈帧中的本地变量表）引用的对象（</b>此时，方法还在执行，因此方法所直接引用或者间接引用到所有对象多不应该被回收）</li><li><b>方法区中类静态属性引用的对象</b></li><li>方法区中常量引用的对象</li><li>本地方法栈JNI引用的对象</li><li><b>线程Thread</b></li><li><b>系统类</b>（被bootsrap类加载器加载的类，例如rt.jar包中的所有类，这些类在方法区中，算是非堆内存）</li><li>等等</li></ul><div><br/></div><div><h1 style="font-size: 1.5em; font-style: normal; font-weight: bold; margin-bottom: 0.5em; word-spacing: 0.1em; margin-top: 0pc; color: rgb(0, 0, 0); font-family: Arial, sans-serif; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;">Garbage Collection Roots</h1><div style="color: rgb(0, 0, 0); font-family: Arial, sans-serif; font-size: 12.8px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;"><p style="margin-top: 1em;">A garbage collection root is an object that is accessible from outside the heap. The following reasons make an object a GC root:</p><dl><dd><div style="margin-top: 0.5em; margin-bottom: 0.5em; font-weight: bold;">System Class</div></dd><dd style="margin-left: 1em;">Class loaded by bootstrap/system class loader. For example, everything from the rt.jar like java.util.* .</dd><dd><div style="margin-top: 0.5em; margin-bottom: 0.5em; font-weight: bold;">JNI Local</div></dd><dd style="margin-left: 1em;">Local variable in native code, such as user defined JNI code or JVM internal code.</dd><dd><div style="margin-top: 0.5em; margin-bottom: 0.5em; font-weight: bold;">JNI Global</div></dd><dd style="margin-left: 1em;">Global variable in native code, such as user defined JNI code or JVM internal code.</dd><dd><div style="margin-top: 0.5em; margin-bottom: 0.5em; font-weight: bold;">Thread Block</div></dd><dd style="margin-left: 1em;">Object referred to from a currently active thread block.</dd><dd><div style="margin-top: 0.5em; margin-bottom: 0.5em; font-weight: bold;">Thread</div></dd><dd style="margin-left: 1em;">A started, but not stopped, thread.</dd><dd><div style="margin-top: 0.5em; margin-bottom: 0.5em; font-weight: bold;">Busy Monitor</div></dd><dd style="margin-left: 1em;">Everything that has called wait() or notify() or that is synchronized. For example, by calling synchronized(Object) or by entering a synchronized method. Static method means class, non-static method means object.</dd><dd><div style="margin-top: 0.5em; margin-bottom: 0.5em; font-weight: bold;">Java Local</div></dd><dd style="margin-left: 1em;">Local variable. For example, input parameters or locally created objects of methods that are still in the stack of a thread.</dd><dd><div style="margin-top: 0.5em; margin-bottom: 0.5em; font-weight: bold;">Native Stack</div></dd><dd style="margin-left: 1em;">In or out parameters in native code, such as user defined JNI code or JVM internal code. This is often the case as many methods have native parts and the objects handled as method parameters become GC roots. For example, parameters used for file/network I/O methods or reflection.</dd><dd><div style="margin-top: 0.5em; margin-bottom: 0.5em; font-weight: bold;">Finalizable</div></dd><dd style="margin-left: 1em;">An object which is in a queue awaiting its finalizer to be run.</dd><dd><div style="margin-top: 0.5em; margin-bottom: 0.5em; font-weight: bold;">Unfinalized</div></dd><dd style="margin-left: 1em;">An object which has a finalize method, but has not been finalized and is not yet on the finalizer queue.</dd><dd><div style="margin-top: 0.5em; margin-bottom: 0.5em; font-weight: bold;">Unreachable</div></dd><dd style="margin-left: 1em;">An object which is unreachable from any other root, but has been marked as a root by MAT to retain objects which otherwise would not be included in the analysis.</dd><dd><div style="margin-top: 0.5em; margin-bottom: 0.5em; font-weight: bold;">Java Stack Frame</div></dd><dd style="margin-left: 1em;">A Java stack frame, holding local variables. Only generated when the dump is parsed with the preference set to treat Java stack frames as objects.</dd><dd><div style="margin-top: 0.5em; margin-bottom: 0.5em; font-weight: bold;">Unknown</div><div style="margin-left: 1em;">An object of unknown root type. Some dumps, such as IBM Portable Heap Dump files, do not have root information. For these dumps the MAT parser marks objects which are have no inbound references or are unreachable from any other root as roots of this type. This ensures that MAT retains all the objects in the dump.</div></dd></dl></div></div><div><br/></div><div><br/></div><ol start="3"><li><span style="font-size: 16px;"><b>引用的分类</b></span></li></ol><div><br/></div><ul><li>强引用 StrongReference：只要存在强引用，就不会回收。</li><li>软引用 SoftReference ：用于描述有用但是不是必须的对象，发生内存溢出之前，会将其进行回收</li><li>弱引用 WeakReference：用于描述非必须的对象，比弱引用稍微弱一些，只能生存到下一次GC发生之前。经常用来实现<b>内存敏感的高速缓存</b>。</li><li>虚引用 PhantomReference：对GC无任何影响。对象被回收会收到通知。</li></ul><div><br/></div><ol start="4"><li><span style="font-size: 16px;"><b>回收方法区</b></span></li></ol><div><b>方法区在HotSpot虚拟机中被划为永久代，对方法区（永久代）的回收的性价比较低，在新生代进行一次GC可以回收70~95%的空间，而永久代收集效率远低于此。</b></div><div><br/></div><div>永久代的方法区的垃圾回收主要包含两部分内容：</div><ul><li>回收废弃的常量</li><li>回收无用的类</li></ul><div><br/></div><div><br/></div><div>堆内存分代：</div><div><br/></div><div>新生代：Eden From To 8:1:1</div><div>老年代</div><div>永久代</div><div><br/></div><div>老年代：Full GC</div><div>新生代： Minor GC</div><div><br/></div><div><span style="font-size: 19px;"><b>三、垃圾回收算法</b></span></div><div><br/></div><div>垃圾回收算法：</div><ul><li>复制(copy)：将可用内存按容量分为大小相等的两块，每次只使用其中的一块。当这一块的内存用完了，将还存活的对象复制到另一块内存上。</li><li>标记清除（mark sweep）：分为标记阶段和清除阶段，标记阶段标记哪些是需要回收的内存；清除阶段同一回收被标记的内存区域；缺点：内存碎片</li><li>标记整理：先标记需要回收的内存区域，后续步骤不是直接回收，而是让存活的对象都向一端移动，然后清除端外界以外的内存，可以解决内存碎片的问题，但是时间消耗比较大；</li><li>分代收集：根据对象的生存周期分为新生代和老年代，根据各个年代的特点采用合适的算法；新生代 复制算法；老年代标记-整理或者标记-清除。</li></ul><div><br/></div><div><span style="font-size: 19px;"><b>四、垃圾回收器</b></span></div><div><br/></div><div>垃圾回收器：</div><ul><li>Serial收集器/Serial Old收集器：GC单线程，新生代采取<b>标记复制算法,暂停所有用户线程；</b>老年代采取<b>标记整理算法，暂停所有用户线程；</b></li><li>ParNew收集器：Serial的多线程版本，GC多线程，新生代采取<b>标记复制算法,暂停所有用户线程；</b>老年代采取<b>标记整理算法，暂停所有用户线程；</b></li><li>CMS收集器：基于<b>标记清除</b>算法实现的，分为四个步骤：初始标记（stop-the-world），并发标记(并发)，重新标记（stop-the-world ），并发清除（并发）。</li><li>G1收集器：</li></ul><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div>
<hr>
<a name="940"/>

<div>
<span><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><span style="font-size: 19px;"><b>一、类加载的全过程</b></span></span></span></div><div><br/></div><div>Java虚拟机中类加载的全过程为以下的五个阶段</div><div><br/></div><div><b>加载阶段  ---&gt; 验证阶段  ----&gt; 准备阶段  -----&gt;   解析阶段  -----&gt;  初始化阶段</b></div><div><br/></div><ul><li><span style="font-size: 16px;"><b>加载阶段</b>：</span></li></ul><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">虚拟机完成三件事：</span></div><ol><li><span style="font-size: 16px;">通过一个类的全限定名来获取定义此类的二进制字节流（类加载器ClassLoader就是干这件事的）</span></li><li><span style="font-size: 16px;">将这个字节流所代表的静态存储结构转换为方法区的运行时数据结构</span></li><li><span style="font-size: 16px;">在内存中生成一个代表这个类的java.lang.Class对象，作为方法区这个类的各种数据的访问入口</span></li></ol><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;"><br/></span></div><ul><li><span style="font-size: 16px;"><b>验证阶段：</b></span></li></ul><div><span style="font-size: 16px;">验证阶段是连接阶段的第一步，这一阶段的目的是为了确保Class文件的字节流包含的信息符合当前虚拟机的要求，并且不会危害虚拟机本身的安全。</span></div><div><span style="font-size: 16px;"><br/></span></div><ul><li><span style="font-size: 16px;"><b>准备阶段：</b></span></li></ul><div><span style="font-size: 16px;">准备阶段是正式为类变量分配内存并设置类变量初始值的阶段，这些变量所使用的内存都将在方法区中进行分配。</span></div><div><span style="font-size: 16px;">注意：首先这时候进行内存分配的仅仅包括类变量（static修饰的变量），而不包含类实例变量，实例变量将会在对象实例化时随着对象一起分配在堆内存中。其次，这里所说的初始值是数据类型的零值，</span></div><div><span style="font-size: 16px;">public static int val = 123;</span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">准备阶段，在方法区为类分配内存是将val赋值为零值，而val赋值123的指令putstatic则是在程序编译后，存放于&lt;clinit&gt;()方法中，这一步是初始化阶段进行的。</span></div><div><span style="font-size: 16px;"><br/></span></div><ul><li><span style="font-size: 16px;"><b>解析阶段</b>：</span></li></ul><div><span style="font-size: 16px;">虚拟机将常量池内的符号引用替换为直接引用的过程。</span></div><div><span style="font-size: 16px;"><br/></span></div><ul><li><span style="font-size: 16px;"><b>初始化阶段：</b></span></li></ul><div><span style="font-size: 16px;">初始化阶段是类加载过程的最后一步，前面的类加载过程中，除了在加载阶段用户应用程序可以通过自定义类加载器参与之外，其余动作完全由虚拟机主导和控制。到了初始化阶段，才真正开始执行类中定义的Java程序代码（字节码）。</span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">执行clinit&lt;&gt;方法。</span></div><div><br/></div><div><hr/></div><div><br/></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 19px;"><span style="color: rgb(255, 0, 0);"><b>二、类和类加载器</b></span></span></span></div><div><br/></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>类加载器：通过一个类的全限定名来获取此类的二进制字节流。</b></span></span></span></div><div><br/></div><div>对于任何一个类，都需要由它加载它的类加载器和这个类本身一同确定其在Java虚拟机中的唯一性，每一个类加载器都拥有一个独立的类名称空间。换句话说，比较两个类是否相等，只有在这两个类是由同一个类加载器加载的前提下才有意义，否则即使两个类来源于同一个class文件，被同一个虚拟机加载，只要加载他们的类加载器不相同，那么这两个类就不相等。</div><div><br/></div><div>相等包括代表类的Class对象的equals、isAssgnableFrom、instanceof 方法返回的结果。</div><div><br/></div><div><hr/></div><div><br/></div><div><br/></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 19px;"><b>三、双亲委托模型（Parents Delegate Model）</b></span></span></span></div><div><br/></div><div><span style="font-size: 16px;"><b>类加载器的这种层次关系，成为类加载器的双亲委托模型。</b></span></div><div><b><span style="font-size: 16px;"><br/></span></b></div><div><span style="font-size: 16px;"><b>双亲委托模型要求除了顶层的启动类加载器外，其余的类加载器都有应该有自己的父类加载器。这里类记载器的关系一般不是以继承的关系来实现，而是通过组合的关系来复用父类加载器的代码。</b></span></div><div><span style="font-size: 16px;"><b><br/></b></span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>双亲委托模型的工作过程：</b></span></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>如果一个类加载器收到了类加载的请求，它首先不会自己去尝试加载这个类，而是把这个请求委派给父类加载器去完成，每一个层次的类加载器都是如此，因此所有的类加载请求都应该传送到顶层的Bootstrap类加载器中，只有当父类加载器反馈自己无法完成这个加载请求（它的搜索范围中没有找到这个所需的类），子加载器才会尝试自己去加载。</b></span></span></span></div><div><span style="font-size: 16px;"><b><br/></b></span></div><div><span style="font-size: 16px;"><b>使用PDM组织类加载器之间的关系时，有一个显而易见的好处：java类随着它的类加载器一起具备了一种带有优先级的层次关系。</b></span></div><div><span style="font-size: 16px;"><b>例如：rt.jar包中的java.lang.Object，无论是哪一个类加载器去加载，最后都会委托到顶层的Bootstrap类加载器，这样保证在各种类加载环境下，Object都是同一个类。</b></span></div><div><br/></div><div><br/></div><div>系统类加载器：</div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b><br/></b></span></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>Bootstrap ClassLoader:负责加载JAVA_HOME/lib下面的类库，例如rt.jar，开发者不能使用这个类加载器</b></span></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>Extention ClassLoader：负责加载JAVA_HOME/lib/ext下面的类库，开发者可以直接使用这个类加载器</b></span></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>Application ClassLoader：负载加载用户类路径下的类（ClassPath），开发者可以直接使用这个类加载器</b></span></span></span></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><hr/></div><div><br/></div><div><br/></div></span>
</div>
<hr>
<a name="942"/>

<div>
<span><div>一、Java NIO与IO</div><div><br/></div><div>IO：阻塞IO</div><div>NIO：非阻塞IO</div><div><hr/></div><div>二、NIO</div><div>关键概念：</div><div>Channel</div><div><br/></div><div>Buffer</div><div><br/></div><div>Selector</div><div><br/></div><div><hr/></div><div>三、NIO原理</div><div><br/></div><div>多路复用 select机制</div><div><br/></div></span>
</div>
<hr>
<a name="950"/>

<div>
<span><div>首先答案是否定的。</div><div><br/></div><div><hr/></div><div><span style="font-size: 16px;"><b>如果某个域是可变对象的引用，虽然引用的final的，但是指向的对象仍然是可变的，如果将该引用暴露出去（提供get set方法），那么类的不可变性就会被打破。</b></span></div><div><span style="font-size: 16px;"><b><br/></b></span></div><div><span style="font-size: 16px;"><b>常见的例子就是：有一个final修饰的引用，该引用指向一个数组Array或者Collection，且提供暴露该引用的get set方法。</b></span></div><div><br/></div><div>例如：</div><div><br/></div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>class Person{</div><div>private final String name;</div><div>private final Date birthday;</div><div>private final List hobbies;</div><div><br/></div><div>public Person(String name, Date birthday, List hobbies){</div><div>this.name = name; this.birthday = birthday; this.hobbies = hobbies;</div><div>}</div><div><br/></div><div>public String getName() {</div><div>return name;</div><div>}</div><div><br/></div><div>public Date getBirthday() {</div><div>return birthday;</div><div>}</div><div><br/></div><div>public List getHobbies() {</div><div>return hobbies;</div><div>}</div><div> </div><div>@Override public String toString() {</div><div>return &quot;Person [name=&quot; + name + &quot;, birthday=&quot; + birthday + &quot;, hobbies=&quot; + hobbies + &quot;]&quot;;</div><div>}</div><div><br/></div><div>}</div></div><div><br/></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(227, 0, 0);"><span style="font-size: 19px;"><b>该Person类虽然域都声明为final，但是仍然不是不可变对象。</b></span></span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(227, 0, 0);"><span style="font-size: 19px;"><b>解决办法就是：</b></span></span></span></div><ol><li><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(227, 0, 0);"><span style="font-size: 19px;"><b>对于那些final修饰的可变对象的引用，不提供对外的get set方法。</b></span></span></span></li><li><font color="#E30000"><span style="font-size: 19px;"><b>如果必须提供get方法，那么就返回一份copy。</b></span></font></li></ol><div><br/></div><div><hr/></div><div><b><span style="font-size: 19px;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(227, 0, 0);">所有域都是final的  --/--&gt; 类是不可变的</span></span></span></b></div><div><b><span style="font-size: 19px;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(227, 0, 0);">类是不可变的         ------&gt; 所有域都是final的</span></span></span></b></div><div><b><span style="font-size: 19px;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(227, 0, 0);">所有域声明为final只是类是不可变的必要条件，而非充分条件。 </span></span></span></b></div><div><br/></div><div><b><span style="font-size: 19px;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(227, 0, 0);"><br/></span></span></span></b></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 19px;"><span style="color: rgb(227, 0, 0);"><b>如何保证不可变性？（根据《并发编程实践》）</b></span></span></span></div><ol><li><span style="color: rgb(227, 0, 0);"><span style="font-size: 19px;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b>所有域都声明为final</b></span></span></span></li><li><font color="#E30000"><span style="font-size: 19px;"><b>对象一经创建其状态就不再修改</b></span></font></li><li><font color="#E30000"><span style="font-size: 19px;"><b>对象正确的被创建（创建过程中，this引用没有逸出）</b></span></font></li></ol><div><b><span style="font-size: 19px;"><span style="color: rgb(227, 0, 0);"><br/></span></span></b></div><div><font color="#E30000"><span style="font-size: 19px;"><b>---------</b></span></font></div><div><b><span style="font-size: 19px;"><span style="color: rgb(227, 0, 0);"><br/></span></span></b></div><div><b><span style="font-size: 19px;"><span style="color: rgb(227, 0, 0);">不可变对象的好处：</span></span></b></div><div><br/></div><ol><li>线程安全，不用同步；</li><li>不可变对象非常适合用来作为Map的Key或者Set的元素，因为它们一经创建便不再改变</li><li>不可变对象可以被缓存，因为这些不可变对象不会改变。</li></ol><div><br/></div><div><br/></div><div><br/></div></span>
</div>
<hr>
<a name="954"/>

<div>
<span><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 19px;"><b>Red Black Tree是一种自平衡的二叉查找树。（相比于AVL平衡二叉查找树，相当于是放低了平衡性的要求，AVL树是左右子树高度差为1，而RBT则要求宽松一些，但是换来的则是RBT在树的结构调整后，只需要进行很少的旋转操作）</b></span></span></span></div><div><b><span style="font-size: 19px;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><br/></span></span></span></b></div><div><b><span style="font-size: 19px;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><br/></span></span></span></b></div><div><img src="常见面试基础题_files/750px-Red-black_tree_example.svg.png" type="image/png" data-filename="750px-Red-black_tree_example.svg.png" style="height: auto;"/></div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-size: 16px;"><b>但是提出了为节点增加颜色，红黑是用非严格的平衡来换取增删节点时候旋转次数的降低，任何不平衡都会在三次旋转之内解决，而AVL是严格平衡树，因此在增加或者删除节点的时候，根据不同情况，旋转的次数比红黑树要多。所以红黑树的插入效率更高！！！</b></span></div><div><br/></div><div><hr/></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 19px;"><b>红黑树相比AVL树的优势在哪里？</b></span></span></span></div><div><span style="font-size: 16px;"><br/></span></div><ul><li><span style="font-size: 16px;">如果插入一个node引起了树的不平衡，AVL和RB-Tree都是最多只需要2次旋转操作，即两者都是O(1)；但是在删除node引起树的不平衡时，最坏情况下，AVL需要维护从被删node到root这条路径上所有node的平衡性，因此需要旋转的量级O(logN)，而RB-Tree最多只需3次旋转，只需要O(1)的复杂度。</span></li><li><span style="font-size: 16px;">其次，AVL的结构相较RB-Tree来说更为平衡，在插入和删除node更容易引起Tree的unbalance，因此在大量数据需要插入或者删除时，AVL需要rebalance的频率会更高。因此，RB-Tree在需要大量插入和删除node的场景下，效率更高。自然，由于AVL高度平衡，因此AVL的search效率更高。</span></li><li><span style="font-size: 16px;">红黑树的查询性能略微逊色于AVL树，因为他比avl树会稍微不平衡最多一层，也就是说红黑树的查询性能只比相同内容的avl树最多多一次比较，但是，红黑树在插入和删除上完爆avl树，avl树每次插入删除会进行大量的平衡度计算，而红黑树为了维持红黑性质所做的红黑变换和旋转的开销，相较于avl树为了维持平衡的开销要小得多。</span></li><li><span style="font-size: 16px;">AVL更平衡，结构上更加直观，时间效能针对读取而言更高；维护稍慢，空间开销较大。红黑树，读取略逊于AVL，维护强于AVL，空间开销与AVL类似，内容极多时略优于AVL，维护优于AVL。基本上主要的几种平衡树看来，红黑树有着良好的稳定性和完整的功能，性能表现也很不错，综合实力强，在诸如STL的场景中需要稳定表现。</span></li></ul><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">红黑树是每个节点都带有颜色属性的二叉查找树，颜色或红色或黑色。在二叉查找树强制一般要求以外，红黑树有如下要求：</span></div><div><span style="font-size: 16px;"><br/></span></div><ul><li><span style="font-size: 16px;">性质1：节点是黑色或者红色</span></li><li><span style="font-size: 16px;">性质2：根节点是黑色</span></li><li><span style="font-size: 16px;">性质3：每个叶结点（NIL节点，空节点）是黑色</span></li><li><span style="font-size: 16px;">性质4：每个红色节点的两个子节点都是黑色（每条根到叶子结点的路径上不能有两个连续的红色节点）</span></li><li><font size="4">性质5：从任一节点到其每个叶子节点的所有的路径都包含相同数目的黑色节点</font></li></ul><div><span style="font-size: 16px;"><br/></span></div><div><br/></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><span style="color: rgb(255, 0, 0);"><b>上述性质约束让红黑树具有一个非常的关键性质：从根到叶子的最长的可能路径不多于最短的可能路径的两倍长。</b></span></span></span></div><div><b><span style="font-size: 16px;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><br/></span></span></span></b></div><div><b><span style="font-size: 16px;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);">The shortest possible path has all black nodes, and the longest possible path alternates between red and black nodes. Since all maximal paths have the same number of black nodes, by property 5, this shows that no path is more than twice as long as any other path.</span></span></span></b></div><div><br/></div><div>最短的路径上全部都是黑色节点，最长的路径上黑色红色交叉出现。因为性质5，所有路径都有相同的黑色节点，因此不存在任何一条路径的长度比其他路径的两倍还长。</div></span>
</div>
<hr>
<a name="962"/>

<div>
<span><div>如何实现多线程之间的通讯和协作</div><div><br/></div><div>利用同步和互斥来解决多线程之间的通讯和协作；可以说资源互斥、协调竞争是要解决的因，而同步是竞争协调的果。</div><div><br/></div><div>- 通过synchronized/notify/notifyAll来实现线程之间的通信。</div><div>- 利用了Java5中提供的Lock/Condition来实现线程之间的相互通信。</div><div>- 使用信号量，如：CyclicBarrier/Semaphore/Countdownbatch。</div></span>
</div>
<hr>
<a name="968"/>

<div>
<span><div><b><span style="font-size: 16px;">产生死锁的原因主要是：</span></b></div><div><span style="font-size: 16px;">（1） 因为系统资源不足。</span></div><div><span style="font-size: 16px;">（2） 进程运行推进的顺序不合适。</span></div><div><span style="font-size: 16px;">（3） 资源分配不当等。</span></div><div><span style="font-size: 16px;">如果系统资源充足，进程的资源请求都能够得到满足，死锁出现的可能性就很低，否则</span></div><div><span style="font-size: 16px;">就会因争夺有限的资源而陷入死锁。其次，进程运行推进顺序与速度不同，也可能产生死锁。</span></div><div><span style="font-size: 16px;"><br/></span></div><div><hr/></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;"><br/></span></div><div><b><span style="font-size: 16px;">产生死锁的四个必要条件：</span></b></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;">（1） <b>互斥条件：</b>一个资源每次只能被一个进程使用。</span></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;">（2） <b>请求与保持条件：</b>一个进程因请求资源而阻塞时，对已获得的资源保持不放。</span></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;">（3） <b>不剥夺条件:</b> 进程已获得的资源，在末使用完之前，不能强行剥夺。</span></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;">（4） <b>循环等待条件:</b> 若干进程之间形成一种头尾相接的循环等待资源关系。</span></span></span></div><div><span style="font-size: 16px;">这四个条件是死锁的必要条件，只要系统发生死锁，这些条件必然成立，而只要上述条件之</span></div><div><span style="font-size: 16px;">一不满足，就不会发生死锁。</span></div><div><span style="font-size: 16px;"><br/></span></div><div><hr/></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;"><br/></span></div><div><b><span style="font-size: 16px;">死锁的解除与预防：</span></b></div><div><span style="font-size: 16px;">理解了死锁的原因，尤其是产生死锁的四个必要条件，就可以最大可能地避免、预防和</span></div><div><span style="font-size: 16px;">解除死锁。所以，在系统设计、进程调度等方面注意如何不让这四个必要条件成立，如何确</span></div><div><span style="font-size: 16px;">定资源的合理分配算法，避免进程永久占据系统资源。此外，也要防止进程在处于等待状态</span></div><div><span style="font-size: 16px;">的情况下占用资源。因此，对资源的分配要给予合理的规划。</span></div><div><span style="font-size: 16px;"><br/></span></div><div><hr/></div><div><b><font size="4"><span>银行家算法：</span></font></b></div><div><span style="font-size: 16px;">银行家算法（Banker's Algorithm）是一个<b>避免死锁</b>（Deadlock）的著名算法，是由艾兹格·迪杰斯特拉在1965年为T.H.E系统设计的一种避免死锁产生的算法。</span></div><div><span style="font-size: 16px;">它以银行借贷系统的分配策略为基础，判断并保证系统的安全运行。</span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">银行家算法是一种最有代表性的避免死锁的算法。在避免死锁方法中允许进程动态地申请资源，但系统在进行资源分配之前，<b>应先计算此次分配资源的安全性</b>，<b>若分配不会导致系统进入不安全状态，则分配</b>，<b>否则等待</b>。为实现银行家算法，系统必须设置若干数据结构。（先评估分配的安全性，如果不安全（不存在安全的序列），则不分配；否则则分配）</span></div><div><span style="font-size: 16px;"><br/></span></div></span>
</div>
<hr>
<a name="970"/>

<div>
<span><div><h1 style="font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; margin: 8px 0px 16px; padding: 0px; font-weight: 700; box-sizing: border-box; color: rgb(79, 79, 79); font-size: 28px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">6.浮点数的精度和数值范围</h1><h2 style="font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; margin: 8px 0px 16px; padding: 0px; font-weight: 700; box-sizing: border-box; color: rgb(79, 79, 79); font-size: 24px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><a name="t10" style="color: rgb(78, 161, 219); outline: 0px; margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; text-decoration: none;"></a>6.1浮点数的数值范围</h2><p style="margin: 0px 0px 16px; padding: 0px; font-weight: 400; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); text-align: justify; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">根据上面的探讨，浮点数可以表示-∞到+∞，这只是一种特殊情况，显然不是我们想要的数值范围。</p><p style="margin: 0px 0px 16px; padding: 0px; font-weight: 400; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); text-align: justify; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">以32位单精度浮点数为例，阶码E由8位表示，取值范围为0-255，去除0和255这两种特殊情况，那么指数e的取值范围就是1-127=-126到254-127=127。</p><p style="margin: 0px 0px 16px; padding: 0px; font-weight: 400; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); text-align: justify; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">（1）最大正数 <br style="box-sizing: border-box;"/>
因此单精度浮点数最大正数值的符号位S=0，阶码E=254，指数e=254-127=127，尾数M=111 1111 1111 1111 1111 1111，其机器码为：0 11111110 111 1111 1111 1111 1111 1111。</p><p style="margin: 0px 0px 16px; padding: 0px; font-weight: 400; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); text-align: justify; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">那么最大正数值: <br style="box-sizing: border-box;"/></p><div style="margin: 1em 0em; padding: 0px; font-weight: 400; box-sizing: border-box; text-align: center; position: relative; text-indent: 0px; max-width: none; max-height: none; min-width: 0px; min-height: 0px; width: 860px; display: block !important; color: rgb(69, 69, 69); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><span style="margin: 0px; padding: 0px; font-weight: normal; box-sizing: border-box; display: inline; font-style: normal; font-size: 16px; text-indent: 0px; text-align: center; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; outline: 0px; position: relative;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: static; border: 0px; vertical-align: 0px; text-decoration: none; width: 45.94em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border: 0px; vertical-align: 0px; text-decoration: none; width: 38.284em; height: 0px; font-size: 19.2px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; clip: rect(1.148em, 1038.23em, 2.607em, -999.997em); top: -2.185em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">P</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">o</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">s</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">M</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">a</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">x</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">=</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">(</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">−</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; width: 0.94em; height: 0px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border: 0px; vertical-align: 0px; text-decoration: none; clip: rect(3.128em, 1000.32em, 4.43em, -999.997em); top: -4.008em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">)</span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; top: -4.424em; left: 0.367em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-size: 13.5744px; font-family: MathJax_Math-italic;">S</span></span></span></span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">×</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1.</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">M</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">×</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; width: 0.888em; height: 0px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border: 0px; vertical-align: 0px; text-decoration: none; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">2</span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; top: -4.424em; left: 0.523em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-size: 13.5744px; font-family: MathJax_Math-italic;">e</span></span></span></span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">=</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">+</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">(</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1.111</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1111</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1111</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1111</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1111</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1111</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">)</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">×</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; width: 1.617em; height: 0px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border: 0px; vertical-align: 0px; text-decoration: none; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">2</span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; top: -4.424em; left: 0.523em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; font-size: 13.5744px; font-family: MathJax_Main;">127</span></span></span></span></span></span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">≈</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">3.402823</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">e</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">+</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">38</span></span></span></span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; top: 0px; left: 0px; clip: rect(1px, 1px, 1px, 1px); user-select: none; position: static; border: 0px; height: 1px !important; width: 735.028px; overflow: hidden !important; display: none; transition: none; vertical-align: 0px; text-decoration: none;">PosMax=(−1)S×1.M×2e=+(1.11111111111111111111111)×2127≈3.402823e+38</span></span></div><br style="box-sizing: border-box; color: rgb(69, 69, 69); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"/><span style="color: rgb(69, 69, 69); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;">这是一个很大的数。</span><p style="margin: 0px 0px 16px; padding: 0px; font-weight: 400; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); text-align: justify; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"></p><p style="margin: 0px 0px 16px; padding: 0px; font-weight: 400; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); text-align: justify; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">（2）最小正数 <br style="box-sizing: border-box;"/>
最小正数符号位S=0，阶码E=1，指数e=1-127=-126，尾数M=0，其机器码为0 00000001 000 0000 0000 0000 0000 0000。</p><p style="margin: 0px 0px 16px; padding: 0px; font-weight: 400; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); text-align: justify; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">那么最小正数为： <br style="box-sizing: border-box;"/></p><div style="margin: 1em 0em; padding: 0px; font-weight: 400; box-sizing: border-box; text-align: center; position: relative; text-indent: 0px; max-width: none; max-height: none; min-width: 0px; min-height: 0px; width: 860px; display: block !important; color: rgb(69, 69, 69); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><span style="margin: 0px; padding: 0px; font-weight: normal; box-sizing: border-box; display: inline; font-style: normal; font-size: 16px; text-indent: 0px; text-align: center; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; outline: 0px; position: relative;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: static; border: 0px; vertical-align: 0px; text-decoration: none; width: 33.284em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border: 0px; vertical-align: 0px; text-decoration: none; width: 27.711em; height: 0px; font-size: 19.2px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; clip: rect(1.148em, 1027.66em, 2.607em, -999.997em); top: -2.185em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">P</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">o</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">s</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">M</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">i</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">n</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">=</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">(</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">−</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; width: 0.94em; height: 0px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border: 0px; vertical-align: 0px; text-decoration: none; clip: rect(3.128em, 1000.32em, 4.43em, -999.997em); top: -4.008em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">)</span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; top: -4.424em; left: 0.367em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-size: 13.5744px; font-family: MathJax_Math-italic;">S</span></span></span></span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">×</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1.</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">M</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">×</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; width: 0.888em; height: 0px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border: 0px; vertical-align: 0px; text-decoration: none; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">2</span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; top: -4.424em; left: 0.523em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-size: 13.5744px; font-family: MathJax_Math-italic;">e</span></span></span></span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">=</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">+</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">(</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1.0</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">)</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">×</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; width: 2.19em; height: 0px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border: 0px; vertical-align: 0px; text-decoration: none; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">2</span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; top: -4.424em; left: 0.523em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-size: 13.5744px; font-family: MathJax_Main;">−</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; font-size: 13.5744px; font-family: MathJax_Main;">126</span></span></span></span></span></span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">≈</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1.175494</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">e</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">−</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">38</span></span></span></span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; top: 0px; left: 0px; clip: rect(1px, 1px, 1px, 1px); user-select: none; position: static; border: 0px; height: 1px !important; width: 532.543px; overflow: hidden !important; display: none; transition: none; vertical-align: 0px; text-decoration: none;">PosMin=(−1)S×1.M×2e=+(1.0)×2−126≈1.175494e−38</span></span></div><p style="margin: 0px 0px 16px; padding: 0px; font-weight: 400; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); text-align: justify; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"></p><p style="margin: 0px 0px 16px; padding: 0px; font-weight: 400; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); text-align: justify; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">这是一个相当小的数。几乎可以近似等于0。当阶码E=0，指数为-127时，IEEE754就是这么规定<span style="margin: 0px; padding: 0px; font-weight: normal; box-sizing: border-box; display: inline; font-style: normal; font-size: 16px; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; outline: 0px; position: relative;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: static; border: 0px; vertical-align: 0px; text-decoration: none; width: 5.576em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border: 0px; vertical-align: 0px; text-decoration: none; width: 4.638em; height: 0px; font-size: 19.2px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; clip: rect(1.148em, 1004.64em, 2.346em, -999.997em); top: -2.185em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1.0</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">×</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; width: 2.19em; height: 0px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border: 0px; vertical-align: 0px; text-decoration: none; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">2</span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; top: -4.424em; left: 0.523em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-size: 13.5744px; font-family: MathJax_Main;">−</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; font-size: 13.5744px; font-family: MathJax_Main;">127</span></span></span></span></span></span></span></span></span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; top: 0px; left: 0px; clip: rect(1px, 1px, 1px, 1px); user-select: none; position: static; border: 0px; height: 1px !important; width: 1px !important; overflow: hidden !important; display: none; transition: none; vertical-align: 0px; text-decoration: none;">1.0×2−127</span></span>近似为0的，事实上，它并不等于0。</p><p style="margin: 0px 0px 16px; padding: 0px; font-weight: 400; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); text-align: justify; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">（3）最大负数 <br style="box-sizing: border-box;"/>
最大负数符号位S=1，阶码E=1，指数e=1-127==-126，尾数M=0，机器码与最小正数的符号位相反，其他均相同，为：1 00000001 000 0000 0000 0000 0000 0000。</p><p style="margin: 0px 0px 16px; padding: 0px; font-weight: 400; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); text-align: justify; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">最大负数等于： <br style="box-sizing: border-box;"/></p><div style="margin: 1em 0em; padding: 0px; font-weight: 400; box-sizing: border-box; text-align: center; position: relative; text-indent: 0px; max-width: none; max-height: none; min-width: 0px; min-height: 0px; width: 860px; display: block !important; color: rgb(69, 69, 69); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><span style="margin: 0px; padding: 0px; font-weight: normal; box-sizing: border-box; display: inline; font-style: normal; font-size: 16px; text-indent: 0px; text-align: center; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; outline: 0px; position: relative;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: static; border: 0px; vertical-align: 0px; text-decoration: none; width: 34.586em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border: 0px; vertical-align: 0px; text-decoration: none; width: 28.805em; height: 0px; font-size: 19.2px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; clip: rect(1.148em, 1028.75em, 2.607em, -999.997em); top: -2.185em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">N</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">e</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">g</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">M</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">a</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">x</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">=</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">(</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">−</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; width: 0.94em; height: 0px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border: 0px; vertical-align: 0px; text-decoration: none; clip: rect(3.128em, 1000.32em, 4.43em, -999.997em); top: -4.008em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">)</span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; top: -4.424em; left: 0.367em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-size: 13.5744px; font-family: MathJax_Math-italic;">S</span></span></span></span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">×</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1.</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">M</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">×</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; width: 0.888em; height: 0px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border: 0px; vertical-align: 0px; text-decoration: none; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">2</span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; top: -4.424em; left: 0.523em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-size: 13.5744px; font-family: MathJax_Math-italic;">e</span></span></span></span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">=</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">−</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">(</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1.0</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">)</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">×</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; width: 2.19em; height: 0px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border: 0px; vertical-align: 0px; text-decoration: none; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">2</span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; top: -4.424em; left: 0.523em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-size: 13.5744px; font-family: MathJax_Main;">−</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; font-size: 13.5744px; font-family: MathJax_Main;">126</span></span></span></span></span></span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">≈</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">−</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1.175494</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">e</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">−</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">38</span></span></span></span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; top: 0px; left: 0px; clip: rect(1px, 1px, 1px, 1px); user-select: none; position: static; border: 0px; height: 1px !important; width: 553.366px; overflow: hidden !important; display: none; transition: none; vertical-align: 0px; text-decoration: none;">NegMax=(−1)S×1.M×2e=−(1.0)×2−126≈−1.175494e−38</span></span></div><p style="margin: 0px 0px 16px; padding: 0px; font-weight: 400; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); text-align: justify; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"></p><p style="margin: 0px 0px 16px; padding: 0px; font-weight: 400; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); text-align: justify; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">（4）最小负数 <br style="box-sizing: border-box;"/>
符号位S=0，阶码E=254，指数e=254-127=127，尾数M=111 1111 1111 1111 1111 1111，其机器码为：1 11111110 111 1111 1111 1111 1111 1111。</p><p style="margin: 0px 0px 16px; padding: 0px; font-weight: 400; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); text-align: justify; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">计算得： <br style="box-sizing: border-box;"/></p><div style="margin: 1em 0em; padding: 0px; font-weight: 400; box-sizing: border-box; text-align: center; position: relative; text-indent: 0px; max-width: none; max-height: none; min-width: 0px; min-height: 0px; width: 860px; display: block !important; color: rgb(69, 69, 69); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><span style="margin: 0px; padding: 0px; font-weight: normal; box-sizing: border-box; display: inline; font-style: normal; font-size: 16px; text-indent: 0px; text-align: center; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; outline: 0px; position: relative;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: static; border: 0px; vertical-align: 0px; text-decoration: none; width: 46.878em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border: 0px; vertical-align: 0px; text-decoration: none; width: 39.065em; height: 0px; font-size: 19.2px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; clip: rect(1.148em, 1039.01em, 2.607em, -999.997em); top: -2.185em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">N</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">e</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">g</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">M</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">i</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">n</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">=</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">(</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">−</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; width: 0.94em; height: 0px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border: 0px; vertical-align: 0px; text-decoration: none; clip: rect(3.128em, 1000.32em, 4.43em, -999.997em); top: -4.008em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">)</span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; top: -4.424em; left: 0.367em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-size: 13.5744px; font-family: MathJax_Math-italic;">S</span></span></span></span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">×</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1.</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">M</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">×</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; width: 0.888em; height: 0px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border: 0px; vertical-align: 0px; text-decoration: none; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">2</span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; top: -4.424em; left: 0.523em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-size: 13.5744px; font-family: MathJax_Math-italic;">e</span></span></span></span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">=</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">+</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">(</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1.111</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1111</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1111</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1111</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1111</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1111</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">)</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">×</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; width: 1.617em; height: 0px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border: 0px; vertical-align: 0px; text-decoration: none; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">2</span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; top: -4.424em; left: 0.523em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; font-size: 13.5744px; font-family: MathJax_Main;">127</span></span></span></span></span></span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">=</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">−</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">3.402823</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">e</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">+</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">38</span></span></span></span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; top: 0px; left: 0px; clip: rect(1px, 1px, 1px, 1px); user-select: none; position: static; border: 0px; height: 1px !important; width: 750.043px; overflow: hidden !important; display: none; transition: none; vertical-align: 0px; text-decoration: none;">NegMin=(−1)S×1.M×2e=+(1.11111111111111111111111)×2127=−3.402823e+38</span></span></div><p style="margin: 0px 0px 16px; padding: 0px; font-weight: 400; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); text-align: justify; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"></p><h2 style="font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; margin: 8px 0px 16px; padding: 0px; font-weight: 700; box-sizing: border-box; color: rgb(79, 79, 79); font-size: 24px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><a name="t11" style="color: rgb(78, 161, 219); outline: 0px; margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; text-decoration: none;"></a>6.2浮点数的精度</h2><p style="margin: 0px 0px 16px; padding: 0px; font-weight: 400; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); text-align: justify; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">说道浮点数的精度，先给精度下一个定义。浮点数的精度是指浮点数的小数位所能表达的位数。</p><p style="margin: 0px 0px 16px; padding: 0px; font-weight: 400; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); text-align: justify; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">阶码的二进制位数决定浮点数的表示范围，尾数的二进制位数表示浮点数的精度。以32位浮点数为例，尾数域有23位。那么浮点数以二进制表示的话精度是23位，23位所能表示的最大数是<span style="margin: 0px; padding: 0px; font-weight: normal; box-sizing: border-box; display: inline; font-style: normal; font-size: 16px; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; outline: 0px; position: relative;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: static; border: 0px; vertical-align: 0px; text-decoration: none; width: 9.273em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border: 0px; vertical-align: 0px; text-decoration: none; width: 7.711em; height: 0px; font-size: 19.2px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; clip: rect(1.148em, 1007.71em, 2.451em, -999.997em); top: -2.185em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; width: 1.305em; height: 0px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border: 0px; vertical-align: 0px; text-decoration: none; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">2</span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; top: -4.424em; left: 0.523em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; font-size: 13.5744px; font-family: MathJax_Main;">23</span></span></span></span></span></span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">−</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">=</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">8388607</span></span></span></span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; top: 0px; left: 0px; clip: rect(1px, 1px, 1px, 1px); user-select: none; position: static; border: 0px; height: 1px !important; width: 1px !important; overflow: hidden !important; display: none; transition: none; vertical-align: 0px; text-decoration: none;">223−1=8388607</span></span>，所以十进制的尾数部分最大数值是8388607，也就是说尾数数值超过这个值，float将无法精确表示，所以float最多能表示小数点后7位，但绝对能保证的为6位，也即float的十进制的精度为为6~7位。</p><div style="margin: 0px 0px 16px; padding: 0px; font-weight: 400; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); text-align: justify; font-family: -apple-system, 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun; font-style: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div>64位双精度浮点数的尾数域52位，因<span style="margin: 0px; padding: 0px; font-weight: normal; box-sizing: border-box; display: inline; font-style: normal; font-size: 16px; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; outline: 0px; position: relative;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: static; border: 0px; vertical-align: 0px; text-decoration: none; width: 17.19em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border: 0px; vertical-align: 0px; text-decoration: none; width: 14.326em; height: 0px; font-size: 19.2px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; clip: rect(1.148em, 1014.27em, 2.555em, -999.997em); top: -2.185em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; width: 1.305em; height: 0px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border: 0px; vertical-align: 0px; text-decoration: none; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">2</span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; top: -4.424em; left: 0.523em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; font-size: 13.5744px; font-family: MathJax_Main;">52</span></span></span></span></span></span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">−</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">=</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">4</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">,</span><span style="margin: 0px; padding: 0px 0px 0px 0.159em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">503</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">,</span><span style="margin: 0px; padding: 0px 0px 0px 0.159em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">599</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">,</span><span style="margin: 0px; padding: 0px 0px 0px 0.159em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">627</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">,</span><span style="margin: 0px; padding: 0px 0px 0px 0.159em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">370</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">,</span><span style="margin: 0px; padding: 0px 0px 0px 0.159em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">495</span></span></span></span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; top: 0px; left: 0px; clip: rect(1px, 1px, 1px, 1px); user-select: none; position: static; border: 0px; height: 1px !important; width: 1px !important; overflow: hidden !important; display: none; transition: none; vertical-align: 0px; text-decoration: none;">252−1=4,503,599,627,370,495</span></span>，所以双精度浮点数的十进制的精度最高为16位，绝对保证的为15位，所以double的十进制的精度为15~16位。</div></div></div></span>
</div>
<hr>
<a name="980"/>

<div>
<span><div>请求首部：</div><div><br/></div><div><span style="font-size: 16px;"><b>Host: URL</b></span></div><div><span style="font-size: 16px;"><b>Connection: keep-alive </b></span></div><div><span style="font-size: 16px;"><b>Cache-Control: no-cache</b></span></div><div><span style="font-size: 16px;"><b>Upgrade-Insecure-Requests: 1</b></span></div><div><span style="font-size: 16px;"><b>User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.186 Safari/537.36</b></span></div><div><span style="font-size: 16px;"><b>Accept: text/html </b></span></div><div><span style="font-size: 16px;"><b>Accept-Encoding: gzip, deflate</b></span></div><div><span style="font-size: 16px;"><b>Accept-Language: zh-CN,zh;q=0.9,en;q=0.8</b></span></div><div><span style="font-size: 16px;"><b>Cookie: SessionId=</b></span></div><div><br/></div><div><hr/></div><div><br/></div><div>响应首部</div><div><br/></div><div><span style="font-size: 16px;"><b>Date: Thu, 15 Mar 2018 07:36:43 GMT</b></span></div><div><span style="font-size: 16px;"><b>Server: VWebServer X-Frame-Options: SAMEORIGIN</b></span></div><div><span style="font-size: 16px;"><b>Last-Modified: Thu, 15 Mar 2018 06:51:38 GMT</b></span></div><div><span style="font-size: 16px;"><b>ETag: &quot;ecb8-5676dec5a7280&quot;  </b></span></div><div><span style="font-size: 16px;"><b>Cache-Control: private, max-age=600</b></span></div><div><span style="font-size: 16px;"><b>Expires: Thu, 15 Mar 2018 07:46:43 GMT</b></span></div><div><span style="font-size: 16px;"><b>Content-Encoding: gzip</b></span></div><div><span style="font-size: 16px;"><b>Content-Length: 12460</b></span></div><div><span style="font-size: 16px;"><b>Keep-Alive: timeout=5, max=200</b></span></div><div><span style="font-size: 16px;"><b>Connection: Keep-Alive</b></span></div><div><span style="font-size: 16px;"><b>Content-Type: text/html</b></span></div><div><span style="font-size: 16px;"><b>Content-Language: zh-CN</b></span></div></span>
</div>
<hr>
<a name="1037"/>

<div>
<span><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 19px;"><b>Red Black Tree是一种自平衡的二叉查找树。（相比于AVL平衡二叉查找树，相当于是放低了平衡性的要求，AVL树是左右子树高度差为1，而RBT则要求宽松一些，但是换来的则是RBT在树的结构调整后，只需要进行很少的旋转操作）</b></span></span></span></div><div><b><span style="font-size: 19px;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><br/></span></span></span></b></div><div><b><span style="font-size: 19px;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><br/></span></span></span></b></div><div><img src="常见面试基础题_files/750px-Red-black_tree_example.svg [1].png" type="image/png" data-filename="750px-Red-black_tree_example.svg.png" style="height: auto;"/></div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-size: 16px;"><b>但是提出了为节点增加颜色，红黑是用非严格的平衡来换取增删节点时候旋转次数的降低，任何不平衡都会在三次旋转之内解决，而AVL是严格平衡树，因此在增加或者删除节点的时候，根据不同情况，旋转的次数比红黑树要多。所以红黑树的插入效率更高！！！</b></span></div><div><br/></div><div><hr/></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 19px;"><b>红黑树相比AVL树的优势在哪里？</b></span></span></span></div><div><span style="font-size: 16px;"><br/></span></div><ul><li><span style="font-size: 16px;">如果插入一个node引起了树的不平衡，AVL和RB-Tree都是最多只需要2次旋转操作，即两者都是O(1)；但是在删除node引起树的不平衡时，最坏情况下，AVL需要维护从被删node到root这条路径上所有node的平衡性，因此需要旋转的量级O(logN)，而RB-Tree最多只需3次旋转，只需要O(1)的复杂度。</span></li><li><span style="font-size: 16px;">其次，AVL的结构相较RB-Tree来说更为平衡，在插入和删除node更容易引起Tree的unbalance，因此在大量数据需要插入或者删除时，AVL需要rebalance的频率会更高。因此，RB-Tree在需要大量插入和删除node的场景下，效率更高。自然，由于AVL高度平衡，因此AVL的search效率更高。</span></li><li><span style="font-size: 16px;">红黑树的查询性能略微逊色于AVL树，因为他比avl树会稍微不平衡最多一层，也就是说红黑树的查询性能只比相同内容的avl树最多多一次比较，但是，红黑树在插入和删除上完爆avl树，avl树每次插入删除会进行大量的平衡度计算，而红黑树为了维持红黑性质所做的红黑变换和旋转的开销，相较于avl树为了维持平衡的开销要小得多。</span></li><li><span style="font-size: 16px;">AVL更平衡，结构上更加直观，时间效能针对读取而言更高；维护稍慢，空间开销较大。红黑树，读取略逊于AVL，维护强于AVL，空间开销与AVL类似，内容极多时略优于AVL，维护优于AVL。基本上主要的几种平衡树看来，红黑树有着良好的稳定性和完整的功能，性能表现也很不错，综合实力强，在诸如STL的场景中需要稳定表现。</span></li></ul><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">红黑树是每个节点都带有颜色属性的二叉查找树，颜色或红色或黑色。在二叉查找树强制一般要求以外，红黑树有如下要求：</span></div><div><span style="font-size: 16px;"><br/></span></div><ul><li><span style="font-size: 16px;">性质1：节点是黑色或者红色</span></li><li><span style="font-size: 16px;">性质2：根节点是黑色</span></li><li><span style="font-size: 16px;">性质3：每个叶结点（NIL节点，空节点）是黑色</span></li><li><span style="font-size: 16px;">性质4：每个红色节点的两个子节点都是黑色（每条根到叶子结点的路径上不能有两个连续的红色节点）</span></li><li><font size="4">性质5：从任一节点到其每个叶子节点的所有的路径都包含相同数目的黑色节点</font></li></ul><div><span style="font-size: 16px;"><br/></span></div><div><br/></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><span style="color: rgb(255, 0, 0);"><b>上述性质约束让红黑树具有一个非常的关键性质：从根到叶子的最长的可能路径不多于最短的可能路径的两倍长。</b></span></span></span></div><div><b><span style="font-size: 16px;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><br/></span></span></span></b></div><div><b><span style="font-size: 16px;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);">The shortest possible path has all black nodes, and the longest possible path alternates between red and black nodes. Since all maximal paths have the same number of black nodes, by property 5, this shows that no path is more than twice as long as any other path.</span></span></span></b></div><div><br/></div><div>最短的路径上全部都是黑色节点，最长的路径上黑色红色交叉出现。因为性质5，所有路径都有相同的黑色节点，因此不存在任何一条路径的长度比其他路径的两倍还长。</div></span>
</div>
<hr>
<a name="1040"/>

<div>
<span><div style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 21px;"><span style="font-family: arial;">Thread safe Singleton means a Singleton class which returns exactly same instance even if exposed to multiple threads. Singleton in Java has been a classical design pattern like <a href="http://javarevisited.blogspot.sg/2011/12/factory-design-pattern-java-example.html" style="color: rgb(102, 0, 153);">Factory method pattern</a> or <a href="http://javarevisited.blogspot.sg/2011/11/decorator-design-pattern-java-example.html" style="color: rgb(102, 0, 153);">Decorator design pattern</a> and has been used a lot even inside JDK like </span><span style="font-family: 'courier new';">java.lang.Runtime </span><span style="font-family: arial;">is an example of Singleton class. Singleton pattern ensures that exactly one instance of class will remain in Java program at any time. In our last post <a href="http://javarevisited.blogspot.com/2011/03/10-interview-questions-on-singleton.html" style="color: rgb(102, 0, 153);">10 Interview questions on Singleton in Java</a> we have discussed many different questions asked on Singleton pattern, One of them was writing Thread safe singleton in Java. Prior to Java 5 <a href="http://javarevisited.blogspot.sg/2012/07/why-enum-singleton-are-better-in-java.html" style="color: rgb(102, 0, 153);">double checked locking</a> mechanism is used to create <i>thread-safe singleton</i> in Java which breaks if one Thread doesn't see instance created by other thread at same time and eventually you will end up with more than one instance of Singleton class. From Java 5 onwards <a href="http://javarevisited.blogspot.sg/2011/06/volatile-keyword-java-example-tutorial.html" style="color: rgb(102, 0, 153);">volatile variable</a> guarantee can be used to write thread safe singleton by using double checked locking pattern. I personally  don't prefer that way as there are many other simpler alternatives to write thread-safe singleton is available available like using <a href="http://javarevisited.blogspot.sg/2011/11/static-keyword-method-variable-java.html" style="color: rgb(102, 0, 153);">static field</a> to initialize Singleton instance or using <a href="http://javarevisited.blogspot.sg/2012/07/why-enum-singleton-are-better-in-java.html" style="color: rgb(102, 0, 153);">Enum as Singleton in Java</a>. Let’s see example of both ways to create thread-safe Singleton in Java.</span></span></div><div><span style="font-size: 21px;"><span style="font-family: 'Trebuchet MS', Verdana, Arial, sans-serif;"><br/></span></span></div><div><font face="Trebuchet MS, Verdana, Arial, sans-serif"><span style="font-size: 21px;">线程安全的单例意味着一个单例类即使在多线程环境下也只返回相同的实例。单例在Java中和工厂方法模式、装饰器模式一样，是一个经典的设计模式，已经被广泛使用与JDK的类中，例如java.lang.Runtime类。单例模式保证在任何时刻Java程序中都只有一个实例。在java5之前，double check的写法其实是线程不安全的，由于存在内存可见性，会导致线程观察到一个正在创建的不完整的实例，从1.5以后开始，volatile关键字可以保证内存可见性，因此double check是线程安全的。从此之外，还有一些简单的可选的实现线程安全单例的方式，例如：使用静态域初始化（饿汉、懒汉holder），或者使用Java枚举类Enum来实现。</span></font></div><div><span style="font-size: 21px;"><span style="font-family: 'Trebuchet MS', Verdana, Arial, sans-serif;"><br/></span></span></div><div><span style="font-size: 21px;"><br/></span></div><div><div style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-weight: bold;"><div><span style="font-size: 21px;"><u><span style="font-style: normal; font-weight: normal;">Java Singleton Example – Thread safe Singleton in Java using Enum使用枚举类实现线程安全的单例类</span></u></span></div></div><div style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div><span style="font-size: 21px;"><span style="font-family: arial;">This is one of the example of Enum which I missed while writing <a href="http://javarevisited.blogspot.sg/2011/08/enum-in-java-example-tutorial.html" style="color: rgb(102, 0, 153);">10 Examples of Enum in Java</a>. Using Enum to create Singleton is by far most simple and effective way to create thread-safe Singleton in Java, asthread-safety guarantee is provided by Java programming language itself. You don't need to bother about thread-safety issue. Since Enum instances are by default <a href="http://javarevisited.blogspot.sg/2011/12/final-variable-method-class-java.html" style="color: rgb(102, 0, 153);">final in Java</a>, it also provides safety against multiple instance due to <a href="http://javarevisited.blogspot.sg/2011/04/top-10-java-serialization-interview.html" style="color: rgb(102, 0, 153);">serialization</a>. </span></span></div><div><span style="font-size: 21px;">使用枚举Enum创建线程安全的单例，是目前为止最简单和最有效的方式。因为线程安全是Java语言本身来保证的，因此我们不需要担忧线程安全的问题。因为Enum实例默认是final的，因此在序列化的时候也提供线程安全性。</span></div><span style="font-size: 21px;"><br/></span><div><span style="font-size: 21px;"><span style="font-family: arial;">One point which is worth remembering is that, when we talk about thread-safe Singleton, we are talking about thread-safety during instance creation of Singleton class and not when we call any method of Singleton class. If your Singleton class maintain any state and contains method to modify that state, you need to write code to avoid and <a href="http://javarevisited.blogspot.sg/2012/01/how-to-write-thread-safe-code-in-java.html" style="color: rgb(102, 0, 153);">thread-safety</a> and <a href="http://javarevisited.blogspot.sg/2011/04/synchronization-in-java-synchronized.html" style="color: rgb(102, 0, 153);">synchronization issues</a>. Any way here is code <i>example of creating thread safe Singleton in Java using Enum</i>.</span></span></div></div><div style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div><span style="font-size: 21px;">需要记住的一点是，当我们讨论线程安全的单例的时候，我们是在讨论实例创建时期的线程安全性，不是说我们调用实例的方法。如果你的单例类需要维护状态，包含修改状态的方法，你需要写一些额外的代码来避免线程安全和同步问题。下面是使用Enum创建单例的例子：</span></div><div><span style="font-size: 21px;"><br/></span></div></div><div style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); border: 1pt dotted windowtext; padding: 1pt 4pt; transition: background-color 0.3s ease; -webkit-transition: background-color 0.3s ease; background-position: initial initial; background-repeat: initial initial;"><div style="background: rgb(193, 230, 198); border: none; padding: 0in; transition: background-color 0.3s ease;"><span style="font-size: 21px;"><span style="font-family: 'courier new';"> <b><span style="color: black;">public</span></b> <b><span style="color: black;">enum</span></b> Singleton<span style="color: rgb(0, 153, 0);">{</span><br/>
    INSTANCE<span style="color: rgb(51, 153, 51);">;</span><br/>
  <br/>
    <b><span style="color: black;">public</span></b> <b><span style="color: rgb(0, 102, 0);">void</span></b> show<span style="color: rgb(0, 153, 0);">(){</span><br/>
        <b>System</b>.<span style="color: rgb(0, 102, 51);">out</span>.<span style="color: rgb(0, 102, 51);">println</span><span style="color: rgb(0, 153, 0);">(</span><span style="color: blue;">&quot;Singleton using Enum in Java&quot;</span><span style="color: rgb(0, 153, 0);">)</span><span style="color: rgb(51, 153, 51);">;</span><br/>
    <span style="color: rgb(0, 153, 0);">}</span><br/><span style="color: rgb(0, 153, 0);">}</span></span></span></div><div style="background: rgb(193, 230, 198); border: none; padding: 0in; transition: background-color 0.3s ease;"><span style="font-size: 21px;"><br/></span></div><div style="background: rgb(193, 230, 198); border: none; padding: 0in; transition: background-color 0.3s ease;"><span style="font-size: 21px;"><span style="color: rgb(0, 153, 0); font-family: 'courier new';">//You can access this Singleton as Singleton.INSTANCE and call any method like below</span></span></div><div style="background: rgb(193, 230, 198); border: none; padding: 0in; transition: background-color 0.3s ease;"><span style="font-size: 21px;"><span style="font-family: 'courier new';">Singleton.INSTANCE.show();</span></span></div></div><div style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 21px;"><br/></span></div><div style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 21px;"><span style="font-family: arial;">If this suits your need than this is the most easy way of writing thread-safe Singleton in Java. Using Enum as Singleton also provide couple of more benefits which you can find out on <a href="http://javarevisited.blogspot.sg/2012/07/why-enum-singleton-are-better-in-java.html" style="color: rgb(102, 0, 153);">Why Enum Singleton are better in Java</a>.</span></span></div><div style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div><span style="font-size: 21px;"><br/></span></div></div><h2 style="color: rgb(0, 0, 0); font-family: &quot;Trebuchet MS&quot;, Verdana, Arial, sans-serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;"><span style="font-size: 21px;"><u><span style="font-style: normal; font-weight: normal;">Java Singleton Example - Thread Safe Singleton using Static field Initialization使用静态域来创建线程安全的单例？</span></u></span></h2><div style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 21px;"><span style="font-family: arial;">You can also create thread safe Singleton in Java by creating Singleton instance during <a href="http://javarevisited.blogspot.sg/2012/07/when-class-loading-initialization-java-example.html" style="color: rgb(102, 0, 153);">class loading</a>. static fields are initialized during class loading and <a href="http://javarevisited.blogspot.com.au/2012/12/how-classloader-works-in-java.html" style="color: rgb(102, 0, 153);">Classloader</a> will guarantee that instance will not be visible until its fully created. Here is example of creating thread safe singleton in Java using static factory method. Only disadvantage of this implementing Singleton patter using static field is that this is <i>not a lazy initialization</i> and Singleton is initialized even before any clients call there </span><span style="font-family: 'courier new';">getInstance()</span><span style="font-family: arial;"> method.</span></span></div><div style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div><span style="font-size: 21px;"><br/></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><b><span style="font-size: 21px;">你可以通过在类加载的时候创建单例的实例的方式来创建线程安全的单例。静态域在类加载的时候被初始化，类加载器将保证实例是可见的直到被完全创建完毕。（因为类加载器加锁，保证只有一个线程去加载这个类，内存可见性得到保证）。下面是使用静态工厂方法创建线程安全的单例的例子，唯一的缺点就是这种方式不是懒加载的，任何触及到该类被加载的调用，都将触发单例实例的创建。</span></b></span></span></div><div><span style="font-size: 21px;"><br/></span></div></div><div style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); border: 1pt dotted windowtext; padding: 1pt 4pt; transition: background-color 0.3s ease; -webkit-transition: background-color 0.3s ease; background-position: initial initial; background-repeat: initial initial;"><div style="background: rgb(193, 230, 198); border: none; padding: 0in; transition: background-color 0.3s ease;"><span style="font-size: 21px;"><b><span style="color: black; font-family: 'courier new';">public</span></b><span style="font-family: 'courier new';"> <b><span style="color: black;">class</span></b> Singleton<span style="color: rgb(0, 153, 0);">{</span><br/>
    <b><span style="color: black;">private</span></b> <b><span style="color: black;">static</span></b> <b><span style="color: black;">final</span></b> Singleton INSTANCE = <b><span style="color: black;">new</span></b> Singleton<span style="color: rgb(0, 153, 0);">()</span><span style="color: rgb(51, 153, 51);">;</span><br/>
  <br/>
    <b><span style="color: black;">private</span></b> Singleton<span style="color: rgb(0, 153, 0);">(){</span> <span style="color: rgb(0, 153, 0);">}</span><br/><br/>
    <b><span style="color: black;">public</span></b> <b><span style="color: black;">static</span></b> Singleton getInstance<span style="color: rgb(0, 153, 0);">(){</span><br/>
        <b><span style="color: black;">return</span></b> INSTANCE<span style="color: rgb(51, 153, 51);">;</span><br/>
    <span style="color: rgb(0, 153, 0);">}</span><br/>
    <b><span style="color: black;">public</span></b> <b><span style="color: rgb(0, 102, 0);">void</span></b> show<span style="color: rgb(0, 153, 0);">(){</span><br/>
        <b>System</b>.<span style="color: rgb(0, 102, 51);">out</span>.<span style="color: rgb(0, 102, 51);">println</span><span style="color: rgb(0, 153, 0);">(</span><span style="color: blue;">&quot;Singleon using static initialization in Java&quot;</span><span style="color: rgb(0, 153, 0);">)</span><span style="color: rgb(51, 153, 51);">;</span><br/>
    <span style="color: rgb(0, 153, 0);">}</span><br/><span style="color: rgb(0, 153, 0);">}</span></span></span></div><div style="background: rgb(193, 230, 198); border: none; padding: 0in; transition: background-color 0.3s ease;"><span style="font-size: 21px;"><br/></span></div><div style="background: rgb(193, 230, 198); border: none; padding: 0in; transition: background-color 0.3s ease;"><span style="font-size: 21px;"><span style="color: rgb(0, 153, 0); font-family: 'courier new';">//Here is how to access this Singleton class</span></span></div><div style="background: rgb(193, 230, 198); border: none; padding: 0in; transition: background-color 0.3s ease;"><span style="font-size: 21px;"><span style="font-family: 'courier new';">Singleton.getInstance().show();</span></span></div></div><div style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 21px;"><br/></span></div><div style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div><span style="font-size: 21px;"><span style="font-family: arial;">here we are not creating Singleton instance inside </span><span style="font-family: 'courier new';">getInstance()</span><span style="font-family: arial;"> method instead it will be created by ClassLoader. Also <a href="http://javarevisited.blogspot.sg/2012/12/what-is-constructor-in-java-example-chainning-overloading.html" style="color: rgb(102, 0, 153);">private constructor</a> makes impossible to create another instance , except one case. You can still access private constructor by reflection and calling </span><span style="font-family: 'courier new';">setAccessible(true).</span><span style="font-family: arial;"> By the way You can still prevent creating another instance of Singleton by this way by <a href="http://javarevisited.blogspot.sg/2012/02/difference-between-throw-and-throws-in.html" style="color: rgb(102, 0, 153);">throwing Exception</a> from constructor.</span></span></div></div></div><div><span style="font-size: 21px;"><span style="font-family: 'Trebuchet MS', Verdana, Arial, sans-serif;">通过将构造器声明为私有的，不允许直接通过构造器来创建实例。但是仍然可以通过反射来调用构造函数创建实例，为了防止这样的无脑操作，可以在<span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(227, 0, 0);"><b>构造函数中抛出异常</b></span></span>来阻止这种行为。</span></span></div><div><span style="font-size: 21px;"><span style="font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-family: 'Trebuchet MS', Verdana, Arial, sans-serif;"><br/></span></span></span></div><div><span style="font-size: 21px;"><span style="font-family: 'Trebuchet MS', Verdana, Arial, sans-serif;">Read more: <a href="http://javarevisited.blogspot.com/2012/12/how-to-create-thread-safe-singleton-in-java-example.html#ixzz59xlE3Ugb" style="color: rgb(0, 51, 153);">http://javarevisited.blogspot.com/2012/12/how-to-create-thread-safe-singleton-in-java-example.html#ixzz59xlE3Ugb</a></span></span></div><div><span style="font-size: 21px;"><span style="font-family: 'Trebuchet MS', Verdana, Arial, sans-serif;"><br/></span></span></div><div><span style="font-size: 21px;"><span style="font-family: 'Trebuchet MS', Verdana, Arial, sans-serif;"><br/></span></span></div><div><span style="font-size: 21px;"><br/></span></div><div><hr/></div><div><span style="font-size: 21px;"><br/></span></div><div>静态域懒汉式：</div><div><br/></div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>class Singleton {</div><div>     private static class SingletonHolder {</div><div>         final static  Singleton instance = new Singletone();</div><div>     }</div><div>     </div><div>     private Singletone(){}</div><div>     public static Singletone getInstance() {</div><div>         return  SingletoneHolder.instance;</div><div>     }</div><div>}</div></div><div><br/></div><div><br/></div><div>double check</div><div><br/></div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>class Singletone {</div><div>     private volatile Singleton instance = null;</div><div>     private Singleton(){}</div><div>     public Singleton getInstance() {</div><div>          if (instance == null) {</div><div>               synchronized(Singleton.class) {</div><div>                   if (instance == null)</div><div>                        instance = new Singleton(); </div><div>               }</div><div>          }</div><div>          return instance;        </div><div>     }</div><div>}</div></div><div><br/></div><div><hr/></div><div>枚举</div><div><br/></div><div>enum Singletone {</div><div>     INSTANCE;</div><div>     public void otherMethod() {</div><div>          ....     </div><div>     }</div><div>}</div><div><span style="font-size: 21px;"><br/></span></div><div><hr/></div><div><span style="font-size: 21px;"><br/></span></div><div><span style="font-size: 21px;"><br/></span></div><div><span style="font-size: 21px;"><br/></span></div><div><span style="font-size: 21px;"><br/></span></div><div><span style="font-size: 21px;"><br/></span></div><div><span style="font-size: 21px;"><br/></span></div><div><span style="font-size: 21px;"><br/></span></div><div><span style="font-size: 21px;"><br/></span></div><div><span style="font-size: 21px;"><br/></span></div><div><span style="font-size: 21px;"><br/></span></div><div><span style="font-size: 21px;"><br/></span></div><div><span style="font-size: 21px;"><br/></span></div><div><span style="font-size: 21px;"><br/></span></div><div><span style="font-size: 21px;"><br/></span></div><div><span style="font-size: 21px;"><br/></span></div><div><span style="font-size: 21px;"><br/></span></div><div><span style="font-size: 21px;"><br/></span></div><div><span style="font-size: 21px;"><br/></span></div><div><br/></div></span>
</div>
<hr>
<a name="1046"/>

<div>
<span><div>大表优化思路：</div><div><br/></div><ul><li>第一步：优化索引和SQL语句</li><li>第二步：加缓存：memcached，redis（尽量少查数据库）</li><li>第三步：读写分离，主主复制，主从复制；</li><li>第四步：表的拆分：垂直拆分、水平拆分；</li></ul></span>
</div>
<hr>
<a name="1048"/>

<div>
<span><div><div><span style="font-size: 19px; font-weight: bold;">一、索引优化</span></div><div><br/></div><div><hr/></div><div><br/></div><div><span style="font-size: 19px;">MySQL的优化主要分为</span><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 19px; color: rgb(255, 0, 0); background-color: rgb(255, 250, 165); font-weight: bold;-evernote-highlight:true;">结构优化（Scheme optimization）和查询优化（Query optimization）</span></span><span style="font-size: 19px;">。</span></div><div><span style="font-size: 19px;">本章讨论的高性能索引策略主要属于结构优化范畴。本章的内容完全基于上文的理论基础，实际上一旦理解了索引背后的机制，那么选择高性能的策略就变成了纯粹的推理，并且可以理解这些策略背后的逻辑。</span></div><div><br/></div><div><span style="font-size: 19px;">6.1 <span style="font-size: 19px; font-weight: bold;">联合索引及<font style="color: rgb(255, 0, 0);">最左前缀原理</font></span></span></div><div><span style="font-size: 19px; font-weight: bold;">联合索引（复合索引）</span></div><div><span style="font-size: 19px;">首先介绍一下联合索引。联合索引其实很简单，相对于一般索引只有一个字段，联合索引可以为多个字段创建一个索引。它的原理也很简单，比如，我们在（a,b,c）字段上创建一个联合索引，则索引记录会首先按照A字段排序，然后再按照B字段排序然后再是C字段，因此，联合索引的特点就是：</span></div><div><span style="font-size: 19px;">- 第一个字段一定是有序的</span></div><div><br/></div><div><span style="font-size: 19px;">- 当第一个字段值相等的时候，第二个字段又是有序的，比如下表中当A=2时所有B的值是有序排列的，依次类推，当同一个B值得所有C字段是有序排列的</span></div><div><span style="font-size: 19px;">| A | B | C |</span></div><div><span style="font-size: 19px;">| 1 | 2 | 3 |</span></div><div><span style="font-size: 19px;">| 1 | 4 | 2 |</span></div><div><span style="font-size: 19px;">| 1 | 1 | 4 |</span></div><div><span style="font-size: 19px;">| 2 | 3 | 5 |</span></div><div><span style="font-size: 19px;">| 2 | 4 | 4 |</span></div><div><span style="font-size: 19px;">| 2 | 4 | 6 |</span></div><div><span style="font-size: 19px;">| 2 | 5 | 5 |</span></div><div><br/></div><div><span style="font-size: 19px;">其实联合索引的查找就跟查字典是一样的，先根据第一个字母查，然后再根据第二个字母查，或者只根据第一个字母查，但是不能跳过第一个字母从第二个字母开始查。这就是所谓的最左前缀原理。</span></div><div><span style="font-size: 19px;">最左前缀原理</span></div><div><span style="font-size: 19px;">我们再来详细介绍一下联合索引的查询。还是上面例子，我们在（a,b,c）字段上建了一个联合索引，所以这个索引是先按a 再按b 再按c进行排列的，所以：</span></div><div><br/></div><div><span style="font-size: 19px;">以下的查询方式都可以用到索引</span></div><div><span style="font-size: 19px;">select * from table where a=1；</span></div><div><span style="font-size: 19px;">select * from table where a=1 and b=2；</span></div><div><span style="font-size: 19px;">select * from table where a=1 and b=2 and c=3；</span></div><div><br/></div><div><span style="font-size: 19px;">上面三个查询按照 （a ）, （a，b ）,（a，b，c ）的顺序都可以利用到索引，这就是最左前缀匹配。</span></div><div><br/></div><div><span style="font-size: 19px;">如果查询语句是：</span></div><div><span style="font-size: 19px;">select * from table where a=1 and c=3； 那么只会用到索引a。</span></div><div><br/></div><div><span style="font-size: 19px;">如果查询语句是：</span></div><div><span style="font-size: 19px;">select * from table where b=2 and c=3； 因为没有用到最左前缀a，所以这个查询是用户到索引的。</span></div><div><br/></div><div><span style="font-size: 19px;">如果用到了最左前缀，但是顺序颠倒会用到索引码？</span></div><div><span style="font-size: 19px;">比如：</span></div><div><span style="font-size: 19px;">select * from table where b=2 and a=1；</span></div><div><span style="font-size: 19px;">select * from table where b=2 and a=1 and c=3；</span></div><div><br/></div><div><span style="font-size: 19px;">如果用到了最左前缀而只是颠倒了顺序，也是可以用到索引的，因为mysql查询优化器会判断纠正这条sql语句该以什么样的顺序执行效率最高，最后才生成真正的执行计划。但我们还是最好按照索引顺序来查询，这样查询优化器就不用重新编译了。</span></div><div><span style="font-size: 19px;">前缀索引</span></div><div><span style="font-size: 19px;">除了联合索引之外，对mysql来说其实还有一种前缀索引。前缀索引就是用列的前缀代替整个列作为索引key，当前缀长度合适时，可以做到既使得前缀索引的选择性接近全列索引，同时因为索引key变短而减少了索引文件的大小和维护开销。</span></div><div><span style="font-size: 19px;">一般来说以下情况可以使用前缀索引：</span></div><div><span style="font-size: 19px;">- 字符串列(varchar,char,text等)，需要进行全字段匹配或者前匹配。也就是=‘xxx’ 或者 like ‘xxx%’</span></div><div><br/></div><div><span style="font-size: 19px;">- 字符串本身可能比较长，而且前几个字符就开始不相同。比如我们对中国人的姓名使用前缀索引就没啥意义，因为中国人名字都很短，另外对收件地址使用前缀索引也不是很实用，因为一方面收件地址一般都是以XX省开头，也就是说前几个字符都是差不多的，而且收件地址进行检索一般都是like ’%xxx%’，不会用到前匹配。相反对外国人的姓名可以使用前缀索引，因为其字符较长，而且前几个字符的选择性比较高。同样电子邮件也是一个可以使用前缀索引的字段。</span></div><div><br/></div><div><span style="font-size: 19px;">- 前一半字符的索引选择性就已经接近于全字段的索引选择性。如果整个字段的长度为20，索引选择性为0.9，而我们对前10个字符建立前缀索引其选择性也只有0.5，那么我们需要继续加大前缀字符的长度，但是这个时候前缀索引的优势已经不明显，没有太大的建前缀索引的必要了。</span></div><div><br/></div><div><span style="font-size: 19px;">一些文章中也提到：</span></div><div><span style="font-size: 19px;">MySQL 前缀索引能有效减小索引文件的大小，提高索引的速度。</span></div><div><span style="font-size: 19px;">但是前缀索引也有它的坏处：MySQL 不能在 ORDER BY 或 GROUP BY 中使用前缀索引，也不能把它们用作覆盖索引(Covering Index)。</span></div><div><br/></div><div><span style="font-size: 19px;"><span style="font-size: 19px; font-weight: bold;">6.2 索引优化策略</span></span></div><div><br/></div><ul><li><div><span style="font-size: 19px;">- 最左前缀匹配原则，上面讲到了</span></div></li></ul><div><br/></div><ul><li><div><span style="font-size: 19px;">- 主键外检一定要建索引</span></div></li></ul><div><br/></div><ul><li><div><span style="font-size: 19px;">- 对 where,on,group by,order by 中出现的列使用索引</span></div></li></ul><div><br/></div><ul><li><div><span style="font-size: 19px;">- 尽量选择区分度高的列作为索引,区分度的公式是count(distinct col)/count(*)，表示字段不重复的比例，比例越大我们扫描的记录数越少，唯一键的区分度是1，而一些状态、性别字段可能在大数据面前区分度就是0</span></div></li></ul><div><br/></div><ul><li><div><span style="font-size: 19px;">- 对较小的数据列使用索引,这样会使索引文件更小,同时内存中也可以装载更多的索引键</span></div></li></ul><div><br/></div><ul><li><div><span style="font-size: 19px;">- 索引列不能参与计算，保持列“干净”，比如from_unixtime(create_time) = ’2014-05-29’就不能使用到索引，原因很简单，b+树中存的都是数据表中的字段值，但进行检索时，需要把所有元素都应用函数才能比较，显然成本太大。所以语句应该写成create_time = unix_timestamp(’2014-05-29’);</span></div></li></ul><div><br/></div><ul><li><div><span style="font-size: 19px;">- 为较长的字符串使用前缀索引</span></div></li></ul><div><br/></div><ul><li><div><span style="font-size: 19px;">- 尽量的扩展索引，不要新建索引。比如表中已经有a的索引，现在要加(a,b)的索引，那么只需要修改原来的索引即可</span></div></li></ul><div><br/></div><ul><li><div><span style="font-size: 19px;">- 不要过多创建索引, 权衡索引个数与DML之间关系，DML也就是插入、删除数据操作。这里需要权衡一个问题，建立索引的目的是为了提高查询效率的，但建立的索引过多，会影响插入、删除数据的速度，因为我们修改的表数据，索引也需要进行调整重建</span></div></li></ul><div><br/></div><ul><li><div><span style="font-size: 19px;">- 对于like查询，”%”不要放在前面。</span></div></li></ul><div><span style="font-size: 19px;">SELECT * FROMhoudunwangWHEREunameLIKE'后盾%' -- 走索引</span></div><ul><li><div><span style="font-size: 19px;">- SELECT * FROMhoudunwangWHEREunameLIKE &quot;%后盾%&quot; -- 不走索引</span></div></li></ul><div><br/></div><div><span style="font-size: 19px;">- 查询where条件数据类型不匹配也无法使用索引</span></div><div><span style="font-size: 19px;">字符串与数字比较不使用索引;</span></div><div><span style="font-size: 19px;">CREATE TABLEa(achar(10));</span></div><div><span style="font-size: 19px;">- EXPLAIN SELECT * FROMaWHEREa=&quot;1&quot; – 走索引</span></div><div><span style="font-size: 19px;">- EXPLAIN SELECT * FROM a WHERE a=1 – 不走索引</span></div><div><span style="font-size: 19px;">- 正则表达式不使用索引,这应该很好理解,所以为什么在SQL中很难看到regexp关键字的原因</span></div><div><br/></div><div><hr/></div><div><br/></div><div><span style="font-size: 19px; font-weight: bold;">建索引原则：</span></div><div><span style="font-size: 19px;">1.</span><span style="font-size: 19px; color: rgb(255, 0, 0); font-weight: bold;">最左前缀匹配原则</span><span style="font-size: 19px;">，非常重要的原则，mysql会一直向右匹配直到遇到范围查询(&gt;、&lt;、between、like)就停止匹配，比如a = 1 and b = 2 and c &gt; 3 and d = 4 如果建立(a,b,c,d)顺序的索引，d是用不到索引的，如果建立(a,b,d,c)的索引则都可以用到，a,b,d的顺序可以任意调整。</span></div><div><span style="font-size: 19px;">2.</span><span style="font-size: 19px; color: rgb(255, 0, 0); font-weight: bold;">=和in可以乱序</span><span style="font-size: 19px;">，比如a = 1 and b = 2 and c = 3 建立(a,b,c)索引可以任意顺序，mysql的查询优化器会帮你优化成索引可以识别的形式</span></div><div><span style="font-size: 19px;">3.</span><span style="font-size: 19px; font-weight: bold; color: rgb(255, 0, 0);">尽量选择区分度高的列作为索引</span><span style="font-size: 19px;">,区分度的公式是count(distinct col)/count(*)，表示字段不重复的比例，比例越大我们扫描的记录数越少，唯一键的区分度是1，而一些状态、性别字段可能在大数据面前区分度就是0，那可能有人会问，这个比例有什么经验值吗？使用场景不同，这个值也很难确定，一般需要join的字段我们都要求是0.1以上，即平均1条扫描10条记录</span></div><div><span style="font-size: 19px;">4.</span><span style="font-size: 19px; color: rgb(255, 0, 0); font-weight: bold;">索引列不能参与计算，保持列“干净”</span><span style="font-size: 19px;">，比如from_unixtime(create_time) = ’2014-05-29’就不能使用到索引，原因很简单，b+树中存的都是数据表中的字段值，但进行检索时，需要把所有元素都应用函数才能比较，显然成本太大。所以语句应该写成create_time = unix_timestamp(’2014-05-29’);</span></div><div><span style="font-size: 19px;">5.</span><span style="font-size: 19px; color: rgb(255, 0, 0); font-weight: bold;">尽量的扩展索引，不要新建索引</span><span style="font-size: 19px;">。比如表中已经有a的索引，现在要加(a,b)的索引，那么只需要修改原来的索引即可</span></div><div><hr/></div><div><br/></div><div>二、分库分表</div><div><br/></div><div>三、读写分离</div><div><br/></div></div><div><br/></div></span>
</div>
<hr>
<a name="1210"/>

<div>
<span><div><ul><li><div><font style="color: rgb(255, 0, 0);"><b><font>SQL注入攻击</font>：常见的安全性问题</b></font></div></li></ul><div><br/></div><div>HTTPS交互数据，保证数据传输的安全性，证书+非对称密钥；</div><div>用户名的密码不存明文，使用随机盐salt，迭代次数k，哈希摘要（例如SHA256等）；</div><div>具体的流程：</div><div>    将用户的密码和随机盐salt拼接，取哈希摘要，重复该操作k次，存取最终结果。</div><div><br/></div><div>SQL注入攻击最常见的方法就是：利用后台动态拼接SQL语句，从而可以构造类似如下的查询：</div><div><br/></div><div>&quot;SELECT * FROM user WHERE user_name = '&quot; + userName + &quot;' AND passwd = '&quot; + userPassWd + &quot;';&quot;</div><div>其中userPassWd 可以指定为&quot;' OR '1' = '1&quot;，即可绕过验证；</div><div><br/></div><div>解决方案：</div><div><br/></div><ol><li><div>使用参数化查询（Java中使用PreparedStatement，不要使用Statement）</div></li><li><div>前端页面需要校验用户的输入数据（限制用户输入的类型，范围，格式和长度等）</div></li><li><div>后端过滤一些特殊的字符例如</div></li></ol><div><br/></div><ul><li><div><font style="color: rgb(255, 0, 0);"><b>XSS攻击：跨站脚本攻击</b></font></div></li></ul><div>    用户将恶意的&lt;script&gt;alert(document.cookie)&lt;/script&gt;脚本上传到服务器，服务器可能会存储、回显到用户      的浏览器，然后浏览器会执行该恶意脚本，从而获取用户的cookie、劫持会话等后果。</div><div><br/></div><div><img src="常见面试基础题_files/Image [14].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>xss分为两大类：</div><ol><li><div>反射型xss： 反射型XSS(Non-persistent XSS)，服务器接受客户端的请求包，不会存储请求包的内容，只是简单的把用户输入的数据“反射”给浏览器。</div></li><li><div>存储型xss:将黑客的恶意脚本通过留言、回帖等渠道上传到服务器，然后任何用户浏览到这些内容的时候，便遭受xss攻击；</div></li></ol><div><br/></div><div>防范：</div><ul><li><div>(1) <span style="font-weight: bold;">输入过滤。</span>永远不要相信用户的输入，对用户输入的数据做一定的过滤。如输入的数据是否符合预期的格式，比如日期格式，Email格式，电话号码格式等等。这样可以初步对XSS漏洞进行防御。上面的措施只在web端做了限制，攻击者通抓包工具如Fiddler还是可以绕过前端输入的限制，修改请求注入攻击脚本。因此，后台服务器需要在接收到用户输入的数据后，对特殊危险字符进行过滤或者转义处理，然后再存储到数据库中。</div></li><li><div>(2) <span style="font-weight: bold;">输出编码。</span>服务器端输出到浏览器的数据，可以使用系统的安全函数来进行编码或转义来防范XSS攻击。在PHP中，有htmlentities()和htmlspecialchars()两个函数可以满足安全要求。相应的JavaScript的编码方式可以使用JavascriptEncode。</div></li><li><div>(3) <span style="font-weight: bold;">安全编码。</span>开发需尽量避免Web客户端文档重写、重定向或其他敏感操作，同时要避免使用客户端数据，这些操作需尽量在服务器端使用动态页面来实现。</div></li><li><div>(4) <span style="font-weight: bold;">HttpOnly Cookie。</span>预防XSS攻击窃取用户cookie最有效的防御手段。Web应用程序在设置cookie时，将其属性设为HttpOnly，就可以避免该网页的cookie被客户端恶意JavaScript窃取，保护用户cookie信息。</div></li><li><div>(5)<span style="font-weight: bold;">WAF(Web Application Firewall)</span>，Web应用防火墙，主要的功能是防范诸如网页木马、XSS以及CSRF等常见的Web漏洞攻击。由第三方公司开发，在企业环境中深受欢迎。</div></li></ul><div><br/></div><div><br/></div><ul><li><div><b><font style="color: rgb(255, 0, 0);">CSRF(Cross Site Request Forgery) 跨站请求伪造</font></b></div></li></ul><div><br/></div><div><img src="常见面试基础题_files/Image [15].png" type="image/png" data-filename="Image.png"/>    </div><div><br/></div><ul><li><div><b><font style="color: rgb(255, 0, 0);">DDoS攻击</font></b></div></li><ul><li><div>SYN洪水：伪造大量的不存在的IP地址，构造SYN包，消耗服务器的大量的连接。</div></li><ul><li><div>解决方案：</div></li><ul><li>第一种是缩短SYN Timeout时间，及时将超时请求丢弃，释放被占用CPU和内存资源。 </li><li>第二种是限制同时打开的SYN半连接数目，关闭不必要的服务。 </li><li>第三种方法是设置SYN Cookie，给每一个请求连接的IP地址分配一个Cookie。如果短时间内连续受到某个IP的重复SYN报文，就认定是受到了攻击，以后从这个IP地址来的包会被一概丢弃。</li></ul></ul></ul></ul><div><br/></div><div><img src="常见面试基础题_files/Image [2].jpg" type="image/jpeg" data-filename="Image.jpg"/></div><div><br/></div></div><div><br/></div></span>
</div>
<hr>
<a name="1220"/>

<div>
<span bgcolor="#FFFFFF"><div><div><table bgcolor="#D4DDE5" border="0" width="100%"><tr><td><h1>数据库索引优化</h1><b>作者：</b> 958340585@qq.com<br/></td></tr></table></div><div><div><div><span style="font-size: 19px; font-weight: bold;">一、索引优化</span></div><div><br/></div><div><hr/></div><div><br/></div><div><span style="font-size: 19px;">MySQL的优化主要分为</span><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 19px; color: rgb(255, 0, 0); background-color: rgb(255, 250, 165); font-weight: bold;-evernote-highlight:true;">结构优化（Scheme optimization）和查询优化（Query optimization）</span></span><span style="font-size: 19px;">。</span></div><div><span style="font-size: 19px;">本章讨论的高性能索引策略主要属于结构优化范畴。本章的内容完全基于上文的理论基础，实际上一旦理解了索引背后的机制，那么选择高性能的策略就变成了纯粹的推理，并且可以理解这些策略背后的逻辑。</span></div><div><br/></div><div><span style="font-size: 19px;">6.1 <span style="font-size: 19px; font-weight: bold;">联合索引及<font style="color: rgb(255, 0, 0);">最左前缀原理</font></span></span></div><div><span style="font-size: 19px; font-weight: bold;">联合索引（复合索引）</span></div><div><span style="font-size: 19px;">首先介绍一下联合索引。联合索引其实很简单，相对于一般索引只有一个字段，联合索引可以为多个字段创建一个索引。它的原理也很简单，比如，我们在（a,b,c）字段上创建一个联合索引，则索引记录会首先按照A字段排序，然后再按照B字段排序然后再是C字段，因此，联合索引的特点就是：</span></div><div><span style="font-size: 19px;">- 第一个字段一定是有序的</span></div><div><br/></div><div><span style="font-size: 19px;">- 当第一个字段值相等的时候，第二个字段又是有序的，比如下表中当A=2时所有B的值是有序排列的，依次类推，当同一个B值得所有C字段是有序排列的</span></div><div><span style="font-size: 19px;">| A | B | C |</span></div><div><span style="font-size: 19px;">| 1 | 2 | 3 |</span></div><div><span style="font-size: 19px;">| 1 | 4 | 2 |</span></div><div><span style="font-size: 19px;">| 1 | 1 | 4 |</span></div><div><span style="font-size: 19px;">| 2 | 3 | 5 |</span></div><div><span style="font-size: 19px;">| 2 | 4 | 4 |</span></div><div><span style="font-size: 19px;">| 2 | 4 | 6 |</span></div><div><span style="font-size: 19px;">| 2 | 5 | 5 |</span></div><div><br/></div><div><span style="font-size: 19px;">其实联合索引的查找就跟查字典是一样的，先根据第一个字母查，然后再根据第二个字母查，或者只根据第一个字母查，但是不能跳过第一个字母从第二个字母开始查。这就是所谓的最左前缀原理。</span></div><div><span style="font-size: 19px;">最左前缀原理</span></div><div><span style="font-size: 19px;">我们再来详细介绍一下联合索引的查询。还是上面例子，我们在（a,b,c）字段上建了一个联合索引，所以这个索引是先按a 再按b 再按c进行排列的，所以：</span></div><div><br/></div><div><span style="font-size: 19px;">以下的查询方式都可以用到索引</span></div><div><span style="font-size: 19px;">select * from table where a=1；</span></div><div><span style="font-size: 19px;">select * from table where a=1 and b=2；</span></div><div><span style="font-size: 19px;">select * from table where a=1 and b=2 and c=3；</span></div><div><br/></div><div><span style="font-size: 19px;">上面三个查询按照 （a ）, （a，b ）,（a，b，c ）的顺序都可以利用到索引，这就是最左前缀匹配。</span></div><div><br/></div><div><span style="font-size: 19px;">如果查询语句是：</span></div><div><span style="font-size: 19px;">select * from table where a=1 and c=3； 那么只会用到索引a。</span></div><div><br/></div><div><span style="font-size: 19px;">如果查询语句是：</span></div><div><span style="font-size: 19px;">select * from table where b=2 and c=3； 因为没有用到最左前缀a，所以这个查询是用户到索引的。</span></div><div><br/></div><div><span style="font-size: 19px;">如果用到了最左前缀，但是顺序颠倒会用到索引码？</span></div><div><span style="font-size: 19px;">比如：</span></div><div><span style="font-size: 19px;">select * from table where b=2 and a=1；</span></div><div><span style="font-size: 19px;">select * from table where b=2 and a=1 and c=3；</span></div><div><br/></div><div><span style="font-size: 19px;">如果用到了最左前缀而只是颠倒了顺序，也是可以用到索引的，因为mysql查询优化器会判断纠正这条sql语句该以什么样的顺序执行效率最高，最后才生成真正的执行计划。但我们还是最好按照索引顺序来查询，这样查询优化器就不用重新编译了。</span></div><div><span style="font-size: 19px;">前缀索引</span></div><div><span style="font-size: 19px;">除了联合索引之外，对mysql来说其实还有一种前缀索引。前缀索引就是用列的前缀代替整个列作为索引key，当前缀长度合适时，可以做到既使得前缀索引的选择性接近全列索引，同时因为索引key变短而减少了索引文件的大小和维护开销。</span></div><div><span style="font-size: 19px;">一般来说以下情况可以使用前缀索引：</span></div><div><span style="font-size: 19px;">- 字符串列(varchar,char,text等)，需要进行全字段匹配或者前匹配。也就是=‘xxx’ 或者 like ‘xxx%’</span></div><div><br/></div><div><span style="font-size: 19px;">- 字符串本身可能比较长，而且前几个字符就开始不相同。比如我们对中国人的姓名使用前缀索引就没啥意义，因为中国人名字都很短，另外对收件地址使用前缀索引也不是很实用，因为一方面收件地址一般都是以XX省开头，也就是说前几个字符都是差不多的，而且收件地址进行检索一般都是like ’%xxx%’，不会用到前匹配。相反对外国人的姓名可以使用前缀索引，因为其字符较长，而且前几个字符的选择性比较高。同样电子邮件也是一个可以使用前缀索引的字段。</span></div><div><br/></div><div><span style="font-size: 19px;">- 前一半字符的索引选择性就已经接近于全字段的索引选择性。如果整个字段的长度为20，索引选择性为0.9，而我们对前10个字符建立前缀索引其选择性也只有0.5，那么我们需要继续加大前缀字符的长度，但是这个时候前缀索引的优势已经不明显，没有太大的建前缀索引的必要了。</span></div><div><br/></div><div><span style="font-size: 19px;">一些文章中也提到：</span></div><div><span style="font-size: 19px;">MySQL 前缀索引能有效减小索引文件的大小，提高索引的速度。</span></div><div><span style="font-size: 19px;">但是前缀索引也有它的坏处：MySQL 不能在 ORDER BY 或 GROUP BY 中使用前缀索引，也不能把它们用作覆盖索引(Covering Index)。</span></div><div><br/></div><div><span style="font-size: 19px;"><span style="font-size: 19px; font-weight: bold;">6.2 索引优化策略</span></span></div><div><br/></div><ul><li><div><span style="font-size: 19px;">- 最左前缀匹配原则，上面讲到了</span></div></li></ul><div><br/></div><ul><li><div><span style="font-size: 19px;">- 主键外检一定要建索引</span></div></li></ul><div><br/></div><ul><li><div><span style="font-size: 19px;">- 对 where,on,group by,order by 中出现的列使用索引</span></div></li></ul><div><br/></div><ul><li><div><span style="font-size: 19px;">- 尽量选择区分度高的列作为索引,区分度的公式是count(distinct col)/count(*)，表示字段不重复的比例，比例越大我们扫描的记录数越少，唯一键的区分度是1，而一些状态、性别字段可能在大数据面前区分度就是0</span></div></li></ul><div><br/></div><ul><li><div><span style="font-size: 19px;">- 对较小的数据列使用索引,这样会使索引文件更小,同时内存中也可以装载更多的索引键</span></div></li></ul><div><br/></div><ul><li><div><span style="font-size: 19px;">- 索引列不能参与计算，保持列“干净”，比如from_unixtime(create_time) = ’2014-05-29’就不能使用到索引，原因很简单，b+树中存的都是数据表中的字段值，但进行检索时，需要把所有元素都应用函数才能比较，显然成本太大。所以语句应该写成create_time = unix_timestamp(’2014-05-29’);</span></div></li></ul><div><br/></div><ul><li><div><span style="font-size: 19px;">- 为较长的字符串使用前缀索引</span></div></li></ul><div><br/></div><ul><li><div><span style="font-size: 19px;">- 尽量的扩展索引，不要新建索引。比如表中已经有a的索引，现在要加(a,b)的索引，那么只需要修改原来的索引即可</span></div></li></ul><div><br/></div><ul><li><div><span style="font-size: 19px;">- 不要过多创建索引, 权衡索引个数与DML之间关系，DML也就是插入、删除数据操作。这里需要权衡一个问题，建立索引的目的是为了提高查询效率的，但建立的索引过多，会影响插入、删除数据的速度，因为我们修改的表数据，索引也需要进行调整重建</span></div></li></ul><div><br/></div><ul><li><div><span style="font-size: 19px;">- 对于like查询，”%”不要放在前面。</span></div></li></ul><div><span style="font-size: 19px;">SELECT * FROMhoudunwangWHEREunameLIKE'后盾%' -- 走索引</span></div><ul><li><div><span style="font-size: 19px;">- SELECT * FROMhoudunwangWHEREunameLIKE &quot;%后盾%&quot; -- 不走索引</span></div></li></ul><div><br/></div><div><span style="font-size: 19px;">- 查询where条件数据类型不匹配也无法使用索引</span></div><div><span style="font-size: 19px;">字符串与数字比较不使用索引;</span></div><div><span style="font-size: 19px;">CREATE TABLEa(achar(10));</span></div><div><span style="font-size: 19px;">- EXPLAIN SELECT * FROMaWHEREa=&quot;1&quot; – 走索引</span></div><div><span style="font-size: 19px;">- EXPLAIN SELECT * FROM a WHERE a=1 – 不走索引</span></div><div><span style="font-size: 19px;">- 正则表达式不使用索引,这应该很好理解,所以为什么在SQL中很难看到regexp关键字的原因</span></div><div><br/></div><div><hr/></div><div><br/></div><div><span style="font-size: 19px; font-weight: bold;">建索引原则：</span></div><div><span style="font-size: 19px;">1.</span><span style="font-size: 19px; color: rgb(255, 0, 0); font-weight: bold;">最左前缀匹配原则</span><span style="font-size: 19px;">，非常重要的原则，mysql会一直向右匹配直到遇到范围查询(&gt;、&lt;、between、like)就停止匹配，比如a = 1 and b = 2 and c &gt; 3 and d = 4 如果建立(a,b,c,d)顺序的索引，d是用不到索引的，如果建立(a,b,d,c)的索引则都可以用到，a,b,d的顺序可以任意调整。</span></div><div><span style="font-size: 19px;">2.</span><span style="font-size: 19px; color: rgb(255, 0, 0); font-weight: bold;">=和in可以乱序</span><span style="font-size: 19px;">，比如a = 1 and b = 2 and c = 3 建立(a,b,c)索引可以任意顺序，mysql的查询优化器会帮你优化成索引可以识别的形式</span></div><div><span style="font-size: 19px;">3.</span><span style="font-size: 19px; font-weight: bold; color: rgb(255, 0, 0);">尽量选择区分度高的列作为索引</span><span style="font-size: 19px;">,区分度的公式是count(distinct col)/count(*)，表示字段不重复的比例，比例越大我们扫描的记录数越少，唯一键的区分度是1，而一些状态、性别字段可能在大数据面前区分度就是0，那可能有人会问，这个比例有什么经验值吗？使用场景不同，这个值也很难确定，一般需要join的字段我们都要求是0.1以上，即平均1条扫描10条记录</span></div><div><span style="font-size: 19px;">4.</span><span style="font-size: 19px; color: rgb(255, 0, 0); font-weight: bold;">索引列不能参与计算，保持列“干净”</span><span style="font-size: 19px;">，比如from_unixtime(create_time) = ’2014-05-29’就不能使用到索引，原因很简单，b+树中存的都是数据表中的字段值，但进行检索时，需要把所有元素都应用函数才能比较，显然成本太大。所以语句应该写成create_time = unix_timestamp(’2014-05-29’);</span></div><div><span style="font-size: 19px;">5.</span><span style="font-size: 19px; color: rgb(255, 0, 0); font-weight: bold;">尽量的扩展索引，不要新建索引</span><span style="font-size: 19px;">。比如表中已经有a的索引，现在要加(a,b)的索引，那么只需要修改原来的索引即可</span></div><div><hr/></div><div><br/></div><div>二、分库分表</div><div><br/></div><div>三、读写分离</div><div><br/></div></div><div><br/></div></div><br/><div><table bgcolor="#D4DDE5" border="0" width="100%"><tr><td><h1>常见的Web安全问题</h1><b>来源网址：</b> <a href="https://www.cnblogs.com/qq350760546/p/6638588.html">https://www.cnblogs.com/qq350760546/p/6638588.html</a><br/><b>作者：</b> 958340585@qq.com<br/></td></tr></table></div><div><div><ul><li><div><font style="color: rgb(255, 0, 0);"><b><font>SQL注入攻击</font>：常见的安全性问题</b></font></div></li></ul><div><br/></div><div>HTTPS交互数据，保证数据传输的安全性，证书+非对称密钥；</div><div>用户名的密码不存明文，使用随机盐salt，迭代次数k，哈希摘要（例如SHA256等）；</div><div>具体的流程：</div><div>    将用户的密码和随机盐salt拼接，取哈希摘要，重复该操作k次，存取最终结果。</div><div><br/></div><div>SQL注入攻击最常见的方法就是：利用后台动态拼接SQL语句，从而可以构造类似如下的查询：</div><div><br/></div><div>&quot;SELECT * FROM user WHERE user_name = '&quot; + userName + &quot;' AND passwd = '&quot; + userPassWd + &quot;';&quot;</div><div>其中userPassWd 可以指定为&quot;' OR '1' = '1&quot;，即可绕过验证；</div><div><br/></div><div>解决方案：</div><div><br/></div><ol><li><div>使用参数化查询（Java中使用PreparedStatement，不要使用Statement）</div></li><li><div>前端页面需要校验用户的输入数据（限制用户输入的类型，范围，格式和长度等）</div></li><li><div>后端过滤一些特殊的字符例如</div></li></ol><div><br/></div><ul><li><div><font style="color: rgb(255, 0, 0);"><b>XSS攻击：跨站脚本攻击</b></font></div></li></ul><div>    用户将恶意的&lt;script&gt;alert(document.cookie)&lt;/script&gt;脚本上传到服务器，服务器可能会存储、回显到用户      的浏览器，然后浏览器会执行该恶意脚本，从而获取用户的cookie、劫持会话等后果。</div><div><br/></div><div><img src="常见面试基础题_files/Image [16].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>xss分为两大类：</div><ol><li><div>反射型xss： 反射型XSS(Non-persistent XSS)，服务器接受客户端的请求包，不会存储请求包的内容，只是简单的把用户输入的数据“反射”给浏览器。</div></li><li><div>存储型xss:将黑客的恶意脚本通过留言、回帖等渠道上传到服务器，然后任何用户浏览到这些内容的时候，便遭受xss攻击；</div></li></ol><div><br/></div><div>防范：</div><ul><li><div>(1) <span style="font-weight: bold;">输入过滤。</span>永远不要相信用户的输入，对用户输入的数据做一定的过滤。如输入的数据是否符合预期的格式，比如日期格式，Email格式，电话号码格式等等。这样可以初步对XSS漏洞进行防御。上面的措施只在web端做了限制，攻击者通抓包工具如Fiddler还是可以绕过前端输入的限制，修改请求注入攻击脚本。因此，后台服务器需要在接收到用户输入的数据后，对特殊危险字符进行过滤或者转义处理，然后再存储到数据库中。</div></li><li><div>(2) <span style="font-weight: bold;">输出编码。</span>服务器端输出到浏览器的数据，可以使用系统的安全函数来进行编码或转义来防范XSS攻击。在PHP中，有htmlentities()和htmlspecialchars()两个函数可以满足安全要求。相应的JavaScript的编码方式可以使用JavascriptEncode。</div></li><li><div>(3) <span style="font-weight: bold;">安全编码。</span>开发需尽量避免Web客户端文档重写、重定向或其他敏感操作，同时要避免使用客户端数据，这些操作需尽量在服务器端使用动态页面来实现。</div></li><li><div>(4) <span style="font-weight: bold;">HttpOnly Cookie。</span>预防XSS攻击窃取用户cookie最有效的防御手段。Web应用程序在设置cookie时，将其属性设为HttpOnly，就可以避免该网页的cookie被客户端恶意JavaScript窃取，保护用户cookie信息。</div></li><li><div>(5)<span style="font-weight: bold;">WAF(Web Application Firewall)</span>，Web应用防火墙，主要的功能是防范诸如网页木马、XSS以及CSRF等常见的Web漏洞攻击。由第三方公司开发，在企业环境中深受欢迎。</div></li></ul><div><br/></div><div><br/></div><ul><li><div><b><font style="color: rgb(255, 0, 0);">CSRF(Cross Site Request Forgery) 跨站请求伪造</font></b></div></li></ul><div><br/></div><div><img src="常见面试基础题_files/Image [17].png" type="image/png" data-filename="Image.png"/>    </div><div><br/></div><ul><li><div><b><font style="color: rgb(255, 0, 0);">DDoS攻击</font></b></div></li><ul><li><div>SYN洪水：伪造大量的不存在的IP地址，构造SYN包，消耗服务器的大量的连接。</div></li><ul><li><div>解决方案：</div></li><ul><li>第一种是缩短SYN Timeout时间，及时将超时请求丢弃，释放被占用CPU和内存资源。 </li><li>第二种是限制同时打开的SYN半连接数目，关闭不必要的服务。 </li><li>第三种方法是设置SYN Cookie，给每一个请求连接的IP地址分配一个Cookie。如果短时间内连续受到某个IP的重复SYN报文，就认定是受到了攻击，以后从这个IP地址来的包会被一概丢弃。</li></ul></ul></ul></ul><div><br/></div><div><img src="常见面试基础题_files/Image [3].jpg" type="image/jpeg" data-filename="Image.jpg"/></div><div><br/></div></div><div><br/></div></div><br/><div><table bgcolor="#D4DDE5" border="0" width="100%"><tr><td><h1>数据库优化高频问题</h1><b>来源网址：</b> <a href="https://www.cnblogs.com/wuchanming/p/6886020.html">https://www.cnblogs.com/wuchanming/p/6886020.html</a><br/><b>作者：</b> 958340585@qq.com<br/></td></tr></table></div><div><div>大表优化思路：</div><div><br/></div><ul><li>第一步：优化索引和SQL语句</li><li>第二步：加缓存：memcached，redis（尽量少查数据库）</li><li>第三步：读写分离，主主复制，主从复制；</li><li>第四步：表的拆分：垂直拆分、水平拆分；</li></ul></div><br/><div><table bgcolor="#D4DDE5" border="0" width="100%"><tr><td><h1>InnoDB和MyIsam存储引擎的索引实现的区别</h1><b>来源网址：</b> <a href="https://www.cnblogs.com/zlcxbb/p/5757245.html">https://www.cnblogs.com/zlcxbb/p/5757245.html</a><br/><b>作者：</b> 958340585@qq.com<br/></td></tr></table></div><div><div><h1 style="margin: 0px 0px 20px; padding: 0px; font-size: 28px; font-weight: 400; color: rgb(51, 51, 51); font-family: Verdana, Arial, Helvetica, sans-serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;"><a href="http://www.cnblogs.com/zlcxbb/p/5757245.html" style="margin: 0px; padding: 0px; color: rgb(51, 51, 51); text-decoration: none;">MyISAM和InnoDB的索引实现</a></h1><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;"><div style="margin: 0px 0px 20px; padding: 0px; word-break: break-word; color: rgb(51, 51, 51);"><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);"> 在 MySQL 中，主要有四种类型的索引，分别为：</span> <strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; color: rgb(134, 0, 164);">B-Tree 索引， Hash 索引， Fulltext 索引和 R-Tree 索引</span></strong><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);">。我们主要分析B-Tree 索引。</span></p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;">        B-Tree 索引是 MySQL 数据库中使用最为频繁的索引类型，除了 Archive 存储引擎之外的其他所有的存储引擎都支持 B-Tree 索引。Archive 引擎直到 MySQL 5.1 才支持索引，而且只支持索引单个 AUTO_INCREMENT 列。</p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;">       不仅仅在 MySQL 中是如此，实际上在其他的很多数据库管理系统中B-Tree 索引也同样是作为最主要的索引类型，这主要是因为 B-Tree 索引的存储结构在数据库的数据检索中有非常优异的表现。</p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);">     一般来说， MySQL 中的 B-Tree 索引的物理文件大多都是以 Balance Tree 的结构来存储的，也就是所有实际需要的数据都存放于 Tree 的 Leaf Node(叶子节点) ，而且</span><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; color: rgb(166, 0, 196);">到任何一个 Leaf Node 的最短路径的长度都是完全相同的</span></strong><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);">，所以我们大家都称之为 B-Tree 索引。当然，可能各种数据库（或 MySQL 的各种存储引擎）在存放自己的 B-Tree 索引的时候会对存储结构稍作改造。</span><span style="margin: 0px; padding: 0px; color: rgb(255, 0, 0);"><strong style="margin: 0px; padding: 0px;">如 Innodb 存储引擎的 B-Tree 索引实际使用的存储结构实际上是 B+Tree</strong></span><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);">，也就是在 B-Tree 数据结构的基础上做了很小的改造，在每一个Leaf Node 上面出了存放索引键的相关信息之外，还</span><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; color: rgb(134, 0, 164);">存储了指向与该 Leaf Node 相邻的后一个 LeafNode 的指针信息（增加了</span><span style="margin: 0px; padding: 0px; color: rgb(227, 0, 0);">顺序访问指针</span><span style="margin: 0px; padding: 0px; color: rgb(134, 0, 164);">），这主要是为了加快</span><span style="margin: 0px; padding: 0px; color: rgb(227, 0, 0);">检索多个相邻 Leaf Node</span> <span style="margin: 0px; padding: 0px; color: rgb(134, 0, 164);">的效率考虑</span></strong><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);">。</span></p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"> </p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"><strong style="margin: 0px; padding: 0px;">下面主要讨论MyISAM和InnoDB两个存储引擎的索引实现方式：</strong></p><h2 style="margin: 20px 0px; padding: 0px; font-size: 21px; font-weight: bold;"><a name="t4" style="margin: 0px; padding: 0px;"></a>1. MyISAM索引实现：MyISAM索引文件和数据文件是分离的，索引文件仅保存数据记录的地址。</h2><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"><strong style="margin: 0px; padding: 0px;">1）主键索引：</strong></p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;">MyISAM引擎使用B+Tree作为索引结构，<strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; color: rgb(255, 0, 0);">叶节点的data域存放的是数据记录的地址</span></strong>。下图是MyISAM主键索引的原理图：</p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"><br style="margin: 0px; padding: 0px;"/><img src="http://my.csdn.net/uploads/201208/01/1343757655_1008.png" style="margin: 0px; padding: 0px; border: none; max-width: 800px; height: auto;"></img></p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;">                                                                           （图myisam1）</p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;">这里设表一共有三列，假设我们以Col1为主键，图myisam1是一个MyISAM表的主索引（Primary key）示意。可以看出MyISAM的索引文件仅仅保存数据记录的地址。</p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"><strong style="margin: 0px; padding: 0px;">2）辅助索引（Secondary key）</strong></p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"><strong style="margin: 0px; padding: 0px;">在MyISAM中，主索引和辅助索引（Secondary key）在结构上没有任何区别，只是主索引要求<span style="margin: 0px; padding: 0px; color: rgb(255, 0, 0);">key是唯一的</span>，而辅助索引的key可以重复。</strong>如果我们在Col2上建立一个辅助索引，则此索引的结构如下图所示：<br style="margin: 0px; padding: 0px;"/>
  </p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"><img src="http://my.csdn.net/uploads/201208/01/1343757949_9784.png" style="margin: 0px; padding: 0px; border: none; max-width: 800px; height: auto;"></img></p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"> </p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;">同样也是一颗B+Tree，data域保存数据记录的地址。因此，<strong style="margin: 0px; padding: 0px;">MyISAM中索引检索的算法为首先按照B+Tree搜索算法搜索索引，如果指定的Key存在，则取出其data域的值，然后以data域的值为地址，读取相应数据记录。</strong></p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);">MyISAM的索引方式也叫做“</span><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; color: rgb(134, 0, 164);">非聚集</span></strong><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);">”的，之所以这么称呼是为了与InnoDB的聚集索引区分。</span></p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"> </p><h2 style="margin: 20px 0px; padding: 0px; font-size: 21px; font-weight: bold;"><a name="t5" style="margin: 0px; padding: 0px;"></a>2. InnoDB索引实现</h2><p style="margin: 10px auto; padding: 0px; text-indent: 0px;">然InnoDB也使用B+Tree作为索引结构，但具体实现方式却与MyISAM截然不同.</p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"><strong style="margin: 0px; padding: 0px;">1）主键索引：</strong></p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"><strong style="margin: 0px; padding: 0px;">         </strong><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);">MyISAM索引文件和数据文件是分离的，索引文件仅保存数据记录的地址。而</span><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; color: rgb(166, 0, 196);">在InnoDB中，表数据文件本身就是按B+Tree组织的一个索引结构</span></strong><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);">，这棵树的叶节点data域保存了完整的数据记录。这个</span><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; color: rgb(134, 0, 164);">索引的key是数据表的主键</span></strong><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);">，因此</span><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; color: rgb(134, 0, 164);">InnoDB表数据文件本身就是主索引</span></strong><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);">。</span></p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"><img src="http://my.csdn.net/uploads/201208/01/1343758042_8526.png" style="margin: 0px; padding: 0px; border: none; max-width: 800px; height: auto;"></img></p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;">               (图inndb主键索引）</p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"> </p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"> </p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;">(图inndb主键索引）是InnoDB主索引（同时也是数据文件）的示意图，可以看到叶节点包含了完整的数据记录。这种索引叫做<span style="margin: 0px; padding: 0px; color: rgb(255, 0, 0);"><strong style="margin: 0px; padding: 0px;">聚集索引</strong></span>。因为InnoDB的数据文件本身要按主键聚集，所以InnoDB要求表必须有主键（MyISAM可以没有），如果没有显式指定，则MySQL系统会自动选择一个可以唯一标识数据记录的列作为主键，如果不存在这种列，则MySQL自动为InnoDB表生成一个隐含字段作为主键，这个字段长度为6个字节，类型为长整形。</p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"> </p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"><strong style="margin: 0px; padding: 0px;">2）. InnoDB的辅助索引</strong></p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;">       InnoDB的所有辅助索引都引用主键作为data域。例如，下图为定义在Col3上的一个辅助索引：</p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"><img src="http://my.csdn.net/uploads/201208/01/1343758434_9462.png" style="margin: 0px; padding: 0px; border: none; max-width: 800px; height: auto;"></img></p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"> </p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;">    </p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;">       </p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"><strong style="margin: 0px; padding: 0px;">        InnoDB 表是基于<span style="margin: 0px; padding: 0px; color: rgb(255, 0, 0);">聚簇索引</span>建立的</strong><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);">。因此</span><span style="margin: 0px; padding: 0px; color: rgb(34, 34, 34);">InnoDB 的索引能提供一种非常快速的主键查找性能。不过，它的辅助索引（Secondary Index， 也就是非主键索引）也会包含主键列，所以，如果主键定义的比较大，其他索引也将很大。如果想在表上定义 、很多索引，则</span><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; color: rgb(134, 0, 164);">争取尽量把主键定义得小一些</span></strong><span style="margin: 0px; padding: 0px; color: rgb(34, 34, 34);">。InnoDB 不会压缩索引。</span></p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);">      文字符的ASCII码作为比较准则。</span><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);">聚集索引这种实现方式使得按主键的搜索十分高效，但是</span><span style="margin: 0px; padding: 0px; color: rgb(227, 0, 0);">辅助索引搜索需要检索两遍索引：首先检索辅助索引获得主键，然后用主键到主索引中检索获得记录</span><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);">。</span></strong></p><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><div><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);">      不同存储引擎的索引实现方式对于正确使用和优化索引都非常有帮助，例如知道了InnoDB的索引实现后，就很容易明白</span></div><ul><li><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; color: rgb(134, 0, 164);">1、</span></strong><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; color: rgb(134, 0, 164);">为什么不建议使用过长的字段作为主键，因为所有辅助索引都引用主索引，过长的主索引会令辅助索引变得过大。</span></strong><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);">再例如，</span></li><li><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; color: rgb(134, 0, 164);">2、用非单调的字段作为主键在InnoDB中不是个好主意，因为InnoDB数据文件本身是一颗B+Tree，非单调的主键会造成在插入新记录时数据文件为了维持B+Tree的特性而频繁的分裂调整，十分低效，而使用</span><span style="margin: 0px; padding: 0px; color: rgb(227, 0, 0);">自增字段作为主键</span><span style="margin: 0px; padding: 0px; color: rgb(134, 0, 164);">则是一个很好的选择</span></strong><span style="margin: 0px; padding: 0px; color: rgb(51, 51, 51);">。</span></li></ul></div><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"> </p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"> <strong style="margin: 0px; padding: 0px;">InnoDB索引</strong>和<strong style="margin: 0px; padding: 0px;">MyISAM索引</strong>的区别：</p><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><div>一是主索引的区别，InnoDB的数据文件本身就是索引文件。而MyISAM的索引和数据是分开的。</div></div><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><div>二是辅助索引的区别：InnoDB的辅助索引data域存储相应记录主键的值而不是地址。而MyISAM的辅助索引和主索引没有多大区别，只是主索引要求列值是唯一的。</div></div></div></div></div></div><br/><div><table bgcolor="#D4DDE5" border="0" width="100%"><tr><td><h1>如何创建线程安全的单例？</h1><b>来源网址：</b> <a href="http://javarevisited.blogspot.hk/2012/12/how-to-create-thread-safe-singleton-in-java-example.html">http://javarevisited.blogspot.hk/2012/12/how-to-create-thread-safe-singleton-in-java-example.html</a><br/><b>作者：</b> 958340585@qq.com<br/></td></tr></table></div><div><div style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 21px;"><span style="font-family: arial;">Thread safe Singleton means a Singleton class which returns exactly same instance even if exposed to multiple threads. Singleton in Java has been a classical design pattern like <a href="http://javarevisited.blogspot.sg/2011/12/factory-design-pattern-java-example.html" style="color: rgb(102, 0, 153);">Factory method pattern</a> or <a href="http://javarevisited.blogspot.sg/2011/11/decorator-design-pattern-java-example.html" style="color: rgb(102, 0, 153);">Decorator design pattern</a> and has been used a lot even inside JDK like </span><span style="font-family: 'courier new';">java.lang.Runtime </span><span style="font-family: arial;">is an example of Singleton class. Singleton pattern ensures that exactly one instance of class will remain in Java program at any time. In our last post <a href="http://javarevisited.blogspot.com/2011/03/10-interview-questions-on-singleton.html" style="color: rgb(102, 0, 153);">10 Interview questions on Singleton in Java</a> we have discussed many different questions asked on Singleton pattern, One of them was writing Thread safe singleton in Java. Prior to Java 5 <a href="http://javarevisited.blogspot.sg/2012/07/why-enum-singleton-are-better-in-java.html" style="color: rgb(102, 0, 153);">double checked locking</a> mechanism is used to create <i>thread-safe singleton</i> in Java which breaks if one Thread doesn't see instance created by other thread at same time and eventually you will end up with more than one instance of Singleton class. From Java 5 onwards <a href="http://javarevisited.blogspot.sg/2011/06/volatile-keyword-java-example-tutorial.html" style="color: rgb(102, 0, 153);">volatile variable</a> guarantee can be used to write thread safe singleton by using double checked locking pattern. I personally  don't prefer that way as there are many other simpler alternatives to write thread-safe singleton is available available like using <a href="http://javarevisited.blogspot.sg/2011/11/static-keyword-method-variable-java.html" style="color: rgb(102, 0, 153);">static field</a> to initialize Singleton instance or using <a href="http://javarevisited.blogspot.sg/2012/07/why-enum-singleton-are-better-in-java.html" style="color: rgb(102, 0, 153);">Enum as Singleton in Java</a>. Let’s see example of both ways to create thread-safe Singleton in Java.</span></span></div><div><span style="font-size: 21px;"><span style="font-family: 'Trebuchet MS', Verdana, Arial, sans-serif;"><br/></span></span></div><div><font face="Trebuchet MS, Verdana, Arial, sans-serif"><span style="font-size: 21px;">线程安全的单例意味着一个单例类即使在多线程环境下也只返回相同的实例。单例在Java中和工厂方法模式、装饰器模式一样，是一个经典的设计模式，已经被广泛使用与JDK的类中，例如java.lang.Runtime类。单例模式保证在任何时刻Java程序中都只有一个实例。在java5之前，double check的写法其实是线程不安全的，由于存在内存可见性，会导致线程观察到一个正在创建的不完整的实例，从1.5以后开始，volatile关键字可以保证内存可见性，因此double check是线程安全的。从此之外，还有一些简单的可选的实现线程安全单例的方式，例如：使用静态域初始化（饿汉、懒汉holder），或者使用Java枚举类Enum来实现。</span></font></div><div><span style="font-size: 21px;"><span style="font-family: 'Trebuchet MS', Verdana, Arial, sans-serif;"><br/></span></span></div><div><span style="font-size: 21px;"><br/></span></div><div><div style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-weight: bold;"><div><span style="font-size: 21px;"><u><span style="font-style: normal; font-weight: normal;">Java Singleton Example – Thread safe Singleton in Java using Enum使用枚举类实现线程安全的单例类</span></u></span></div></div><div style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div><span style="font-size: 21px;"><span style="font-family: arial;">This is one of the example of Enum which I missed while writing <a href="http://javarevisited.blogspot.sg/2011/08/enum-in-java-example-tutorial.html" style="color: rgb(102, 0, 153);">10 Examples of Enum in Java</a>. Using Enum to create Singleton is by far most simple and effective way to create thread-safe Singleton in Java, asthread-safety guarantee is provided by Java programming language itself. You don't need to bother about thread-safety issue. Since Enum instances are by default <a href="http://javarevisited.blogspot.sg/2011/12/final-variable-method-class-java.html" style="color: rgb(102, 0, 153);">final in Java</a>, it also provides safety against multiple instance due to <a href="http://javarevisited.blogspot.sg/2011/04/top-10-java-serialization-interview.html" style="color: rgb(102, 0, 153);">serialization</a>. </span></span></div><div><span style="font-size: 21px;">使用枚举Enum创建线程安全的单例，是目前为止最简单和最有效的方式。因为线程安全是Java语言本身来保证的，因此我们不需要担忧线程安全的问题。因为Enum实例默认是final的，因此在序列化的时候也提供线程安全性。</span></div><span style="font-size: 21px;"><br/></span><div><span style="font-size: 21px;"><span style="font-family: arial;">One point which is worth remembering is that, when we talk about thread-safe Singleton, we are talking about thread-safety during instance creation of Singleton class and not when we call any method of Singleton class. If your Singleton class maintain any state and contains method to modify that state, you need to write code to avoid and <a href="http://javarevisited.blogspot.sg/2012/01/how-to-write-thread-safe-code-in-java.html" style="color: rgb(102, 0, 153);">thread-safety</a> and <a href="http://javarevisited.blogspot.sg/2011/04/synchronization-in-java-synchronized.html" style="color: rgb(102, 0, 153);">synchronization issues</a>. Any way here is code <i>example of creating thread safe Singleton in Java using Enum</i>.</span></span></div></div><div style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div><span style="font-size: 21px;">需要记住的一点是，当我们讨论线程安全的单例的时候，我们是在讨论实例创建时期的线程安全性，不是说我们调用实例的方法。如果你的单例类需要维护状态，包含修改状态的方法，你需要写一些额外的代码来避免线程安全和同步问题。下面是使用Enum创建单例的例子：</span></div><div><span style="font-size: 21px;"><br/></span></div></div><div style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); border: 1pt dotted windowtext; padding: 1pt 4pt; transition: background-color 0.3s ease; -webkit-transition: background-color 0.3s ease; background-position: initial initial; background-repeat: initial initial;"><div style="background: rgb(193, 230, 198); border: none; padding: 0in; transition: background-color 0.3s ease;"><span style="font-size: 21px;"><span style="font-family: 'courier new';"> <b><span style="color: black;">public</span></b> <b><span style="color: black;">enum</span></b> Singleton<span style="color: rgb(0, 153, 0);">{</span><br/>
    INSTANCE<span style="color: rgb(51, 153, 51);">;</span><br/>
  <br/>
    <b><span style="color: black;">public</span></b> <b><span style="color: rgb(0, 102, 0);">void</span></b> show<span style="color: rgb(0, 153, 0);">(){</span><br/>
        <b>System</b>.<span style="color: rgb(0, 102, 51);">out</span>.<span style="color: rgb(0, 102, 51);">println</span><span style="color: rgb(0, 153, 0);">(</span><span style="color: blue;">&quot;Singleton using Enum in Java&quot;</span><span style="color: rgb(0, 153, 0);">)</span><span style="color: rgb(51, 153, 51);">;</span><br/>
    <span style="color: rgb(0, 153, 0);">}</span><br/><span style="color: rgb(0, 153, 0);">}</span></span></span></div><div style="background: rgb(193, 230, 198); border: none; padding: 0in; transition: background-color 0.3s ease;"><span style="font-size: 21px;"><br/></span></div><div style="background: rgb(193, 230, 198); border: none; padding: 0in; transition: background-color 0.3s ease;"><span style="font-size: 21px;"><span style="color: rgb(0, 153, 0); font-family: 'courier new';">//You can access this Singleton as Singleton.INSTANCE and call any method like below</span></span></div><div style="background: rgb(193, 230, 198); border: none; padding: 0in; transition: background-color 0.3s ease;"><span style="font-size: 21px;"><span style="font-family: 'courier new';">Singleton.INSTANCE.show();</span></span></div></div><div style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 21px;"><br/></span></div><div style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 21px;"><span style="font-family: arial;">If this suits your need than this is the most easy way of writing thread-safe Singleton in Java. Using Enum as Singleton also provide couple of more benefits which you can find out on <a href="http://javarevisited.blogspot.sg/2012/07/why-enum-singleton-are-better-in-java.html" style="color: rgb(102, 0, 153);">Why Enum Singleton are better in Java</a>.</span></span></div><div style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div><span style="font-size: 21px;"><br/></span></div></div><h2 style="color: rgb(0, 0, 0); font-family: &quot;Trebuchet MS&quot;, Verdana, Arial, sans-serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;"><span style="font-size: 21px;"><u><span style="font-style: normal; font-weight: normal;">Java Singleton Example - Thread Safe Singleton using Static field Initialization使用静态域来创建线程安全的单例？</span></u></span></h2><div style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 21px;"><span style="font-family: arial;">You can also create thread safe Singleton in Java by creating Singleton instance during <a href="http://javarevisited.blogspot.sg/2012/07/when-class-loading-initialization-java-example.html" style="color: rgb(102, 0, 153);">class loading</a>. static fields are initialized during class loading and <a href="http://javarevisited.blogspot.com.au/2012/12/how-classloader-works-in-java.html" style="color: rgb(102, 0, 153);">Classloader</a> will guarantee that instance will not be visible until its fully created. Here is example of creating thread safe singleton in Java using static factory method. Only disadvantage of this implementing Singleton patter using static field is that this is <i>not a lazy initialization</i> and Singleton is initialized even before any clients call there </span><span style="font-family: 'courier new';">getInstance()</span><span style="font-family: arial;"> method.</span></span></div><div style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div><span style="font-size: 21px;"><br/></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><b><span style="font-size: 21px;">你可以通过在类加载的时候创建单例的实例的方式来创建线程安全的单例。静态域在类加载的时候被初始化，类加载器将保证实例是可见的直到被完全创建完毕。（因为类加载器加锁，保证只有一个线程去加载这个类，内存可见性得到保证）。下面是使用静态工厂方法创建线程安全的单例的例子，唯一的缺点就是这种方式不是懒加载的，任何触及到该类被加载的调用，都将触发单例实例的创建。</span></b></span></span></div><div><span style="font-size: 21px;"><br/></span></div></div><div style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); border: 1pt dotted windowtext; padding: 1pt 4pt; transition: background-color 0.3s ease; -webkit-transition: background-color 0.3s ease; background-position: initial initial; background-repeat: initial initial;"><div style="background: rgb(193, 230, 198); border: none; padding: 0in; transition: background-color 0.3s ease;"><span style="font-size: 21px;"><b><span style="color: black; font-family: 'courier new';">public</span></b><span style="font-family: 'courier new';"> <b><span style="color: black;">class</span></b> Singleton<span style="color: rgb(0, 153, 0);">{</span><br/>
    <b><span style="color: black;">private</span></b> <b><span style="color: black;">static</span></b> <b><span style="color: black;">final</span></b> Singleton INSTANCE = <b><span style="color: black;">new</span></b> Singleton<span style="color: rgb(0, 153, 0);">()</span><span style="color: rgb(51, 153, 51);">;</span><br/>
  <br/>
    <b><span style="color: black;">private</span></b> Singleton<span style="color: rgb(0, 153, 0);">(){</span> <span style="color: rgb(0, 153, 0);">}</span><br/><br/>
    <b><span style="color: black;">public</span></b> <b><span style="color: black;">static</span></b> Singleton getInstance<span style="color: rgb(0, 153, 0);">(){</span><br/>
        <b><span style="color: black;">return</span></b> INSTANCE<span style="color: rgb(51, 153, 51);">;</span><br/>
    <span style="color: rgb(0, 153, 0);">}</span><br/>
    <b><span style="color: black;">public</span></b> <b><span style="color: rgb(0, 102, 0);">void</span></b> show<span style="color: rgb(0, 153, 0);">(){</span><br/>
        <b>System</b>.<span style="color: rgb(0, 102, 51);">out</span>.<span style="color: rgb(0, 102, 51);">println</span><span style="color: rgb(0, 153, 0);">(</span><span style="color: blue;">&quot;Singleon using static initialization in Java&quot;</span><span style="color: rgb(0, 153, 0);">)</span><span style="color: rgb(51, 153, 51);">;</span><br/>
    <span style="color: rgb(0, 153, 0);">}</span><br/><span style="color: rgb(0, 153, 0);">}</span></span></span></div><div style="background: rgb(193, 230, 198); border: none; padding: 0in; transition: background-color 0.3s ease;"><span style="font-size: 21px;"><br/></span></div><div style="background: rgb(193, 230, 198); border: none; padding: 0in; transition: background-color 0.3s ease;"><span style="font-size: 21px;"><span style="color: rgb(0, 153, 0); font-family: 'courier new';">//Here is how to access this Singleton class</span></span></div><div style="background: rgb(193, 230, 198); border: none; padding: 0in; transition: background-color 0.3s ease;"><span style="font-size: 21px;"><span style="font-family: 'courier new';">Singleton.getInstance().show();</span></span></div></div><div style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 21px;"><br/></span></div><div style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div><span style="font-size: 21px;"><span style="font-family: arial;">here we are not creating Singleton instance inside </span><span style="font-family: 'courier new';">getInstance()</span><span style="font-family: arial;"> method instead it will be created by ClassLoader. Also <a href="http://javarevisited.blogspot.sg/2012/12/what-is-constructor-in-java-example-chainning-overloading.html" style="color: rgb(102, 0, 153);">private constructor</a> makes impossible to create another instance , except one case. You can still access private constructor by reflection and calling </span><span style="font-family: 'courier new';">setAccessible(true).</span><span style="font-family: arial;"> By the way You can still prevent creating another instance of Singleton by this way by <a href="http://javarevisited.blogspot.sg/2012/02/difference-between-throw-and-throws-in.html" style="color: rgb(102, 0, 153);">throwing Exception</a> from constructor.</span></span></div></div></div><div><span style="font-size: 21px;"><span style="font-family: 'Trebuchet MS', Verdana, Arial, sans-serif;">通过将构造器声明为私有的，不允许直接通过构造器来创建实例。但是仍然可以通过反射来调用构造函数创建实例，为了防止这样的无脑操作，可以在<span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(227, 0, 0);"><b>构造函数中抛出异常</b></span></span>来阻止这种行为。</span></span></div><div><span style="font-size: 21px;"><span style="font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-family: 'Trebuchet MS', Verdana, Arial, sans-serif;"><br/></span></span></span></div><div><span style="font-size: 21px;"><span style="font-family: 'Trebuchet MS', Verdana, Arial, sans-serif;">Read more: <a href="http://javarevisited.blogspot.com/2012/12/how-to-create-thread-safe-singleton-in-java-example.html#ixzz59xlE3Ugb" style="color: rgb(0, 51, 153);">http://javarevisited.blogspot.com/2012/12/how-to-create-thread-safe-singleton-in-java-example.html#ixzz59xlE3Ugb</a></span></span></div><div><span style="font-size: 21px;"><span style="font-family: 'Trebuchet MS', Verdana, Arial, sans-serif;"><br/></span></span></div><div><span style="font-size: 21px;"><span style="font-family: 'Trebuchet MS', Verdana, Arial, sans-serif;"><br/></span></span></div><div><span style="font-size: 21px;"><br/></span></div><div><hr/></div><div><span style="font-size: 21px;"><br/></span></div><div>静态域懒汉式：</div><div><br/></div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>class Singleton {</div><div>     private static class SingletonHolder {</div><div>         final static  Singleton instance = new Singletone();</div><div>     }</div><div>     </div><div>     private Singletone(){}</div><div>     public static Singletone getInstance() {</div><div>         return  SingletoneHolder.instance;</div><div>     }</div><div>}</div></div><div><br/></div><div><br/></div><div>double check</div><div><br/></div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>class Singletone {</div><div>     private volatile Singleton instance = null;</div><div>     private Singleton(){}</div><div>     public Singleton getInstance() {</div><div>          if (instance == null) {</div><div>               synchronized(Singleton.class) {</div><div>                   if (instance == null)</div><div>                        instance = new Singleton(); </div><div>               }</div><div>          }</div><div>          return instance;        </div><div>     }</div><div>}</div></div><div><br/></div><div><hr/></div><div>枚举</div><div><br/></div><div>enum Singletone {</div><div>     INSTANCE;</div><div>     public void otherMethod() {</div><div>          ....     </div><div>     }</div><div>}</div><div><span style="font-size: 21px;"><br/></span></div><div><hr/></div><div><span style="font-size: 21px;"><br/></span></div><div><span style="font-size: 21px;"><br/></span></div><div><span style="font-size: 21px;"><br/></span></div><div><span style="font-size: 21px;"><br/></span></div><div><span style="font-size: 21px;"><br/></span></div><div><span style="font-size: 21px;"><br/></span></div><div><span style="font-size: 21px;"><br/></span></div><div><span style="font-size: 21px;"><br/></span></div><div><span style="font-size: 21px;"><br/></span></div><div><span style="font-size: 21px;"><br/></span></div><div><span style="font-size: 21px;"><br/></span></div><div><span style="font-size: 21px;"><br/></span></div><div><span style="font-size: 21px;"><br/></span></div><div><span style="font-size: 21px;"><br/></span></div><div><span style="font-size: 21px;"><br/></span></div><div><span style="font-size: 21px;"><br/></span></div><div><span style="font-size: 21px;"><br/></span></div><div><span style="font-size: 21px;"><br/></span></div><div><br/></div></div><br/><div><table bgcolor="#D4DDE5" border="0" width="100%"><tr><td><h1>HTTP协议首部字段</h1><b>作者：</b> 958340585@qq.com<br/></td></tr></table></div><div><div>请求首部：</div><div><br/></div><div><span style="font-size: 16px;"><b>Host: URL</b></span></div><div><span style="font-size: 16px;"><b>Connection: keep-alive </b></span></div><div><span style="font-size: 16px;"><b>Cache-Control: no-cache</b></span></div><div><span style="font-size: 16px;"><b>Upgrade-Insecure-Requests: 1</b></span></div><div><span style="font-size: 16px;"><b>User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.186 Safari/537.36</b></span></div><div><span style="font-size: 16px;"><b>Accept: text/html </b></span></div><div><span style="font-size: 16px;"><b>Accept-Encoding: gzip, deflate</b></span></div><div><span style="font-size: 16px;"><b>Accept-Language: zh-CN,zh;q=0.9,en;q=0.8</b></span></div><div><span style="font-size: 16px;"><b>Cookie: SessionId=</b></span></div><div><br/></div><div><hr/></div><div><br/></div><div>响应首部</div><div><br/></div><div><span style="font-size: 16px;"><b>Date: Thu, 15 Mar 2018 07:36:43 GMT</b></span></div><div><span style="font-size: 16px;"><b>Server: VWebServer X-Frame-Options: SAMEORIGIN</b></span></div><div><span style="font-size: 16px;"><b>Last-Modified: Thu, 15 Mar 2018 06:51:38 GMT</b></span></div><div><span style="font-size: 16px;"><b>ETag: &quot;ecb8-5676dec5a7280&quot;  </b></span></div><div><span style="font-size: 16px;"><b>Cache-Control: private, max-age=600</b></span></div><div><span style="font-size: 16px;"><b>Expires: Thu, 15 Mar 2018 07:46:43 GMT</b></span></div><div><span style="font-size: 16px;"><b>Content-Encoding: gzip</b></span></div><div><span style="font-size: 16px;"><b>Content-Length: 12460</b></span></div><div><span style="font-size: 16px;"><b>Keep-Alive: timeout=5, max=200</b></span></div><div><span style="font-size: 16px;"><b>Connection: Keep-Alive</b></span></div><div><span style="font-size: 16px;"><b>Content-Type: text/html</b></span></div><div><span style="font-size: 16px;"><b>Content-Language: zh-CN</b></span></div></div><br/><div><table bgcolor="#D4DDE5" border="0" width="100%"><tr><td><h1>JVM 垃圾回收</h1><b>来源网址：</b> <a href="http://help.eclipse.org/luna/topic/org.eclipse.mat.ui.help/concepts/gcroots.html?cp=37_2_3">http://help.eclipse.org/luna/topic/org.eclipse.mat.ui.help/concepts/gcroots.html?cp=37_2_3</a><br/><b>作者：</b> 958340585@qq.com<br/></td></tr></table></div><div><div><span style="font-size: 19px;"><b>一、概述</b></span></div><div><br/></div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>Java与C++之间有一堵内存动态分配和垃圾收集技术所围成的“高墙”，墙外面的人想进去，墙里面的人想进来。</div></div><div><br/></div><div>GC需要回答的三个问题？</div><ul><li>哪些内存需要被回收？（哪些是垃圾？）</li><li>什么时候回收？（如何找到这些垃圾，可达性分析、引用计数）</li><li>如何回收？（垃圾回收算法）</li></ul><div><br/></div><div>JVM运行时内存区域大致分为 <span style="font-size: 15px;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><b>：程序计算器、栈内存（虚拟机栈、本地方法栈）、堆内存、方法区（包含运行时常量池）</b></span></span></span>，</div><div>而程序计数器、栈内存都是随线程而生，随线程而灭，这些区域的内存在方法结束或者线程结束，内存自然被回收。</div><div><br/></div><div>因此需要GC的内存区域就是：<span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><span style="font-size: 19px;"><b>堆内存和方法区。</b></span></span></span></div><div><br/></div><div><br/></div><div><span style="font-size: 19px;"><b>二、判断对象的存活</b></span></div><div><br/></div><ol><li><span style="font-size: 16px;"><b>引用计数</b></span></li></ol><div>  </div><div>问题：很难解决循环引用的问题；</div><div><br/></div><ol start="2"><li><span style="font-size: 16px;"><b>可达性分析</b></span></li></ol><div>  </div><div>可达性分析算法：</div><div><br/></div><div><b><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><span style="font-size: 16px;">通过一系列“GC Roots”的对象作为起始点，从这些节点开始向下搜索，搜索走过的路径成为“引用链”，如果一个对象（或者多个彼此有联系的对象组成的对象组）到GC Roots没有任何引用链相连（不可达），则证明此对象或者对象组是不可用的，会被判定为可回收的对象。</span></span></span></b></div><div><br/></div><div><span style="font-size: 16px;"><span style="color: rgb(0, 0, 0); font-family: Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">GC ROOT: A garbage collection root is an object that is accessible from outside the heap.</span></span></div><div><span style="font-size: 19px;"><b>GC Root是从堆外访问的对象。（比如从栈内存、方法区）</b></span></div><div><br/></div><div><br/></div><div>适合作为Java GC Roots的对象包括如下几种：</div><ul><li><b>虚拟机栈中（栈帧中的本地变量表）引用的对象（</b>此时，方法还在执行，因此方法所直接引用或者间接引用到所有对象多不应该被回收）</li><li><b>方法区中类静态属性引用的对象</b></li><li>方法区中常量引用的对象</li><li>本地方法栈JNI引用的对象</li><li><b>线程Thread</b></li><li><b>系统类</b>（被bootsrap类加载器加载的类，例如rt.jar包中的所有类，这些类在方法区中，算是非堆内存）</li><li>等等</li></ul><div><br/></div><div><h1 style="font-size: 1.5em; font-style: normal; font-weight: bold; margin-bottom: 0.5em; word-spacing: 0.1em; margin-top: 0pc; color: rgb(0, 0, 0); font-family: Arial, sans-serif; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;">Garbage Collection Roots</h1><div style="color: rgb(0, 0, 0); font-family: Arial, sans-serif; font-size: 12.8px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;"><p style="margin-top: 1em;">A garbage collection root is an object that is accessible from outside the heap. The following reasons make an object a GC root:</p><dl><dd><div style="margin-top: 0.5em; margin-bottom: 0.5em; font-weight: bold;">System Class</div></dd><dd style="margin-left: 1em;">Class loaded by bootstrap/system class loader. For example, everything from the rt.jar like java.util.* .</dd><dd><div style="margin-top: 0.5em; margin-bottom: 0.5em; font-weight: bold;">JNI Local</div></dd><dd style="margin-left: 1em;">Local variable in native code, such as user defined JNI code or JVM internal code.</dd><dd><div style="margin-top: 0.5em; margin-bottom: 0.5em; font-weight: bold;">JNI Global</div></dd><dd style="margin-left: 1em;">Global variable in native code, such as user defined JNI code or JVM internal code.</dd><dd><div style="margin-top: 0.5em; margin-bottom: 0.5em; font-weight: bold;">Thread Block</div></dd><dd style="margin-left: 1em;">Object referred to from a currently active thread block.</dd><dd><div style="margin-top: 0.5em; margin-bottom: 0.5em; font-weight: bold;">Thread</div></dd><dd style="margin-left: 1em;">A started, but not stopped, thread.</dd><dd><div style="margin-top: 0.5em; margin-bottom: 0.5em; font-weight: bold;">Busy Monitor</div></dd><dd style="margin-left: 1em;">Everything that has called wait() or notify() or that is synchronized. For example, by calling synchronized(Object) or by entering a synchronized method. Static method means class, non-static method means object.</dd><dd><div style="margin-top: 0.5em; margin-bottom: 0.5em; font-weight: bold;">Java Local</div></dd><dd style="margin-left: 1em;">Local variable. For example, input parameters or locally created objects of methods that are still in the stack of a thread.</dd><dd><div style="margin-top: 0.5em; margin-bottom: 0.5em; font-weight: bold;">Native Stack</div></dd><dd style="margin-left: 1em;">In or out parameters in native code, such as user defined JNI code or JVM internal code. This is often the case as many methods have native parts and the objects handled as method parameters become GC roots. For example, parameters used for file/network I/O methods or reflection.</dd><dd><div style="margin-top: 0.5em; margin-bottom: 0.5em; font-weight: bold;">Finalizable</div></dd><dd style="margin-left: 1em;">An object which is in a queue awaiting its finalizer to be run.</dd><dd><div style="margin-top: 0.5em; margin-bottom: 0.5em; font-weight: bold;">Unfinalized</div></dd><dd style="margin-left: 1em;">An object which has a finalize method, but has not been finalized and is not yet on the finalizer queue.</dd><dd><div style="margin-top: 0.5em; margin-bottom: 0.5em; font-weight: bold;">Unreachable</div></dd><dd style="margin-left: 1em;">An object which is unreachable from any other root, but has been marked as a root by MAT to retain objects which otherwise would not be included in the analysis.</dd><dd><div style="margin-top: 0.5em; margin-bottom: 0.5em; font-weight: bold;">Java Stack Frame</div></dd><dd style="margin-left: 1em;">A Java stack frame, holding local variables. Only generated when the dump is parsed with the preference set to treat Java stack frames as objects.</dd><dd><div style="margin-top: 0.5em; margin-bottom: 0.5em; font-weight: bold;">Unknown</div><div style="margin-left: 1em;">An object of unknown root type. Some dumps, such as IBM Portable Heap Dump files, do not have root information. For these dumps the MAT parser marks objects which are have no inbound references or are unreachable from any other root as roots of this type. This ensures that MAT retains all the objects in the dump.</div></dd></dl></div></div><div><br/></div><div><br/></div><ol start="3"><li><span style="font-size: 16px;"><b>引用的分类</b></span></li></ol><div><br/></div><ul><li>强引用 StrongReference：只要存在强引用，就不会回收。</li><li>软引用 SoftReference ：用于描述有用但是不是必须的对象，发生内存溢出之前，会将其进行回收</li><li>弱引用 WeakReference：用于描述非必须的对象，比弱引用稍微弱一些，只能生存到下一次GC发生之前。经常用来实现<b>内存敏感的高速缓存</b>。</li><li>虚引用 PhantomReference：对GC无任何影响。对象被回收会收到通知。</li></ul><div><br/></div><ol start="4"><li><span style="font-size: 16px;"><b>回收方法区</b></span></li></ol><div><b>方法区在HotSpot虚拟机中被划为永久代，对方法区（永久代）的回收的性价比较低，在新生代进行一次GC可以回收70~95%的空间，而永久代收集效率远低于此。</b></div><div><br/></div><div>永久代的方法区的垃圾回收主要包含两部分内容：</div><ul><li>回收废弃的常量</li><li>回收无用的类</li></ul><div><br/></div><div><br/></div><div>堆内存分代：</div><div><br/></div><div>新生代：Eden From To 8:1:1</div><div>老年代</div><div>永久代</div><div><br/></div><div>老年代：Full GC</div><div>新生代： Minor GC</div><div><br/></div><div><span style="font-size: 19px;"><b>三、垃圾回收算法</b></span></div><div><br/></div><div>垃圾回收算法：</div><ul><li>复制(copy)：将可用内存按容量分为大小相等的两块，每次只使用其中的一块。当这一块的内存用完了，将还存活的对象复制到另一块内存上。</li><li>标记清除（mark sweep）：分为标记阶段和清除阶段，标记阶段标记哪些是需要回收的内存；清除阶段同一回收被标记的内存区域；缺点：内存碎片</li><li>标记整理：先标记需要回收的内存区域，后续步骤不是直接回收，而是让存活的对象都向一端移动，然后清除端外界以外的内存，可以解决内存碎片的问题，但是时间消耗比较大；</li><li>分代收集：根据对象的生存周期分为新生代和老年代，根据各个年代的特点采用合适的算法；新生代 复制算法；老年代标记-整理或者标记-清除。</li></ul><div><br/></div><div><span style="font-size: 19px;"><b>四、垃圾回收器</b></span></div><div><br/></div><div>垃圾回收器：</div><ul><li>Serial收集器/Serial Old收集器：GC单线程，新生代采取<b>标记复制算法,暂停所有用户线程；</b>老年代采取<b>标记整理算法，暂停所有用户线程；</b></li><li>ParNew收集器：Serial的多线程版本，GC多线程，新生代采取<b>标记复制算法,暂停所有用户线程；</b>老年代采取<b>标记整理算法，暂停所有用户线程；</b></li><li>CMS收集器：基于<b>标记清除</b>算法实现的，分为四个步骤：初始标记（stop-the-world），并发标记(并发)，重新标记（stop-the-world ），并发清除（并发）。</li><li>G1收集器：</li></ul><div><br/></div><div><br/></div><div><br/></div><div><br/></div></div><br/><div><table bgcolor="#D4DDE5" border="0" width="100%"><tr><td><h1>IEEE754 Float和Double精度问题</h1><b>来源网址：</b> <a href="http://blog.csdn.net/k346k346/article/details/50487127">http://blog.csdn.net/k346k346/article/details/50487127</a><br/><b>作者：</b> 958340585@qq.com<br/></td></tr></table></div><div><div><h1 style="font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; margin: 8px 0px 16px; padding: 0px; font-weight: 700; box-sizing: border-box; color: rgb(79, 79, 79); font-size: 28px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">6.浮点数的精度和数值范围</h1><h2 style="font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; margin: 8px 0px 16px; padding: 0px; font-weight: 700; box-sizing: border-box; color: rgb(79, 79, 79); font-size: 24px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><a name="t10" style="color: rgb(78, 161, 219); outline: 0px; margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; text-decoration: none;"></a>6.1浮点数的数值范围</h2><p style="margin: 0px 0px 16px; padding: 0px; font-weight: 400; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); text-align: justify; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">根据上面的探讨，浮点数可以表示-∞到+∞，这只是一种特殊情况，显然不是我们想要的数值范围。</p><p style="margin: 0px 0px 16px; padding: 0px; font-weight: 400; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); text-align: justify; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">以32位单精度浮点数为例，阶码E由8位表示，取值范围为0-255，去除0和255这两种特殊情况，那么指数e的取值范围就是1-127=-126到254-127=127。</p><p style="margin: 0px 0px 16px; padding: 0px; font-weight: 400; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); text-align: justify; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">（1）最大正数 <br style="box-sizing: border-box;"/>
因此单精度浮点数最大正数值的符号位S=0，阶码E=254，指数e=254-127=127，尾数M=111 1111 1111 1111 1111 1111，其机器码为：0 11111110 111 1111 1111 1111 1111 1111。</p><p style="margin: 0px 0px 16px; padding: 0px; font-weight: 400; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); text-align: justify; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">那么最大正数值: <br style="box-sizing: border-box;"/></p><div style="margin: 1em 0em; padding: 0px; font-weight: 400; box-sizing: border-box; text-align: center; position: relative; text-indent: 0px; max-width: none; max-height: none; min-width: 0px; min-height: 0px; width: 860px; display: block !important; color: rgb(69, 69, 69); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><span style="margin: 0px; padding: 0px; font-weight: normal; box-sizing: border-box; display: inline; font-style: normal; font-size: 16px; text-indent: 0px; text-align: center; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; outline: 0px; position: relative;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: static; border: 0px; vertical-align: 0px; text-decoration: none; width: 45.94em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border: 0px; vertical-align: 0px; text-decoration: none; width: 38.284em; height: 0px; font-size: 19.2px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; clip: rect(1.148em, 1038.23em, 2.607em, -999.997em); top: -2.185em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">P</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">o</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">s</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">M</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">a</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">x</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">=</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">(</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">−</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; width: 0.94em; height: 0px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border: 0px; vertical-align: 0px; text-decoration: none; clip: rect(3.128em, 1000.32em, 4.43em, -999.997em); top: -4.008em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">)</span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; top: -4.424em; left: 0.367em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-size: 13.5744px; font-family: MathJax_Math-italic;">S</span></span></span></span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">×</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1.</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">M</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">×</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; width: 0.888em; height: 0px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border: 0px; vertical-align: 0px; text-decoration: none; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">2</span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; top: -4.424em; left: 0.523em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-size: 13.5744px; font-family: MathJax_Math-italic;">e</span></span></span></span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">=</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">+</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">(</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1.111</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1111</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1111</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1111</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1111</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1111</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">)</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">×</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; width: 1.617em; height: 0px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border: 0px; vertical-align: 0px; text-decoration: none; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">2</span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; top: -4.424em; left: 0.523em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; font-size: 13.5744px; font-family: MathJax_Main;">127</span></span></span></span></span></span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">≈</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">3.402823</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">e</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">+</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">38</span></span></span></span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; top: 0px; left: 0px; clip: rect(1px, 1px, 1px, 1px); user-select: none; position: static; border: 0px; height: 1px !important; width: 735.028px; overflow: hidden !important; display: none; transition: none; vertical-align: 0px; text-decoration: none;">PosMax=(−1)S×1.M×2e=+(1.11111111111111111111111)×2127≈3.402823e+38</span></span></div><br style="box-sizing: border-box; color: rgb(69, 69, 69); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"/><span style="color: rgb(69, 69, 69); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;">这是一个很大的数。</span><p style="margin: 0px 0px 16px; padding: 0px; font-weight: 400; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); text-align: justify; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"></p><p style="margin: 0px 0px 16px; padding: 0px; font-weight: 400; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); text-align: justify; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">（2）最小正数 <br style="box-sizing: border-box;"/>
最小正数符号位S=0，阶码E=1，指数e=1-127=-126，尾数M=0，其机器码为0 00000001 000 0000 0000 0000 0000 0000。</p><p style="margin: 0px 0px 16px; padding: 0px; font-weight: 400; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); text-align: justify; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">那么最小正数为： <br style="box-sizing: border-box;"/></p><div style="margin: 1em 0em; padding: 0px; font-weight: 400; box-sizing: border-box; text-align: center; position: relative; text-indent: 0px; max-width: none; max-height: none; min-width: 0px; min-height: 0px; width: 860px; display: block !important; color: rgb(69, 69, 69); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><span style="margin: 0px; padding: 0px; font-weight: normal; box-sizing: border-box; display: inline; font-style: normal; font-size: 16px; text-indent: 0px; text-align: center; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; outline: 0px; position: relative;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: static; border: 0px; vertical-align: 0px; text-decoration: none; width: 33.284em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border: 0px; vertical-align: 0px; text-decoration: none; width: 27.711em; height: 0px; font-size: 19.2px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; clip: rect(1.148em, 1027.66em, 2.607em, -999.997em); top: -2.185em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">P</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">o</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">s</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">M</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">i</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">n</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">=</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">(</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">−</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; width: 0.94em; height: 0px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border: 0px; vertical-align: 0px; text-decoration: none; clip: rect(3.128em, 1000.32em, 4.43em, -999.997em); top: -4.008em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">)</span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; top: -4.424em; left: 0.367em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-size: 13.5744px; font-family: MathJax_Math-italic;">S</span></span></span></span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">×</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1.</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">M</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">×</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; width: 0.888em; height: 0px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border: 0px; vertical-align: 0px; text-decoration: none; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">2</span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; top: -4.424em; left: 0.523em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-size: 13.5744px; font-family: MathJax_Math-italic;">e</span></span></span></span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">=</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">+</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">(</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1.0</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">)</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">×</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; width: 2.19em; height: 0px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border: 0px; vertical-align: 0px; text-decoration: none; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">2</span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; top: -4.424em; left: 0.523em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-size: 13.5744px; font-family: MathJax_Main;">−</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; font-size: 13.5744px; font-family: MathJax_Main;">126</span></span></span></span></span></span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">≈</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1.175494</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">e</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">−</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">38</span></span></span></span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; top: 0px; left: 0px; clip: rect(1px, 1px, 1px, 1px); user-select: none; position: static; border: 0px; height: 1px !important; width: 532.543px; overflow: hidden !important; display: none; transition: none; vertical-align: 0px; text-decoration: none;">PosMin=(−1)S×1.M×2e=+(1.0)×2−126≈1.175494e−38</span></span></div><p style="margin: 0px 0px 16px; padding: 0px; font-weight: 400; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); text-align: justify; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"></p><p style="margin: 0px 0px 16px; padding: 0px; font-weight: 400; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); text-align: justify; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">这是一个相当小的数。几乎可以近似等于0。当阶码E=0，指数为-127时，IEEE754就是这么规定<span style="margin: 0px; padding: 0px; font-weight: normal; box-sizing: border-box; display: inline; font-style: normal; font-size: 16px; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; outline: 0px; position: relative;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: static; border: 0px; vertical-align: 0px; text-decoration: none; width: 5.576em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border: 0px; vertical-align: 0px; text-decoration: none; width: 4.638em; height: 0px; font-size: 19.2px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; clip: rect(1.148em, 1004.64em, 2.346em, -999.997em); top: -2.185em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1.0</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">×</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; width: 2.19em; height: 0px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border: 0px; vertical-align: 0px; text-decoration: none; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">2</span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; top: -4.424em; left: 0.523em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-size: 13.5744px; font-family: MathJax_Main;">−</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; font-size: 13.5744px; font-family: MathJax_Main;">127</span></span></span></span></span></span></span></span></span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; top: 0px; left: 0px; clip: rect(1px, 1px, 1px, 1px); user-select: none; position: static; border: 0px; height: 1px !important; width: 1px !important; overflow: hidden !important; display: none; transition: none; vertical-align: 0px; text-decoration: none;">1.0×2−127</span></span>近似为0的，事实上，它并不等于0。</p><p style="margin: 0px 0px 16px; padding: 0px; font-weight: 400; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); text-align: justify; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">（3）最大负数 <br style="box-sizing: border-box;"/>
最大负数符号位S=1，阶码E=1，指数e=1-127==-126，尾数M=0，机器码与最小正数的符号位相反，其他均相同，为：1 00000001 000 0000 0000 0000 0000 0000。</p><p style="margin: 0px 0px 16px; padding: 0px; font-weight: 400; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); text-align: justify; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">最大负数等于： <br style="box-sizing: border-box;"/></p><div style="margin: 1em 0em; padding: 0px; font-weight: 400; box-sizing: border-box; text-align: center; position: relative; text-indent: 0px; max-width: none; max-height: none; min-width: 0px; min-height: 0px; width: 860px; display: block !important; color: rgb(69, 69, 69); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><span style="margin: 0px; padding: 0px; font-weight: normal; box-sizing: border-box; display: inline; font-style: normal; font-size: 16px; text-indent: 0px; text-align: center; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; outline: 0px; position: relative;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: static; border: 0px; vertical-align: 0px; text-decoration: none; width: 34.586em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border: 0px; vertical-align: 0px; text-decoration: none; width: 28.805em; height: 0px; font-size: 19.2px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; clip: rect(1.148em, 1028.75em, 2.607em, -999.997em); top: -2.185em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">N</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">e</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">g</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">M</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">a</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">x</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">=</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">(</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">−</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; width: 0.94em; height: 0px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border: 0px; vertical-align: 0px; text-decoration: none; clip: rect(3.128em, 1000.32em, 4.43em, -999.997em); top: -4.008em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">)</span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; top: -4.424em; left: 0.367em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-size: 13.5744px; font-family: MathJax_Math-italic;">S</span></span></span></span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">×</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1.</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">M</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">×</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; width: 0.888em; height: 0px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border: 0px; vertical-align: 0px; text-decoration: none; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">2</span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; top: -4.424em; left: 0.523em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-size: 13.5744px; font-family: MathJax_Math-italic;">e</span></span></span></span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">=</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">−</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">(</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1.0</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">)</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">×</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; width: 2.19em; height: 0px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border: 0px; vertical-align: 0px; text-decoration: none; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">2</span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; top: -4.424em; left: 0.523em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-size: 13.5744px; font-family: MathJax_Main;">−</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; font-size: 13.5744px; font-family: MathJax_Main;">126</span></span></span></span></span></span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">≈</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">−</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1.175494</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">e</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">−</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">38</span></span></span></span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; top: 0px; left: 0px; clip: rect(1px, 1px, 1px, 1px); user-select: none; position: static; border: 0px; height: 1px !important; width: 553.366px; overflow: hidden !important; display: none; transition: none; vertical-align: 0px; text-decoration: none;">NegMax=(−1)S×1.M×2e=−(1.0)×2−126≈−1.175494e−38</span></span></div><p style="margin: 0px 0px 16px; padding: 0px; font-weight: 400; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); text-align: justify; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"></p><p style="margin: 0px 0px 16px; padding: 0px; font-weight: 400; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); text-align: justify; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">（4）最小负数 <br style="box-sizing: border-box;"/>
符号位S=0，阶码E=254，指数e=254-127=127，尾数M=111 1111 1111 1111 1111 1111，其机器码为：1 11111110 111 1111 1111 1111 1111 1111。</p><p style="margin: 0px 0px 16px; padding: 0px; font-weight: 400; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); text-align: justify; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">计算得： <br style="box-sizing: border-box;"/></p><div style="margin: 1em 0em; padding: 0px; font-weight: 400; box-sizing: border-box; text-align: center; position: relative; text-indent: 0px; max-width: none; max-height: none; min-width: 0px; min-height: 0px; width: 860px; display: block !important; color: rgb(69, 69, 69); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><span style="margin: 0px; padding: 0px; font-weight: normal; box-sizing: border-box; display: inline; font-style: normal; font-size: 16px; text-indent: 0px; text-align: center; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; outline: 0px; position: relative;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: static; border: 0px; vertical-align: 0px; text-decoration: none; width: 46.878em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border: 0px; vertical-align: 0px; text-decoration: none; width: 39.065em; height: 0px; font-size: 19.2px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; clip: rect(1.148em, 1039.01em, 2.607em, -999.997em); top: -2.185em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">N</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">e</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">g</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">M</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">i</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">n</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">=</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">(</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">−</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; width: 0.94em; height: 0px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border: 0px; vertical-align: 0px; text-decoration: none; clip: rect(3.128em, 1000.32em, 4.43em, -999.997em); top: -4.008em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">)</span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; top: -4.424em; left: 0.367em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-size: 13.5744px; font-family: MathJax_Math-italic;">S</span></span></span></span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">×</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1.</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">M</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">×</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; width: 0.888em; height: 0px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border: 0px; vertical-align: 0px; text-decoration: none; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">2</span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; top: -4.424em; left: 0.523em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-size: 13.5744px; font-family: MathJax_Math-italic;">e</span></span></span></span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">=</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">+</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">(</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1.111</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1111</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1111</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1111</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1111</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1111</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">)</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">×</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; width: 1.617em; height: 0px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border: 0px; vertical-align: 0px; text-decoration: none; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">2</span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; top: -4.424em; left: 0.523em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; font-size: 13.5744px; font-family: MathJax_Main;">127</span></span></span></span></span></span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">=</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">−</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">3.402823</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Math-italic;">e</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">+</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">38</span></span></span></span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; top: 0px; left: 0px; clip: rect(1px, 1px, 1px, 1px); user-select: none; position: static; border: 0px; height: 1px !important; width: 750.043px; overflow: hidden !important; display: none; transition: none; vertical-align: 0px; text-decoration: none;">NegMin=(−1)S×1.M×2e=+(1.11111111111111111111111)×2127=−3.402823e+38</span></span></div><p style="margin: 0px 0px 16px; padding: 0px; font-weight: 400; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); text-align: justify; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"></p><h2 style="font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; margin: 8px 0px 16px; padding: 0px; font-weight: 700; box-sizing: border-box; color: rgb(79, 79, 79); font-size: 24px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><a name="t11" style="color: rgb(78, 161, 219); outline: 0px; margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; text-decoration: none;"></a>6.2浮点数的精度</h2><p style="margin: 0px 0px 16px; padding: 0px; font-weight: 400; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); text-align: justify; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">说道浮点数的精度，先给精度下一个定义。浮点数的精度是指浮点数的小数位所能表达的位数。</p><p style="margin: 0px 0px 16px; padding: 0px; font-weight: 400; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); text-align: justify; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">阶码的二进制位数决定浮点数的表示范围，尾数的二进制位数表示浮点数的精度。以32位浮点数为例，尾数域有23位。那么浮点数以二进制表示的话精度是23位，23位所能表示的最大数是<span style="margin: 0px; padding: 0px; font-weight: normal; box-sizing: border-box; display: inline; font-style: normal; font-size: 16px; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; outline: 0px; position: relative;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: static; border: 0px; vertical-align: 0px; text-decoration: none; width: 9.273em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border: 0px; vertical-align: 0px; text-decoration: none; width: 7.711em; height: 0px; font-size: 19.2px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; clip: rect(1.148em, 1007.71em, 2.451em, -999.997em); top: -2.185em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; width: 1.305em; height: 0px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border: 0px; vertical-align: 0px; text-decoration: none; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">2</span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; top: -4.424em; left: 0.523em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; font-size: 13.5744px; font-family: MathJax_Main;">23</span></span></span></span></span></span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">−</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">=</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">8388607</span></span></span></span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; top: 0px; left: 0px; clip: rect(1px, 1px, 1px, 1px); user-select: none; position: static; border: 0px; height: 1px !important; width: 1px !important; overflow: hidden !important; display: none; transition: none; vertical-align: 0px; text-decoration: none;">223−1=8388607</span></span>，所以十进制的尾数部分最大数值是8388607，也就是说尾数数值超过这个值，float将无法精确表示，所以float最多能表示小数点后7位，但绝对能保证的为6位，也即float的十进制的精度为为6~7位。</p><div style="margin: 0px 0px 16px; padding: 0px; font-weight: 400; box-sizing: border-box; font-size: 16px; color: rgb(79, 79, 79); text-align: justify; font-family: -apple-system, 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun; font-style: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div>64位双精度浮点数的尾数域52位，因<span style="margin: 0px; padding: 0px; font-weight: normal; box-sizing: border-box; display: inline; font-style: normal; font-size: 16px; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; outline: 0px; position: relative;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: static; border: 0px; vertical-align: 0px; text-decoration: none; width: 17.19em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border: 0px; vertical-align: 0px; text-decoration: none; width: 14.326em; height: 0px; font-size: 19.2px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; clip: rect(1.148em, 1014.27em, 2.555em, -999.997em); top: -2.185em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline-block; position: relative; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; width: 1.305em; height: 0px;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border: 0px; vertical-align: 0px; text-decoration: none; clip: rect(3.18em, 1000.47em, 4.169em, -999.997em); top: -4.008em; left: 0em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">2</span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: absolute; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; top: -4.424em; left: 0.523em;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none;"><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; font-size: 13.5744px; font-family: MathJax_Main;">52</span></span></span></span></span></span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">−</span><span style="margin: 0px; padding: 0px 0px 0px 0.211em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">1</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">=</span><span style="margin: 0px; padding: 0px 0px 0px 0.263em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">4</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">,</span><span style="margin: 0px; padding: 0px 0px 0px 0.159em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">503</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">,</span><span style="margin: 0px; padding: 0px 0px 0px 0.159em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">599</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">,</span><span style="margin: 0px; padding: 0px 0px 0px 0.159em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">627</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">,</span><span style="margin: 0px; padding: 0px 0px 0px 0.159em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">370</span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border: 0px; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">,</span><span style="margin: 0px; padding: 0px 0px 0px 0.159em; font-weight: 400; box-sizing: border-box; transition: none; display: inline; position: static; border-width: 0px; border-style: initial; border-color: transparent !important; border-image: initial; vertical-align: 0px; text-decoration: none; font-family: MathJax_Main;">495</span></span></span></span></span><span style="margin: 0px; padding: 0px; font-weight: 400; box-sizing: border-box; top: 0px; left: 0px; clip: rect(1px, 1px, 1px, 1px); user-select: none; position: static; border: 0px; height: 1px !important; width: 1px !important; overflow: hidden !important; display: none; transition: none; vertical-align: 0px; text-decoration: none;">252−1=4,503,599,627,370,495</span></span>，所以双精度浮点数的十进制的精度最高为16位，绝对保证的为15位，所以double的十进制的精度为15~16位。</div></div></div></div><br/><div><table bgcolor="#D4DDE5" border="0" width="100%"><tr><td><h1>操作系统死锁</h1><b>来源网址：</b> <a href="http://blog.csdn.net/ysdaniel/article/details/6644418">http://blog.csdn.net/ysdaniel/article/details/6644418</a><br/><b>作者：</b> 958340585@qq.com<br/></td></tr></table></div><div><div><b><span style="font-size: 16px;">产生死锁的原因主要是：</span></b></div><div><span style="font-size: 16px;">（1） 因为系统资源不足。</span></div><div><span style="font-size: 16px;">（2） 进程运行推进的顺序不合适。</span></div><div><span style="font-size: 16px;">（3） 资源分配不当等。</span></div><div><span style="font-size: 16px;">如果系统资源充足，进程的资源请求都能够得到满足，死锁出现的可能性就很低，否则</span></div><div><span style="font-size: 16px;">就会因争夺有限的资源而陷入死锁。其次，进程运行推进顺序与速度不同，也可能产生死锁。</span></div><div><span style="font-size: 16px;"><br/></span></div><div><hr/></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;"><br/></span></div><div><b><span style="font-size: 16px;">产生死锁的四个必要条件：</span></b></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;">（1） <b>互斥条件：</b>一个资源每次只能被一个进程使用。</span></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;">（2） <b>请求与保持条件：</b>一个进程因请求资源而阻塞时，对已获得的资源保持不放。</span></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;">（3） <b>不剥夺条件:</b> 进程已获得的资源，在末使用完之前，不能强行剥夺。</span></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;">（4） <b>循环等待条件:</b> 若干进程之间形成一种头尾相接的循环等待资源关系。</span></span></span></div><div><span style="font-size: 16px;">这四个条件是死锁的必要条件，只要系统发生死锁，这些条件必然成立，而只要上述条件之</span></div><div><span style="font-size: 16px;">一不满足，就不会发生死锁。</span></div><div><span style="font-size: 16px;"><br/></span></div><div><hr/></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;"><br/></span></div><div><b><span style="font-size: 16px;">死锁的解除与预防：</span></b></div><div><span style="font-size: 16px;">理解了死锁的原因，尤其是产生死锁的四个必要条件，就可以最大可能地避免、预防和</span></div><div><span style="font-size: 16px;">解除死锁。所以，在系统设计、进程调度等方面注意如何不让这四个必要条件成立，如何确</span></div><div><span style="font-size: 16px;">定资源的合理分配算法，避免进程永久占据系统资源。此外，也要防止进程在处于等待状态</span></div><div><span style="font-size: 16px;">的情况下占用资源。因此，对资源的分配要给予合理的规划。</span></div><div><span style="font-size: 16px;"><br/></span></div><div><hr/></div><div><b><font size="4"><span>银行家算法：</span></font></b></div><div><span style="font-size: 16px;">银行家算法（Banker's Algorithm）是一个<b>避免死锁</b>（Deadlock）的著名算法，是由艾兹格·迪杰斯特拉在1965年为T.H.E系统设计的一种避免死锁产生的算法。</span></div><div><span style="font-size: 16px;">它以银行借贷系统的分配策略为基础，判断并保证系统的安全运行。</span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">银行家算法是一种最有代表性的避免死锁的算法。在避免死锁方法中允许进程动态地申请资源，但系统在进行资源分配之前，<b>应先计算此次分配资源的安全性</b>，<b>若分配不会导致系统进入不安全状态，则分配</b>，<b>否则等待</b>。为实现银行家算法，系统必须设置若干数据结构。（先评估分配的安全性，如果不安全（不存在安全的序列），则不分配；否则则分配）</span></div><div><span style="font-size: 16px;"><br/></span></div></div><br/><div><table bgcolor="#D4DDE5" border="0" width="100%"><tr><td><h1>如何实现多线程之间的通讯和协作</h1><b>来源网址：</b> <a href="https://zhuanlan.zhihu.com/p/28049003">https://zhuanlan.zhihu.com/p/28049003</a><br/><b>作者：</b> 958340585@qq.com<br/></td></tr></table></div><div><div>如何实现多线程之间的通讯和协作</div><div><br/></div><div>利用同步和互斥来解决多线程之间的通讯和协作；可以说资源互斥、协调竞争是要解决的因，而同步是竞争协调的果。</div><div><br/></div><div>- 通过synchronized/notify/notifyAll来实现线程之间的通信。</div><div>- 利用了Java5中提供的Lock/Condition来实现线程之间的相互通信。</div><div>- 使用信号量，如：CyclicBarrier/Semaphore/Countdownbatch。</div></div><br/><div><table bgcolor="#D4DDE5" border="0" width="100%"><tr><td><h1>JVM 内存模型</h1><b>作者：</b> 958340585@qq.com<br/></td></tr></table></div><div><div>主内存</div><div><br/></div><div>工作内存</div><div><br/></div></div><br/><div><table bgcolor="#D4DDE5" border="0" width="100%"><tr><td><h1>Java NIO</h1><b>作者：</b> 958340585@qq.com<br/></td></tr></table></div><div><div>一、Java NIO与IO</div><div><br/></div><div>IO：阻塞IO</div><div>NIO：非阻塞IO</div><div><hr/></div><div>二、NIO</div><div>关键概念：</div><div>Channel</div><div><br/></div><div>Buffer</div><div><br/></div><div>Selector</div><div><br/></div><div><hr/></div><div>三、NIO原理</div><div><br/></div><div>多路复用 select机制</div><div><br/></div></div><br/><div><table bgcolor="#D4DDE5" border="0" width="100%"><tr><td><h1>红黑树简介</h1><b>来源网址：</b> <a href="http://blog.csdn.net/mmshixing/article/details/51692892">http://blog.csdn.net/mmshixing/article/details/51692892</a><br/><b>作者：</b> 958340585@qq.com<br/></td></tr></table></div><div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 19px;"><b>Red Black Tree是一种自平衡的二叉查找树。（相比于AVL平衡二叉查找树，相当于是放低了平衡性的要求，AVL树是左右子树高度差为1，而RBT则要求宽松一些，但是换来的则是RBT在树的结构调整后，只需要进行很少的旋转操作）</b></span></span></span></div><div><b><span style="font-size: 19px;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><br/></span></span></span></b></div><div><b><span style="font-size: 19px;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><br/></span></span></span></b></div><div><img src="常见面试基础题_files/750px-Red-black_tree_example.svg [2].png" type="image/png" data-filename="750px-Red-black_tree_example.svg.png" style="height: auto;"/></div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-size: 16px;"><b>但是提出了为节点增加颜色，红黑是用非严格的平衡来换取增删节点时候旋转次数的降低，任何不平衡都会在三次旋转之内解决，而AVL是严格平衡树，因此在增加或者删除节点的时候，根据不同情况，旋转的次数比红黑树要多。所以红黑树的插入效率更高！！！</b></span></div><div><br/></div><div><hr/></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 19px;"><b>红黑树相比AVL树的优势在哪里？</b></span></span></span></div><div><span style="font-size: 16px;"><br/></span></div><ul><li><span style="font-size: 16px;">如果插入一个node引起了树的不平衡，AVL和RB-Tree都是最多只需要2次旋转操作，即两者都是O(1)；但是在删除node引起树的不平衡时，最坏情况下，AVL需要维护从被删node到root这条路径上所有node的平衡性，因此需要旋转的量级O(logN)，而RB-Tree最多只需3次旋转，只需要O(1)的复杂度。</span></li><li><span style="font-size: 16px;">其次，AVL的结构相较RB-Tree来说更为平衡，在插入和删除node更容易引起Tree的unbalance，因此在大量数据需要插入或者删除时，AVL需要rebalance的频率会更高。因此，RB-Tree在需要大量插入和删除node的场景下，效率更高。自然，由于AVL高度平衡，因此AVL的search效率更高。</span></li><li><span style="font-size: 16px;">红黑树的查询性能略微逊色于AVL树，因为他比avl树会稍微不平衡最多一层，也就是说红黑树的查询性能只比相同内容的avl树最多多一次比较，但是，红黑树在插入和删除上完爆avl树，avl树每次插入删除会进行大量的平衡度计算，而红黑树为了维持红黑性质所做的红黑变换和旋转的开销，相较于avl树为了维持平衡的开销要小得多。</span></li><li><span style="font-size: 16px;">AVL更平衡，结构上更加直观，时间效能针对读取而言更高；维护稍慢，空间开销较大。红黑树，读取略逊于AVL，维护强于AVL，空间开销与AVL类似，内容极多时略优于AVL，维护优于AVL。基本上主要的几种平衡树看来，红黑树有着良好的稳定性和完整的功能，性能表现也很不错，综合实力强，在诸如STL的场景中需要稳定表现。</span></li></ul><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">红黑树是每个节点都带有颜色属性的二叉查找树，颜色或红色或黑色。在二叉查找树强制一般要求以外，红黑树有如下要求：</span></div><div><span style="font-size: 16px;"><br/></span></div><ul><li><span style="font-size: 16px;">性质1：节点是黑色或者红色</span></li><li><span style="font-size: 16px;">性质2：根节点是黑色</span></li><li><span style="font-size: 16px;">性质3：每个叶结点（NIL节点，空节点）是黑色</span></li><li><span style="font-size: 16px;">性质4：每个红色节点的两个子节点都是黑色（每条根到叶子结点的路径上不能有两个连续的红色节点）</span></li><li><font size="4">性质5：从任一节点到其每个叶子节点的所有的路径都包含相同数目的黑色节点</font></li></ul><div><span style="font-size: 16px;"><br/></span></div><div><br/></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><span style="color: rgb(255, 0, 0);"><b>上述性质约束让红黑树具有一个非常的关键性质：从根到叶子的最长的可能路径不多于最短的可能路径的两倍长。</b></span></span></span></div><div><b><span style="font-size: 16px;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><br/></span></span></span></b></div><div><b><span style="font-size: 16px;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);">The shortest possible path has all black nodes, and the longest possible path alternates between red and black nodes. Since all maximal paths have the same number of black nodes, by property 5, this shows that no path is more than twice as long as any other path.</span></span></span></b></div><div><br/></div><div>最短的路径上全部都是黑色节点，最长的路径上黑色红色交叉出现。因为性质5，所有路径都有相同的黑色节点，因此不存在任何一条路径的长度比其他路径的两倍还长。</div></div><br/><div><table bgcolor="#D4DDE5" border="0" width="100%"><tr><td><h1>JVM 类加载机制</h1><b>作者：</b> 958340585@qq.com<br/></td></tr></table></div><div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><span style="font-size: 19px;"><b>一、类加载的全过程</b></span></span></span></div><div><br/></div><div>Java虚拟机中类加载的全过程为以下的五个阶段</div><div><br/></div><div><b>加载阶段  ---&gt; 验证阶段  ----&gt; 准备阶段  -----&gt;   解析阶段  -----&gt;  初始化阶段</b></div><div><br/></div><ul><li><span style="font-size: 16px;"><b>加载阶段</b>：</span></li></ul><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">虚拟机完成三件事：</span></div><ol><li><span style="font-size: 16px;">通过一个类的全限定名来获取定义此类的二进制字节流（类加载器ClassLoader就是干这件事的）</span></li><li><span style="font-size: 16px;">将这个字节流所代表的静态存储结构转换为方法区的运行时数据结构</span></li><li><span style="font-size: 16px;">在内存中生成一个代表这个类的java.lang.Class对象，作为方法区这个类的各种数据的访问入口</span></li></ol><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;"><br/></span></div><ul><li><span style="font-size: 16px;"><b>验证阶段：</b></span></li></ul><div><span style="font-size: 16px;">验证阶段是连接阶段的第一步，这一阶段的目的是为了确保Class文件的字节流包含的信息符合当前虚拟机的要求，并且不会危害虚拟机本身的安全。</span></div><div><span style="font-size: 16px;"><br/></span></div><ul><li><span style="font-size: 16px;"><b>准备阶段：</b></span></li></ul><div><span style="font-size: 16px;">准备阶段是正式为类变量分配内存并设置类变量初始值的阶段，这些变量所使用的内存都将在方法区中进行分配。</span></div><div><span style="font-size: 16px;">注意：首先这时候进行内存分配的仅仅包括类变量（static修饰的变量），而不包含类实例变量，实例变量将会在对象实例化时随着对象一起分配在堆内存中。其次，这里所说的初始值是数据类型的零值，</span></div><div><span style="font-size: 16px;">public static int val = 123;</span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">准备阶段，在方法区为类分配内存是将val赋值为零值，而val赋值123的指令putstatic则是在程序编译后，存放于&lt;clinit&gt;()方法中，这一步是初始化阶段进行的。</span></div><div><span style="font-size: 16px;"><br/></span></div><ul><li><span style="font-size: 16px;"><b>解析阶段</b>：</span></li></ul><div><span style="font-size: 16px;">虚拟机将常量池内的符号引用替换为直接引用的过程。</span></div><div><span style="font-size: 16px;"><br/></span></div><ul><li><span style="font-size: 16px;"><b>初始化阶段：</b></span></li></ul><div><span style="font-size: 16px;">初始化阶段是类加载过程的最后一步，前面的类加载过程中，除了在加载阶段用户应用程序可以通过自定义类加载器参与之外，其余动作完全由虚拟机主导和控制。到了初始化阶段，才真正开始执行类中定义的Java程序代码（字节码）。</span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">执行clinit&lt;&gt;方法。</span></div><div><br/></div><div><hr/></div><div><br/></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 19px;"><span style="color: rgb(255, 0, 0);"><b>二、类和类加载器</b></span></span></span></div><div><br/></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>类加载器：通过一个类的全限定名来获取此类的二进制字节流。</b></span></span></span></div><div><br/></div><div>对于任何一个类，都需要由它加载它的类加载器和这个类本身一同确定其在Java虚拟机中的唯一性，每一个类加载器都拥有一个独立的类名称空间。换句话说，比较两个类是否相等，只有在这两个类是由同一个类加载器加载的前提下才有意义，否则即使两个类来源于同一个class文件，被同一个虚拟机加载，只要加载他们的类加载器不相同，那么这两个类就不相等。</div><div><br/></div><div>相等包括代表类的Class对象的equals、isAssgnableFrom、instanceof 方法返回的结果。</div><div><br/></div><div><hr/></div><div><br/></div><div><br/></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 19px;"><b>三、双亲委托模型（Parents Delegate Model）</b></span></span></span></div><div><br/></div><div><span style="font-size: 16px;"><b>类加载器的这种层次关系，成为类加载器的双亲委托模型。</b></span></div><div><b><span style="font-size: 16px;"><br/></span></b></div><div><span style="font-size: 16px;"><b>双亲委托模型要求除了顶层的启动类加载器外，其余的类加载器都有应该有自己的父类加载器。这里类记载器的关系一般不是以继承的关系来实现，而是通过组合的关系来复用父类加载器的代码。</b></span></div><div><span style="font-size: 16px;"><b><br/></b></span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>双亲委托模型的工作过程：</b></span></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>如果一个类加载器收到了类加载的请求，它首先不会自己去尝试加载这个类，而是把这个请求委派给父类加载器去完成，每一个层次的类加载器都是如此，因此所有的类加载请求都应该传送到顶层的Bootstrap类加载器中，只有当父类加载器反馈自己无法完成这个加载请求（它的搜索范围中没有找到这个所需的类），子加载器才会尝试自己去加载。</b></span></span></span></div><div><span style="font-size: 16px;"><b><br/></b></span></div><div><span style="font-size: 16px;"><b>使用PDM组织类加载器之间的关系时，有一个显而易见的好处：java类随着它的类加载器一起具备了一种带有优先级的层次关系。</b></span></div><div><span style="font-size: 16px;"><b>例如：rt.jar包中的java.lang.Object，无论是哪一个类加载器去加载，最后都会委托到顶层的Bootstrap类加载器，这样保证在各种类加载环境下，Object都是同一个类。</b></span></div><div><br/></div><div><br/></div><div>系统类加载器：</div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b><br/></b></span></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>Bootstrap ClassLoader:负责加载JAVA_HOME/lib下面的类库，例如rt.jar，开发者不能使用这个类加载器</b></span></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>Extention ClassLoader：负责加载JAVA_HOME/lib/ext下面的类库，开发者可以直接使用这个类加载器</b></span></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>Application ClassLoader：负载加载用户类路径下的类（ClassPath），开发者可以直接使用这个类加载器</b></span></span></span></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><hr/></div><div><br/></div><div><br/></div></div><br/><div><table bgcolor="#D4DDE5" border="0" width="100%"><tr><td><h1>所有的域声明为final，可以让一个类成为Immuatble的吗？</h1><b>来源网址：</b> <a href="http://javarevisited.blogspot.hk/2017/04/does-making-all-fields-final-makes-a-class-Immutable-in-Java.html">http://javarevisited.blogspot.hk/2017/04/does-making-all-fields-final-makes-a-class-Immutable-in-Java.html</a><br/><b>作者：</b> 958340585@qq.com<br/></td></tr></table></div><div><div>首先答案是否定的。</div><div><br/></div><div><hr/></div><div><span style="font-size: 16px;"><b>如果某个域是可变对象的引用，虽然引用的final的，但是指向的对象仍然是可变的，如果将该引用暴露出去（提供get set方法），那么类的不可变性就会被打破。</b></span></div><div><span style="font-size: 16px;"><b><br/></b></span></div><div><span style="font-size: 16px;"><b>常见的例子就是：有一个final修饰的引用，该引用指向一个数组Array或者Collection，且提供暴露该引用的get set方法。</b></span></div><div><br/></div><div>例如：</div><div><br/></div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>class Person{</div><div>private final String name;</div><div>private final Date birthday;</div><div>private final List hobbies;</div><div><br/></div><div>public Person(String name, Date birthday, List hobbies){</div><div>this.name = name; this.birthday = birthday; this.hobbies = hobbies;</div><div>}</div><div><br/></div><div>public String getName() {</div><div>return name;</div><div>}</div><div><br/></div><div>public Date getBirthday() {</div><div>return birthday;</div><div>}</div><div><br/></div><div>public List getHobbies() {</div><div>return hobbies;</div><div>}</div><div> </div><div>@Override public String toString() {</div><div>return &quot;Person [name=&quot; + name + &quot;, birthday=&quot; + birthday + &quot;, hobbies=&quot; + hobbies + &quot;]&quot;;</div><div>}</div><div><br/></div><div>}</div></div><div><br/></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(227, 0, 0);"><span style="font-size: 19px;"><b>该Person类虽然域都声明为final，但是仍然不是不可变对象。</b></span></span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(227, 0, 0);"><span style="font-size: 19px;"><b>解决办法就是：</b></span></span></span></div><ol><li><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(227, 0, 0);"><span style="font-size: 19px;"><b>对于那些final修饰的可变对象的引用，不提供对外的get set方法。</b></span></span></span></li><li><font color="#E30000"><span style="font-size: 19px;"><b>如果必须提供get方法，那么就返回一份copy。</b></span></font></li></ol><div><br/></div><div><hr/></div><div><b><span style="font-size: 19px;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(227, 0, 0);">所有域都是final的  --/--&gt; 类是不可变的</span></span></span></b></div><div><b><span style="font-size: 19px;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(227, 0, 0);">类是不可变的         ------&gt; 所有域都是final的</span></span></span></b></div><div><b><span style="font-size: 19px;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(227, 0, 0);">所有域声明为final只是类是不可变的必要条件，而非充分条件。 </span></span></span></b></div><div><br/></div><div><b><span style="font-size: 19px;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(227, 0, 0);"><br/></span></span></span></b></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 19px;"><span style="color: rgb(227, 0, 0);"><b>如何保证不可变性？（根据《并发编程实践》）</b></span></span></span></div><ol><li><span style="color: rgb(227, 0, 0);"><span style="font-size: 19px;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b>所有域都声明为final</b></span></span></span></li><li><font color="#E30000"><span style="font-size: 19px;"><b>对象一经创建其状态就不再修改</b></span></font></li><li><font color="#E30000"><span style="font-size: 19px;"><b>对象正确的被创建（创建过程中，this引用没有逸出）</b></span></font></li></ol><div><b><span style="font-size: 19px;"><span style="color: rgb(227, 0, 0);"><br/></span></span></b></div><div><font color="#E30000"><span style="font-size: 19px;"><b>---------</b></span></font></div><div><b><span style="font-size: 19px;"><span style="color: rgb(227, 0, 0);"><br/></span></span></b></div><div><b><span style="font-size: 19px;"><span style="color: rgb(227, 0, 0);">不可变对象的好处：</span></span></b></div><div><br/></div><ol><li>线程安全，不用同步；</li><li>不可变对象非常适合用来作为Map的Key或者Set的元素，因为它们一经创建便不再改变</li><li>不可变对象可以被缓存，因为这些不可变对象不会改变。</li></ol><div><br/></div><div><br/></div><div><br/></div></div><br/><div><table bgcolor="#D4DDE5" border="0" width="100%"><tr><td><h1>TCP三次握手和四次挥手</h1><b>来源网址：</b> <a href="https://www.cnblogs.com/xiaoming0601/p/6001021.html">https://www.cnblogs.com/xiaoming0601/p/6001021.html</a><br/><b>作者：</b> 958340585@qq.com<br/></td></tr></table></div><div><div>TCP报文结构：</div><div><br/></div><div><img src="常见面试基础题_files/Image [18].png" type="image/png" data-filename="Image.png" style="height: auto;" title="Attachment"/><br/></div><div><br/></div><div><span style="font-size: 19px;">TCP报文根据标志位来区分报文的意图；比如 连接报文、连接确认报文、请求断开报文等等；</span></div><div><span style="font-size: 19px;">标志位常见的有：</span></div><div><span style="font-size: 19px;"><span style="font-size: 19px; font-weight: bold;">SYN</span></span></div><div><span style="font-size: 19px;"><span style="font-size: 19px; font-weight: bold;">ACK</span></span></div><div><span style="font-size: 19px;"><span style="font-size: 19px; font-weight: bold;">FIN</span></span></div><div>PSH</div><div>RST</div><div><br/></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 19px; background-color: rgb(255, 250, 165); font-weight: bold;-evernote-highlight:true;">TCP通信分为三个阶段：</span></span></div><ol><li><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 19px; background-color: rgb(255, 250, 165); font-weight: bold;-evernote-highlight:true;">连接建立</span></span></li><li><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 19px; background-color: rgb(255, 250, 165); font-weight: bold;-evernote-highlight:true;">数据传输</span></span></li><li><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 19px; background-color: rgb(255, 250, 165); font-weight: bold;-evernote-highlight:true;">连接断开</span></span></li></ol><div><br/></div><div>而三次握手是发生在阶段1：</div><div>具体包含哪三次握手呢？</div><div><br/></div><ul><li><span style="font-size: 21px;"><span style="font-size: 21px; font-weight: bold;">三次握手</span></span></li></ul><div><br/></div><div>第一次握手：主机A发送一个TCP连接请求报文（seq=x, SYN=1），进入 SYN_SEND状态</div><div>第二次握手：主机B接收到A的TCP连接请求报文，发送一个TCP连接确认报文（seq = y, ack=x+1,SYN=1, ACK=1） B进入SYN_RECV状态</div><div>第三次握手：主机A发送一个TCP确认报文（seq = x+1, ack = y+1, ACK=1）A发送便进入ESTABLISHED状态，B收到该报文后也进入ESTABLISHED状态</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>见如下图：</div><div><img src="常见面试基础题_files/Image [19].png" type="image/png" data-filename="Image.png" style="height: auto;" title="Attachment"/><br/></div><div><br/></div><div><br/></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><span style="background-color: rgb(255, 250, 165); font-size: 16px; font-weight: bold;-evernote-highlight:true;">注意区分ack和ACK不是一回事；ack是序号，ACK是标志位</span></span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><span style="background-color: rgb(255, 250, 165); font-size: 16px; font-weight: bold;-evernote-highlight:true;">ack是将当前收到的报文的seq加1；（也就是说希望下一次接受到seq号）</span></span></span></div><div><br/></div><div>ack：确认序号；</div><div>seq：发送序号；</div><div><br/></div><div>为什么是三次握手，因为两次会出现下面的问题，而四次有点多余。</div><div><br/></div><div><span style="font-size: 16px;"><span style="letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); float: none; font-size: 16px; display: inline !important; color: rgb(0, 0, 0); font-family: verdana, &quot;ms song&quot;, 宋体, Arial, 微软雅黑, Helvetica, sans-serif; font-style: normal; font-weight: 400;">谢希仁版《计算机网络》中的例子是这样的，已失效的连接请求报文段的产生在这样一种情况下：client发出的第一个连接请求报文段并没有丢失，而是在某个网络结点长时间的滞留了，以致延误到连接释放以后的某个时间才到达server。本来这是一个早已失效的报文段。但server收到此失效的连接请求报文段后，就误认为是client再次发出的一个新的连接请求。于是就向client发出确认报文段，同意建立连接。假设不采用三次握手，那么只要server发出确认，新的连接就建立了。由于现在client并没有发出建立连接的请求，因此不会理睬server的确认，也不会向server发送数据。但server却以为新的运输连接已经建立，并一直等待client发来数据。这样，server的很多资源就白白浪费掉了。采用三次握手的办法可以防止上述现象发生。例如刚才那种情况，client不会向server的确认发出确认。server由于收不到确认，就知道client并没有要求建立连接。</span></span></div><div><br/></div><ul><li><span style="font-size: 21px;"><span style="font-size: 21px; font-weight: bold;">四次挥手</span></span></li></ul><div><br/></div><div><img src="常见面试基础题_files/Image [20].png" type="image/png" data-filename="Image.png" style="height: auto;" title="Attachment"/><br/></div><div><br/></div><div><br/></div><div>四次挥手的过程：</div><div><br/></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><span style="background-color: rgb(255, 250, 165); font-size: 16px; font-weight: bold;-evernote-highlight:true;">第一次：主机A发送一个TCP请求关闭的报文（FIN=1, seq = u），随后A进入FIN-WAIT-1状态，</span></span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><span style="background-color: rgb(255, 250, 165); font-size: 16px; font-weight: bold;-evernote-highlight:true;">第二次：主机B收到该报文后，会对该报文进行一次确认，发送一个确认报文（seq=v, ack=u+1, ACK=1），随机进入CLOSE-WAIT状态；由于主机B可能还有数据</span></span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><span style="background-color: rgb(255, 250, 165); font-size: 16px; font-weight: bold;-evernote-highlight:true;">没有发送完，随后B就发送主机的数据；主机A收到TCP请求关闭确认报文后，进入FIN-WAIT-2状态</span></span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><span style="background-color: rgb(255, 250, 165); font-size: 16px; font-weight: bold;-evernote-highlight:true;">第三次：主机B数据发送完毕后，发送一个TCP请求关闭确认报文（FIN=1, ACK=1, ack=u+1, seq = w），随机B进入LAST-ACK状态</span></span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><span style="background-color: rgb(255, 250, 165); font-size: 16px; font-weight: bold;-evernote-highlight:true;">第四次：A收到报文后，发送一个确认报文(ACK=1, seq=u+1，ack=w+1），随机进入TIME-WAIT状态，随后主机A等待2MSL时间，如果期间主机B没有发来任何报文，进入CLOSED状态；主机B收到确认报文后，进入CLOSED状态；</span></span></span></div><div><br/></div><div style="margin: 10px auto; padding: 0px; text-indent: 0px; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198);"><span style="font-size: 16px; color: rgb(0, 0, 0); font-family: verdana, &quot;ms song&quot;, 宋体, Arial, 微软雅黑, Helvetica, sans-serif; font-style: normal; font-weight: 400;">A为什么等待2MSL，从TIME_WAIT到CLOSE？</span></div><div style="margin: 10px auto; padding: 0px; text-indent: 0px; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198);"><div><span style="font-size: 16px; color: rgb(0, 0, 0); font-family: verdana, &quot;ms song&quot;, 宋体, Arial, 微软雅黑, Helvetica, sans-serif; font-style: normal; font-weight: 400;"> 在Client发送出最后的ACK回复，但该ACK可能丢失。Server如果没有收到ACK，将不断重复发送FIN片段。所以Client不能立即关闭，它必须确认Server接收到了该ACK。Client会在发送出ACK之后进入到TIME_WAIT状态。Client会设置一个计时器，等待2MSL的时间。如果在该时间内再次收到FIN，那么Client会重发ACK并再次等待2MSL。所谓的2MSL是两倍的MSL(Maximum Segment Lifetime)。MSL指一个片段在网络中最大的存活时间，2MSL就是一个发送和一个回复所需的最大时间。如果直到2MSL，Client都没有再次收到FIN，那么Client推断ACK已经被成功接收，则结束TCP连接。</span></div></div><div><br/></div><div><br/></div><div><br/></div><div><hr/></div><div><br/></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><span style="font-size: 16px;"><b>TCP流量控制机制</b></span></span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><span style="font-size: 16px;"><b>滑动窗口</b></span></span></span></div><div><ul><li><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><span style="font-size: 16px;"><b>接收端的接收窗口</b></span></span></span></li><li><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><span style="font-size: 16px;"><b>发送端的发送端口</b></span></span></span></li></ul><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><span style="font-size: 16px;"><b>接收端返回的ACK包里面含有自己的窗口大小，因此发送端会根据接受端的窗口大小和ack包的ack号来决定当前的数据是否发送。</b></span></span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><span style="font-size: 16px;"><b>从而达到流量控制的目的。</b></span></span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><span style="font-size: 16px;"><b><br/></b></span></span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><span style="font-size: 16px;"><b>TCP拥塞控制</b></span></span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><span style="font-size: 16px;"><b>拥塞窗口 cwnd</b></span></span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><span style="font-size: 16px;"><b><br/></b></span></span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><span style="font-size: 16px;"><b>几种机制</b></span></span></span></div><div><ul><li><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><span style="font-size: 16px;"><b>慢启动：cwnd先是double增加，超过阈值ssthresh后，cwnd开始缓慢增加，进入拥塞控制算法，发现拥塞时，阈值降为一半，cwnd=1，启用慢启动算法。</b></span></span></span></li><li><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><span style="font-size: 16px;"><b>拥塞避免：</b></span></span></span></li><li><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><span style="font-size: 16px;"><b>快重传：当接受方收到乱序的报文时，立刻对前面收到的正确的最后一个报文进行重复确认，发送方收到连续三个同样的ack后，不用等到重传倒计时timeout，直接快速重新传送丢失的报文。</b></span></span></span></li></ul><div><br/></div><div><br/></div><div><br/></div></div><div><br/></div></div><div><br/></div></div><br/><div><table bgcolor="#D4DDE5" border="0" width="100%"><tr><td><h1>Spring MVC概述</h1><b>作者：</b> 958340585@qq.com<br/></td></tr></table></div><div><ul><li><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 19px;"><b>一、Spring 请求处理流程和关键类</b></span></span></span></li></ul><div><br/></div><div><img src="常见面试基础题_files/Image [21].png" type="image/png" data-filename="Image.png" style="height: auto;"/></div><div><br/></div><div><br/></div><div><hr/></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>DispatchServlet初始化后，会生成HandlerMapping，这样收到请求后，可以将请求和能够处理该请求的Handler对应起来。</b></span></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b><br/></b></span></span></span></div><ol><li><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>首先用户发送请求，DispatchServlet(以下简称DS)收到请求后，获取得到HandlerMapping（以下简称HM）</b></span></span></span></li><li><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>DS通过HM将请求映射为HandlerExecutionChain(简称HEC)，HEC包含一个Handler处理器（也就是常见的页面控制器Controller，多个相关的HandlerInterceptor）</b></span></span></span></li><li><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>然后DS根据获得的HEC生成对应的HandlerAdapter(简称HA)，从而支持多种类型的处理器。</b></span></span></span></li><li><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>HA然后调用Handler的请求处理方法</b></span></span></span></li><li><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>Handler执行完毕后，返回一个ModelAndView(简称MAV)对象（包含模型数据、逻辑视图名）</b></span></span></span></li><li><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>MAV通过ViewResolver将逻辑视图名解析为具体的View对象，通过这种方式，Spring MVC支持多种试图渲染技术</b></span></span></span></li><li><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>DS将视图渲染的工作委托给View对象，View根据传进来的Model模型数据进行数据渲染，此处的Model实际是一个Map数据结构</b></span></span></span></li><li><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>然后控制权给DS，由DS将Response返回给用户，到此一个流程结束</b></span></span></span></li></ol><div><br/></div><div><hr/></div><div>核心类：</div><div><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b><br/></b></span></span></span></div><ol><li><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>DispatchServlet</b></span></span></span></li><li><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>HandlerMapping</b></span></span></span></li><li><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>HandlerExecutionChain</b></span></span></span></li><li><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>HandlerInterceptor</b></span></span></span></li><li><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>HandlerAdapter</b></span></span></span></li></ol><div><br/></div><div><hr/></div><div><br/></div><div><br/></div><div><br/></div><ul><li><br/></li></ul></div><br/><div><table bgcolor="#D4DDE5" border="0" width="100%"><tr><td><h1>Spring IoC概述</h1><b>来源网址：</b> <a href="http://paine1690.github.io/2016/12/31/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(2)%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/">http://paine1690.github.io/2016/12/31/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(2)%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/</a><br/><b>作者：</b> 958340585@qq.com<br/></td></tr></table></div><div><div><span style="font-size: 19px;"><b>一 、依赖注入</b></span></div><div><span style="font-size: 15px;"><br/></span></div><div><span style="font-size: 15px;">DI和Factory Pattern：都是关于对象创建的过程。</span></div><div><br/></div><div>区别在于：</div><div>工厂模式虽然让类实例的创建和依赖解耦，但是却和Factory耦合在一起了，每一个类的实例的创建都需要调用XxxFactory.getInstance()，这是一种新的强依赖；</div><div><br/></div><div>DI模式通过将<span style="font-size: 16px;"><b>依赖获取的职责反转</b></span>（IoC），原来是类的实例的创建，需要使用者自己去获取先关依赖的实例，而控制反转却让程序的外部去获取这些依赖实例，而内部程序直接使用。</div><div>这种由内到外的控制权的转移，就是控制反转的意思，被反转的是获取依赖的职责，以前是使用者的职责，现在是使用者的外部（第三方，IoC容器）的职责。</div><div><span style="font-size: 15px;"><br/></span></div><div>1.工厂模式耦合了对象和工厂，对象需要一个工厂对象，然而通过DI，对象仅仅知道依赖是什么，不需要知道其他东西（例如Factory实例）的存在就可以得到相应的依赖的实例。</div><div><br/></div><div>2.和工厂模式相比，DI让单元测试更加简单</div><div><br/></div><div>3.和工厂模式相比DI的一个缺点就是需要一个IoC容器，并且需要配置依赖注入（对象之间的依赖关系，Spring中就是基于XML或者基于注解的方式），而这些工厂模式是不需要的。</div><div><br/></div><div>4. 因为低耦合，DI写出来的代码看起来比工厂模式简洁。对象看起来就像POJO，通过观察对象使用的哪种方式进行的依赖注入，也可以看到那些依赖是必须的，而哪些确实可选的。</div><div><br/></div><div>如果一个依赖通过Setter方式注入进来，这意味着这是可选的，并且任何时候都可以被注入进来；然而使用构造器注入的依赖确实必须的，仅仅是按照构造器参数被声明的顺序被注入。</div><div><span style="font-size: 15px;"><br/></span></div><div><img src="常见面试基础题_files/Image [22].png" type="image/png" data-filename="Image.png" style="height: auto;"/></div><div><span style="font-size: 15px;"><br/></span></div><div><span style="font-size: 15px;">DI里面最重要的便是IoC容器，它负责管理这些依赖关系，并根据这些依赖关系正确的将依赖注入到我们的实例中，常见的IoC容器有：Spring、Google Guice等</span></div><div><span style="font-size: 15px;"><br/></span></div><div><span style="font-size: 15px;"><br/></span></div><div><span style="font-size: 19px;"><b>二、Sping IoC容器的初始化过程：</b></span></div><div><span style="font-size: 15px;"><br/></span></div><div>Spring可以算是业界的IoC容器的标准了，因此看看Spring的 IoC容器的实现原理。</div><div><br/></div><div>IoC容器的一般过程大致分为：</div><div><br/></div><div><b>获取依赖关系的定义 ----&gt; 反射实例化对象 --&gt; 通过依赖关系将依赖注入到对象中</b></div><div><br/></div><div>先看看Spring 中依赖注入的用法：</div><div><br/></div><div>Spring IoC容器将管理的对象实例称之为Bean，依赖关系的声明有哪几种方式：</div><div><br/></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>- 基于XML文件显示配置</b></span></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>- Java代码中显示配置</b></span></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>- 隐式的Bean发现机制和自动装配（@Component和@Autowire）</b></span></span></span></div><div><br/></div><div><br/></div><div>另外依赖注入的方式有如下几种：</div><div><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b>- set注入</b></span></span></div><div><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b>- 构造器注入</b></span></span></div><div><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b>- 静态工厂方法注入</b></span></span></div><div><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b>- 实例工厂方法注入</b></span></span></div><div><br/></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;"><b>Set注入和构造器注入的区别：</b></span></span></div><div><br/></div><div><span style="font-size: 16px;"><b>使用构造函数依赖注入时，Spring保证所有一个对象所有依赖的对象先实例化后，才实例化这个对象。（没有他们就没有我原则）</b></span><span style="font-size: 16px;"><b>使用set方法依赖注入时，Spring首先实例化对象，然后才实例化所有依赖的对象。</b></span></div><div><br/></div><div>示例1：</div><div>基于XML的依赖关系的声明：</div><div><br/></div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div>&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</div><div>       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div>       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</div><div>       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans</div><div>http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</div><div>http://www.springframework.org/schema/context</div><div>http://www.springframework.org/schema/context/spring-context-3.0.xsd&quot;&gt;</div><div>   &lt;!-- set方法注入 --&gt;</div><div>    &lt;bean id=&quot;car&quot; class=&quot;dlut.springdemo.Car&quot;&gt;</div><div>        &lt;property name=&quot;tire&quot; ref=&quot;tire&quot;&gt;&lt;/property&gt;</div><div>    &lt;/bean&gt;</div><div><br/></div><div>    &lt;bean id=&quot;tire&quot; class=&quot;dlut.springdemo.Tire&quot;&gt;</div><div>     &lt;constructor-arg name=&quot;size&quot; value=&quot;50&quot;&gt;&lt;/constructor-arg&gt;</div><div>    &lt;/bean&gt;</div><div><br/></div><div>    &lt;!-- 构造器注入 --&gt;</div><div>    &lt;bean id = &quot;truck&quot; class = &quot;dlut.springdemo.Truck&quot;&gt;</div><div>     &lt;constructor-arg name=&quot;tire&quot; ref=&quot;tire&quot;&gt;&lt;/constructor-arg&gt;</div><div>    &lt;/bean&gt;</div><div>&lt;/beans&gt;</div></div><div><br/></div><div>示例2：</div><div>自动装配</div><div><br/></div><div><ul style="list-style: none; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><li style="list-style: circle;">组建扫描（component scanning）：Spring会自动发现应用上下文中锁创建的bean</li><li style="list-style: circle;">自动装载（autowiring）：Spring自动满足bean之间的依赖</li></ul><div style="list-style: circle;"><div><br/></div><div><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">这两个分别对应了注解@Component和@Autowiring</p><ul style="list-style: none; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><li style="list-style: circle;">@Component：这个注解表明该类会作为组件类，并告知Spring要为这个类创建bean</li><li style="list-style: circle;">@AutoWiring：可以用在构造方法或set方法上，表明注入一个依赖</li></ul><div style="list-style: circle;"><div><br/></div><div><br/></div></div></div></div></div><div>set注入：</div><div><br/></div><div align="left" style="min-height: 14pt;"><font color="#646464" face="Consolas"><span style="font-size:12pt">@Component</span></font><font face="Consolas"><span style="font-size:12pt">(</span></font><font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;house&quot;</span></font><font face="Consolas"><span style="font-size:12pt">)</span></font></div><div align="left" style="min-height: 14pt;"><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>class</b></span></font> <font face="Consolas"><span style="font-size:12pt">House {</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#646464" face="Consolas"><span style="font-size:12pt">@Autowired</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>private</b></span></font> <font face="Consolas"><span style="font-size:12pt">Person</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">owner</span></font><font face="Consolas"><span style="font-size:12pt">;</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#646464" face="Consolas"><span style="font-size:12pt">@</span><span style="font-size:12pt; background:#d4d4d4">Override</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font face="Consolas"><span style="font-size:12pt">String toString() {</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">           </span></font><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//</span></font> <font color="#7F9FBF" face="Consolas"><span style="font-size:12pt"><b>TODO</b></span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">Auto-generated method stub</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">           </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>return</b></span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;House : &quot;</span></font> <font face="Consolas"><span style="font-size:12pt">+</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>this</b></span></font><font face="Consolas"><span style="font-size:12pt">.</span></font><font color="#0000C0" face="Consolas"><span style="font-size:12pt">owner</span></font><font face="Consolas"><span style="font-size:12pt">;</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font></div><div align="left" style="min-height: 14pt;"><div><font face="Consolas"><span style="font-size:12pt">}</span></font></div><div><span style="font-size: 12pt;"><span style="font-family: Consolas;"><br/></span></span></div><div align="left" style="min-height: 14pt;"><font color="#646464" face="Consolas"><span style="font-size:12pt">@Component</span></font><font face="Consolas"><span style="font-size:12pt">(</span></font><font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;house&quot;</span></font><font face="Consolas"><span style="font-size:12pt">)</span></font></div><div align="left" style="min-height: 14pt;"><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>class</b></span></font> <font face="Consolas"><span style="font-size:12pt">House {</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>private</b></span></font> <font face="Consolas"><span style="font-size:12pt">Person</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">owner</span></font><font face="Consolas"><span style="font-size:12pt">;</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#646464" face="Consolas"><span style="font-size:12pt">@Autowired</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">setPerson(Person</span></font> <font color="#6A3E3E" face="Consolas"><span style="font-size:12pt">owner</span></font><font face="Consolas"><span style="font-size:12pt">) {</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">           </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>this</b></span></font><font face="Consolas"><span style="font-size:12pt">.</span></font><font color="#0000C0" face="Consolas"><span style="font-size:12pt">owner</span></font> <font face="Consolas"><span style="font-size:12pt">=</span></font> <font color="#6A3E3E" face="Consolas"><span style="font-size:12pt">owner</span></font><font face="Consolas"><span style="font-size:12pt">;</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#646464" face="Consolas"><span style="font-size:12pt">@Override</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font face="Consolas"><span style="font-size:12pt">String toString() {</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">           </span></font><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//</span></font> <font color="#7F9FBF" face="Consolas"><span style="font-size:12pt"><b>TODO</b></span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">Auto-generated method stub</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">           </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>return</b></span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;House : &quot;</span></font> <font face="Consolas"><span style="font-size:12pt">+</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>this</b></span></font><font face="Consolas"><span style="font-size:12pt">.</span></font><font color="#0000C0" face="Consolas"><span style="font-size:12pt">owner</span></font><font face="Consolas"><span style="font-size:12pt">;</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font></div><div align="left" style="min-height: 14pt;"><div><font face="Consolas"><span style="font-size:12pt">}</span></font></div></div><div><span style="font-size: 12pt;"><span style="font-family: Consolas;"><br/></span></span></div></div><div>构造器注入：</div><div><br/></div><div align="left" style="min-height: 14pt;"><font color="#646464" face="Consolas"><span style="font-size:12pt">@Component</span></font><font face="Consolas"><span style="font-size:12pt">(</span></font><font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;house&quot;</span></font><font face="Consolas"><span style="font-size:12pt">)</span></font></div><div align="left" style="min-height: 14pt;"><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>class</b></span></font> <font face="Consolas"><span style="font-size:12pt">House {</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>private</b></span></font> <font face="Consolas"><span style="font-size:12pt">Person</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">owner</span></font><font face="Consolas"><span style="font-size:12pt">;</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#646464" face="Consolas"><span style="font-size:12pt">@</span><span style="font-size:12pt; background:#d4d4d4">Autowired</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font face="Consolas"><span style="font-size:12pt">House(Person</span></font> <font color="#6A3E3E" face="Consolas"><span style="font-size:12pt">owner</span></font><font face="Consolas"><span style="font-size:12pt">) {</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">           </span></font><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//</span></font> <font color="#7F9FBF" face="Consolas"><span style="font-size:12pt"><b>TODO</b></span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">Auto-generated constructor stub</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">           </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>this</b></span></font><font face="Consolas"><span style="font-size:12pt">.</span></font><font color="#0000C0" face="Consolas"><span style="font-size:12pt">owner</span></font> <font face="Consolas"><span style="font-size:12pt">=</span></font> <font color="#6A3E3E" face="Consolas"><span style="font-size:12pt">owner</span></font><font face="Consolas"><span style="font-size:12pt">;</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#646464" face="Consolas"><span style="font-size:12pt">@Override</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font face="Consolas"><span style="font-size:12pt">String toString() {</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">           </span></font><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//</span></font> <font color="#7F9FBF" face="Consolas"><span style="font-size:12pt"><b>TODO</b></span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">Auto-generated method stub</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">           </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>return</b></span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;House : &quot;</span></font> <font face="Consolas"><span style="font-size:12pt">+</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>this</b></span></font><font face="Consolas"><span style="font-size:12pt">.</span></font><font color="#0000C0" face="Consolas"><span style="font-size:12pt">owner</span></font><font face="Consolas"><span style="font-size:12pt">;</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left" style="min-height: 14pt;"><font face="Consolas"><span style="font-size:12pt">     </span></font></div><div align="left" style="min-height: 14pt;"><div><font face="Consolas"><span style="font-size:12pt">}</span></font></div><div><span style="font-size: 12pt;"><span style="font-family: Consolas;"><br/></span></span></div><div><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px; color: rgb(85, 85, 85); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">@Component,@Service,@Controller,@Repository</h3><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">Spring 2.5 中除了提供 @Component 注释外，还定义了几个拥有特殊语义的注释，它们分别是：</p><ul style="list-style: none; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><li style="list-style: circle;">@Repository</li><li style="list-style: circle;">@Service</li><li style="list-style: circle;">@Controller。</li></ul><div style="margin: 0px 0px 25px; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><span style="color: rgb(85, 85, 85);"><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;">在目前的 Spring 版本中，这 3 个注释和 @Component 是等效的，但是从注释类的命名上，很容易看出这 3 个注释分别和持久层、业务层和控制层（Web 层）相对应。</span></span></span></div><div><span style="color: rgb(85, 85, 85);"><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><br/></span></span></span></div><div><span style="color: rgb(85, 85, 85);"><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><br/></span></span></span></div><div><span style="color: rgb(85, 85, 85);"><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><br/></span></span></span></div><div><span style="color: rgb(85, 85, 85);"><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;">-------------------</span></span></span></div><div><span style="color: rgb(85, 85, 85);"><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><br/></span></span></span></div><div><span style="color: rgb(85, 85, 85);"><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;">依赖注入的时机：</span></span></span></div><div><span style="color: rgb(85, 85, 85);"><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><br/></span></span></span></div><div><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">在IOC容器中依赖注入的触发有两种情况</p><ul style="list-style: none; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><li style="list-style: circle;">用户第一次调用getBean方法时触发</li><li style="list-style: circle;">通过设置lazy-init属性设置让容器在初始化阶段完成预实例化</li></ul><div style="list-style: circle;"><div><br/></div><div><br/></div><div>---------------------------</div><div><br/></div><div><div style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif; font-size: 22px; color: rgb(85, 85, 85); font-style: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><br/></div><div>启动步骤</div></div><ol style="color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><li><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#Bean%E7%9A%84%E5%BB%BA%E7%AB%8B" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="Bean的建立"></a>Bean的建立</h3><p style="margin: 0px 0px 25px;">容器寻找Bean的定义信息并将其实例化。看过源码都知道，容器首先将Bean的定义信息以BeanDefinition的形式存储，等第一次getBean的时候再将其实例化并完成下面的依赖注入过程。</p></li><li><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#%E5%B1%9E%E6%80%A7%E6%B3%A8%E5%85%A5" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="属性注入"></a>属性注入</h3><p style="margin: 0px 0px 25px;">使用依赖注入，Spring将值和bean的引用注入到bean对应的属性中。</p></li><li><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#BeanNameAware%E7%9A%84setBeanName-%EF%BC%9A" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="BeanNameAware的setBeanName()："></a>BeanNameAware的setBeanName()：</h3><p style="margin: 0px 0px 25px;">如果bean实现了org.springframework.beans.BeanNameAware接口，Spring将bean的ID传递给setBeanName()方法。</p></li><li><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#BeanFactoryAware%E7%9A%84setBeanFactory-%EF%BC%9A" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="BeanFactoryAware的setBeanFactory()："></a>BeanFactoryAware的setBeanFactory()：</h3><p style="margin: 0px 0px 25px;">如果bean实现了org.springframework.beans.factory.BeanFactoryAware接口，Spring将调用setBeanName()方法，将BeanFactory容器实例传入。</p></li><li><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#BeanPostProcessors%E7%9A%84ProcessBeforeInitialization" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="BeanPostProcessors的ProcessBeforeInitialization()"></a>BeanPostProcessors的ProcessBeforeInitialization()</h3><p style="margin: 0px 0px 25px;">如果有org.springframework.beans.factory.config.BeanPostProcessors和Bean关联，那么其postProcessBeforeInitialization()方法将被将被调用。</p></li><li><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#InitializingBean%E7%9A%84afterPropertiesSet" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="InitializingBean的afterPropertiesSet()"></a>InitializingBean的afterPropertiesSet()</h3><p style="margin: 0px 0px 25px;">如果Bean类已实现org.springframework.beans.factory.InitializingBean接口，则执行他的afterProPertiesSet()方法。</p></li><li><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#Bean%E5%AE%9A%E4%B9%89%E6%96%87%E4%BB%B6%E4%B8%AD%E5%AE%9A%E4%B9%89init-method%EF%BC%9A" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="Bean定义文件中定义init-method："></a>Bean定义文件中定义init-method：</h3><p style="margin: 0px 0px 25px;">如果bean使用init-method生命了初始化方法，该方法也会被调用</p></li><li><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#BeanPostProcessors%E7%9A%84ProcessaAfterInitialization" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="BeanPostProcessors的ProcessaAfterInitialization()"></a>BeanPostProcessors的ProcessaAfterInitialization()</h3><p style="margin: 0px 0px 25px;">如果有任何的BeanPostProcessors实例与Bean实例关联，则执行BeanPostProcessors实例的ProcessaAfterInitialization()方法</p></li><li><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#%E5%B0%B1%E7%BB%AA" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="就绪"></a>就绪</h3><p style="margin: 0px 0px 25px;">此时，Bean已准备就绪，可以被应用程序使用了，它们将一直驻留在容器中，直到该容器被销毁。</p></li><li><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#DisposableBean%E7%9A%84destroy" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="DisposableBean的destroy()"></a>DisposableBean的destroy()</h3><p style="margin: 0px 0px 25px;">在容器关闭时，如果Bean类有实现org.springframework.beans.factory.DisposableBean接口，Spring将调用他的destroy()方法。</p></li><li><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#Bean%E5%AE%9A%E4%B9%89%E6%96%87%E4%BB%B6%E4%B8%AD%E5%AE%9A%E4%B9%89destroy-method" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="Bean定义文件中定义destroy-method"></a>Bean定义文件中定义destroy-method</h3><div style="margin: 0px 0px 25px;">如果bean使用destroy-method生命了初始化方法，该方法也会被调用</div></li></ol></div><div><h2 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 22px; color: rgb(85, 85, 85); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">3、总结</h2><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">这个生命周期是在是太复杂了，需要很长时间才能理清他们之间的逻辑关系。</p><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px; color: rgb(85, 85, 85); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#BeanNameAware%E3%80%81ApplicationContextAware%E5%92%8CBeanFactoryAware" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="BeanNameAware、ApplicationContextAware和BeanFactoryAware"></a><strong style="font-weight: bold;">BeanNameAware、ApplicationContextAware和BeanFactoryAware</strong></h3><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">这三个接口放在一起写，是因为它们是一组的，作用相似。</p><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">“Aware”的意思是”感知到的”，那么这三个接口的意思也不难理解：</p><ol style="color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><li>实现BeanNameAware接口的Bean，在Bean加载的过程中可以获取到该Bean的id</li><li>实现ApplicationContextAware接口的Bean，在Bean加载的过程中可以获取到Spring的ApplicationContext，这个尤其重要，ApplicationContext是Spring应用上下文，从ApplicationContext中可以获取包括任意的Bean在内的大量Spring容器内容和信息</li><li>实现BeanFactoryAware接口的Bean，在Bean加载的过程中可以获取到加载该Bean的BeanFactory</li></ol><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">从上面的调用顺序可以看出，在bean实例化并设置属性之后，紧接着就是先调用这三个接口相关的方法。</p><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px; color: rgb(85, 85, 85); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#InitialingBean%E5%92%8CDisposableBean" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="InitialingBean和DisposableBean"></a><strong style="font-weight: bold;">InitialingBean和DisposableBean</strong></h3><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">InitialingBean是一个接口，提供了一个唯一的方法afterPropertiesSet()。</p><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">DisposableBean也是一个接口，提供了一个唯一的方法destory()。</p><div style="margin: 0px 0px 25px; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><span style="color: rgb(85, 85, 85);"><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;">这两个接口是一组的，功能类似，因此放在一起：前者顾名思义在Bean属性都设置完毕后调用afterPropertiesSet()方法做一些初始化的工作，后者在Bean生命周期结束前调用destory()方法做一些收尾工作。</span></span></span></div><div><span style="color: rgb(85, 85, 85);"><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><br/></span></span></span></div><div>------------------------------</div><div><br/></div><div style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-style: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">现在bean的生命周期各个阶段应该就很清晰了，上面的步骤对应一下几个大的阶段</p><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px; color: rgb(85, 85, 85); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#%E5%AE%9E%E4%BE%8B%E5%8C%96%E4%B8%8E%E5%B1%9E%E6%80%A7" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="实例化与属性"></a>实例化与属性</h3><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">对应步骤1和2</p><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px; color: rgb(85, 85, 85); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#Aware%E7%9B%B8%E5%85%B3%E7%9A%84%E4%B8%89%E4%B8%AA%E6%96%B9%E6%B3%95" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="Aware相关的三个方法"></a>Aware相关的三个方法</h3><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">BeanNameAware、ApplicationContextAware和BeanFactoryAware三个接口的方法，对应上面的步骤3和4，应该还有一个的里面没有写上</p><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px; color: rgb(85, 85, 85); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#BeanPostProcessor%E5%90%8E%E7%BD%AE%E5%A4%84%E7%90%86%E5%99%A8" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="BeanPostProcessor后置处理器"></a>BeanPostProcessor后置处理器</h3><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">这个接口是容器级别的，对所有的bean都起作用，也就是说每个bean初始化的时候都会检测实现这个接口的bean。</p><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">而这个接口对应两个方法，postProcessBeforeInitialization和postProcessAfterInitialization，分别对应上面的步骤5和8，因为一个是before一个是after，而中间的步骤6和7就是下面的各个bean自己实现的接口或者方法</p><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px; color: rgb(85, 85, 85); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#InitializingBean%E6%8E%A5%E5%8F%A3%E5%92%8Cinit-method" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="InitializingBean接口和init-method"></a>InitializingBean接口和init-method</h3><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">InitializingBean接口可以和init-method配合使用，接口执行顺序优先于配置，也就是上面的步骤6和步骤7他们的区别上面已经介绍过。</p><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px; color: rgb(85, 85, 85); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#%E5%87%86%E5%A4%87%E5%B0%B1%E7%BB%AA" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="准备就绪"></a>准备就绪</h3><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">至此bean已经可以使用，可以看出大体分为上面的四个阶段</p><h3 style="margin: 20px 0px 10px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px; color: rgb(85, 85, 85); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><a href="http://paine1690.github.io/2016/12/18/spring/Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86(1)Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#%E9%94%80%E6%AF%81" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(204, 204, 204); word-wrap: break-word;" title="销毁"></a>销毁</h3><div style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif; font-size: 16px; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div>销毁阶段相对简单，因为没有上面的后置处理器，就是Disposable接口的方法和destory-method，两者的顺序和左右与InitializingBean接口和init-method都很类似，对应上面的步骤10和步骤11.</div></div></div></div></div></div></div></div><div><h1 style="font-size: 24px; margin: 20px 0px 10px; padding: 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; color: rgb(85, 85, 85); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">Bean的作用域</h1><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">当通过Spring容器创建一个Bean实例时，不仅可以完成Bean实例的实例化，还可以为Bean指定特定的作用域。<strong style="font-weight: bold;">Spring支持如下5种作用域：</strong></p><ul style="list-style: none; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><li style="list-style: circle;"><strong style="font-weight: bold;">singleton</strong>：单例模式，在整个Spring IoC容器中，使用singleton定义的Bean将只有一个实例</li><li style="list-style: circle;"><strong style="font-weight: bold;">prototype</strong>：原型模式，每次通过容器的getBean方法获取prototype定义的Bean时，都将产生一个新的Bean实例</li><li style="list-style: circle;"><strong style="font-weight: bold;">request</strong>：对于每次HTTP请求，使用request定义的Bean都将产生一个新实例，即每次HTTP请求将会产生不同的Bean实例。只有在Web应用中使用Spring时，该作用域才有效</li><li style="list-style: circle;"><strong style="font-weight: bold;">session</strong>：对于每次HTTP Session，使用session定义的Bean豆浆产生一个新实例。同样只有在Web应用中使用Spring时，该作用域才有效</li><li style="list-style: circle;"><strong style="font-weight: bold;">globalsession</strong>：每个全局的HTTP Session，使用session定义的Bean都将产生一个新实例。典型情况下，仅在使用portlet context的时候有效。同样只有在Web应用中使用Spring时，该作用域才有效</li></ul></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><br/></span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">-----------------</span></span></span></div><div><span style="font-size: 19px;"><b><font color="#555555" face="Lato, PingFang SC, Microsoft YaHei, sans-serif"><span>Spring IOC容器对Bean定义资源的定位、读入和解析过程，然后对Bean进行初始化和依赖注入。</span></font></b></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><br/></span></span></span></div><div><b><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">Spring IOC容器的高级特性：</span></span></span></b></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">lazy-init对Bean初始化</span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">后置处理器</span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">Autowire自动装配</span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><br/></span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><br/></span></span></span></div><div><span style="color: rgb(85, 85, 85);"><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><br/></span></span></span></div></div></div></div><div><br/></div><div><br/></div><div><br/></div></div><br/><div><table bgcolor="#D4DDE5" border="0" width="100%"><tr><td><h1>Spring IoC容器的初始化过程</h1><b>来源网址：</b> <a href="http://paine1690.github.io/2016/12/29/spring/Spring%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90(1)IOC%E5%AE%B9%E5%99%A8%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96%E8%BF%87%E7%A8%8B/">http://paine1690.github.io/2016/12/29/spring/Spring%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90(1)IOC%E5%AE%B9%E5%99%A8%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96%E8%BF%87%E7%A8%8B/</a><br/><b>作者：</b> 958340585@qq.com<br/></td></tr></table></div><div><div><br/></div><div style="font-size: 24px; margin: 20px 0px 10px; padding: 0px; font-weight: bold; font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif; color: rgb(85, 85, 85); font-style: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div>一、核心类</div></div><ol><li><span style="color: rgb(255, 0, 0);"><span style="font-size: 19px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><b><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">Resource</span></b><br/></span></span></span></span></li></ol><div><b><span style="font-size: 19px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><br/></span></span></span></span></b></div><div><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">在Spring内部，针对于资源文件有一个统一的接口Resource表示。其主要实现类有ClassPathResource、FileSystemResource、UrlResource、ByteArrayResource、ServletContextResource和InputStreamResource。Resource接口中主要定义有以下方法：</p><ul style="list-style: none; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><li style="list-style: circle;">exists()：用于判断对应的资源是否真的存在。</li><li style="list-style: circle;">isReadable()：用于判断对应资源的内容是否可读。需要注意的是当其结果为true的时候，其内容未必真的可读，但如果返回false，则其内容必定不可读。</li><li style="list-style: circle;">isOpen()：用于判断当前资源是否代表一个已打开的输入流，如果结果为true，则表示当前资源的输入流不可多次读取，而且在读取以后需要对它进行关闭，以防止内存泄露。该方法主要针对于InputStreamResource，实现类中只有它的返回结果为true，其他都为false。</li><li style="list-style: circle;">getURL()：返回当前资源对应的URL。如果当前资源不能解析为一个URL则会抛出异常。如ByteArrayResource就不能解析为一个URL。</li><li style="list-style: circle;">getFile()：返回当前资源对应的File。如果当前资源不能以绝对路径解析为一个File则会抛出异常。如ByteArrayResource就不能解析为一个File。</li><li style="list-style: circle;"><strong style="font-weight: bold;">getInputStream()：获取当前资源代表的输入流。除了InputStreamResource以外，其它Resource实现类每次调用getInputStream()方法都将返回一个全新的InputStream。</strong></li></ul><div style="list-style: circle;"><div><b><br/></b></div><div><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">实现类：</p><ul style="list-style: none; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><li style="list-style: circle;"><strong style="font-weight: bold;">ClassPathResource</strong>可用来获取类路径下的资源文件。假设我们有一个资源文件test.txt在类路径下，我们就可以通过给定对应资源文件在类路径下的路径path来获取它，new ClassPathResource(“test.txt”)。</li><li style="list-style: circle;"><strong style="font-weight: bold;">FileSystemResource</strong>可用来获取文件系统里面的资源。我们可以通过对应资源文件的文件路径来构建一个FileSystemResource。FileSystemResource还可以往对应的资源文件里面写内容，当然前提是当前资源文件是可写的，这可以通过其isWritable()方法来判断。FileSystemResource对外开放了对应资源文件的输出流，可以通过getOutputStream()方法获取到。</li><li style="list-style: circle;"><strong style="font-weight: bold;">UrlResource</strong>可用来代表URL对应的资源，它对URL做了一个简单的封装。通过给定一个URL地址，我们就能构建一个UrlResource。</li><li style="list-style: circle;"><strong style="font-weight: bold;">ByteArrayResource</strong>是针对于字节数组封装的资源，它的构建需要一个字节数组。</li><li style="list-style: circle;"><strong style="font-weight: bold;">ServletContextResource</strong>是针对于ServletContext封装的资源，用于访问ServletContext环境下的资源。ServletContextResource持有一个ServletContext的引用，其底层是通过ServletContext的getResource()方法和getResourceAsStream()方法来获取资源的。</li><li style="list-style: circle;"><strong style="font-weight: bold;">InputStreamResource</strong>是针对于输入流封装的资源，它的构建需要一个输入流。</li></ul></div></div></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);"><br/></span></span></span></span></div><ol start="2"><li><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 19px;"><b><span style="font-family: Lato;">ResourceLoader</span></b></span></span></span></li></ol><div><span style="color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;">IoC容器的初始化过程就是含有BeanDefinition的信息的Resource的定位、载入、解析、注册的四个过程，最终配置的bean以BeanDefinition的数据与结构存在于IOC容器之中，这个过程不涉及bean的依赖注入，也不产生任何bean。</span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);"><br/></span></span></span></span></div><ol start="3"><li><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);">BeanDefinition</span></span></span></span></li></ol><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);"><br/></span></span></span></span></div><div><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">一个BeanDefinition描述了一个bean的实例，包括属性值，构造方法参数值和继承自它的类的更多信息。</p><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">作用：持有bean数据结构，是注入的bean在IoC容器中的抽象，方法列表如下</p></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);">getBeanClassName;</span></span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);">getFactoryBeanName;</span></span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);">getScope;</span></span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);">isLazyInit;</span></span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);">isSingleton;</span></span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);">isPrototype;</span></span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);">isAbstract;</span></span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);">isPrimary;</span></span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);">isAutowireCandidate;</span></span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);">getDescription;</span></span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);">相关的类与接口：</span></span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);"><br/></span></span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);">- AbstractBeanDefinition：是BeanDefinition的一个完整实现</span></span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);">- BeanDefinitionReader：用于读取bean的信息的接口。AbstractBeanDefinitionReader实现了该接口，XmlBeanDefinitionReader继承了AbstractBeanDefinitionReader。</span></span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);"><br/></span></span></span></span></div><ol start="4"><li><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><b>ApplicationContext</b></span></span></span></span></span></span></li></ol><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);">     </span></span></span></span></div><div><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">高级IoC容器，除了基本的IoC容器功能外，支持不同信息源、访问资源、支持事件发布等功能。</p><p style="margin: 0px 0px 25px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">继承了以下接口：</p><ul style="list-style: none; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><li style="list-style: circle;">ListableBeanFactory：继承自BeanFactory，在此基础上，添加了containsBeanDefinition、getBeanDefinitionCount、getBeanDefinitionNames等方法。</li><li style="list-style: circle;">HierarchicalBeanFactory：继承自BeanFactory，在此基础之上，添加了getParentBeanFactory、containsLocalBean这两个方法。</li><li style="list-style: circle;">AutoWireCapableBeanFactory：继承自BeanFactory</li><li style="list-style: circle;">MessageSource：用于获取国际化信息</li><li style="list-style: circle;">ApplicationEventPublisher：因为ApplicationContext实现了该接口，因此spring的ApplicationContext实例具有发布事件的功能。</li></ul></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);"><br/></span></span></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 19px;"><b>二、容器的初始化过程</b></span></span></span></div><div><br/></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 19px;"><b>IoC容器的初始化过程就是含有BeanDefinition的信息的Resource的定位、载入、解析、注册的四个过程，最终配置的bean以BeanDifinition的类存在于IoC容器中，这个过程不涉及Bean的依赖注入，也不产生任何Bean?</b></span></span></span></div><div><br/></div><div>String filePath ---&gt; Resource对象 ---&gt;(XML解析 JAXP方式，另外两种解析方式：SAX和DOM)Document对象 ---&gt; BeanDifinition</div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-size: 16px;"><span style="font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);"><br/></span></span></span></span></div></div><br/><div><table bgcolor="#D4DDE5" border="0" width="100%"><tr><td><h1>常见Java多线程面试题</h1><b>来源网址：</b> <a href="http://javarevisited.blogspot.hk/2011/07/java-multi-threading-interview.html">http://javarevisited.blogspot.hk/2011/07/java-multi-threading-interview.html</a><br/><b>作者：</b> 958340585@qq.com<br/></td></tr></table></div><div><div><h2 style="color: rgb(0, 0, 0); font-family: &quot;Trebuchet MS&quot;, Verdana, Arial, sans-serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;"><span style="font-size: 19px;"><u>15 Java Thread Interview Questions and answers</u></span></h2></div><div><span style="font-size: 19px;"><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">Anyway, without any further ado, here is my list of some of the frequently asked Java multithreading and concurrency questions from Java developer Interviews on Investment banks e.g. Barclays, Morgan Stanley, Citibank etc.</span></span></div><div><span style="font-size: 19px;">投资银行Java开发者遇到的Java多线程常见面试题型</span></div><div><span style="font-size: 19px;"><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/></span></div><div><span style="font-size: 19px;"><b style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">1) You have thread T1, T2, and T3, how will you ensure that thread T2 run after T1 and thread T3 run after T2?</b></span></div><div><b><span style="font-size: 19px;"><span style="font-family: 'Trebuchet MS', Verdana, Arial, sans-serif;">1）你有三个下线程T1 T2 T3，你如何确保T1运行完毕，运行T2,T2运行完毕，运行T3?</span></span></b></div><div><span style="font-size: 19px;"><span style="font-family: 'Trebuchet MS', Verdana, Arial, sans-serif;"><span style="background-color: rgb(255, 255, 255);"><br/></span></span></span></div><div><span style="font-size: 19px;"><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">This thread interview question is mostly asked in the first round or phone screening round of interview and purpose of this multi-threading question is to check whether the candidate is familiar with the concept of &quot;join&quot; method or not. The answer to this multi-threading questions is simple it can be achieved by using join method of Thread class.</span></span></div><div><font face="Trebuchet MS, Verdana, Arial, sans-serif"><span style="font-size: 19px;">主要考察多线程的joint方法，能够使用join方法完成。</span></font></div><div><span style="font-size: 19px;"><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><b style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">2) What is the advantage of new Lock interface over a synchronized block in Java? You need to implement a high-performance cache which allows multiple readers but the single writer to keep the integrity how will you implement it?</b><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">The major advantage of lock interfaces on multi-threaded and concurrent programming is they provide two separate lock for reading and writing which enables you to write high-performance data structure like </span><a href="http://javarevisited.posterous.com/difference-between-concurrenthashmap-and-coll" style="color: rgb(102, 0, 153); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">ConcurrentHashMap</a><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;"> and </span><a href="http://javarevisited.blogspot.sg/2012/02/what-is-blocking-methods-in-java-and.html" style="color: rgb(102, 0, 153); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">conditional blocking</a><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">.</span><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">This java threads interview question is getting increasingly popular and more and more follow-up questions come based on the answer of the interviewee.</span><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/></span></div><div><span style="font-size: 19px;"><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">I would strongly suggest reading Locks before appearing for any Java multi-threading interview because nowadays It's heavily used to build cache for an electronic trading system on client and exchange connectivity space.</span></span></div><div><span style="font-size: 19px;">2）Java里面新的Lock接口提供的显示锁和synchronized内置锁的优势是什么？你如果实现一个高性能缓存，允许多个读者读，但是仅仅一个写者写，为了保证完整性，你将如何实现这个高性能缓存？</span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 19px;">答：主要的优势是：显示锁可以提供（中断、轮询的显示锁）同时也提供读写锁，读锁和写锁的分离允许开发者实现高性能的数据结构像ConcurrentHashMap和条件阻塞。</span></b></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 19px;">Java线程面试题现在越来越常见了，并且就此可以展开问很多问题。</span></b></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 19px;">参见面试之前，我建议你了解学习下Lock接口提供的显式锁，因为当下它经常被用来实现缓存。</span></b></span></span></div><div><span style="font-size: 19px;"><br/></span></div><div><span style="font-size: 19px;"><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><b style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">3) What are differences between wait and sleep method in Java?</b></span></div><div><span style="font-size: 19px;"><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">Another frequently asked thread interview question in Java mostly appear in a phone interview. The only major difference is to wait for release the lock or monitor while sleep doesn't release any lock or monitor while waiting. The wait is used for inter-thread communication while sleep is used to introduce pause on execution. See my post </span><a href="http://javarevisited.blogspot.sg/2011/12/difference-between-wait-sleep-yield.html" style="color: rgb(102, 0, 153); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">wait vs sleep in Java</a><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;"> for more differences</span></span></div><div><span style="font-size: 19px;"><b><span style="background-color: rgb(255, 255, 255);">3）wait方法和sleep方法的区别？</span></b></span></div><div><span style="font-size: 19px;"><span style="color: rgb(255, 70, 53);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b>wait方法释放锁，让出cpu进入等待。而sleep方法不释放锁，让出cpu进入等待。</b></span></span></span></div><div style="font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; clear: both; text-align: center;"><div><span style="font-size: 19px;"><b style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></b></span></div></div><div><span style="font-size: 19px;"><b style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">4) Write code to implement blocking queue in Java?</b></span></div><div><span style="font-size: 19px;"><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">This is relatively tough java multi-threading interview question which serves many purposes, it checks whether a candidate can actually write Java code using </span><a href="http://javarevisited.blogspot.sg/2011/02/how-to-implement-thread-in-java.html" style="color: rgb(102, 0, 153); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">thread</a><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;"> or not, it sees how good candidate is on understanding concurrent scenarios and you can ask a lot of follow-up question based upon his code. If he uses </span><a href="http://javarevisited.blogspot.sg/2011/05/wait-notify-and-notifyall-in-java.html" style="color: rgb(102, 0, 153); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">wait() and notify() method</a><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;"> to implement blocking queue, Once candidate successfully writes it you can ask him to write it again using new Java 5 concurrent classes etc.</span></span></div><div><span style="font-size: 19px;">4）写代码实现一个阻塞队列？</span></div><div><span style="font-size: 19px;">略</span></div><div><span style="font-size: 19px;"><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><b style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">5) Write code to solve the Produce consumer problem in Java? </b><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">(</span><a href="http://www.java67.com/2015/12/producer-consumer-solution-using-blocking-queue-java.html" style="color: rgb(102, 0, 153); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;" target="_blank">solution</a><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">)</span></span></div><div><span style="font-size: 19px;"><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">Similar to above questions on the thread but more classic in nature, some time interviewer ask follow up questions  How do you solve producer consumer problem in Java, well it can be solved in a multiple ways, I have shared one way to solve producer consumer problem using BlockingQueue in Java, so be prepared for surprises. Sometimes they even ask to implement a solution of dining philosopher problem as well.</span></span></div><div><span style="font-size: 19px;">5）写代码解决生产者消费者问题？</span></div><div><span style="font-size: 19px; line-height: 27px;">略</span></div><div><span style="font-size: 19px;"><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><b style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">6) Write a program which will result in deadlock? How will you fix deadlock in Java?</b></span></div><div><span style="font-size: 19px;"><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">This is my favorite java thread interview question because even though deadlock is quite common while writing multi-threaded concurrent program many candidates not able to write deadlock free code and they simply struggle.</span></span></div><div><br/></div><div><span style="font-size: 19px;"><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">Just ask them you have N resources and N threads and to complete an operation you require all resources.</span><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/></span></div><div><span style="font-size: 19px;"><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">Here N can be replaced with 2 for the simplest case and higher number to make the question more intimidating. see </span><a href="http://javarevisited.blogspot.com/2010/10/what-is-deadlock-in-java-how-to-fix-it.html" style="color: rgb(102, 0, 153); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">How to avoid deadlock in java</a><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;"> for more information on the deadlock in Java.</span></span></div><div><span style="font-size: 19px;"><b><span style="background-color: rgb(255, 255, 255);">6） 写一段能导致死锁的代码？你怎么解决死锁问题？</span></b></span></div><div><span style="font-size: 19px;"><b>这是我最喜欢的java线程面试题们因为即使死锁在多线程环境下是十分常见的，但是 要求直接写出死锁的代码确实很让人纠结的。</b></span></div><div><b><span style="font-size: 19px;">N个线程去竞争N个资源，每个线程都需要获得N个资源才可以完成任务。</span></b></div><div><b><span style="font-size: 19px;">这里N=2，死锁就是多个线程握着其他线程需要的锁，而去等待其它线程释放锁，形成互相等待。</span></b></div><div><span style="font-size: 19px;"><br/></span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 19px;">避免死锁的常用方式就是：</span></b></span></span></div><ol><li><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 19px;">按着相同的顺序去获取锁。</span></b></span></span></li><li><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 19px;">轮询锁（可超时）tryLock（long timeout）</span></b></span></span></li><li><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 19px;">采用无锁非阻塞算法，例如CAS</span></b></span></span></li></ol><div><span style="font-size: 19px;"><br/></span></div><div><span style="font-size: 19px;"><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><b style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">7) What is an atomic operation? What are atomic operations in Java?</b></span></div><div><span style="font-size: 19px;"><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">Simple java thread interview questions, another follow-up is do you need to synchronize an atomic operation? :) You can read more about </span><a href="http://javarevisited.blogspot.com/2011/04/synchronization-in-java-synchronized.html" style="color: rgb(102, 0, 153); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">java synchronization</a><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;"> here.</span></span></div><div><span style="font-size: 19px;">7）原子操作是什么？Java里面的原子操作呢？</span></div><div><span style="font-size: 19px;">简单的Java线程面试题，另一个扩展的问题就是 你需要对一个原子操作进行同步吗?(应该是不需要吧)</span></div><div><span style="font-size: 19px;"><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><b style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">8) What is a volatile keyword in Java? How to use it? How is it different from the synchronized method in Java?</b></span></div><div><span style="font-size: 19px;"><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">Thread questions based on a </span><a href="http://javarevisited.blogspot.com/2011/06/volatile-keyword-java-example-tutorial.html" style="color: rgb(102, 0, 153); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">volatile keyword in Java</a><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;"> has become more popular after changes made on it on Java 5 and Java memory model. It’s good to prepare well about how volatile variables ensures visibility, ordering, and consistency in a concurrent environment.</span></span></div><div><span style="font-size: 19px;"><span style="font-family: 'Trebuchet MS', Verdana, Arial, sans-serif;"><span style="background-color: rgb(255, 255, 255);">8) volatile关键字是什么？如何使用它？它和synchronized方法有什么区别？</span></span></span></div><div><span style="font-size: 19px;"><span style="font-family: 'Trebuchet MS', Verdana, Arial, sans-serif;"><span style="background-color: rgb(255, 255, 255);"><br/></span></span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(227, 0, 0);"><b><span style="font-size: 19px;"><span style="font-family: 'Trebuchet MS', Verdana, Arial, sans-serif;"><span style="background-color: rgb(255, 255, 255);">1.5后引入的，在新的内存模型下（接下来就会让你介绍下内存模型），volatile保证可见性、顺序性和一致性在并发环境下。</span></span></span></b></span></span></div><div><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 19px;">volatile指令对应内存屏障，是一种轻量级的synchronized。</span></b></span></span></div><div><span style="font-size: 19px;"><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><b style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">9) What is a race condition? How will you find and solve race condition?</b></span></div><div><span style="font-size: 19px;"><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">Another multi-threading question in Java which appear mostly on senior-level interviews. Most interviewer grill on recent race condition you have faced and how did you solve it and sometime they will write sample code and ask you detect race condition. See my post on the </span><a href="http://javarevisited.blogspot.sg/2012/02/what-is-race-condition-in.html" style="color: rgb(102, 0, 153); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Race condition in Java</a><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;"> for more information. In my opinion, this is one of the best java thread interview questions and can really test the candidate's experience on solving race condition or writing code which is free of data race or any other race condition. Best book to get the mastery of this topic is &quot;Concurrency practices in Java'&quot;.</span></span></div><div><span style="font-size: 19px;">9) 竞态条件是什么意思？你如何发现并且解决这些竞态条件？</span></div><div><span style="font-size: 19px;">这种面试题通常出现在高级别的面试中（真的吗？）。略。</span></div><div><span style="font-size: 19px;"><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><b style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">10) How will you take thread dump in Java? How will you analyze Thread dump?</b><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">In UNIX you can use </span><span style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: 'courier new', courier, monospace;">kill -3</span><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;"> and then thread dump will print on log on windows you can use </span><span style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: 'courier new', courier, monospace;">&quot;CTRL+Break&quot;</span><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">. Rather simple and focus thread interview question but can get tricky if he asks how you analyze it. A thread dump can be useful to analyze deadlock situations as well.</span><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/>
略<br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><b style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">11) Why we call start() method which in turns calls run() method, why not we directly call run() method?</b><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">Another classic java multi-threading interview question This was my original doubt when I started programming in the thread. Now days mostly asked in a phone interview or first round of interview at mid and junior level java interviews.</span><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">The answer to this question is that when you call start() method it creates new Thread and executes code declared in the run() while directly calling run() method doesn’t create any new thread and execute code on the same calling thread. Read my post </span><a href="http://javarevisited.blogspot.sg/2012/03/difference-between-start-and-run-method.html" style="color: rgb(102, 0, 153); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Difference between start and run method in Thread</a><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;"> for more details.</span></span></div><div><span style="font-size: 19px;"><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/></span></div><div><span style="font-size: 19px;"><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><b style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">12) How will you awake a blocked thread in Java?</b><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">This is tricky question on threading, blocking can result in many ways, if thread is blocked on IO then I don't think there is a way to interrupt the thread, let me know if there is any, on the other hand, if thread is blocked due to result of calling</span><span style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: 'courier new', courier, monospace;"> wait()</span><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">, </span><span style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: 'courier new', courier, monospace;">sleep(),</span><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;"> or </span><span style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: 'courier new', courier, monospace;">join()</span><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;"> method you can interrupt the thread and it will awake by throwing InterruptedException. See my post </span><a href="http://javarevisited.blogspot.sg/2012/02/what-is-blocking-methods-in-java-and.html" style="color: rgb(102, 0, 153); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">How to deal with blocking methods in Java</a><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;"> for more information on handling blocked thread.</span></span></div><div><span style="font-size: 19px;">12）你如何唤醒一个阻塞的线程？</span></div><div><span style="font-size: 19px;">interrupt一个阻塞在wait方法、sleep()、或者join方法上的线程。</span></div><div><span style="font-size: 19px;"><br/></span></div><div><span style="font-size: 19px;"><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><b style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">13) What is the difference between CyclicBarriar and CountdownLatch in Java? </b><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">(</span><a href="http://www.java67.com/2012/08/difference-between-countdownlatch-and-cyclicbarrier-java.html" style="color: rgb(102, 0, 153); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;" target="_blank">answer</a><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">)</span></span></div><div><span style="font-size: 19px;"><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">New Java thread interview questions mostly to check familiarity with JDK 5 concurrent packages. One difference is that you can reuse CyclicBarrier once the barrier is broken but you can not reuse CountDownLatch. If you want to learn more see </span><a href="https://click.linksynergy.com/fs-bin/click?id=JVFxdTr9V80&amp;subid=0&amp;offerid=323058.1&amp;type=10&amp;tmpid=14538&amp;RD_PARM1=https%3A%2F%2Fwww.udemy.com%2Fmultithreading-and-parallel-computing-in-java%2F" rel="nofollow" style="color: rgb(102, 0, 153); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;" target="_blank">Multithreading and Parallel Computing in Java</a><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;"> course on Udemy.</span></span></div><div><span style="font-size: 19px;">13）CycleBarriar和CountdownLatch的区别是什么？</span></div><div><span style="font-size: 19px;">CycleBarriar可以重用，而CountDownLatch不可以重用。</span></div><div><span style="font-size: 19px;"><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><b style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></b><b style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">14) What is an immutable object? How does it help in writing a concurrent application?</b><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">Another classic interview questions on multi-threading, not directly related to the thread but indirectly helps a lot. This java interview question can become more tricky if ask you to write an immutable class or ask you </span><a href="http://javarevisited.blogspot.com/2010/10/why-string-is-immutable-in-java.html" style="color: rgb(102, 0, 153); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Why String is immutable in Java</a><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;"> as a follow-up.</span></span></div><div><span style="font-size: 19px;">14）不可变对象是什么？并发编程中它是怎么样起作用的？</span></div><div><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 19px;">（不可变对象是一经创建，状态不会再发改变的对象，这样的不可变对象是线程安全的，在多线程环境下不需要同步，因此可以提高多线程的性能，</span></b></span></span></div><div><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 19px;">Java里面不可变对象通常是满足如下条件：</span></b></span></span></div><ol><li><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b>对象创建以后状态不能修改。</b></span></span></li><li><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b>对象所有的域都是final的。</b></span></span></li><li><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b>对象是正确被构造的（在构造的时候，this没有被提前逸出）。</b></span></span></li></ol><div><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 19px;">）</span></b></span></span></div><div><span style="font-size: 19px;"><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/></span></div><div><span style="font-size: 19px;"><b style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">15) What are some common problems you have faced in multi-threading environment? How did you resolve it?</b></span></div><div><span style="font-size: 19px;"><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">Memory-interference, race conditions, deadlock, livelock, and starvation are an example of some problems comes in multi-threading and concurrent programming. There is no end of a problem if you get it wrong and they will be hard to detect and debug.</span><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">This is mostly experienced based interview question on java thread instead of fact-based. You can further see </span><a href="https://learning.javaspecialists.eu/courses/concurrency-in-practice-bundle?affcode=92815_johrd7r8" rel="nofollow" style="color: rgb(102, 0, 153); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;" target="_blank">Java Concurrency in Practice Course by Heinz Kabutz</a><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;"> for some real-world problems faced in actual high-performance multi-threaded applications.</span></span></div><div><span style="font-size: 19px;"><br/></span></div><div><span style="font-size: 19px;">15）多线程环境下有哪些常见的问题？如何解决的？</span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 19px; line-height: 27px;">内存干涉、竞态条件、死锁、活锁和饥饿。</span></b></span></span></div><div><div style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; clear: both; text-align: center;"><div><br/></div></div><span style="font-size: 19px;"><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><br style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">These were some of my favorite J</span><i style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">ava thread interview questions and mostly asked on Investment banks</i><span style="color: rgb(0, 0, 0); font-family: 'Trebuchet MS', Verdana, Arial, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">. This list is by no means complete so please contribute some of interesting java thread questions you have faced during the interview.  Purpose of this article is to collect and share great interview questions on multi-threading concept which not only helps in the interview but opens the door for learning a new threading concept.</span><span style="font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-family: 'Trebuchet MS', Verdana, Arial, sans-serif;"><br/><br/></span></span></span></div><div><span style="font-size: 19px;"><span style="font-family: 'Trebuchet MS', Verdana, Arial, sans-serif;">Read more: <a href="http://javarevisited.blogspot.com/2011/07/java-multi-threading-interview.html#ixzz58phRyQZ5" style="color: rgb(0, 51, 153);">http://javarevisited.blogspot.com/2011/07/java-multi-threading-interview.html#ixzz58phRyQZ5</a></span></span></div></div><br/><div><table bgcolor="#D4DDE5" border="0" width="100%"><tr><td><h1>Volatile关键字</h1><b>来源网址：</b> <a href="http://www.cnblogs.com/dolphin0520/p/3920373.html">http://www.cnblogs.com/dolphin0520/p/3920373.html</a><br/><b>作者：</b> 958340585@qq.com<br/></td></tr></table></div><div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;"><br/></span></div><div><img src="常见面试基础题_files/Image [23].png" type="image/png" data-filename="Image.png"/></div><div><span style="font-size: 16px;"><br/></span></div><div><hr/></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">Java内存模型：</span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">主内存</span></div><div><span style="font-size: 16px;">工作内存</span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;">并发编程存在的问题：</span></span></div><ol><li><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;">原子性</span></span></li><li><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;">可见性</span></span></li><li><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px;">有序性</span></span></li></ol><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">在JVM内存模型层次上：也存在这三个问题：</span></div><div><span style="font-size: 16px;"><br/></span></div><ol><li><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(227, 0, 0);"><b><span style="font-size: 16px;">原子性：Java内存模型只保证了基本读取和赋值是原子性操作</span></b></span></span></li><li><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(227, 0, 0);"><b><span style="font-size: 16px;">可见性：volatile关键字保证可见性，当一个共享变量被volatile修饰时，它会保证修改的值会立即被更新到主存，当有其他线程需要读取时，它会去内存中读取新值。</span></b></span></span></li><li><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(227, 0, 0);"><b><span style="font-size: 16px;">有序性：在Java里面，可以通过volatile关键字来保证一定的“有序性”（具体原理在下一节讲述）。另外可以通过synchronized和Lock来保证有序性，很显然，synchronized和Lock保证每个时刻是有一个线程执行同步代码，相当于是让线程顺序执行同步代码，自然就保证了有序性。</span></b></span></span></li></ol><div><p style="margin: 10px auto; padding: 0px; text-indent: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198);"><span style="font-size: 16px;">另外，<span style="margin: 0px; padding: 0px; color: rgb(255, 0, 0);">Java内存模型具备一些先天的“有序性”，即不需要通过任何手段就能够得到保证的有序性，这个通常也称为 happens-before 原则。如果两个操作的执行次序无法从happens-before原则推导出来，那么它们就不能保证它们的有序性，虚拟机可以随意地对它们进行重排序。</span></span></p><p style="margin: 10px auto; padding: 0px; text-indent: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198);"><span style="font-size: 16px;">　　下面就来具体介绍下happens-before原则（先行发生原则）：</span></p><ul style="margin: 0px 0px 0px 30px; padding: 0px; word-break: break-all; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198);"><li style="margin: 0px 0px 1em; padding: 0px; list-style: disc; text-align: left;"><span style="font-size: 16px;">程序次序规则：一个线程内，按照代码顺序，书写在前面的操作先行发生于书写在后面的操作</span></li><li style="margin: 0px 0px 1em; padding: 0px; list-style: disc; text-align: left;"><span style="font-size: 16px;">锁定规则：一个unLock操作先行发生于后面对同一个锁额lock操作</span></li><li style="margin: 0px 0px 1em; padding: 0px; list-style: disc; text-align: left;"><span style="font-size: 16px;">volatile变量规则：对一个变量的写操作先行发生于后面对这个变量的读操作</span></li><li style="margin: 0px 0px 1em; padding: 0px; list-style: disc; text-align: left;"><span style="font-size: 16px;">传递规则：如果操作A先行发生于操作B，而操作B又先行发生于操作C，则可以得出操作A先行发生于操作C</span></li><li style="margin: 0px 0px 1em; padding: 0px; list-style: disc; text-align: left;"><span style="font-size: 16px;">线程启动规则：Thread对象的start()方法先行发生于此线程的每个一个动作</span></li><li style="margin: 0px 0px 1em; padding: 0px; list-style: disc; text-align: left;"><span style="font-size: 16px;">线程中断规则：对线程interrupt()方法的调用先行发生于被中断线程的代码检测到中断事件的发生</span></li><li style="margin: 0px 0px 1em; padding: 0px; list-style: disc; text-align: left;"><span style="font-size: 16px;">线程终结规则：线程中所有的操作都先行发生于线程的终止检测，我们可以通过Thread.join()方法结束、Thread.isAlive()的返回值手段检测到线程已经终止执行</span></li><li style="margin: 0px 0px 1em; padding: 0px; list-style: disc; text-align: left;"><span style="font-size: 16px;">对象终结规则：一个对象的初始化完成先行发生于他的finalize()方法的开始</span></li></ul><div style="margin: 0px 0px 1em; padding: 0px; list-style: disc; text-align: left;"><div><span style="font-size: 16px;"><br/></span></div><div><br/></div><div>深入理解volatile关键字：</div><div><br/></div><div><span style="font-size: 16px;"><b>1.volatile关键字的两层语义</b></span></div><div><br/></div><div>　　一旦一个共享变量（类的成员变量、类的静态成员变量）被volatile修饰之后，那么就具备了两层语义：</div><div><br/></div><div>　　<span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><span style="font-size: 16px;"><b>1）保证了不同线程对这个变量进行操作时的可见性，即一个线程修改了某个变量的值，这新值对其他线程来说是立即可见的。</b></span></span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);"><span style="font-size: 16px;"><b>　　2）禁止进行指令重排序。</b></span></span></span></div><div><br/></div><div><p style="margin: 10px auto; padding: 0px; text-indent: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">先看一段代码，假如线程1先执行，线程2后执行：</p><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;"><div style="margin: 0px; padding: 0px;"><div style="margin: 1em 0px !important; padding: 0px; width: 1195.4px; position: relative !important; overflow: auto !important; font-size: 1em !important; background-color: rgb(255, 255, 255) !important;"><table border="0" cellpadding="0" cellspacing="0" style="margin: 0px !important; padding: 0px !important; border-collapse: collapse; border-spacing: 0px; border-radius: 0px !important; background: none !important; border: 1px solid silver; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; word-break: break-word;width:1195px;"><tbody><tr style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important;"><td style="margin: 0px !important; padding: 3px; border-radius: 0px !important; background: none !important; border: 1px solid silver; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; color: rgb(175, 175, 175) !important; border-collapse: collapse;width:3.430962343096234%;"><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">1</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">2</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">3</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">4</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">5</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">6</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">7</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">8</div></td><td style="margin: 0px !important; padding: 3px; border-radius: 0px !important; background: none !important; border: 1px solid silver; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; border-collapse: collapse;width:96.48535564853556%;"><div style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: relative !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important;"><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 130, 0) !important;">//线程1</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 255) !important;">boolean</code> <code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">stop = </code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 255) !important;">false</code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">;</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 255) !important;">while</code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">(!stop){</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important;">    </code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">doSomething();</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">}</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"> </div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 130, 0) !important;">//线程2</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">stop = </code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 255) !important;">true</code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">;</code></div></div></td></tr></tbody></table></div></div></div><p style="margin: 10px auto; padding: 0px; text-indent: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;"> 　　这段代码是很典型的一段代码，很多人在中断线程时可能都会采用这种标记办法。但是事实上，这段代码会完全运行正确么？即一定会将线程中断么？不一定，也许在大多数时候，这个代码能够把线程中断，但是也有可能会导致无法中断线程（虽然这个可能性很小，但是只要一旦发生这种情况就会造成死循环了）。</p><p style="margin: 10px auto; padding: 0px; text-indent: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">　　下面解释一下这段代码为何有可能导致无法中断线程。在前面已经解释过，每个线程在运行过程中都有自己的工作内存，那么线程1在运行的时候，会将stop变量的值拷贝一份放在自己的工作内存当中。</p><p style="margin: 10px auto; padding: 0px; text-indent: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">　　那么当线程2更改了stop变量的值之后，但是还没来得及写入主存当中，线程2转去做其他事情了，那么线程1由于不知道线程2对stop变量的更改，因此还会一直循环下去。</p><p style="margin: 10px auto; padding: 0px; text-indent: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">　　但是用volatile修饰之后就变得不一样了：</p><p style="margin: 10px auto; padding: 0px; text-indent: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">　　第一：使用volatile关键字会强制将修改的值立即写入主存；</p><p style="margin: 10px auto; padding: 0px; text-indent: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">　　第二：使用volatile关键字的话，当线程2进行修改时，会导致线程1的工作内存中缓存变量stop的缓存行无效（反映到硬件层的话，就是CPU的L1或者L2缓存中对应的缓存行无效）；</p><p style="margin: 10px auto; padding: 0px; text-indent: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">　　第三：由于线程1的工作内存中缓存变量stop的缓存行无效，所以线程1再次读取变量stop的值时会去主存读取。</p><p style="margin: 10px auto; padding: 0px; text-indent: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">　　那么在线程2修改stop值时（当然这里包括2个操作，修改线程2工作内存中的值，然后将修改后的值写入内存），会使得线程1的工作内存中缓存变量stop的缓存行无效，然后线程1读取时，发现自己的缓存行无效，它会等待缓存行对应的主存地址被更新之后，然后去对应的主存读取最新的值。</p><div style="margin: 10px auto; padding: 0px; text-indent: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198);"><div>　　那么线程1读取到的就是最新的正确的值。</div></div></div><div><br/></div><div><br/></div><div><span style="font-size: 16px;"><b>2.volatile保证原子性吗？并不能</b></span></div><div><br/></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b>如何保证原子性呢？</b></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b>sychronized</b></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b>Lock</b></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b>Atomic类 使用CAS操作</b></span></span></div><div><br/></div><div><span style="font-size: 16px;"><b>3.<span style="font-family: Verdana;"> volatile能保证有序性吗？</span></b></span></div><div><b><span style="font-size: 14px;"><span style="font-family: Verdana;"><br/></span></span></b></div><div><b><span style="font-size: 14px;"><span style="font-family: Verdana;">在前面提到volatile关键字能禁止指令重排序，所以volatile能在一定程度上保证有序性。</span></span></b></div><div><b><span style="font-size: 14px;"><span style="font-family: Verdana;"><br/></span></span></b></div><div><b><span style="font-size: 14px;"><span style="font-family: Verdana;">　　volatile关键字禁止指令重排序有两层意思：</span></span></b></div><div><b><span style="font-size: 14px;"><span style="font-family: Verdana;"><br/></span></span></b></div><div><b><span style="font-size: 14px;"><span style="font-family: Verdana;">　　<span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);">1）当程序执行到volatile变量的读操作或者写操作时，在其前面的操作的更改肯定全部已经进行，且结果已经对后面的操作可见；在其后面的操作肯定还没有进行；</span></span></span></span></b></div><div><b><span style="font-size: 14px;"><span style="font-family: Verdana;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="color: rgb(255, 0, 0);">　　2）在进行指令优化时，不能将在对volatile变量访问的语句放在其后面执行，也不能把volatile变量后面的语句放到其前面执行</span></span>。</span></span></b></div><div><b><span style="font-size: 14px;"><span style="font-family: Verdana;"><br/></span></span></b></div><div><p style="margin: 10px auto; padding: 0px; text-indent: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">可能上面说的比较绕，举个简单的例子：</p><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;"><div style="margin: 0px; padding: 0px;"><div style="margin: 1em 0px !important; padding: 0px; width: 1195.4px; position: relative !important; overflow: auto !important; font-size: 1em !important; background-color: rgb(255, 255, 255) !important;"><table border="0" cellpadding="0" cellspacing="0" style="margin: 0px !important; padding: 0px !important; border-collapse: collapse; border-spacing: 0px; border-radius: 0px !important; background: none !important; border: 1px solid silver; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; word-break: break-word;width:1195px;"><tr style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important;"><td style="margin: 0px !important; padding: 3px; border-radius: 0px !important; background: none !important; border: 1px solid silver; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; color: rgb(175, 175, 175) !important; border-collapse: collapse;width:3.5146443514644354%;"><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">1</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">2</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">3</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">4</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">5</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">6</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">7</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">8</div></td><td style="margin: 0px !important; padding: 3px; border-radius: 0px !important; background: none !important; border: 1px solid silver; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; border-collapse: collapse;width:96.40167364016736%;"><div style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: relative !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important;"><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 130, 0) !important;">//x、y为非volatile变量</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 130, 0) !important;">//flag为volatile变量</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"> </div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">x = </code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 153, 0) !important;">2</code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">;        </code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 130, 0) !important;">//语句1</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">y = </code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 153, 0) !important;">0</code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">;        </code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 130, 0) !important;">//语句2</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">flag = </code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 255) !important;">true</code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">;  </code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 130, 0) !important;">//语句3</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">x = </code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 153, 0) !important;">4</code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">;         </code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 130, 0) !important;">//语句4</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">y = -</code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 153, 0) !important;">1</code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">;       </code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 130, 0) !important;">//语句5</code></div></div></td></tr></table></div></div></div><p style="margin: 10px auto; padding: 0px; text-indent: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;"> 　　由于flag变量为volatile变量，那么在进行指令重排序的过程的时候，不会将语句3放到语句1、语句2前面，也不会讲语句3放到语句4、语句5后面。但是要注意语句1和语句2的顺序、语句4和语句5的顺序是不作任何保证的。</p><p style="margin: 10px auto; padding: 0px; text-indent: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">　　并且volatile关键字能保证，执行到语句3时，语句1和语句2必定是执行完毕了的，且语句1和语句2的执行结果对语句3、语句4、语句5是可见的。</p><p style="margin: 10px auto; padding: 0px; text-indent: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">　　那么我们回到前面举的一个例子：</p><div style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;"><div style="margin: 0px; padding: 0px;"><div style="margin: 1em 0px !important; padding: 0px; width: 1195.4px; position: relative !important; overflow: auto !important; font-size: 1em !important; background-color: rgb(255, 255, 255) !important;"><table border="0" cellpadding="0" cellspacing="0" style="margin: 0px !important; padding: 0px !important; border-collapse: collapse; border-spacing: 0px; border-radius: 0px !important; background: none !important; border: 1px solid silver; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; word-break: break-word;width:1195px;"><tr style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important;"><td style="margin: 0px !important; padding: 3px; border-radius: 0px !important; background: none !important; border: 1px solid silver; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; color: rgb(175, 175, 175) !important; border-collapse: collapse;width:3.430962343096234%;"><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">1</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">2</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">3</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">4</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">5</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">6</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">7</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">8</div><div style="margin: 0px !important; padding: 0px 0.5em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border-width: 0px 2px 0px 0px !important; border-top-style: initial !important; border-right-style: solid !important; border-bottom-style: initial !important; border-left-style: initial !important; border-color: rgba(0, 0, 0, 0.35); border-image: initial !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease; color: rgb(0, 0, 0);">9</div></td><td style="margin: 0px !important; padding: 3px; border-radius: 0px !important; background: none !important; border: 1px solid silver; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; border-collapse: collapse;width:96.48535564853556%;"><div style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: relative !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important;"><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 130, 0) !important;">//线程1:</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">context = loadContext();   </code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 130, 0) !important;">//语句1</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">inited = </code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 255) !important;">true</code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">;             </code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 130, 0) !important;">//语句2</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"> </div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 130, 0) !important;">//线程2:</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 255) !important;">while</code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">(!inited ){</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important;">  </code><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">sleep()</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">}</code></div><div style="margin: 0px !important; padding: 0px 1em !important; border-radius: 0px !important; background-image: none !important; background-position: initial !important; background-size: initial !important; background-repeat: initial !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: rgb(193, 230, 198); border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; transition: background-color 0.3s ease;"><code style="margin: 0px !important; padding: 0px !important; border-radius: 0px !important; background: none !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: nowrap !important; color: rgb(0, 0, 0) !important;">doSomethingwithconfig(context);</code></div></div></td></tr></table></div></div></div><p style="margin: 10px auto; padding: 0px; text-indent: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;"> 　　前面举这个例子的时候，提到有可能语句2会在语句1之前执行，那么久可能导致context还没被初始化，而线程2中就使用未初始化的context去进行操作，导致程序出错。</p><div style="margin: 10px auto; padding: 0px; text-indent: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198);"><div>　　这里如果用volatile关键字对inited变量进行修饰，就不会出现这种问题了，因为当执行到语句2时，必定能保证context已经初始化完毕。</div></div></div><div><b><span style="font-size: 14px;"><span style="font-family: Verdana;"><br/></span></span></b></div><div><span style="font-size: 16px;"><b><span style="font-family: Verdana;">4.volatile的原理和实现机制</span></b></span></div><div><b><span style="font-size: 16px;"><span style="font-family: Verdana;"><br/></span></span></b></div><div><span style="font-size: 16px;"><span style="font-family: Verdana;">前面讲述了源于volatile关键字的一些使用，下面我们来探讨一下volatile到底如何保证可见性和禁止指令重排序的。</span></span></div><div><span style="font-size: 16px;"><span style="font-family: Verdana;">　　下面这段话摘自《深入理解Java虚拟机》：</span></span></div><div><span style="font-size: 16px;"><span style="font-family: Verdana;"><br/></span></span></div><div><b><span style="font-size: 16px;"><span style="font-family: Verdana;">　　<span style="color: rgb(255, 0, 0);">“观察加入volatile关键字和没有加入volatile关键字时所生成的汇编代码发现，加入volatile关键字时，会多出一个lock前缀指令”</span></span></span></b></div><div><span style="color: rgb(255, 0, 0);"><b><span style="font-size: 16px;"><span style="font-family: Verdana;">　　lock前缀指令实际上相当于一个内存屏障（也成内存栅栏），内存屏障会提供3个功能：</span></span></b></span></div><div><b><span style="font-size: 16px;"><span style="font-family: Verdana;">　　</span></span></b></div><div><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 16px;"><span style="font-family: Verdana;">        1）它确保指令重排序时不会把其后面的指令排到内存屏障之前的位置，也不会把前面的指令排到内存屏障的后面；即在执行到内存屏障这句指令时，在它前面的操作已经全部完成；</span></span></b></span></span></div><div><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 16px;"><span style="font-family: Verdana;">　　2）它会强制将对缓存的修改操作立即写入主存；</span></span></b></span></span></div><div><span style="color: rgb(227, 0, 0);"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 16px;"><span style="font-family: Verdana;">　　3）如果是写操作，它会导致其他CPU中对应的缓存行无效。</span></span></b></span></span></div><div><b><span style="font-size: 14px;"><span style="font-family: Verdana;"><br/></span></span></b></div><div>摘自：<a href="http://www.cnblogs.com/dolphin0520/p/3920373.html">http://www.cnblogs.com/dolphin0520/p/3920373.html</a></div><div><b><span style="font-size: 14px;"><span style="font-family: Verdana;"><br/></span></span></b></div></div></div></div><br/><div><table bgcolor="#D4DDE5" border="0" width="100%"><tr><td><h1>AOP相关</h1><b>来源网址：</b> <a href="http://blog.csdn.net/caterpillar_here/article/details/753473">http://blog.csdn.net/caterpillar_here/article/details/753473</a><br/><b>作者：</b> 958340585@qq.com<br/></td></tr></table></div><div><div>一：AOP的概念</div><div><br/></div><div>AOP全称 Aspect Oriented Programming 面向切面编程，是一种新的编程范式，实际的使用是作为OO编程的一种补充。</div><div>AOP通过分离交叉的关注点（cross-cutting concerns）来增加程序的模块化程度。</div><div>AOP为原有的代码增加一些行为（Advice），AOP并不不修改原有代码本身，而是通过声明切入点（PointCut）来指明哪些代码需要被增加新的行为。</div><div>例如，在所有函数名以set开头的方法调用的前都要执行log操作。</div><div>这里“以set开头的函数”是切入点（Point Cut），它指明或限定了哪些代码需要需要增加新行为，而“log操作”则是增加的新行为（Advice）。</div><div><br/></div><div>AOP编程范式将程序逻辑拆分成不同的部分（关注点Concern），几乎所有的编程方式都支持不同程度对关注点封装成不同的抽象的实体（例如函数，过程，模块，类和方法等），这些不同的实体能够通过组合来完成具体的功能。然而，不同的抽象实体包含的关注点可能是互相有交叉和重复。这些跨多个抽象实体的关注点被称为cross-cutting concerns或者horizontal concern，常用来举例的便是日志功能这个关注点，在典型的三层架构中，它既存在于Web层，也存在于Business层和Data层，显然这个不能再按照垂直方向进行划分了，而是一个水平方向上的关注点。这个就叫做cross-cutting concerns（横切关注点），就比较适合采用AOP来实现。</div><div><br/></div><div><br/></div><div>这个允许一些共性的代码或者功能能够在不修改源代码的情况下，被增加到现有的代码中，做到非侵入式修改代码。</div><div><br/></div><div>AOP编程的概念（术语）：</div><div><br/></div><div>Cross-cutting concern:（横切关注点）</div><div><br/></div><div>Advice</div><div><br/></div><div>需要被如的额外的代码，例如实现log的代码；</div><div><br/></div><div>Pointcut（切入点）</div><div>指明了程序中的横切关注点需要被应用到哪些地方。（或者是说从哪儿开始切，切成横切关注点，相当于在定义横切关注点的位置）。</div><div>例如：“所有已set开头的方法”，“所有xxxUserName的方法”等等，都在指定Pointcut；</div><div><br/></div><div>Aspect（方面）</div><div>PonitCut和Advice组合构成了一个Aspect。例如我们通过定义了一个Ponitcut和一个正确的advice，为我们的程序增加了一个log aspect。</div><div><br/></div><div><br/></div><div>Joinpoint（连接点）</div><div><br/></div><div>Aspect在应用程序执行时加入业务流程的点或时机称之为Joinpoint，具体来说，就是Advice在应用程序中被呼叫执行的时机，这个时机可能是某个方法被呼叫之前或之后（或两者都有），或是某个例外发生的时候。</div><div>例如：在xxxUserName方法之前或者之后（亦或者两者均可）执行。这种类似的说明便是Jointpoint。</div><div><br/></div><div>Target</div><div>一个Advice被应用的对象或目标对象</div><div><br/></div><div>Weave</div><div>Advice被应用至对象之上的过程称之为缝合（Weave），在AOP中缝合的方式有几个时间点：编译时期（Compile time）、类别加载时期（Classload time）、执行时期（Runtime）。</div><div><br/></div><div><br/></div><div><br/></div><div>示例：</div><div><br/></div><div>原来的业务流程划分：</div><div><br/></div><div><br/></div><div><img src="常见面试基础题_files/Image [24].png" type="image/png" data-filename="Image.png" style="height: auto;"/></div><div><br/></div><div><br/></div><div>现在需要加入logging和security等服务，</div><div><br/></div><div><br/></div><div><img src="常见面试基础题_files/Image [25].png" type="image/png" data-filename="Image.png" style="height: auto;"/></div><div><br/></div><div><br/></div><div><br/></div><div><img src="常见面试基础题_files/Image [26].png" type="image/png" data-filename="Image.png" style="height: auto;"/></div><div><br/></div><div>二：Spring中的AOP实现原理</div><div><br/></div><div>5种：</div><div><strong style="border: 0px; margin: 0px; padding: 0px; font-size: 14px; font-weight: bold; color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;, 宋体, &quot;Myriad Pro&quot;, Lato, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">前置增强</strong></div><div><b><span style="font-size: 14px;"><span style="font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif;"><span style="background-color: rgb(193, 230, 198);"><br/></span></span></span></b></div><div><b><span style="font-size: 14px;"><span style="font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif;"><span style="background-color: rgb(193, 230, 198);"><br/></span></span></span></b></div><div><b><span style="font-size: 14px;"><span style="font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif;"><span style="background-color: rgb(193, 230, 198);"><br/></span></span></span></b></div><div><strong style="border: 0px; margin: 0px; padding: 0px; font-size: 14px; font-weight: bold; color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;, 宋体, &quot;Myriad Pro&quot;, Lato, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">后置增强</strong></div><div><b><span style="font-size: 14px;"><span style="font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif;"><span style="background-color: rgb(193, 230, 198);"><br/></span></span></span></b></div><div><b><span style="font-size: 14px;"><span style="font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif;"><span style="background-color: rgb(193, 230, 198);"><br/></span></span></span></b></div><div><b><span style="font-size: 14px;"><span style="font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif;"><span style="background-color: rgb(193, 230, 198);"><br/></span></span></span></b></div><div><strong style="border: 0px; margin: 0px; padding: 0px; font-size: 14px; font-weight: bold; color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;, 宋体, &quot;Myriad Pro&quot;, Lato, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">环绕增强</strong></div><div><b><span style="font-size: 14px;"><span style="font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif;"><span style="background-color: rgb(193, 230, 198);"><br/></span></span></span></b></div><div><b><span style="font-size: 14px;"><span style="font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif;"><span style="background-color: rgb(193, 230, 198);"><br/></span></span></span></b></div><div><strong style="border: 0px; margin: 0px; padding: 0px; font-size: 14px; font-weight: bold; color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;, 宋体, &quot;Myriad Pro&quot;, Lato, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">抛出增强：</strong></div><div><span style="color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;, 宋体, &quot;Myriad Pro&quot;, Lato, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;">程序报错，抛出异常了，一般的做法是打印到控制台或日志文件中，这样很多地方都得去处理，有没有一个一劳永逸的方法呢？那就是 </span><strong style="border: 0px; margin: 0px; padding: 0px; font-size: 14px; font-weight: bold; color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;, 宋体, &quot;Myriad Pro&quot;, Lato, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">Throws Advice（抛出增强）</strong></div><div><b><span style="font-size: 14px;"><span style="font-family: 'Microsoft YaHei', 宋体, 'Myriad Pro', Lato, 'Helvetica Neue', Helvetica, Arial, sans-serif;"><span style="background-color: rgb(193, 230, 198);"><br/></span></span></span></b></div><div><strong style="border: 0px; margin: 0px; padding: 0px; font-size: 14px; font-weight: bold; color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;, 宋体, &quot;Myriad Pro&quot;, Lato, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">引入增强：</strong> <span style="color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;, 宋体, &quot;Myriad Pro&quot;, Lato, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;">以上提到的都是对方法的增强，那能否对类进行增强呢？用 AOP 的行话来讲，对方法的增强叫做 </span><strong style="border: 0px; margin: 0px; padding: 0px; font-size: 14px; font-weight: bold; color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;, 宋体, &quot;Myriad Pro&quot;, Lato, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">Weaving（织入）</strong><span style="color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;, 宋体, &quot;Myriad Pro&quot;, Lato, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;">，而对类的增强叫做 </span><strong style="border: 0px; margin: 0px; padding: 0px; font-size: 14px; font-weight: bold; color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;, 宋体, &quot;Myriad Pro&quot;, Lato, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">Introduction（引入）</strong><span style="color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;, 宋体, &quot;Myriad Pro&quot;, Lato, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;">。而 </span><strong style="border: 0px; margin: 0px; padding: 0px; font-size: 14px; font-weight: bold; color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;, 宋体, &quot;Myriad Pro&quot;, Lato, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial;">Introduction Advice（引入增强）</strong><span style="color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;, 宋体, &quot;Myriad Pro&quot;, Lato, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(193, 230, 198); text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;">就是对类的功能增强，它也是 Spring AOP 提供的最后一种增强。</span></div><div><br/></div><div>动态代理：</div><div>- JDK提供的Proxy（只能代理了声明了接口的类）</div><div>- CGLib字节码生成（可以代理没有声明接口的类，可以为任何类做增强）</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></div><br/><div><table bgcolor="#D4DDE5" border="0" width="100%"><tr><td><h1>匿名内部类和闭包</h1><b>来源网址：</b> <a href="https://www.cnblogs.com/cxying93/p/6103375.html">https://www.cnblogs.com/cxying93/p/6103375.html</a><br/><b>作者：</b> 958340585@qq.com<br/></td></tr></table></div><div><div><span style="font-size: 19px;"><br/></span></div><div><span style="font-size: 19px;"><b>1.闭包</b>：各种专业文献的闭包定义都非常抽象，我的理解是: 闭包就是能够读取其他函数内部变量的函数。</span></div><div><span style="font-size: 19px;">由于在javascript中，只有函数内部的子函数才能读取局部变量，所以说，闭包可以简单理解成“定义在一个函数内部的函数“。</span></div><div><span style="font-size: 19px;">所以，在本质上，闭包是将函数内部和函数外部连接起来的桥梁。</span></div><div><span style="font-size: 19px;"><br/></span></div><div><b><span style="font-size: 19px;">2.匿名内部类也是内部类</span></b></div><div><span style="font-size: 19px;"><br/></span></div><div><span style="font-size: 19px;"><b>3.内部类实例中包含外围对象的引用，这也是可能引发内存泄露的地方之一。</b>（<span style="font-size: 16px;">比如观察者模式中的监听器Listener，通常是传入一个匿名内部类实例给监听者，而这个实例会包含外围对象（观察者）的引用，因此相当于监听者通过监听器间接引用着观察者，如果监听者的生命周期特别长，那么观察者就看出现内存泄露，迟迟得不到GC）</span></span></div><div><span style="font-size: 19px;"><br/></span></div><div><b><span style="font-size: 19px;">4.内部类可以声明在：</span><span style="font-size: 19px;">类中，方法中。</span></b></div><div><span style="font-size: 19px;"><br/></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 16px;">在外围类Enclosing的方法中：</span></b></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 16px;">匿名内部类实例a引用外围类方法f的局部变量var的时候，这个局部变量var必须是final的，这是java处理闭包问题的方式。Java通过将局部变量var做一份copy var_copy到匿名内部类，成为其一个私有域。</span></b></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 16px;">因为f运行结束后var便不存在了（栈被清空了），但是此时匿名内部类实例a仍然存在内存在中，因此需要将其声明为final，保证var和var_copy的一致。</span></b></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 16px;"><br/></span></b></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><b><span style="font-size: 16px;">但是引用外围类Enclosing的实例的域和静态域，却不需要声明为final，这是因为当引用的域存在的时候，那么外围类实例肯定存在内存中。</span></b></span></div><div><br/></div><div><br/></div><div><span style="font-size: 19px;"><br/></span></div><div><span style="font-size: 19px;"><br/></span></div><div><br/></div><div><br/></div><div><br/></div></div><br/><div><table bgcolor="#D4DDE5" border="0" width="100%"><tr><td><h1>ConcurrentHashMap源码分析</h1><b>作者：</b> 958340585@qq.com<br/></td></tr></table></div><div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 19px;"><b>Java7：采用分段锁+不可变Entry+volatile的方式</b></span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 19px;"><b>Java8： 摒弃分段锁，采用CAS+volatile+链表转红黑树方式</b></span></span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">size的计算采用类似LongAdder的CounterCell，一个并发累加器，这个是分段锁的思想。多个CounterCell，最后累加。</span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">put方法：采用每个桶的第一个节点作为整个桶内节点的锁：</span></div><div><span style="font-size: 16px;">当桶空的时候，采用CAS插入节点，非空的时候，申请封锁桶内的first节点，然后进行相关操作。</span></div><div><br/></div><div><span style="font-size: 16px;">get方法：是不加锁的，因为Node节点的next是volatile的，因此可以保证内存可见性和同步性。（回忆一下volatile关键字）</span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">resize方法 实际上是transfer方法，当put方法需要增加一个节点的时候，如果增加到桶上的节点数量少于2，那ok，不需要计算size来和阈值比较，不考虑扩容。如果大于等于2那么计算size并考虑扩容。</span></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">扩容发生的时候，主要是transfer方法完成，可以有多个线程帮助transfer（会根据CPU的数量调整每个线程的transfer的index范围）。由于桶的容量扩容必须为2倍，因此旧桶上的链表在会根据与hash&amp;n是否等于0而被分为成两条链表</span></div><div><span style="font-size: 16px;">一条ln另有一条hn，lh在新表的位置保持不变，hn则是偏移n。</span></div><div><br/></div><div><br/></div></div><br/><div><table bgcolor="#D4DDE5" border="0" width="100%"><tr><td><h1>HashMap工作原理和扩容机制</h1><b>来源网址：</b> <a href="https://spground.github.io/2017/12/30/HashMap%E7%9A%84%E6%89%A9%E5%AE%B9/">https://spground.github.io/2017/12/30/HashMap%E7%9A%84%E6%89%A9%E5%AE%B9/</a><br/><b>作者：</b> 958340585@qq.com<br/></td></tr></table></div><div><div><h1 style="font-size: 26px; margin: 0px; padding: 0px; font-weight: 400; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; text-align: center; word-break: break-word;">HashMap工作原理和扩容机制</h1><div style="margin: 3px 0px 60px; color: rgb(153, 153, 153); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 12px; text-align: center;"><span style="margin-right: 3px;"> </span>发表于 2017-12-30 <span style="margin: 0px 0.5em;">|</span> <span style="margin-right: 3px;"> </span>分类于 <a href="https://spground.github.io/categories/Java%E6%BA%90%E7%A0%81/" rel="index" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;">Java源码 </a><span style="margin: 0px 0.5em;">|</span> <span style="margin-right: 3px;"> </span>阅读次数 13</div><div style="font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; text-align: justify; color: rgb(85, 85, 85); font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><h2 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="https://spground.github.io/2017/12/30/HashMap%E7%9A%84%E6%89%A9%E5%AE%B9/#1-HashMap%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="1. HashMap工作原理"></a>1. HashMap工作原理</h2><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>作为优秀的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Java</code>集合框架中的一个重要的成员，在很多编程场景下为我们所用。<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>作为数据结构散列表的一种实现，就其工作原理来讲单独列出一篇博客来讲都是不过分的。由于本文主要是简单总结其扩容机制，因此对于<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>的实现原理仅做简单的概述。</p><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>内部实现是一个<strong style="font-weight: bold;">桶数组</strong>，每个桶中存放着一个<strong style="font-weight: bold;">单链表</strong>的头结点。其中每个结点存储的是一个<strong style="font-weight: bold;">键值对</strong>整体（<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Entry</code>），<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>采用<strong style="font-weight: bold;">拉链法</strong>解决<strong style="font-weight: bold;">哈希冲突</strong>（关于哈希冲突后面会介绍）。</p><p style="margin: 0px 0px 20px;"><em>由于<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Java8</code>对<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>的某些地方进行了优化，以下的总结和源码分析都是基于<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Java7</code>。</em></p><p style="margin: 0px 0px 20px;">示意图如下：</p><p style="margin: 0px 0px 20px;"><a href="http://img.blog.csdn.net/20171119123859600?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxNDUzMjkwMQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" rel="group" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;"><img src="常见面试基础题_files/Image [27].png" type="image/png" data-filename="Image.png" style="border: 1px solid rgb(221, 221, 221); margin: 0px auto; max-width: 100%; height: auto; cursor: -webkit-zoom-in; box-sizing: border-box; padding: 3px; display: block !important;"/></a></p><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>提供两个重要的基本操作，<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">put(K, V)</code>和<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">get(K)</code>。</p><ul><li style="list-style: circle;">当调用<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">put</code>操作时，<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>计算键值K的哈希值，然后将其对应到<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>的某一个桶(<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">bucket</code>)上；此时找到以这个桶为头结点的一个单链表，然后顺序遍历该单链表找到某个节点的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Entry</code>中的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Key</code>是<strong style="font-weight: bold;">等于</strong>给定的参数K；若找到，则将其的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">old V</code>替换为参数指定的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">V</code>；否则直接在链表尾部插入一个新的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Entry</code>节点。</li><li style="list-style: circle;">对于<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">get(K)</code>操作类似于<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">put</code>操作，<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>通过计算键的哈希值，先找到对应的桶，然后遍历桶存放的单链表通过比照<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Entry</code>的键来找到对应的值。</li></ul><p style="margin: 0px 0px 20px;">以上就是<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>的基本工作原理，但是问题总是比我们看到的要复杂。由于哈希是一种压缩映射，换句话说就是每一个<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Entry</code>节点无法对应到一个<strong style="font-weight: bold;">只属于</strong>自己的桶，那么必然会存在多个<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Entry</code>共用一个桶，拉成一条链表的情况，这种情况叫做<strong style="font-weight: bold;">哈希冲突</strong>。当哈希冲突产生严重的情况，某一个桶后面挂着的链表就会特别长，我们知道<strong style="font-weight: bold;">查找</strong>最怕看见的就是顺序查找，那几乎就是无脑查找。</p><p style="margin: 0px 0px 20px;"><strong style="font-weight: bold;">哈希冲突</strong>无法完全避免，因此为了提高<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>的性能，<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>不得尽量<strong style="font-weight: bold;">缓解</strong>哈希冲突以<strong style="font-weight: bold;">缩短</strong>每个桶的外挂链表长度。</p><p style="margin: 0px 0px 20px;">频繁产生哈希冲突最重要的原因就像是<strong style="font-weight: bold;">要存储的Entry太多，而桶不够</strong>，这和供不应求的矛盾类似。因此，当<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>中的存储的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Entry</code>较多的时候，我们就要考虑<strong style="font-weight: bold;">增加桶的数量</strong>，这样对于后续要存储的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Entry</code>来讲，就会大大缓解哈希冲突。</p><p style="margin: 0px 0px 20px;">因此就涉及到<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>的扩容，上面算是回答了为什么扩容，那么什么时候扩容？扩容多少？怎么扩容？便是第二部分要总结的了。</p><h2 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="https://spground.github.io/2017/12/30/HashMap%E7%9A%84%E6%89%A9%E5%AE%B9/#2-HashMap%E6%89%A9%E5%AE%B9" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="2. HashMap扩容"></a>2. HashMap扩容</h2><h3 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 18px;"><a href="https://spground.github.io/2017/12/30/HashMap%E7%9A%84%E6%89%A9%E5%AE%B9/#2-1-HashMap%E7%9A%84%E6%89%A9%E5%AE%B9%E6%97%B6%E6%9C%BA" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="2.1 HashMap的扩容时机"></a>2.1 HashMap的扩容时机</h3><p style="margin: 0px 0px 20px;">在使用<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>的过程中，我们经常会遇到这样一个带参数的构造方法。</p><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; border: none; font-size: 14px; table-layout: fixed;width:416.7px;"><tbody><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;width:8.399328053755701%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;width:91.99568763330372%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 414px;"><span style="height: 20px;"><span style="color: rgb(129, 162, 190);"><span style="color: rgb(178, 148, 187);">public</span> <span style="color: rgb(138, 190, 183);">HashMap</span><span style="color: rgb(222, 147, 95);">(<span style="color: rgb(178, 148, 187);">int</span> initialCapacity, <span style="color: rgb(178, 148, 187);">float</span> loadFactor)</span> </span>;</span><br/></pre></td></tr></tbody></table><ul><li style="list-style: circle;">第一个参数：初始容量，指明初始的桶的个数；相当于桶数组的大小。</li><li style="list-style: circle;">第二个参数：装载因子，是一个0-1之间的系数，根据它来确定需要扩容的阈值，默认值是0.75。</li></ul><p style="margin: 0px 0px 20px;">现在开始通过源码来寻找扩容的时机：</p><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">put(K, V)</code>操作</p><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; border: none; font-size: 14px; table-layout: fixed;width:830.7px;"><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;width:4.213314072469002%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/><span style="height: 20px;">2</span><br/><span style="height: 20px;">3</span><br/><span style="height: 20px;">4</span><br/><span style="height: 20px;">5</span><br/><span style="height: 20px;">6</span><br/><span style="height: 20px;">7</span><br/><span style="height: 20px;">8</span><br/><span style="height: 20px;">9</span><br/><span style="height: 20px;">10</span><br/><span style="height: 20px;">11</span><br/><span style="height: 20px;">12</span><br/><span style="height: 20px;">13</span><br/><span style="height: 20px;">14</span><br/><span style="height: 20px;">15</span><br/><span style="height: 20px;">16</span><br/><span style="height: 20px;">17</span><br/><span style="height: 20px;">18</span><br/><span style="height: 20px;">19</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;width:96.00000000000001%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 866px;"><span style="height: 20px;"><span style="color: rgb(129, 162, 190);"><span style="color: rgb(178, 148, 187);">public</span> V <span style="color: rgb(138, 190, 183);">put</span><span style="color: rgb(222, 147, 95);">(K key, V value)</span> </span>{</span><br/><span style="height: 20px;">        <span style="color: rgb(178, 148, 187);">if</span> (key == <span style="color: rgb(178, 148, 187);">null</span>)</span><br/><span style="height: 20px;">            <span style="color: rgb(178, 148, 187);">return</span> putForNullKey(value);</span><br/><span style="height: 20px;">        <span style="color: rgb(178, 148, 187);">int</span> hash = hash(key);<span style="color: rgb(150, 152, 150);">//计算键的hash值</span></span><br/><span style="height: 20px;">        <span style="color: rgb(178, 148, 187);">int</span> i = indexFor(hash, table.length);<span style="color: rgb(150, 152, 150);">//通过hash值对应到桶位置</span></span><br/><span style="height: 20px;">        <span style="color: rgb(178, 148, 187);">for</span> (Entry&lt;K,V&gt; e = table[i]; e != <span style="color: rgb(178, 148, 187);">null</span>; e = e.next) {<span style="color: rgb(150, 152, 150);">//顺序遍历桶外挂的单链表</span></span><br/><span style="height: 20px;">            Object k;</span><br/><span style="height: 20px;">            <span style="color: rgb(178, 148, 187);">if</span> (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) {<span style="color: rgb(150, 152, 150);">//注意这里的键的比较方式== 或者 equals()</span></span><br/><span style="height: 20px;">                V oldValue = e.value;</span><br/><span style="height: 20px;">                e.value = value;</span><br/><span style="height: 20px;">                e.recordAccess(<span style="color: rgb(178, 148, 187);">this</span>);</span><br/><span style="height: 20px;">                <span style="color: rgb(178, 148, 187);">return</span> oldValue;</span><br/><span style="height: 20px;">            }</span><br/><span style="height: 20px;">        }</span><br/><br/><span style="height: 20px;">        modCount++;</span><br/><span style="height: 20px;">        addEntry(hash, key, value, i);<span style="color: rgb(150, 152, 150);">//遍历单链表完毕，没有找到与键相对的Entry，需要新建一个Entry换句话说就是桶i是一个空桶；</span></span><br/><span style="height: 20px;">        <span style="color: rgb(178, 148, 187);">return</span> <span style="color: rgb(178, 148, 187);">null</span>;</span><br/><span style="height: 20px;">    }</span><br/></pre></td></tr></table><p style="margin: 0px 0px 20px;">既然找到一个空桶，那么新建的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Entry</code>必然会是这个桶外挂单链表的第一个结点。通过<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">addEntry</code>，找到了扩容的时机。</p><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; border: none; font-size: 14px; table-layout: fixed;width:1444.5px;"><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;width:2.4229837313949463%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/><span style="height: 20px;">2</span><br/><span style="height: 20px;">3</span><br/><span style="height: 20px;">4</span><br/><span style="height: 20px;">5</span><br/><span style="height: 20px;">6</span><br/><span style="height: 20px;">7</span><br/><span style="height: 20px;">8</span><br/><span style="height: 20px;">9</span><br/><span style="height: 20px;">10</span><br/><span style="height: 20px;">11</span><br/><span style="height: 20px;">12</span><br/><span style="height: 20px;">13</span><br/><span style="height: 20px;">14</span><br/><span style="height: 20px;">15</span><br/><span style="height: 20px;">16</span><br/><span style="height: 20px;">17</span><br/><span style="height: 20px;">18</span><br/><span style="height: 20px;">19</span><br/><span style="height: 20px;">20</span><br/><span style="height: 20px;">21</span><br/><span style="height: 20px;">22</span><br/><span style="height: 20px;">23</span><br/><span style="height: 20px;">24</span><br/><span style="height: 20px;">25</span><br/><span style="height: 20px;">26</span><br/><span style="height: 20px;">27</span><br/><span style="height: 20px;">28</span><br/><span style="height: 20px;">29</span><br/><span style="height: 20px;">30</span><br/><span style="height: 20px;">31</span><br/><span style="height: 20px;">32</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;width:98.00437975563688%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 1548px;"><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">/**</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> * Adds a new entry with the specified key, value and hash code to</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> * the specified bucket.  It is the responsibility of this</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> * method to resize the table if appropriate.</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> *</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> * Subclass overrides this to alter the behavior of put method.</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> */</span></span><br/><span style="height: 20px;"><span style="color: rgb(129, 162, 190);"><span style="color: rgb(178, 148, 187);">void</span> <span style="color: rgb(138, 190, 183);">addEntry</span><span style="color: rgb(222, 147, 95);">(<span style="color: rgb(178, 148, 187);">int</span> hash, K key, V value, <span style="color: rgb(178, 148, 187);">int</span> bucketIndex)</span> </span>{</span><br/><span style="height: 20px;">    <span style="color: rgb(178, 148, 187);">if</span> ((size &gt;= threshold) &amp;&amp; (<span style="color: rgb(178, 148, 187);">null</span> != table[bucketIndex])) {<span style="color: rgb(150, 152, 150);">//当size大于等于某一个阈值thresholdde时候且该桶并不是一个空桶；</span></span><br/><span style="height: 20px;">      <span style="color: rgb(150, 152, 150);">/*这个这样说明比较好理解：因为size 已经大于等于阈值了，说明Entry数量较多，哈希冲突严重，那么若该Entry对应的桶不是一个空桶，这个Entry的加入必然会把原来的链表拉得更长，因此需要扩容；若对应的桶是一个空桶，那么此时没有必要扩容。*/</span></span><br/><span style="height: 20px;">        resize(<span style="color: rgb(181, 189, 104);">2</span> * table.length);<span style="color: rgb(150, 152, 150);">//将容量扩容为原来的2倍</span></span><br/><span style="height: 20px;">        hash = (<span style="color: rgb(178, 148, 187);">null</span> != key) ? hash(key) : <span style="color: rgb(181, 189, 104);">0</span>;</span><br/><span style="height: 20px;">        bucketIndex = indexFor(hash, table.length);<span style="color: rgb(150, 152, 150);">//扩容后的，该hash值对应的新的桶位置</span></span><br/><span style="height: 20px;">    }</span><br/><br/><span style="height: 20px;">    createEntry(hash, key, value, bucketIndex);<span style="color: rgb(150, 152, 150);">//在指定的桶位置上，创建一个新的Entry</span></span><br/><span style="height: 20px;">}</span><br/><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">/**</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> * Like addEntry except that this version is used when creating entries</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> * as part of Map construction or &quot;pseudo-construction&quot; (cloning,</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> * deserialization).  This version needn't worry about resizing the table.</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> *</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> * Subclass overrides this to alter the behavior of HashMap(Map),</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> * clone, and readObject.</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> */</span></span><br/><span style="height: 20px;"><span style="color: rgb(129, 162, 190);"><span style="color: rgb(178, 148, 187);">void</span> <span style="color: rgb(138, 190, 183);">createEntry</span><span style="color: rgb(222, 147, 95);">(<span style="color: rgb(178, 148, 187);">int</span> hash, K key, V value, <span style="color: rgb(178, 148, 187);">int</span> bucketIndex)</span> </span>{</span><br/><span style="height: 20px;">    Entry&lt;K,V&gt; e = table[bucketIndex];</span><br/><span style="height: 20px;">    table[bucketIndex] = <span style="color: rgb(178, 148, 187);">new</span> Entry&lt;&gt;(hash, key, value, e);<span style="color: rgb(150, 152, 150);">//链表的头插法插入新建的Entry</span></span><br/><span style="height: 20px;">    size++;<span style="color: rgb(150, 152, 150);">//更新size</span></span><br/><span style="height: 20px;">}</span><br/></pre></td></tr></table><p style="margin: 0px 0px 20px;">上面有几个重要成员变量：</p><ul><li style="list-style: circle;">size</li><li style="list-style: circle;">threshold</li></ul><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; border: none; font-size: 14px; table-layout: fixed;width:507.6px;"><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;width:6.895193065405832%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/><span style="height: 20px;">2</span><br/><span style="height: 20px;">3</span><br/><span style="height: 20px;">4</span><br/><span style="height: 20px;">5</span><br/><span style="height: 20px;">6</span><br/><span style="height: 20px;">7</span><br/><span style="height: 20px;">8</span><br/><span style="height: 20px;">9</span><br/><span style="height: 20px;">10</span><br/><span style="height: 20px;">11</span><br/><span style="height: 20px;">12</span><br/><span style="height: 20px;">13</span><br/><span style="height: 20px;">14</span><br/><span style="height: 20px;">15</span><br/><span style="height: 20px;">16</span><br/><span style="height: 20px;">17</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;width:94.0097192871382%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 507px;"><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">/**</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">  * The number of key-value mappings contained in this map.</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">  */</span>    </span><br/><span style="height: 20px;"><span style="color: rgb(178, 148, 187);">transient</span> <span style="color: rgb(178, 148, 187);">int</span> size;</span><br/><br/><span style="height: 20px;"> <span style="color: rgb(150, 152, 150);">/**</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">  * The next size value at which to resize (capacity * load factor).</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">  * @serial</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">  */</span></span><br/><span style="height: 20px;"> <span style="color: rgb(178, 148, 187);">int</span> threshold;</span><br/><br/><span style="height: 20px;"> <span style="color: rgb(150, 152, 150);">/**</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">  * The load factor for the hash table.</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">  *</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">  * @serial</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">  */</span></span><br/><span style="height: 20px;"> <span style="color: rgb(178, 148, 187);">final</span> <span style="color: rgb(178, 148, 187);">float</span> loadFactor;</span><br/></pre></td></tr></table><p style="margin: 0px 0px 20px;">由注释可以知道：</p><ul><li style="list-style: circle;"><p style="margin: 0px 0px 20px;">size记录的是map中包含的Entry的数量</p></li><li style="list-style: circle;"><p style="margin: 0px 0px 20px;">而threshold记录的是需要resize的阈值 且 <code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">threshold = loadFactor * capacity</code></p></li><li style="list-style: circle;"><p style="margin: 0px 0px 20px;">capacity 其实就是桶的长度</p><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; border: none; font-size: 14px; table-layout: fixed;width:539.1px;"><tbody><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;width:6.4923019847894645%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;width:93.99479087952486%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 549px;"><span style="height: 20px;">threshold = (<span style="color: rgb(178, 148, 187);">int</span>)Math.min(newCapacity * loadFactor, MAXIMUM_CAPACITY + <span style="color: rgb(181, 189, 104);">1</span>);</span><br/></pre></td></tr></tbody></table></li></ul><p style="margin: 0px 0px 20px;">因此现在总结出扩容的时机：</p><p style="margin: 0px 0px 20px;"><strong style="font-weight: bold;">当<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">map</code>中包含的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Entry</code>的数量大于等于<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">threshold = loadFactor * capacity</code>的时候，且新建的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Entry</code>刚好落在一个非空的桶上，此刻触发扩容机制，将其容量扩大为2倍。</strong>（为什么2倍，而不是1.5倍，3倍，10倍；解释见最后的补充）</p><p style="margin: 0px 0px 20px;">当<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">size</code>大于等于<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">threshold</code>的时候，并不一定会触发扩容机制，但是会很可能就触发扩容机制，只要有一个新建的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Entry</code>出现哈希冲突，则立刻<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">resize</code>。</p><p style="margin: 0px 0px 20px;">直到这里我们回答了什么时候扩容和扩容多少的问题，那么下面回答如何扩容的问题。</p><h3 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 18px;"><a href="https://spground.github.io/2017/12/30/HashMap%E7%9A%84%E6%89%A9%E5%AE%B9/#2-2-HashMap%E7%9A%84%E6%89%A9%E5%AE%B9%E8%BF%87%E7%A8%8B" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="2.2 HashMap的扩容过程"></a>2.2 HashMap的扩容过程</h3><p style="margin: 0px 0px 20px;">上面有一个很重要的方法，包含了几乎属于的扩容过程，这就是<br/></p><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; border: none; font-size: 14px; table-layout: fixed;width:114.3px;"><tbody><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;width:30.621172353455815%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;width:69.9430705261108%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 78px;"><span style="height: 20px;">resize()</span><br/></pre></td></tr></tbody></table><p style="margin: 0px 0px 20px;"></p><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; border: none; font-size: 14px; table-layout: fixed;width:688.5px;"><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;width:5.083514887436456%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/><span style="height: 20px;">2</span><br/><span style="height: 20px;">3</span><br/><span style="height: 20px;">4</span><br/><span style="height: 20px;">5</span><br/><span style="height: 20px;">6</span><br/><span style="height: 20px;">7</span><br/><span style="height: 20px;">8</span><br/><span style="height: 20px;">9</span><br/><span style="height: 20px;">10</span><br/><span style="height: 20px;">11</span><br/><span style="height: 20px;">12</span><br/><span style="height: 20px;">13</span><br/><span style="height: 20px;">14</span><br/><span style="height: 20px;">15</span><br/><span style="height: 20px;">16</span><br/><span style="height: 20px;">17</span><br/><span style="height: 20px;">18</span><br/><span style="height: 20px;">19</span><br/><span style="height: 20px;">20</span><br/><span style="height: 20px;">21</span><br/><span style="height: 20px;">22</span><br/><span style="height: 20px;">23</span><br/><span style="height: 20px;">24</span><br/><span style="height: 20px;">25</span><br/><span style="height: 20px;">26</span><br/><span style="height: 20px;">27</span><br/><span style="height: 20px;">28</span><br/><span style="height: 20px;">29</span><br/><span style="height: 20px;">30</span><br/><span style="height: 20px;">31</span><br/><span style="height: 20px;">32</span><br/><span style="height: 20px;">33</span><br/><span style="height: 20px;">34</span><br/><span style="height: 20px;">35</span><br/><span style="height: 20px;">36</span><br/><span style="height: 20px;">37</span><br/><span style="height: 20px;">38</span><br/><span style="height: 20px;">39</span><br/><span style="height: 20px;">40</span><br/><span style="height: 20px;">41</span><br/><span style="height: 20px;">42</span><br/><span style="height: 20px;">43</span><br/><span style="height: 20px;">44</span><br/><span style="height: 20px;">45</span><br/><span style="height: 20px;">46</span><br/><span style="height: 20px;">47</span><br/><span style="height: 20px;">48</span><br/><span style="height: 20px;">49</span><br/><span style="height: 20px;">50</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;width:95.00983494398359%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 1111px;"><span style="height: 20px;"> <span style="color: rgb(150, 152, 150);">/**</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> * Rehashes the contents of this map into a new array with a</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> * larger capacity.  This method is called automatically when the</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> * number of keys in this map reaches its threshold.</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> *</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> * If current capacity is MAXIMUM_CAPACITY, this method does not</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> * resize the map, but sets threshold to Integer.MAX_VALUE.</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> * This has the effect of preventing future calls.</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> *</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> * @param newCapacity the new capacity, MUST be a power of two;</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> *        must be greater than current capacity unless current</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> *        capacity is MAXIMUM_CAPACITY (in which case value</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> *        is irrelevant).</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> */</span></span><br/><span style="height: 20px;"><span style="color: rgb(129, 162, 190);"><span style="color: rgb(178, 148, 187);">void</span> <span style="color: rgb(138, 190, 183);">resize</span><span style="color: rgb(222, 147, 95);">(<span style="color: rgb(178, 148, 187);">int</span> newCapacity)</span> </span>{</span><br/><span style="height: 20px;">    Entry[] oldTable = table;</span><br/><span style="height: 20px;">    <span style="color: rgb(178, 148, 187);">int</span> oldCapacity = oldTable.length;</span><br/><span style="height: 20px;">    <span style="color: rgb(178, 148, 187);">if</span> (oldCapacity == MAXIMUM_CAPACITY) {<span style="color: rgb(150, 152, 150);">//最大容量为 1 &lt;&lt; 30</span></span><br/><span style="height: 20px;">        threshold = Integer.MAX_VALUE;</span><br/><span style="height: 20px;">        <span style="color: rgb(178, 148, 187);">return</span>;</span><br/><span style="height: 20px;">    }</span><br/><br/><span style="height: 20px;">    Entry[] newTable = <span style="color: rgb(178, 148, 187);">new</span> Entry[newCapacity];<span style="color: rgb(150, 152, 150);">//新建一个新表</span></span><br/><span style="height: 20px;">    <span style="color: rgb(178, 148, 187);">boolean</span> oldAltHashing = useAltHashing;</span><br/><span style="height: 20px;">    useAltHashing |= sun.misc.VM.isBooted() &amp;&amp;</span><br/><span style="height: 20px;">            (newCapacity &gt;= Holder.ALTERNATIVE_HASHING_THRESHOLD);</span><br/><span style="height: 20px;">    <span style="color: rgb(178, 148, 187);">boolean</span> rehash = oldAltHashing ^ useAltHashing;<span style="color: rgb(150, 152, 150);">//是否再hash</span></span><br/><span style="height: 20px;">    transfer(newTable, rehash);<span style="color: rgb(150, 152, 150);">//完成旧表到新表的转移</span></span><br/><span style="height: 20px;">    table = newTable;</span><br/><span style="height: 20px;">    threshold = (<span style="color: rgb(178, 148, 187);">int</span>)Math.min(newCapacity * loadFactor, MAXIMUM_CAPACITY + <span style="color: rgb(181, 189, 104);">1</span>);</span><br/><span style="height: 20px;">}</span><br/><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">/**</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> * Transfers all entries from current table to newTable.</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> */</span></span><br/><span style="height: 20px;"><span style="color: rgb(129, 162, 190);"><span style="color: rgb(178, 148, 187);">void</span> <span style="color: rgb(138, 190, 183);">transfer</span><span style="color: rgb(222, 147, 95);">(Entry[] newTable, <span style="color: rgb(178, 148, 187);">boolean</span> rehash)</span> </span>{</span><br/><span style="height: 20px;">    <span style="color: rgb(178, 148, 187);">int</span> newCapacity = newTable.length;</span><br/><span style="height: 20px;">    <span style="color: rgb(178, 148, 187);">for</span> (Entry&lt;K,V&gt; e : table) {<span style="color: rgb(150, 152, 150);">//遍历同桶数组中的每一个桶</span></span><br/><span style="height: 20px;">        <span style="color: rgb(178, 148, 187);">while</span>(<span style="color: rgb(178, 148, 187);">null</span> != e) {<span style="color: rgb(150, 152, 150);">//顺序遍历某个桶的外挂链表</span></span><br/><span style="height: 20px;">            Entry&lt;K,V&gt; next = e.next;<span style="color: rgb(150, 152, 150);">//引用next</span></span><br/><span style="height: 20px;">            <span style="color: rgb(178, 148, 187);">if</span> (rehash) {</span><br/><span style="height: 20px;">                e.hash = <span style="color: rgb(178, 148, 187);">null</span> == e.key ? <span style="color: rgb(181, 189, 104);">0</span> : hash(e.key);</span><br/><span style="height: 20px;">            }</span><br/><span style="height: 20px;">            <span style="color: rgb(178, 148, 187);">int</span> i = indexFor(e.hash, newCapacity);<span style="color: rgb(150, 152, 150);">//找到新表的桶位置;原桶数组中的某个桶上的同一链表中的Entry此刻可能被分散到不同的桶中去了，有效的缓解了哈希冲突。</span></span><br/><span style="height: 20px;">            e.next = newTable[i];<span style="color: rgb(150, 152, 150);">//头插法插入新表中</span></span><br/><span style="height: 20px;">            newTable[i] = e;</span><br/><span style="height: 20px;">            e = next;</span><br/><span style="height: 20px;">        }</span><br/><span style="height: 20px;">    }</span><br/><span style="height: 20px;">}</span><br/></pre></td></tr></table><p style="margin: 0px 0px 20px;">对于<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">resize</code>的过程，相对来讲是比较简单清晰易于理解的。<strong style="font-weight: bold;">旧桶数组中的某个桶的外挂单链表是通过头插法插入新桶数组中的，并且原链表中的Entry结点并不一定仍然在新桶数组的同一链表</strong>。</p><p style="margin: 0px 0px 20px;">示意图如下：</p><p style="margin: 0px 0px 20px;"><a href="http://tech.meituan.com/img/java-hashmap/jdk1.8%20hashMap%E6%89%A9%E5%AE%B9%E4%BE%8B%E5%9B%BE.png" rel="group" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;"><img src="http://tech.meituan.com/img/java-hashmap/jdk1.8%20hashMap%E6%89%A9%E5%AE%B9%E4%BE%8B%E5%9B%BE.png" style="border: 1px solid rgb(221, 221, 221); margin: 0px auto; max-width: 100%; height: auto; cursor: -webkit-zoom-in; box-sizing: border-box; padding: 3px; display: block !important;"></img></a></p><p style="margin: 0px 0px 20px;">这里很容易就想到多线程情况下，隐约感觉这个<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">transfer</code>方法在多线程环境下会乱套。事实上也是这样的，由于<strong style="font-weight: bold;">缺乏同步机制</strong>，当多个线程同时<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">resize</code>的时候，某个线程<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">t</code>所持有的引用<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">next</code>（参考上面代码<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">next</code>指向原桶数组中某个桶外挂单链表的下一个需要转移的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Entry</code>），可能已经被转移到了新桶数组中，那么最后该线程<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">t</code>实际上在对新的桶数组进行<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">transfer</code>操作。</p><p style="margin: 0px 0px 20px;">如果有更多的线程出现这种情况，那很可能出现大量线程都在对<strong style="font-weight: bold;">新桶数组</strong>进行<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">transfer</code>，那么就会出现多个线程对同一链表<strong style="font-weight: bold;">无限进行链表反转</strong>的操作，极易造成死循环，数据丢失等等，因此<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>不是线程安全的，考虑在多线程环境下使用并发工具包下的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">ConcurrentHashMap</code>。</p><h2 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="https://spground.github.io/2017/12/30/HashMap%E7%9A%84%E6%89%A9%E5%AE%B9/#3-%E8%A1%A5%E5%85%85" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="3. 补充"></a>3. 补充</h2><h3 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 18px;"><a href="https://spground.github.io/2017/12/30/HashMap%E7%9A%84%E6%89%A9%E5%AE%B9/#3-1-%E5%AE%B9%E9%87%8F%E5%BF%85%E9%A1%BB%E6%98%AF2%E7%9A%84%E5%B9%82" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="3.1 容量必须是2的幂"></a>3.1 容量必须是2的幂</h3><p style="margin: 0px 0px 20px;">在<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">resize()</code>，为什么容量需要时2倍这样扩张，而不是1.5倍，3倍，10倍，另外在<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>中有如下的代码：</p><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; border: none; font-size: 14px; table-layout: fixed;width:430.2px;"><tbody><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;width:8.135750813575083%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/><span style="height: 20px;">2</span><br/><span style="height: 20px;">3</span><br/><span style="height: 20px;">4</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;width:91.99710750760269%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 428px;"><span style="height: 20px;"> <span style="color: rgb(150, 152, 150);">/**</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> * The default initial capacity - MUST be a power of two.</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);"> */</span></span><br/><span style="height: 20px;"><span style="color: rgb(178, 148, 187);">static</span> <span style="color: rgb(178, 148, 187);">final</span> <span style="color: rgb(178, 148, 187);">int</span> DEFAULT_INITIAL_CAPACITY = <span style="color: rgb(181, 189, 104);">16</span>;</span><br/></pre></td></tr></tbody></table><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; border: none; font-size: 14px; table-layout: fixed;width:444.6px;"><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;width:7.872244714349977%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/><span style="height: 20px;">2</span><br/><span style="height: 20px;">3</span><br/><span style="height: 20px;">4</span><br/><span style="height: 20px;">5</span><br/><span style="height: 20px;">6</span><br/><span style="height: 20px;">7</span><br/><span style="height: 20px;">8</span><br/><span style="height: 20px;">9</span><br/><span style="height: 20px;">10</span><br/><span style="height: 20px;">11</span><br/><span style="height: 20px;">12</span><br/><span style="height: 20px;">13</span><br/><span style="height: 20px;">14</span><br/><span style="height: 20px;">15</span><br/><span style="height: 20px;">16</span><br/><span style="height: 20px;">17</span><br/><span style="height: 20px;">18</span><br/><span style="height: 20px;">19</span><br/><span style="height: 20px;">20</span><br/><span style="height: 20px;">21</span><br/><span style="height: 20px;">22</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;width:93.10620583885633%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 696px;"><span style="height: 20px;"><span style="color: rgb(129, 162, 190);"><span style="color: rgb(178, 148, 187);">public</span> <span style="color: rgb(138, 190, 183);">HashMap</span><span style="color: rgb(222, 147, 95);">(<span style="color: rgb(178, 148, 187);">int</span> initialCapacity, <span style="color: rgb(178, 148, 187);">float</span> loadFactor)</span> </span>{</span><br/><span style="height: 20px;">        <span style="color: rgb(178, 148, 187);">if</span> (initialCapacity &lt; <span style="color: rgb(181, 189, 104);">0</span>)</span><br/><span style="height: 20px;">            <span style="color: rgb(178, 148, 187);">throw</span> <span style="color: rgb(178, 148, 187);">new</span> IllegalArgumentException(<span style="color: rgb(181, 189, 104);">&quot;Illegal initial capacity: &quot;</span> +</span><br/><span style="height: 20px;">                                               initialCapacity);</span><br/><span style="height: 20px;">        <span style="color: rgb(178, 148, 187);">if</span> (initialCapacity &gt; MAXIMUM_CAPACITY)</span><br/><span style="height: 20px;">            initialCapacity = MAXIMUM_CAPACITY;</span><br/><span style="height: 20px;">        <span style="color: rgb(178, 148, 187);">if</span> (loadFactor &lt;= <span style="color: rgb(181, 189, 104);">0</span> || Float.isNaN(loadFactor))</span><br/><span style="height: 20px;">            <span style="color: rgb(178, 148, 187);">throw</span> <span style="color: rgb(178, 148, 187);">new</span> IllegalArgumentException(<span style="color: rgb(181, 189, 104);">&quot;Illegal load factor: &quot;</span> +</span><br/><span style="height: 20px;">                                               loadFactor);</span><br/><br/><span style="height: 20px;">        <span style="color: rgb(150, 152, 150);">// Find a power of 2 &gt;= initialCapacity 找到一个大于等于初始容量的且是2的幂的数作为实际容量</span></span><br/><span style="height: 20px;">        <span style="color: rgb(178, 148, 187);">int</span> capacity = <span style="color: rgb(181, 189, 104);">1</span>;</span><br/><span style="height: 20px;">        <span style="color: rgb(178, 148, 187);">while</span> (capacity &lt; initialCapacity)</span><br/><span style="height: 20px;">            capacity &lt;&lt;= <span style="color: rgb(181, 189, 104);">1</span>;</span><br/><br/><span style="height: 20px;">        <span style="color: rgb(178, 148, 187);">this</span>.loadFactor = loadFactor;</span><br/><span style="height: 20px;">        threshold = (<span style="color: rgb(178, 148, 187);">int</span>)Math.min(capacity * loadFactor, MAXIMUM_CAPACITY + <span style="color: rgb(181, 189, 104);">1</span>);</span><br/><span style="height: 20px;">        table = <span style="color: rgb(178, 148, 187);">new</span> Entry[capacity];</span><br/><span style="height: 20px;">        useAltHashing = sun.misc.VM.isBooted() &amp;&amp;</span><br/><span style="height: 20px;">                (capacity &gt;= Holder.ALTERNATIVE_HASHING_THRESHOLD);</span><br/><span style="height: 20px;">        init();</span><br/><span style="height: 20px;">    }</span><br/></pre></td></tr></table><p style="margin: 0px 0px 20px;">通过以上我们知道<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>的容量必须是2的幂，那么为什么要这么设计呢？答案当然是为了性能。在<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>通过键的哈希值进行定位桶位置的时候，调用了一个<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">indexFor(hash, table.length);</code>方法。</p><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; border: none; font-size: 14px; table-layout: fixed;width:340.2px;"><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;width:10.2880658436214%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/><span style="height: 20px;">2</span><br/><span style="height: 20px;">3</span><br/><span style="height: 20px;">4</span><br/><span style="height: 20px;">5</span><br/><span style="height: 20px;">6</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;width:89.99371802925603%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 328px;"><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">/**</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">    * Returns index for hash code h.</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">    */</span></span><br/><span style="height: 20px;">   <span style="color: rgb(129, 162, 190);"><span style="color: rgb(178, 148, 187);">static</span> <span style="color: rgb(178, 148, 187);">int</span> <span style="color: rgb(138, 190, 183);">indexFor</span><span style="color: rgb(222, 147, 95);">(<span style="color: rgb(178, 148, 187);">int</span> h, <span style="color: rgb(178, 148, 187);">int</span> length)</span> </span>{</span><br/><span style="height: 20px;">       <span style="color: rgb(178, 148, 187);">return</span> h &amp; (length-<span style="color: rgb(181, 189, 104);">1</span>);</span><br/><span style="height: 20px;">   }</span><br/></pre></td></tr></table><p style="margin: 0px 0px 20px;">可以看到这里是将哈希值<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">h</code>与桶数组的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">length-1</code>（实际上也是<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">map</code>的容量-1）进行了一个与操作得出了对应的桶的位置，<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">h &amp; (length-1)</code>。</p><p style="margin: 0px 0px 20px;">但是为什么不采用<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">h % length</code>这种计算方式呢？</p><p style="margin: 0px 0px 20px;"><a href="https://bugs.java.com/bugdatabase/view_bug.do?bug_id=4631373" rel="noopener" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" target="_blank">https://bugs.java.com/bugdatabase/view_bug.do?bug_id=4631373</a>中提出<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Java</code>的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">%</code>、<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">/</code>操作比<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">&amp;</code>慢10倍左右，因此采用<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">&amp;</code>运算会提高性能。</p><p style="margin: 0px 0px 20px;"><strong style="font-weight: bold;">通过限制<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">length</code>是一个<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">2的幂</code>数，<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">h &amp; (length-1)</code>和<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">h % length</code>结果是一致的。</strong>这就是为什么要限制容量必须是一个<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">2</code>的幂的原因。</p><p style="margin: 0px 0px 20px;">举个简单的例子说明这两个操作的结果一致性：</p><p style="margin: 0px 0px 20px;">假设有个<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">hashcode</code>是311，对应的二进制是(1 0011 0111)</p><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">length</code>为16，对应的二进制位(1 0000)</p><ul><li style="list-style: circle;"><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">%</code>操作：311 = 16*19 + 7；所以结果为7，二进制位(0111)；</p></li><li style="list-style: circle;"><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">&amp;</code>操作：(1 0011 0111) &amp; (0111) = 0111 = 7, 二进制位(0111)</p><p style="margin: 0px 0px 20px;">1 0011 0111 = (1 0011 0000) + (0111) = (1*2^4 + 1* 2^5 + 0*2^6 + 0*2^7 + 1*2^8 ) + 7 = <strong style="font-weight: bold;">2^4</strong>*(1 + 2 + 0 + 0 + 16) + 7 = <strong style="font-weight: bold;">16</strong> * 19 + 7; 和<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">%</code>操作一致。</p><p style="margin: 0px 0px 20px;">如果<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">length</code>是一个2的幂的数，那么<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">length-1</code>就会变成一个<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">mask</code>, 它会将<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">hashcode</code>低位取出来，<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">hashcode</code>的<strong style="font-weight: bold;">低位实际就是余数</strong>，和取余操作相比，与操作会将性能提升很多。</p></li></ul><h3 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 18px;"><a href="https://spground.github.io/2017/12/30/HashMap%E7%9A%84%E6%89%A9%E5%AE%B9/#3-2-rehash" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="3.2 rehash"></a>3.2 rehash</h3><p style="margin: 0px 0px 20px;">通过上面的分析可以看出，不同的键的的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">hashcode</code>仅仅只能通过<strong style="font-weight: bold;">低位</strong>来区分。<strong style="font-weight: bold;">高位的信息</strong>没有被充分利用，举个例子：</p><p style="margin: 0px 0px 20px;">假设容量为为<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">16</code>， 二进制位(<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">10000</code>)。</p><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">key1</code>的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">hashcode</code>为<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">11111 10101</code>，另一个<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">key2</code>的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">hashcode</code>为<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">00000 10101</code>，很明显这两个<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">hashcode</code>不是一样的，甚至连相似性（例如海明距离）也是很远的。但是直接进行<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">&amp;</code>操作得出的桶位置是同一个桶，这直接就产生了<strong style="font-weight: bold;">哈希冲突</strong>。</p><p style="margin: 0px 0px 20px;">由于键的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">hashCode</code>是<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>的使用者来设计的，主要也就是我们这群程序员，由于设计一个良好的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">hashcode</code>分布，是比较困难的，因此会容易出现分布质量差的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">hashcode</code>分布，<strong style="font-weight: bold;">极端情况就是：所有的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">hashCode</code>低位全相等，而高位不相等</strong>，这大大加大了哈希冲突，降低了<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>的性能。</p><p style="margin: 0px 0px 20px;">为了防止这种情况的出现，<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">HashMap</code>它使用一个<strong style="font-weight: bold;">supplemental hash function</strong>对键的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">hashCode</code>再进行了一个<strong style="font-weight: bold;">supplemental hash</strong> ，将最终的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">hash</code>值作为键的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">hash</code>值来进行桶的位置映射（也就是说<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">JDK</code>团队在为我们这群程序员加性能保险<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Orz</code>）。这个过程叫做再哈希(<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">rehash</code>)。</p><p style="margin: 0px 0px 20px;">经过一个<strong style="font-weight: bold;">supplemental hash</strong>过程后，能保证<strong style="font-weight: bold;">海明距离为常数</strong>的不同的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">hashcode</code>有一个<strong style="font-weight: bold;">哈希冲突次数上界</strong>（装载因子为0.75的时候，大约是8次）。</p><p style="margin: 0px 0px 20px;">参见下段代码：<br/></p><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; border: none; font-size: 14px; table-layout: fixed;width:577.8000000000001px;"><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;width:6.057459328487365%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/><span style="height: 20px;">2</span><br/><span style="height: 20px;">3</span><br/><span style="height: 20px;">4</span><br/><span style="height: 20px;">5</span><br/><span style="height: 20px;">6</span><br/><span style="height: 20px;">7</span><br/><span style="height: 20px;">8</span><br/><span style="height: 20px;">9</span><br/><span style="height: 20px;">10</span><br/><span style="height: 20px;">11</span><br/><span style="height: 20px;">12</span><br/><span style="height: 20px;">13</span><br/><span style="height: 20px;">14</span><br/><span style="height: 20px;">15</span><br/><span style="height: 20px;">16</span><br/><span style="height: 20px;">17</span><br/><span style="height: 20px;">18</span><br/><span style="height: 20px;">19</span><br/><span style="height: 20px;">20</span><br/><span style="height: 20px;">21</span><br/><span style="height: 20px;">22</span><br/><span style="height: 20px;">23</span><br/><span style="height: 20px;">24</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;width:94%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 585px;"><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">/**</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">    * Retrieve object hash code and applies a supplemental hash function to the</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">    * result hash, which defends against poor quality hash functions.  This is</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">    * critical because HashMap uses power-of-two length hash tables, that</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">    * otherwise encounter collisions for hashCodes that do not differ</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">    * in lower bits. Note: Null keys always map to hash 0, thus index 0.</span></span><br/><span style="height: 20px;"><span style="color: rgb(150, 152, 150);">    */</span></span><br/><span style="height: 20px;">   <span style="color: rgb(129, 162, 190);"><span style="color: rgb(178, 148, 187);">final</span> <span style="color: rgb(178, 148, 187);">int</span> <span style="color: rgb(138, 190, 183);">hash</span><span style="color: rgb(222, 147, 95);">(Object k)</span> </span>{</span><br/><span style="height: 20px;">       <span style="color: rgb(178, 148, 187);">int</span> h = <span style="color: rgb(181, 189, 104);">0</span>;</span><br/><span style="height: 20px;">       <span style="color: rgb(178, 148, 187);">if</span> (useAltHashing) {</span><br/><span style="height: 20px;">           <span style="color: rgb(178, 148, 187);">if</span> (k <span style="color: rgb(178, 148, 187);">instanceof</span> String) {</span><br/><span style="height: 20px;">               <span style="color: rgb(178, 148, 187);">return</span> sun.misc.Hashing.stringHash32((String) k);</span><br/><span style="height: 20px;">           }</span><br/><span style="height: 20px;">           h = hashSeed;</span><br/><span style="height: 20px;">       }</span><br/><span style="height: 20px;">   </span><br/><span style="height: 20px;">       h ^= k.hashCode();</span><br/><span style="height: 20px;">   </span><br/><span style="height: 20px;">       <span style="color: rgb(150, 152, 150);">// This function ensures that hashCodes that differ only by</span></span><br/><span style="height: 20px;">       <span style="color: rgb(150, 152, 150);">// constant multiples at each bit position have a bounded</span></span><br/><span style="height: 20px;">       <span style="color: rgb(150, 152, 150);">// number of collisions (approximately 8 at default load factor).</span></span><br/><span style="height: 20px;">       h ^= (h &gt;&gt;&gt; <span style="color: rgb(181, 189, 104);">20</span>) ^ (h &gt;&gt;&gt; <span style="color: rgb(181, 189, 104);">12</span>);</span><br/><span style="height: 20px;">       <span style="color: rgb(178, 148, 187);">return</span> h ^ (h &gt;&gt;&gt; <span style="color: rgb(181, 189, 104);">7</span>) ^ (h &gt;&gt;&gt; <span style="color: rgb(181, 189, 104);">4</span>);</span><br/><span style="height: 20px;">   }</span><br/></pre></td></tr></table><p style="margin: 0px 0px 20px;"></p><h2 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="https://spground.github.io/2017/12/30/HashMap%E7%9A%84%E6%89%A9%E5%AE%B9/#4-References" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="4 References"></a>4 References</h2><ol><li><a href="http://www.javarticles.com/2012/11/hashmap-faq.html" rel="noopener" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" target="_blank">http://www.javarticles.com/2012/11/hashmap-faq.html</a></li><li><a href="http://blog.csdn.net/u014532901/article/details/78573740" rel="noopener" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" target="_blank">http://blog.csdn.net/u014532901/article/details/78573740</a></li><li><a href="https://bugs.java.com/bugdatabase/view_bug.do?bug_id=4631373" rel="noopener" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" target="_blank">https://bugs.java.com/bugdatabase/view_bug.do?bug_id=4631373</a></li></ol></div></div></div><br/><div><table bgcolor="#D4DDE5" border="0" width="100%"><tr><td><h1>数据库事务隔离级别</h1><b>来源网址：</b> <a href="https://spground.github.io/2018/01/04/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB/">https://spground.github.io/2018/01/04/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB/</a><br/><b>作者：</b> 958340585@qq.com<br/></td></tr></table></div><div><div><h1 style="font-size: 26px; margin: 0px; padding: 0px; font-weight: 400; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; text-align: center; word-break: break-word;">数据库事务隔离级别</h1><div style="margin: 3px 0px 60px; color: rgb(153, 153, 153); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 12px; text-align: center;"><span style="margin-right: 3px;"> </span>发表于 2018-01-04 <span style="margin: 0px 0.5em;">|</span> <span style="margin-right: 3px;"> </span>分类于 <a href="https://spground.github.io/categories/MySQL/" rel="index" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;">MySQL </a><span style="margin: 0px 0.5em;">|</span> <span style="margin-right: 3px;"> </span>阅读次数 21</div><div style="font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; text-align: justify; color: rgb(85, 85, 85); font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><h2 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="https://spground.github.io/2018/01/04/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB/#1-%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="1.数据库事务"></a>1.数据库事务</h2><blockquote style="margin: 0px; padding: 0px 15px; color: rgb(102, 102, 102); border-left: 4px solid rgb(221, 221, 221);"><p style="margin: 0px 0px 20px;">事务是用户定义的一个数据库操作系列，这些操作要么全做要么全不做，是一个不可分割的工作单位。</p></blockquote><p style="margin: 0px 0px 20px;">事务是数据库中重要的概念，通常以<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">BEGIN TRANSACTION</code>开始，以<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">COMMIT</code>或者<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">ROLLBACK</code>结束。数据库事务具有四个著名的特性：<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">ACID</code>。</p><ul><li style="list-style: circle;"><p style="margin: 0px 0px 20px;">Automatic</p><p style="margin: 0px 0px 20px;">原子性：即事务中的操作要么都做，要么都不做。</p></li><li style="list-style: circle;"><p style="margin: 0px 0px 20px;">Consistency</p><p style="margin: 0px 0px 20px;">一致性：事务的执行的结果必须是使数据库从一个<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">一致性状态</code>到另一个<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">一致性状态</code>。这里的一致性状态指的是物理和逻辑上的数据库一致性状态。</p><p style="margin: 0px 0px 20px;">比如一个银行系统内部各个用户直接互相转账，无论如何转账，系统内部的金额的总数总是恒定不变的。</p></li><li style="list-style: circle;"><p style="margin: 0px 0px 20px;">Isolation</p><p style="margin: 0px 0px 20px;">隔离性：一个事务的执行不能被其他事务干扰。即一个事务内部的操作及使用的数据对其他并发事务是隔离的，并发执行的各个事务之间不能相互干扰。</p></li><li style="list-style: circle;"><p style="margin: 0px 0px 20px;">Duration</p><p style="margin: 0px 0px 20px;">持久性：一个事务一旦提交，它对数据库中数据的改变就该是永久性的。</p><p style="margin: 0px 0px 20px;">事务的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">ACID</code>特性需要数据库管理系统保证，同时事务也是数据库管理系统<strong style="font-weight: bold;">恢复</strong>和<strong style="font-weight: bold;">并发控制</strong>的基本单位。</p></li></ul><h2 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="https://spground.github.io/2018/01/04/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB/#2-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="2. 数据库并发控制"></a>2. 数据库并发控制</h2><h3 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 18px;"><a href="https://spground.github.io/2018/01/04/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB/#2-1-%E6%95%B0%E6%8D%AE%E4%B8%8D%E4%B8%80%E8%87%B4%E6%80%A7" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="2.1 数据不一致性"></a>2.1 数据不一致性</h3><p style="margin: 0px 0px 20px;">第1节提到了事务是并发控制的基本单位，由于并发控制可能会导致事务的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">ACID</code>特性遭到破坏，从而带来了数据库的数据不一致性。具体来讲，由于并发操作，多个事务的并发执行会带来如下四个典型的数据不一致性问题，而这几种问题主要是由于并发操作破坏了事务的<strong style="font-weight: bold;">隔离性</strong>（<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Isolation</code>）导致的，第3节会介绍<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">MySQL</code>数据库中并发控制机制下不同的事务隔离级别。</p><ol><li><p style="margin: 0px 0px 20px;"><strong style="font-weight: bold;">丢失修改</strong></p><p style="margin: 0px 0px 20px;">这种问题是最直观，最不应该发生的，例如两个事务<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>和<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T2</code>都读入同一数据进行修改，这样<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>提交修改结果后，随即<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T2</code>也提交了结果。这样，<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T2</code>便将<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>对数据的修改给覆盖了，这样就出现了丢失修改的问题了。</p><p style="margin: 0px 0px 20px;">这种问题发生的最主要原因是：<strong style="font-weight: bold;">两个或多个事务都在对同一数据项进行写操作</strong>。</p></li><li><p style="margin: 0px 0px 20px;"><strong style="font-weight: bold;">不可重复读</strong></p><p style="margin: 0px 0px 20px;">不可重复读指的是：事务<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>读取了某个数据项<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">A</code>，在事务<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>运行期间又有其他事务例如<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T2</code>对数据项<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">A</code>进行了修改并提交了，这样事务<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>再次读取数据项<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">A</code>的时候，发现结果不一致了。</p><p style="margin: 0px 0px 20px;">这种问题发生的最主要原因是：<strong style="font-weight: bold;">一个事务在对某一个数据项进行读操作，而另外的其他事务对该数据项进行了写操作。</strong></p></li><li><p style="margin: 0px 0px 20px;"><strong style="font-weight: bold;">读脏数据</strong></p><p style="margin: 0px 0px 20px;">读脏数据指的是：事务<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>正在修改某个数据项<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">A</code>，事务还未提交，而事务<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T2</code>读取了数据项<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">A</code>，但是随后事务<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>由于某种原因回滚了事务（并未提交事务），此时事务<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T2</code>读取到的数据项<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">A</code>的值和数据库中的值是不一致的，称事务<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T2</code>读了脏数据（<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Read Dirty</code>）。</p><p style="margin: 0px 0px 20px;">这种问题发生的最主要原因是：<strong style="font-weight: bold;">一个事务在对某一个数据项进行写操作，而另外的其他事务对该数据项进行了读操作。</strong></p></li><li><p style="margin: 0px 0px 20px;"><strong style="font-weight: bold;">幻读</strong></p><p style="margin: 0px 0px 20px;">幻读指的是：事务<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>按照某些条件从数据库中查询了一些数据记录，但是在事务<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>执行过程中，事务<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T2</code>插入或者删除了某些数据记录，这样当事务<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>再一次按照同样的条件从数据库查询的时候，发现多了或者少了某些记录。<strong style="font-weight: bold;">幻读本质上属于不可重复读</strong>，这里为了和第3节的隔离级别作对照，所以将其单独划出来作为幻读。</p><p style="margin: 0px 0px 20px;">产生的原因同不可重复读类似：<strong style="font-weight: bold;">由于事务<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>按条件对数据表中的很多数据项查询的时候，这时候其他事务<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T2</code>对数据表进行了其他数据项的写操作（插入、修改或者删除）。</strong></p><p style="margin: 0px 0px 20px;">为解决并发带来的一系列问题，主要有<strong style="font-weight: bold;">封锁、时间戳和乐观控制法</strong>来进行并发机制的设计。而<strong style="font-weight: bold;">封锁</strong>是最常用的数据库管理系统并发机制采用的方法。</p></li></ol><h3 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 18px;"><a href="https://spground.github.io/2018/01/04/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB/#2-2-%E5%B0%81%E9%94%81%E5%92%8C%E5%B9%B6%E5%8F%91%E5%BA%A6" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="2.2 封锁和并发度"></a>2.2 封锁和并发度</h3><p style="margin: 0px 0px 20px;">封锁是实现并发控制的一个非常重要的技术。所谓封锁就是在事务对某个数据对象例如表、记录等进行操作的时候（读或写），先向系统请求对其加锁，成功加锁后，该事务才可以继续对其进行操作；否则，只能等待直到加锁成功。</p><p style="margin: 0px 0px 20px;">具体来说：基本的锁分为两种：</p><ul><li style="list-style: circle;">排他锁（Exclusive Locks）又称写锁，X锁；</li><li style="list-style: circle;"><p style="margin: 0px 0px 20px;">共享锁（Share Locks）又称读锁，S锁；</p><p style="margin: 0px 0px 20px;">采用封锁确实能来保证并发下的数据库事务的特性，但是封锁带来了额外的系统开销，进而影响到系统的并发度。</p><p style="margin: 0px 0px 20px;">例如1：当事务<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>对某个数据项<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">A</code>进行写操作的时候，为避免<strong style="font-weight: bold;">读脏数据</strong>， 那么所有的其他向对数据项<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">A</code>进行读取的事务都得进行等待，那么系统此刻的并发度就大大降低了。</p><p style="margin: 0px 0px 20px;">例如2：为避免<strong style="font-weight: bold;">幻读</strong>的产生，当事务<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>对某一表<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Table</code>中的某几行记录进项查询的时候，由于封锁了整个表<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Table</code>，此时所有其他想对该表<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Table</code>进项增加删除记录的事务都得进行等待，由于封锁的<strong style="font-weight: bold;">数据对象粒度太大</strong>，导致并发度大大降低。</p><p style="margin: 0px 0px 20px;">综上可以看出：<strong style="font-weight: bold;">封锁和并发度本来就是一种矛盾，一方面我们想要尽可能的保证事务的隔离性进而避免2.1节中的问题；另一方面我们有希望系统的并发度不要下降。</strong></p><p style="margin: 0px 0px 20px;">既然是矛盾，那就只能妥协，为了充分满足不同的应用场景，<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">MySQL</code>数据库<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">InnoDB</code>支持4种不同的事务隔离级别。</p><p style="margin: 0px 0px 20px;">第3节将结合两种不同的封锁类型来理解这四种不同的事务隔离级别。</p></li></ul><h2 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="https://spground.github.io/2018/01/04/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB/#3-%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="3. 事务隔离级别"></a>3. 事务隔离级别</h2><p style="margin: 0px 0px 20px;">考虑到封锁和并发度的权衡，<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">MySQL</code>为用户提供了四种不同的事务隔离性级别。并发度从低到高（数据一致性强度从高到低）分别是：</p><ul><li style="list-style: circle;">SERIALIZABLE（可串行化）可避免脏读、不可重复读、幻读情况的发生。</li><li style="list-style: circle;">REPEATABLE READ（可重复读）可避免脏读、不可重复读情况的发生。</li><li style="list-style: circle;">READ COMMITTED（读已提交）可避免脏读情况发生。</li><li style="list-style: circle;">READ UNCOMMITTED（读未提交）最低级别，以上情况均无法保证。</li></ul><p style="margin: 0px 0px 20px;">通过2.1节我们知道了几种数据不一致产生的主要原因，即写写和读写同时发生在多个事务对同一数据对象的情况下，另外还介绍了两种锁类型：X锁和S锁。</p><p style="margin: 0px 0px 20px;">两个事务的X锁和S锁可以构成一个相容矩阵：如下：</p><table style="border-collapse: collapse; border-spacing: 0px; margin: 20px 0px; width: 899px; border: 1px solid rgb(221, 221, 221); font-size: 14px; table-layout: fixed;"><thead><tr><th style="padding: 8px 8px 10px; text-align: left; vertical-align: middle; font-weight: 700; border-bottom: 3px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);"><strong style="font-weight: bold;">T1 / T2</strong></th><th style="padding: 8px 8px 10px; text-align: left; vertical-align: middle; font-weight: 700; border-bottom: 3px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);"><strong style="font-weight: bold;">X锁</strong></th><th style="padding: 8px 8px 10px; text-align: left; vertical-align: middle; font-weight: 700; border-bottom: 3px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);"><strong style="font-weight: bold;">S锁</strong></th></tr></thead><tbody><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);"><strong style="font-weight: bold;">X锁</strong></td><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">No</td><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">No</td></tr><tr><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);"><strong style="font-weight: bold;">S锁</strong></td><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">No</td><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">Yes</td></tr></tbody></table><p style="margin: 0px 0px 20px;">含义就是：<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>对数据项加了<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">X</code>锁，则<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T2</code>不能对其加<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">S</code>和<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">X</code>锁，<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T2</code>对数据项加了<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">S</code>锁，则<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>可以对其加<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">S</code>锁而不能加<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">X</code>锁。（<strong style="font-weight: bold;">相容矩阵的加锁顺序都是是T1先加锁，T2后加锁</strong>）</p><ul><li style="list-style: circle;"><strong style="font-weight: bold;">READ UNCOMMITTED（读未提交）</strong>最低级别，以上情况均无法保证。</li></ul><p style="margin: 0px 0px 20px;">官网给出建议：该隔离级别仅仅能做查询</p><blockquote style="margin: 0px; padding: 0px 15px; color: rgb(102, 102, 102); border-left: 4px solid rgb(221, 221, 221);"><p style="margin: 0px 0px 20px;">The <strong style="font-weight: bold;">isolation level</strong> that provides the least amount of protection between transactions. Queries employ a <strong style="font-weight: bold;">locking</strong> strategy that allows them to proceed in situations where they would normally wait for another transaction. However, this extra performance comes at the cost of less reliable results, including data that has been changed by other transactions and not committed yet (known as <strong style="font-weight: bold;">dirty read</strong>). Use this isolation level with great caution, and be aware that the results might not be consistent or reproducible, depending on what other transactions are doing at the same time. Typically, transactions with this isolation level only do queries, not insert, update, or delete operations.</p></blockquote><p style="margin: 0px 0px 20px;">由于其不能保证<strong style="font-weight: bold;">读脏数据</strong>，因此S锁和X是相容的；因此可能如下：</p><table style="border-collapse: collapse; border-spacing: 0px; margin: 20px 0px; width: 899px; border: 1px solid rgb(221, 221, 221); font-size: 14px; table-layout: fixed;"><thead><tr><th style="padding: 8px 8px 10px; text-align: left; vertical-align: middle; font-weight: 700; border-bottom: 3px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">T1 / T2</th><th style="padding: 8px 8px 10px; text-align: left; vertical-align: middle; font-weight: 700; border-bottom: 3px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">X锁</th><th style="padding: 8px 8px 10px; text-align: left; vertical-align: middle; font-weight: 700; border-bottom: 3px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">S锁</th></tr></thead><tbody><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);"><strong style="font-weight: bold;">X锁</strong></td><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">No(?待考证)</td><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">Yes</td></tr><tr><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);"><strong style="font-weight: bold;">S锁</strong></td><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">Yes</td><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">Yes</td></tr></tbody></table><ul><li style="list-style: circle;"><strong style="font-weight: bold;">READ COMMITTED（读已提交）</strong>可避免脏读情况发生。</li></ul><p style="margin: 0px 0px 20px;">读已提交，避免脏读，但是不能保证可重复读；说明<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">X</code>锁和<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T2</code>的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">S</code>锁不相容；而<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">S</code>锁和<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">X</code>锁相容的。<strong style="font-weight: bold;">也就是保证了某个事务在写数据项的时候，其他事务是不能读写该数据项的。</strong></p><table style="border-collapse: collapse; border-spacing: 0px; margin: 20px 0px; width: 899px; border: 1px solid rgb(221, 221, 221); font-size: 14px; table-layout: fixed;"><thead><tr><th style="padding: 8px 8px 10px; text-align: left; vertical-align: middle; font-weight: 700; border-bottom: 3px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">T1 / T2</th><th style="padding: 8px 8px 10px; text-align: left; vertical-align: middle; font-weight: 700; border-bottom: 3px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">X锁</th><th style="padding: 8px 8px 10px; text-align: left; vertical-align: middle; font-weight: 700; border-bottom: 3px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">S锁</th></tr></thead><tbody><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);"><strong style="font-weight: bold;">X锁</strong></td><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">No</td><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">No</td></tr><tr><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);"><strong style="font-weight: bold;">S锁</strong></td><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">Yes</td><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">Yes</td></tr></tbody></table><ul><li style="list-style: circle;"><strong style="font-weight: bold;">REPEATABLE READ（可重复读）</strong>可避免脏读、不可重复读情况的发生。</li></ul><p style="margin: 0px 0px 20px;">可重复读，避免了脏读和不可重复读；说明<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">X</code>锁和<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T2</code>的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">S</code>锁、<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T1</code>的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">S</code>锁和<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">T2</code>的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">X</code>锁都不相容。<strong style="font-weight: bold;">也就是保证了某个事务在写某个数据项的时候，其他事务不能读写该数据项；且在读某个数据项时，其他事务只能读该数据项。</strong></p><table style="border-collapse: collapse; border-spacing: 0px; margin: 20px 0px; width: 899px; border: 1px solid rgb(221, 221, 221); font-size: 14px; table-layout: fixed;"><thead><tr><th style="padding: 8px 8px 10px; text-align: left; vertical-align: middle; font-weight: 700; border-bottom: 3px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">T1 / T2</th><th style="padding: 8px 8px 10px; text-align: left; vertical-align: middle; font-weight: 700; border-bottom: 3px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">X锁</th><th style="padding: 8px 8px 10px; text-align: left; vertical-align: middle; font-weight: 700; border-bottom: 3px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">S锁</th></tr></thead><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">X锁</td><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">No</td><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">No</td></tr><tr><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">S锁</td><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">No</td><td style="padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; border-bottom: 1px solid rgb(221, 221, 221); border-right: 1px solid rgb(238, 238, 238);">Yes</td></tr></table><ul><li style="list-style: circle;"><strong style="font-weight: bold;">SERIALIZABLE（可串行化）</strong>可避免脏读、不可重复读、幻读情况的发生。</li></ul><p style="margin: 0px 0px 20px;">为了避免幻读、不可重复读、脏读、丢失修改等产生，将并发事务的<strong style="font-weight: bold;">事务调度策略</strong>设置为为<strong style="font-weight: bold;">可串行化调度</strong>，这能保证该事务调度策略的运行结果同<strong style="font-weight: bold;">某一种串行调度</strong>结果一致，但是这会极大的降低并发度；同时，这也是<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">MySQL</code>的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">InnoDB</code>提供的最高的事务隔离级别，这里的相容矩阵同3。</p><blockquote style="margin: 0px; padding: 0px 15px; color: rgb(102, 102, 102); border-left: 4px solid rgb(221, 221, 221);"><p style="margin: 0px 0px 20px;">The <strong style="font-weight: bold;">isolation level</strong> that uses the most conservative locking strategy, to prevent any other <strong style="font-weight: bold;">transactions</strong> from inserting or changing data that was read by this transaction, until it is finished. This way, the same query can be run over and over within a transaction, and be certain to retrieve the same set of results each time. Any attempt to change data that was committed by another transaction since the start of the current transaction, cause the current transaction to wait.</p><p style="margin: 0px 0px 20px;">This is the default isolation level specified by the SQL standard. In practice, this degree of strictness is rarely needed, so the default isolation level for <code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">InnoDB</code> is the next most strict, <strong style="font-weight: bold;">REPEATABLE READ</strong>.</p></blockquote><h2 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="https://spground.github.io/2018/01/04/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB/#4-References" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="4. References"></a>4. References</h2><p style="margin: 0px 0px 20px;"><a href="https://dev.mysql.com/doc/refman/5.7/en/glossary.html#glos_isolation_level" rel="noopener" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" target="_blank">https://dev.mysql.com/doc/refman/5.7/en/glossary.html#glos_isolation_level</a></p><p style="margin: 0px 0px 20px;"><a href="http://www.cnblogs.com/xdp-gacl/p/3984001.html" rel="noopener" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" target="_blank">http://www.cnblogs.com/xdp-gacl/p/3984001.html</a></p><div style="margin: 0px 0px 20px;"><div><a href="https://spground.github.io/2018/01/04/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB/" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;">《数据库系统概论》王珊，萨师煊</a></div></div></div></div></div><br/><div><table bgcolor="#D4DDE5" border="0" width="100%"><tr><td><h1>数据库索引</h1><b>来源网址：</b> <a href="https://spground.github.io/2018/01/09/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/">https://spground.github.io/2018/01/09/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/</a><br/><b>作者：</b> 958340585@qq.com<br/></td></tr></table></div><div><div><h1 style="font-size: 26px; margin: 0px; padding: 0px; font-weight: 400; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; text-align: center; word-break: break-word;">数据库索引</h1><div style="margin: 3px 0px 60px; color: rgb(153, 153, 153); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 12px; text-align: center;"><span style="margin-right: 3px;"> </span>发表于 2018-01-09 <span style="margin: 0px 0.5em;">|</span> <span style="margin-right: 3px;"> </span>分类于 <a href="https://spground.github.io/categories/MySQL/" rel="index" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;">MySQL </a><span style="margin: 0px 0.5em;">|</span> <span style="margin-right: 3px;"> </span>阅读次数 10</div><div style="font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; text-align: justify; color: rgb(85, 85, 85); font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><h1 style="font-size: 22px; margin: 0px; padding: 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;"><a href="https://spground.github.io/2018/01/09/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#1-%E6%A6%82%E8%BF%B0" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="1.概述"></a>1.概述</h1><p style="margin: 0px 0px 20px;">大量的结构化数据通常被存储在数据库中，通过简单的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">SQL</code>语句，我们可以方便的查询、修改、插入、删除这些数据。例如当我们执行：</p><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; width: auto; border: none; font-size: 14px; table-layout: fixed;"><tbody><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 306px;"><span style="height: 20px;"><span style="color: rgb(178, 148, 187);">SELECT</span> * <span style="color: rgb(178, 148, 187);">FROM</span> <span style="color: rgb(178, 148, 187);">USER</span> <span style="color: rgb(178, 148, 187);">WHERE</span> userName = <span style="color: rgb(181, 189, 104);">'A'</span>;</span><br/></pre></td></tr></tbody></table><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">DBMS</code>会将表中所有用户名等于<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">A</code>的用户的记录返回给我们，但随着表中的记录越来越多，比如说从<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">10000</code>增加到<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">1000万</code>，这时候我们往往会发现查询的速度会变慢很多。这时候，通常的做法就是在<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">userName</code>列上面创建<strong style="font-weight: bold;">索引</strong>，以加快数据的查询。</p><p style="margin: 0px 0px 20px;">那么<strong style="font-weight: bold;">什么是数据库索引</strong>、<strong style="font-weight: bold;">为什么数据库索引可以加快查询</strong>以及<strong style="font-weight: bold;">如何正确的使用数据库索引</strong>呢？以下将从这个几个方面做一下简单的总结。</p><h1 style="font-size: 22px; margin: 0px; padding: 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;"><a href="https://spground.github.io/2018/01/09/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#2-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="2. 数据库索引"></a>2. 数据库索引</h1><h2 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="https://spground.github.io/2018/01/09/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#2-1-%E6%94%B9%E5%96%84%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9F%A5%E8%AF%A2" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="2.1 改善数据库查询"></a>2.1 改善数据库查询</h2><h3 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 18px;"><a href="https://spground.github.io/2018/01/09/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#2-1-1-%E7%94%A8%E6%A0%91%E5%BD%A2%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E8%BF%9B%E8%A1%8C%E6%9F%A5%E6%89%BE" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="2.1.1 用树形数据结构进行查找"></a>2.1.1 用树形数据结构进行查找</h3><p style="margin: 0px 0px 20px;">通常来讲，我们在对数据库中数据最频繁的操作便是查询，比如我们给定一定的查询条件将某个表的数据记录查询出来，因此这实际就是一个<strong style="font-weight: bold;">查找问题</strong>。</p><p style="margin: 0px 0px 20px;">查找问题最简单直接的就是<strong style="font-weight: bold;">顺序查找</strong>，其时间复杂度为<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">O(N)</code>。</p><p style="margin: 0px 0px 20px;">例如第1节中的：</p><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; width: auto; border: none; font-size: 14px; table-layout: fixed;"><tbody><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 306px;"><span style="height: 20px;"><span style="color: rgb(178, 148, 187);">SELECT</span> * <span style="color: rgb(178, 148, 187);">FROM</span> <span style="color: rgb(178, 148, 187);">USER</span> <span style="color: rgb(178, 148, 187);">WHERE</span> userName = <span style="color: rgb(181, 189, 104);">'A'</span>;</span><br/></pre></td></tr></tbody></table><ul><li style="list-style: circle;">假设<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">userName</code>列中不存在重复值，很显然我们在查找这条记录的时候需要对数据表中数据记录一行一行的扫描，然后直到找到我们需要的那条记录，这种方式的平均时间复杂度是<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">O(N/2)</code></li><li style="list-style: circle;">假设<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">userName</code>列中存在重复值，这时情况更加糟糕，我们需要进行所谓的<strong style="font-weight: bold;">全表扫描</strong>找到所有的记录，这种方式的时间复杂度是<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">O(N)</code></li></ul><p style="margin: 0px 0px 20px;">即便是在<strong style="font-weight: bold;">内存</strong>中对大量数据进行<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">O(N)</code>的查询我们也很难接受，更何况是这些数据是存在<strong style="font-weight: bold;">外部存储</strong>设备上（常见便是<strong style="font-weight: bold;">磁盘</strong>）。磁盘的一次访问时间大约是<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">8ms</code>，而内存的一次访问约<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">50ns</code>。</p><p style="margin: 0px 0px 20px;">因此当数据量特别大的时候，数据库用<strong style="font-weight: bold;">顺序查找</strong>的方式进行数据查找几乎是不可接受的。</p><p style="margin: 0px 0px 20px;">在众多的用于查找的数据结构中，<strong style="font-weight: bold;">平衡的树形结构</strong>是十分合适被用来进行查找，其查找的时间复杂度可以降到<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">O(logN)</code>，当然某些<strong style="font-weight: bold;">数据库索引</strong>便是采用树形结构来组织的。</p><p style="margin: 0px 0px 20px;">到现在，我们总结了为什么要使用数据库索引的原因，并且我们总结了数据库索引可以使用树形数据结构来加快数据的查询。下面给出<a href="https://en.wikipedia.org/wiki/Database_index" rel="noopener" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" target="_blank">维基百科</a>的定义:</p><blockquote style="margin: 0px; padding: 0px 15px; color: rgb(102, 102, 102); border-left: 4px solid rgb(221, 221, 221);"><p style="margin: 0px 0px 20px;">数据库索引是一种花费额外存储空间以加快数据库数据检索的数据结构。</p></blockquote><p style="margin: 0px 0px 20px;">我们知道我们可以采用<strong style="font-weight: bold;">平衡二叉排序树</strong>来组织数据库索引，每个节点存储关键字和其对应的数据（或者数据所在的磁盘地址）。这样在进行查询的时候，我们可以将时间复杂度降低到我们需要的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">O(logN)</code>。但是实际上数据库索引并不是采用这种二叉树的数据结构，而是采用<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">B-Tree</code>来实现数据库索引以加快数据查询。关于为什么不使用二叉搜索树的原因以及<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">B-Tree</code>是什么，2.1.2会进行总结。</p><h3 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 18px;"><a href="https://spground.github.io/2018/01/09/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#2-1-2-B-Tree" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="2.1.2 B-Tree"></a>2.1.2 B-Tree</h3><p style="margin: 0px 0px 20px;"><a href="http://img.blog.csdn.net/20161215230141403?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveW9uZ2hlbmdfMTk5OQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" rel="group" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;"><img src="常见面试基础题_files/Image [28].png" type="image/png" data-filename="Image.png" style="border: 1px solid rgb(221, 221, 221); display: block !important; margin: 0px auto; max-width: 100%; height: auto; cursor: -webkit-zoom-in; box-sizing: border-box; padding: 3px;"/></a></p><p style="margin: 0px 0px 20px;">上图为磁盘的某个盘面的解剖示意图，由于一次寻道操作很慢，为了数据读取的有效性，磁盘是按扇区为单位存储和访问数据的。关于磁盘的工作原理，参见这篇<a href="http://blog.csdn.net/yongheng_1999/article/details/53678814" rel="noopener" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" target="_blank">博文</a>。</p><ol><li>如果我们用二叉搜索树组织<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">10000</code>个关键字，那么我们的树的高度约为：14。因此如果我们要查询叶节点上的关键字则需要14次磁盘访问，大约耗时:<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">8ms*14=112ms</code>。虽然这个结果对于顺序查找好了不少，但实际上为了降低磁盘访问次数，我们可以进一步将树变得矮一点便可以<strong style="font-weight: bold;">降低磁盘访问次数</strong>，从而提高查询速度。</li><li>为了降低树的高度，我们将二叉树中的每个节点最多<strong style="font-weight: bold;">俩孩子变为多个孩子</strong>，便可以将树的高度大大降低。</li></ol><p style="margin: 0px 0px 20px;"><a href="https://techdifferences.com/wp-content/uploads/2017/10/Untitled-7.jpg" rel="group" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;"><img src="常见面试基础题_files/Image [4].jpg" type="image/jpeg" data-filename="Image.jpg" style="border: 1px solid rgb(221, 221, 221); display: block !important; margin: 0px auto; max-width: 100%; height: auto; cursor: -webkit-zoom-in; box-sizing: border-box; padding: 3px;"/></a></p><p style="margin: 0px 0px 20px;">而这种平衡的、每个节点多与2个孩子节点的树形数据结构便是<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">B-Tree</code>。上图是一个简单的对比图，从图中我们可以看出<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">B Tree</code>相比二叉树，其每一个结点里面含有<strong style="font-weight: bold;">多个关键字</strong>，从而大大降低了树的高度。当每个结点允许存放100个关键字的时候，<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">10000</code>个关键字的B Tree树高大约为2，因此仅需要2次磁盘访问便可以访问到数据，大约耗时<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">8ms*2=16ms</code>，相比于前面的二叉树来讲，性能又提升了不少。<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">B Tree</code>的结点的大小通常被设置为一个扇区的大小（假如说是<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">4KB</code>），这样一次磁盘访问便可以读取到该节点所有关键字。</p><p style="margin: 0px 0px 20px;">简单总结一下：<strong style="font-weight: bold;">由于数据存储在磁盘上，考虑到磁盘的特性，因此通过将结点的大小增加到一个扇区的大小，从而降低查找树的高度以减少耗时的磁盘访问次数，这就是<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">B Tree</code>适合用来查找基于外部存储数据的主要原因。</strong></p><p style="margin: 0px 0px 20px;">到这里我们总结了数据库索引为什么不采用二叉搜索树实现的原因。接下来我们稍微简单的总结下<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">B Tree</code>相关的内容。</p><p style="margin: 0px 0px 20px;">来自<a href="https://en.wikipedia.org/wiki/B-tree" rel="noopener" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" target="_blank">维基</a>的定义：</p><blockquote style="margin: 0px; padding: 0px 15px; color: rgb(102, 102, 102); border-left: 4px solid rgb(221, 221, 221);"><p style="margin: 0px 0px 20px;">在计算机科学中，<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">B</code>树是一棵自平衡树，它允许在<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">logN</code>的时间内完成查找、顺序访问、插入和删除。B树是一种泛化的二叉搜索树，其结点可以拥有超过2个孩子结点。</p></blockquote><p style="margin: 0px 0px 20px;">一棵5阶的B树大概长这样（5阶指的是孩子节点数量最多为5）：</p><p style="margin: 0px 0px 20px;"><a href="https://upload.wikimedia.org/wikipedia/commons/thumb/6/65/B-tree.svg/600px-B-tree.svg.png" rel="group" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;"><img src="常见面试基础题_files/Image [29].png" type="image/png" data-filename="Image.png" style="border: 1px solid rgb(221, 221, 221); display: block !important; margin: 0px auto; max-width: 100%; height: auto; cursor: -webkit-zoom-in; box-sizing: border-box; padding: 3px;"/></a></p><p style="margin: 0px 0px 20px;">B树中的结点通常分为<strong style="font-weight: bold;">三类</strong>：</p><ul><li style="list-style: circle;">根结点：包含关键字，包含关键字的个数<strong style="font-weight: bold;">有上界无下界</strong>，有孩子结点，包含指向孩子结点的指针</li><li style="list-style: circle;">内部结点：包含关键字，且包含关键字的个数<strong style="font-weight: bold;">有上下界</strong>，有孩子结点，包含指向孩子结点的指针</li><li style="list-style: circle;">叶子结点：包含关键字，且包含关键字的个数<strong style="font-weight: bold;">有上下界</strong>，没有孩子结点，不包含指向孩子结点的指针</li></ul><p style="margin: 0px 0px 20px;">关于B树的性质的描写有很多种，以下是从《算法导论》总结出来的：</p><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">B</code>树应该满足的性质：</p><ol><li>每个叶结点具有相同的深度，即树的高度<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">h</code></li><li>每个结点所包含的关键字个数都有个下界（根节点没有下界）和上界，上下界通过一个被称为<strong style="font-weight: bold;">B树的最小度数</strong>的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">t&gt;=2</code>来表示
<ul><li style="list-style: circle;">除了根节点以外，每个结点至少含有<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">t-1</code>个关键字；因此除了根节点以外的每个内部结点至少含有<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">t</code>个孩子。如果树非空，根节点至少能含有1个关键字以保证树的最小度<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">t&gt;=2</code></li><li style="list-style: circle;">每个结点最多包含<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">2t-1</code>个关键字。因此一个内部结点最多有<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">2t</code>个孩子，当一个结点恰好有<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">2t-1</code>个关键字的时候，称该结点是<strong style="font-weight: bold;">满的</strong></li></ul></li></ol><p style="margin: 0px 0px 20px;">另外，有的地方存在<strong style="font-weight: bold;">阶</strong>的概念，指的是B树允许非叶子结点的最大孩子结点个数，关于<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">B Tree</code>的基本操作<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Search</code>、<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Insertion</code>、<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Delete</code>等将在下一篇博文介绍，这里不做介绍。</p><p style="margin: 0px 0px 20px;">数据库索引中的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">B</code>树中，每个结点包含如下内容：</p><ul><li style="list-style: circle;">存储代表被索引数据库列的关键字</li><li style="list-style: circle;">指向孩子结点的指针</li><li style="list-style: circle;">指向数据库记录的指针</li></ul><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">B Tree</code>虽然能很好的帮助我们改善诸如<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">WHERE userName = 'A'</code>之类的查询，但是<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">B</code>树还存在以下两个缺点：</p><ol><li>但是对于一些常见的<strong style="font-weight: bold;">范围查询</strong>，例如<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">WHERE age &gt; 10</code>等，我们就需要中序遍历<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">B</code>树，这会增加缓存miss率，从而增加我们的磁盘访问次数。</li><li>与此同时，由于我们在结点中不仅仅存储了指向孩子结点的指针，而且还存储了指向数据库记录的指针，因此每个结点的<strong style="font-weight: bold;">大小就会较大</strong>，又由于扇区的大小通常是固定的，因此每个结点包含的关键字的个数就会<strong style="font-weight: bold;">减少</strong>，也就是说<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">B</code>的阶会<strong style="font-weight: bold;">降低</strong>（树会变高）。</li></ol><p style="margin: 0px 0px 20px;">因此为避免上述两个缺点，<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">B</code>树的变体<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">B+</code>树便应运而生。</p><h3 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 18px;"><a href="https://spground.github.io/2018/01/09/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#2-1-3-B-%E6%A0%91" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="2.1.3 B+树"></a>2.1.3 B+树</h3><p style="margin: 0px 0px 20px;">同B树不同，B+树主要有如下不同：</p><ul><li style="list-style: circle;">B+树中关键字和指向数据记录的指针仅仅存放在<strong style="font-weight: bold;">叶子结点</strong>；</li><li style="list-style: circle;">B+树中<strong style="font-weight: bold;">同一关键字可能出现在多个结点中</strong>，但是仅仅叶子结点还有指向数据记录的指正；而B树<strong style="font-weight: bold;">同一关键字仅仅可能出现在一个结点中</strong>；</li><li style="list-style: circle;">由于B+树的关键字和数据记录的信息仅仅保存在叶子结点中，因此无论查找是否成功，都会深入到B+树的叶子结点，因此<strong style="font-weight: bold;">查询时间基本上是稳定</strong>的；而B树的查询时间和关键字在树中的位置有关，因此<strong style="font-weight: bold;">查询时间不是稳定的</strong>；</li></ul><p style="margin: 0px 0px 20px;">除此之外，<strong style="font-weight: bold;">B+树将叶结点通过链表的形式连接起来</strong>，这样避免了<strong style="font-weight: bold;">范围查询</strong>或者<strong style="font-weight: bold;">全表扫描</strong>的时候，对B树的中序遍历。</p><p style="margin: 0px 0px 20px;">下图是B树和B+树的对比图：</p><p style="margin: 0px 0px 20px;"><a href="https://i.stack.imgur.com/l6UyF.png" rel="group" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;"><img src="常见面试基础题_files/Image [30].png" type="image/png" data-filename="Image.png" style="border: 1px solid rgb(221, 221, 221); display: block !important; margin: 0px auto; max-width: 100%; height: auto; cursor: -webkit-zoom-in; box-sizing: border-box; padding: 3px;"/></a></p><h2 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px;"><a href="https://spground.github.io/2018/01/09/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#2-2-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95%E7%9A%84%E7%B1%BB%E5%9E%8B" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="2.2 数据库索引的类型"></a>2.2 数据库索引的类型</h2><p style="margin: 0px 0px 20px;">由于不同数据库提供的索引分类不同，因此很多时候索引分类是混乱的。但是常见的数据库索引主要有如下几种：</p><ol><li><strong style="font-weight: bold;">聚集索引（Clustered Index）</strong>：数据表中的记录的物理顺序和索引关键字的逻辑顺序是一致的。由于这个特性，聚集索引能够大大加快类似顺序检索、反序检索和范围查询。由于聚集索引的逻辑顺序和记录的物理顺序是一致的，显然一张数据表聚集索引<strong style="font-weight: bold;">只能有一个</strong>，<strong style="font-weight: bold;">通常建立在主键上</strong>。</li><li><strong style="font-weight: bold;">非聚集索引（Non-Clustered Index）</strong>：和聚集索引相反，记录的物理顺序和索引关键字的逻辑顺序不是一致的。因此一个数据表可以有<strong style="font-weight: bold;">0个或者多个</strong>非聚集索引。</li><li><strong style="font-weight: bold;">唯一索引（Unique Index）</strong>：唯一索引是不允许其中任何两行具有相同索引值的索引。</li><li><strong style="font-weight: bold;">非唯一索引（Non-Unique Index）</strong>：允许任何两行具有相同索引值的索引，仅仅是用来加快查询。</li><li><strong style="font-weight: bold;">主键索引（Primary Index）</strong>：建立在主键上的索引，由于主键具有<strong style="font-weight: bold;">唯一性</strong>，因此从某种意义上来讲，<strong style="font-weight: bold;">主键索引</strong>也是<strong style="font-weight: bold;">唯一索引</strong>，又因为主键列具有<strong style="font-weight: bold;">不经常修改</strong>等特性，因此主键索引通常也设置为<strong style="font-weight: bold;">聚集索引</strong>。由于主键索引的特殊性，大多数数据库都会默认在主键上自动创建主键索引。</li></ol><h1 style="font-size: 22px; margin: 0px; padding: 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;"><a href="https://spground.github.io/2018/01/09/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#3-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="3. 创建数据库索引"></a>3. 创建数据库索引</h1><p style="margin: 0px 0px 20px;">虽然索引会加快数据的查询，但是维护索引需要<strong style="font-weight: bold;">额外的空间和时间</strong>。因此需要在<strong style="font-weight: bold;">合适的列上创建合适的索引</strong>的，否则只会盲目的创建索引只会适得其反。</p><p style="margin: 0px 0px 20px;"><strong style="font-weight: bold;">适合创建索引</strong>的列具有如下特点：</p><ul><li style="list-style: circle;">对于经常处于WHERE、JOIN、OrderBy字句中的列应该创建索引，以加快查询</li><li style="list-style: circle;">对于需要<strong style="font-weight: bold;">保持唯一性</strong>的列，需要在创建<strong style="font-weight: bold;">唯一索引</strong></li><li style="list-style: circle;">主键列默认是创建<strong style="font-weight: bold;">主键索引</strong></li><li style="list-style: circle;"><strong style="font-weight: bold;">聚集索引</strong>应该创建在<strong style="font-weight: bold;">很少修改</strong>的列</li></ul><p style="margin: 0px 0px 20px;"><strong style="font-weight: bold;">不适合创建索引</strong>的列具有如下特点：</p><ul><li style="list-style: circle;"><p style="margin: 0px 0px 20px;">查询中很少使用或者参考的列不应该创建索引；</p></li><li style="list-style: circle;"><p style="margin: 0px 0px 20px;">对于取值很少的列，例如性别列没必要创建索引；</p></li><li style="list-style: circle;"><p style="margin: 0px 0px 20px;">定义为text、image、bit的列不适和创建索引；</p></li><li style="list-style: circle;"><p style="margin: 0px 0px 20px;">频繁修改的列不适合创建索引，维护索引的代价会很大；</p><p style="margin: 0px 0px 20px;">​</p></li></ul><p style="margin: 0px 0px 20px;">因为物理顺序和逻辑顺序是一致的，如果被索引的列频繁更新，为了维护逻辑顺序很物理顺序的一致性，会付出很大的代价，因此聚集索引应该建立在<strong style="font-weight: bold;">很少和不更新的列</strong>上面，</p><h1 style="font-size: 22px; margin: 0px; padding: 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;"><a href="https://spground.github.io/2018/01/09/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#4-References" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="4. References"></a>4. References</h1><ol><li><a href="https://stackoverflow.com/questions/1108/how-does-database-indexing-work" rel="noopener" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" target="_blank">https://stackoverflow.com/questions/1108/how-does-database-indexing-work</a></li><li><a href="https://stackoverflow.com/questions/107132/what-columns-generally-make-good-indexes/8937872#8937872" rel="noopener" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" target="_blank">https://stackoverflow.com/questions/107132/what-columns-generally-make-good-indexes/8937872#8937872</a></li><li><a href="https://stackoverflow.com/questions/870218/differences-between-b-trees-and-b-trees" rel="noopener" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" target="_blank">https://stackoverflow.com/questions/870218/differences-between-b-trees-and-b-trees</a></li><li><a href="http://blog.csdn.net/yongheng_1999/article/details/53678814" rel="noopener" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" target="_blank">http://blog.csdn.net/yongheng_1999/article/details/53678814</a></li><li><a href="http://blog.csdn.net/kennyrose/article/details/7532032" rel="noopener" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" target="_blank">http://blog.csdn.net/kennyrose/article/details/7532032</a></li></ol></div></div></div><br/><div><table bgcolor="#D4DDE5" border="0" width="100%"><tr><td><h1>Java并发中的锁</h1><b>来源网址：</b> <a href="https://spground.github.io/2018/02/03/JAVA%E9%94%81/">https://spground.github.io/2018/02/03/JAVA%E9%94%81/</a><br/><b>作者：</b> 958340585@qq.com<br/></td></tr></table></div><div><div><h1 style="font-size: 22px; margin: 0px; padding: 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; color: rgb(85, 85, 85); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">1. 并发控制和锁</h1><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">在多处理器的时代，程序设计中经常采用多线程以充分利用处理器的性能。在多线程环境下，由于存在共享变量、共享资源等情况，因此有时候需要对多线程的并发访问进行控制。</p><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">同很多并发控制的问题类似（例如数据库的并发控制），程序中的并发控制也会使用到例如加<strong style="font-weight: bold;">悲观锁、乐观锁、多版本视图</strong>等技术来完成并发控制（或者称为多线程同步）。因此谈到并发控制，基本上会涉及到锁的概念，而涉及到锁的问题也基本是属于并发控制问题的范畴。</p><h1 style="font-size: 22px; margin: 0px; padding: 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; color: rgb(85, 85, 85); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><a href="https://spground.github.io/2018/02/03/JAVA%E9%94%81/#2-Java%E4%B8%AD%E7%9A%84%E9%94%81" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="2. Java中的锁"></a>2. Java中的锁</h1><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">Java中涉及到很多锁的概念，而涉及到的使用层次也不同，因此这里做一个简单的总结。</p><ol style="color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><li><p style="margin: 0px 0px 20px;"><strong style="font-weight: bold;">内置锁/隐式锁</strong></p><p style="margin: 0px 0px 20px;">Java的每一个对象都有一个<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">monitor</code>，且这个<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">monitor</code>每一次仅能被一个线程所拥有，这就是内置锁或者叫隐式锁。内置锁的获取、释放通常是如下的范式写的：</p><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; border: none; font-size: 14px; table-layout: fixed;width:468px;"><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;width:7.478632478632479%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/><span style="height: 20px;">2</span><br/><span style="height: 20px;">3</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;width:92.99488210564796%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 421px;"><span style="height: 20px;"><span style="color: rgb(178, 148, 187);">synchronized</span>(obj) {</span><br/><span style="height: 20px;">  <span style="color: rgb(150, 152, 150);">//当线程获取到obj的内置锁--monitor时，线程会进入到此代码块</span></span><br/><span style="height: 20px;">}</span><br/></pre></td></tr></table><p style="margin: 0px 0px 20px;">释放内置锁：</p><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; width: auto; border: none; font-size: 14px; table-layout: fixed;"><tbody><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 304px;"><span style="height: 20px;">obj.wait();<span style="color: rgb(150, 152, 150);">//当前线程放弃obj对象上的内置锁</span></span><br/></pre></td></tr></tbody></table><p style="margin: 0px 0px 20px;">或者退出<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">synchronized</code>代码块，也会自动释放获取的内置锁。</p></li><li><p style="margin: 0px 0px 20px;"><strong style="font-weight: bold;">显式锁</strong></p><p style="margin: 0px 0px 20px;">顾名思义，显式锁是显式定义的锁。例如并发工具包的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Lock</code>接口下的一些实现类。</p><p style="margin: 0px 0px 20px;">内置锁在<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Java</code>的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">synchronized</code>关键字的配合下使用起来十分的简单，但是简答的预定义的东西往往缺乏灵活性，因此为了补充内置锁，显示锁提供了一些额外的特性例如：<strong style="font-weight: bold;">可轮询</strong>、<strong style="font-weight: bold;">可超时</strong>、<strong style="font-weight: bold;">可中断锁</strong>等。这些特性在实际的编程中提供着很大的灵活性。</p><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Lock</code>类的实现类常见的主要是<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">ReentrantLock</code>类。</p><p style="margin: 0px 0px 20px;">该类提供了几个重要的方法：</p><ul><li style="list-style: circle;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">lock()</code> 语义同<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">synchronized</code></li><li style="list-style: circle;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">tryLock()</code> 提供了可超时的特性，在某些情况下可以通过该特性<strong style="font-weight: bold;">避免死锁</strong>的发生</li><li style="list-style: circle;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">lockInterruptibly() throws InterruptedException</code> 在获取锁失败被阻塞的时候可被<strong style="font-weight: bold;">中断</strong>，而采用<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">synchronized</code>获取内置锁的时候，无法被中断</li></ul></li><li><p style="margin: 0px 0px 20px;">​</p></li><li><p style="margin: 0px 0px 20px;"><strong style="font-weight: bold;">可重入锁</strong>(Reentrant Lock)</p><p style="margin: 0px 0px 20px;">可重入锁指的是已经获取了某个锁的线程去尝试再一次该锁的时候，是可以直接获取到的，而不会阻塞。</p><p style="margin: 0px 0px 20px;">可重入锁避免了如下的死锁情况的产生:</p><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; width: auto; border: none; font-size: 14px; table-layout: fixed;"><tbody><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/><span style="height: 20px;">2</span><br/><span style="height: 20px;">3</span><br/><span style="height: 20px;">4</span><br/><span style="height: 20px;">5</span><br/><span style="height: 20px;">6</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 199px;"><span style="height: 20px;"><span style="color: rgb(129, 162, 190);"><span style="color: rgb(178, 148, 187);">synchronized</span> <span style="color: rgb(178, 148, 187);">void</span> <span style="color: rgb(138, 190, 183);">get</span><span style="color: rgb(222, 147, 95);">()</span> </span>{</span><br/><span style="height: 20px;">  set();</span><br/><span style="height: 20px;">}</span><br/><span style="height: 20px;"><span style="color: rgb(129, 162, 190);"><span style="color: rgb(178, 148, 187);">synchronized</span> <span style="color: rgb(178, 148, 187);">void</span> <span style="color: rgb(138, 190, 183);">set</span><span style="color: rgb(222, 147, 95);">()</span> </span>{</span><br/><span style="height: 20px;">  </span><br/><span style="height: 20px;">}</span><br/></pre></td></tr></tbody></table><p style="margin: 0px 0px 20px;">如果锁不可重入，那么当线程A获取到了“保护”get方法的锁时，那么再进入set方法的时候，会无限期阻塞。而此时，除了线程A，没有任何线程拥有该锁，因此线程A相相等于握着锁去等锁，首尾相连形成死锁了。</p></li><li><p style="margin: 0px 0px 20px;"><strong style="font-weight: bold;">读写锁</strong>(Read Write Lock)</p><p style="margin: 0px 0px 20px;">通常的锁都为互斥锁，大多数被共享的变量都是由这种互斥锁保护。一个时刻只能有一个线程在访问该变量。这个在该变量<strong style="font-weight: bold;">读多写少</strong>的情况下显然效率不高。因为<strong style="font-weight: bold;">读读</strong>不需要并发控制，而<strong style="font-weight: bold;">读写、 写写</strong>才需要并发控制。那么显然应该同数据库的并发控制加锁的策略一样，应该提供两种锁，一个是共享锁（读锁）、另一个是互斥锁（写锁），当读取变量的时候，主需要获取共享锁，而写变量的时候才去获取互斥锁。</p><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Java</code>并发包中提供了常用的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">ReentrantReadWriteLock</code>锁，该锁提供了<strong style="font-weight: bold;">读锁、写锁、以及锁降级</strong>等特性。</p><ul><li style="list-style: circle;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">readLock()</code> 返回该读写锁对应的读锁</li><li style="list-style: circle;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">writeLock()</code> 返回该读写锁对应的写锁</li></ul></li><li><p style="margin: 0px 0px 20px;">​</p><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; border: none; font-size: 14px; table-layout: fixed;width:518px;"><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;width:6.756756756756757%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/><span style="height: 20px;">2</span><br/><span style="height: 20px;">3</span><br/><span style="height: 20px;">4</span><br/><span style="height: 20px;">5</span><br/><span style="height: 20px;">6</span><br/><span style="height: 20px;">7</span><br/><span style="height: 20px;">8</span><br/><span style="height: 20px;">9</span><br/><span style="height: 20px;">10</span><br/><span style="height: 20px;">11</span><br/><span style="height: 20px;">12</span><br/><span style="height: 20px;">13</span><br/><span style="height: 20px;">14</span><br/><span style="height: 20px;">15</span><br/><span style="height: 20px;">16</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;width:94.00820392616465%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 464px;"><span style="height: 20px;"><span style="color: rgb(178, 148, 187);">private</span> ReadWriteLock lock = <span style="color: rgb(178, 148, 187);">new</span> ReentrantReadWriteLock(<span style="color: rgb(178, 148, 187);">true</span>);</span><br/><span style="height: 20px;"><span style="color: rgb(178, 148, 187);">private</span> Lock r = lock.readLock(), w = lock.writeLock();</span><br/><span style="height: 20px;">...</span><br/><span style="height: 20px;">w.lock();</span><br/><span style="height: 20px;"><span style="color: rgb(178, 148, 187);">try</span> {</span><br/><span style="height: 20px;">  sb.append(append); <span style="color: rgb(150, 152, 150);">//降级为read lock</span></span><br/><span style="height: 20px;">  r.lock();</span><br/><span style="height: 20px;">} <span style="color: rgb(178, 148, 187);">finally</span> {</span><br/><span style="height: 20px;">  w.unlock();<span style="color: rgb(150, 152, 150);">//still hold read lock</span></span><br/><span style="height: 20px;">}</span><br/><span style="height: 20px;"><span style="color: rgb(178, 148, 187);">try</span> {</span><br/><span style="height: 20px;">...</span><br/><span style="height: 20px;">} <span style="color: rgb(178, 148, 187);">finally</span> {</span><br/><span style="height: 20px;">  r.unlock();</span><br/><span style="height: 20px;">}</span><br/><span style="height: 20px;">...</span><br/></pre></td></tr></table><p style="margin: 0px 0px 20px;">读写所允许<strong style="font-weight: bold;">锁降级</strong>：当一个线程持有写锁的时候，可以直接降级为读锁，而<strong style="font-weight: bold;">不支持锁升级</strong>，因为锁升级会可能会引发死锁（当两个持有读锁的线程，同时进行锁升级，那么这两个线程都不会释放自己的读锁，从而发生死锁）</p><p style="margin: 0px 0px 20px;">当线程获取读锁的时候，如果没有线程持有写锁，则获取读锁成功；否则，获取读锁失败；</p><p style="margin: 0px 0px 20px;">当线程获取写锁的时候，如果该读写锁的读锁、写锁被其他线程占有，则该线程获取锁失败；</p></li><li><p style="margin: 0px 0px 20px;"><strong style="font-weight: bold;">偏向锁</strong>(Biased Lock)</p><p style="margin: 0px 0px 20px;">偏向锁是<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">JDK1.6</code>引入的一项锁优化，指的是偏向锁会偏向第一个获得它的线程，如果在接下来的执行过程中，该锁没有被其他的线程获取，则持有偏向锁的线程将永远不需要同步。在某些情况下，锁不存在多线程竞争的情况，而总是由同一线程在获取、释放、获取、释放。因此，引入了偏向锁，让此种情况下的锁获取的代价变小，偏向锁可以提高<strong style="font-weight: bold;">带有同步但无竞争</strong>的程序性能。</p><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; border: none; font-size: 14px; table-layout: fixed;width:780px;"><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;width:4.487179487179487%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/><span style="height: 20px;">2</span><br/><span style="height: 20px;">3</span><br/><span style="height: 20px;">4</span><br/><span style="height: 20px;">5</span><br/><span style="height: 20px;">6</span><br/><span style="height: 20px;">7</span><br/><span style="height: 20px;">8</span><br/><span style="height: 20px;">9</span><br/><span style="height: 20px;">10</span><br/><span style="height: 20px;">11</span><br/><span style="height: 20px;">12</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;width:96.00515463917526%;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 726px;"><span style="height: 20px;"><span style="color: rgb(178, 148, 187);">public</span> <span style="color: rgb(178, 148, 187);">class</span> <span style="color: rgb(138, 190, 183);">BiasLockDemo</span> {</span><br/><br/><span style="height: 20px;">      <span style="color: rgb(129, 162, 190);"><span style="color: rgb(178, 148, 187);">public</span> <span style="color: rgb(178, 148, 187);">static</span> <span style="color: rgb(178, 148, 187);">void</span> <span style="color: rgb(138, 190, 183);">main</span><span style="color: rgb(222, 147, 95);">(String[] args)</span> </span>{</span><br/><span style="height: 20px;">               <span style="color: rgb(150, 152, 150);">// TODO Auto-generated method stub</span></span><br/><span style="height: 20px;">          <span style="color: rgb(178, 148, 187);">long</span> t = System.currentTimeMillis();</span><br/><span style="height: 20px;">                List&lt;Integer&gt; list = <span style="color: rgb(178, 148, 187);">new</span> Vector&lt;&gt;();<span style="color: rgb(150, 152, 150);">//选择Vector是由于其add方法是synchronized修饰的；</span></span><br/><span style="height: 20px;">                <span style="color: rgb(178, 148, 187);">for</span> (<span style="color: rgb(178, 148, 187);">int</span> i = <span style="color: rgb(181, 189, 104);">0</span>; i &lt; <span style="color: rgb(181, 189, 104);">1000_0000</span>; i++) {</span><br/><span style="height: 20px;">                      list.add(i);</span><br/><span style="height: 20px;">                }</span><br/><span style="height: 20px;">           System.out.println(<span style="color: rgb(181, 189, 104);">&quot;cost: &quot;</span> + (System.currentTimeMillis() - t) + <span style="color: rgb(181, 189, 104);">&quot;ms&quot;</span>);</span><br/><span style="height: 20px;">       }</span><br/><span style="height: 20px;">}</span><br/></pre></td></tr></table><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">-XX:+UseBiasedLocking -XX:BiasedLockingStartupDelay=0</code>开启偏向锁后，运行时间：</p><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; width: auto; border: none; font-size: 14px; table-layout: fixed;"><tbody><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 99px;"><span style="height: 20px;">cost: 340ms</span><br/></pre></td></tr></tbody></table><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">-XX:-UseBiasedLocking</code>禁用偏向锁后，运行时间：</p><table style="border-collapse: collapse; border-spacing: 0px; margin: 0px; width: auto; border: none; font-size: 14px; table-layout: fixed;"><tbody><tr style="background-color: rgb(249, 249, 249);"><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none; user-select: none;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(136, 143, 150); background: rgb(0, 0, 0); border: none; text-align: right;"><span style="height: 20px;">1</span><br/></pre></td><td style="padding: 0px; text-align: left; vertical-align: middle; font-weight: normal; border: none;"><pre style="overflow: auto; font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; margin: 0px; padding: 10px; color: rgb(197, 200, 198); background: rgb(29, 31, 33); border: none; width: 99px;"><span style="height: 20px;">cost: 519ms</span><br/></pre></td></tr></tbody></table></li><li><p style="margin: 0px 0px 20px;"><strong style="font-weight: bold;">公平锁/非公平锁</strong></p><p style="margin: 0px 0px 20px;">公平锁是指多个线程在等待同一个锁时，必须按照申请锁的先后顺序来获得锁。</p><p style="margin: 0px 0px 20px;">非公平锁是指多个线程在等待同一个锁时，是按按照不确定的顺序来选择某一个线程获取锁。</p><p style="margin: 0px 0px 20px;">通常来讲，<strong style="font-weight: bold;">公平锁的性能低于非公平锁，但是公平锁可以解决线程饥饿的问题</strong>。</p><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Java</code>中可以使用<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">new ReentrantLock(true)</code>构造得到公平锁，而<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">synchronized</code>则提供的内置锁是非公平的。</p><p style="margin: 0px 0px 20px;">ps: <code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Java</code>中提供的显式锁一般都提供Fair和Non-Fair模式，但是即便是公平模式也会提供一些允许<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">插队(barging)</code>的方法允许线程先于等待在前面的线程得到锁。</p></li><li><p style="margin: 0px 0px 20px;"><strong style="font-weight: bold;">悲观锁/乐观锁</strong></p><p style="margin: 0px 0px 20px;">悲观锁：主要的并发控制策略之一，假设冲突总是发生，如果不采取同步措施，例如对共享的变量或者资源加锁，那么肯定会出现问题，类似于<strong style="font-weight: bold;">事前预防</strong>。因此无论共享的数据无论是是否出现竞争冲突，都会对它进行正确的同步。</p><p style="margin: 0px 0px 20px;">乐观锁：和悲观锁不一样，乐观并发控制策略先进行操作，如果操作的数据没出现竞争，那么操作成功；如果操作的数据出现竞争，那么再进行一些后续的弥补操作（常见的就是不断的重试、或者重试数次返回失败信息），类似<strong style="font-weight: bold;">事后弥补</strong>，实现乐观并发控制策略有多种常见的方式：</p><ul><li style="list-style: circle;">CAS</li><li style="list-style: circle;">时间戳</li><li style="list-style: circle;">版本号</li></ul></li><li><p style="margin: 0px 0px 20px;">存在即合理，悲观锁和乐观锁都有其应用的场景，当数据争用、冲突发生频繁的场景，悲观锁较适合；而数据争用、冲突不频繁的场景，乐观锁则更适合。</p></li><li><p style="margin: 0px 0px 20px;"><strong style="font-weight: bold;">自旋锁</strong>(Spinning Lock)</p><p style="margin: 0px 0px 20px;">互斥同步的时候，当线程获取锁失败的时候，通常会进入阻塞状态，<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">java</code>线程和操作系统线程是一一对应的，挂起和恢复线程操作需要由<strong style="font-weight: bold;">用户态转入核心态</strong>完成，这些操作<strong style="font-weight: bold;">耗时、耗资源</strong>。但是某些情况下，某一个线程只会将锁独占很短时间，或者是说很快 便完成了同步代码块的执行，因此其它线程为了这点时间选择将自己挂起、恢复十分没有必要。因此，特别是在多处理环境下，可以让后面请求独占锁失败的线程，进行<strong style="font-weight: bold;">自旋</strong>（忙循环）一会儿，而不是阻塞挂起线程。</p><p style="margin: 0px 0px 20px;">自旋锁的引入是为了解决锁被独占的时间很短的情况下，避免线程被挂起-恢复带来的<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">overhead</code>，因此当锁独占的时间本来就很长的，这种锁便没有存在的意义了。</p><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">JVM</code>中可以通过参数：</p><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">-XX:+UseSpinning</code>开启自旋锁功能；<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">JDK1.6</code>默认是开启的。</p><p style="margin: 0px 0px 20px;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">-XX:PreBlockSpin</code>配置每次自旋的次数，默认是10次；</p><p style="margin: 0px 0px 20px;">​</p></li></ol><h1 style="font-size: 22px; margin: 0px; padding: 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; color: rgb(85, 85, 85); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><a href="https://spground.github.io/2018/02/03/JAVA%E9%94%81/#3-%E6%AD%BB%E9%94%81%E5%92%8C%E6%B4%BB%E9%94%81" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="3. 死锁和活锁"></a>3. 死锁和活锁</h1><h2 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px; color: rgb(85, 85, 85); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><a href="https://spground.github.io/2018/02/03/JAVA%E9%94%81/#3-1-%E6%AD%BB%E9%94%81" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="3.1 死锁"></a>3.1 死锁</h2><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">并发中问题中的死锁最经典莫过于<a href="https://en.wikipedia.org/wiki/Dining_philosophers_problem" rel="noopener" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" target="_blank"><strong style="font-weight: bold;">哲学家就餐</strong></a>问题，死锁常常发生在系统高负载环境下，多线程竞争某一共享数据的情况下。当线程A持有锁L的时候同时，线程B持有锁M并尝试获得L，那么这两个线程将永远等待下去。这种情况就是最简单的死锁形式，多个线程由于存在环路的依赖关系而永远的等待下去。</p><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><a href="https://upload.wikimedia.org/wikipedia/commons/thumb/7/7b/An_illustration_of_the_dining_philosophers_problem.png/463px-An_illustration_of_the_dining_philosophers_problem.png" rel="group" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;"><img src="常见面试基础题_files/Image [31].png" type="image/png" data-filename="Image.png" style="border: 1px solid rgb(221, 221, 221); display: block !important; margin: 0px auto; max-width: 100%; height: auto; cursor: -webkit-zoom-in; box-sizing: border-box; padding: 3px;"/></a></p><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">死锁发生最常见的的根本原因就是：<strong style="font-weight: bold;">多个线程存在环路的依赖关系</strong>。</p><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">比如<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">A</code>等待B，B等待C，C等待D, …, Z等待A，则A间接的等待A，形成环路，发生死锁。</p><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">环路的产生具体有如下几种情况：</p><ul style="color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><li style="list-style: circle;"><strong style="font-weight: bold;">锁顺序死锁</strong>：加锁的顺序不一致导致的死锁；</li><li style="list-style: circle;"><strong style="font-weight: bold;">动态的锁顺序死锁</strong>：方法内部加锁顺序是一致的，但是由于锁被参数化了，因此调用该方法时，锁的顺序取决于方法调用者传来的参数，因此也会动态的产生锁顺序死锁。</li><li style="list-style: circle;"><strong style="font-weight: bold;">协作对象之间发生的死锁</strong></li><li style="list-style: circle;"><strong style="font-weight: bold;">资源死锁</strong> 例如：线程A持有数据库连接D1并等待D2，而线程B持有数据库连接D2，等待D1则A、B之间出现死锁</li></ul><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">解决死锁问题通常有两个角度来解决，<strong style="font-weight: bold;">死锁避免和死锁解除</strong>，一个属于事前预防，另一个是事后弥补；</p><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">数据库系统中，为避免死锁，有一个著名的<strong style="font-weight: bold;">两阶段加锁协议</strong>，同时，事务管理器可以通过环路判断死锁的存在，并取消一个代价小的事务以达到死锁的解除。</p><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Java</code>没有数据库事务管理器那么强大，<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Java</code>中也有一些方法可以避免死锁，但是当死锁发生的时候，除了重启应用别无他法。</p><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">Java</code>中的死锁避免：</p><ul style="color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><li style="list-style: circle;"><strong style="font-weight: bold;">加锁顺序保持相同</strong>（synchronized提供的内置锁只能通过此种方式来避免死锁的发生）</li><li style="list-style: circle;"><strong style="font-weight: bold;">采用可轮询的、可超时的锁</strong>(显式锁Lock提供<code style="font-family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace; font-size: 13px; padding: 2px 4px; word-wrap: break-word; color: rgb(85, 85, 85); background: rgb(238, 238, 238); border-radius: 3px;">tryLock(long timeout)</code>轮询和超时的特性，因此不会无限的等待下去，当超时的时候，程序可以简单的重试，或者放弃获取该锁，释放已有的锁。同时这种方式通过引入<strong style="font-weight: bold;">随机因素</strong>也可以有限的解决<strong style="font-weight: bold;">活锁的问题</strong>)</li></ul><h2 style="margin: 20px 0px 15px; padding: 10px 0px 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 20px; color: rgb(85, 85, 85); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><a href="https://spground.github.io/2018/02/03/JAVA%E9%94%81/#3-2-%E6%B4%BB%E9%94%81" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="3.2 活锁"></a>3.2 活锁</h2><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">死锁是形成死锁的线程全部处于无限等待状态，而<strong style="font-weight: bold;">活锁则是线程不断的重复执行相同的操作，而且总是失败</strong>。就相当于线程在执行一个循环的操作序列，周而复始，无穷无尽，导致系统的状态整体停滞不前。</p><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">最形象的例子便是：</p><blockquote style="margin: 0px; padding: 0px 15px; color: rgb(102, 102, 102); border-left: 4px solid rgb(221, 221, 221); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><p style="margin: 0px 0px 20px;">两个过于礼貌的人甲乙，相向走在一个狭窄的巷子里面，甲和乙同时让对方先走，然后甲乙同时准备接受对方的谦让自己先走，然后两人又同时让对方先走…，如此循环往复，两人没有等待，始终处于活动状态，但是两人始终都无法通过巷子。</p></blockquote><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">同样的类似活锁的例子就是，以太网的共享介质传输信息时，也会出现活锁的问题，以太网技术采用了一种叫做<strong style="font-weight: bold;">载波多路访问-冲突检测（CSMA-CD）</strong>的技术，该技术引入了一些<strong style="font-weight: bold;">随机因素</strong>来避免活锁。</p><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">同样的，解决活锁的问题，可以在<strong style="font-weight: bold;">重试机制中以引入随机性</strong>，这样可以有效的避免活锁问题。</p><h1 style="font-size: 22px; margin: 0px; padding: 0px; font-weight: bold; font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; color: rgb(85, 85, 85); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><a href="https://spground.github.io/2018/02/03/JAVA%E9%94%81/#4-reference" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" title="4.reference"></a>4.reference</h1><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">[1]. Java并发编程实践</p><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">[2]. 深入理解JVM虚拟机</p><p style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">[3]. <a href="http://www.importnew.com/19472.html" rel="noopener" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" target="_blank">http://www.importnew.com/19472.html</a></p><div style="margin: 0px 0px 20px; color: rgb(85, 85, 85); font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif; font-size: 16px; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div>[4]. <a href="https://www.cnblogs.com/qifengshi/p/6831055.html" rel="noopener" style="background-color: transparent; color: rgb(85, 85, 85); text-decoration: none; border-bottom: 1px solid rgb(153, 153, 153); word-wrap: break-word;" target="_blank">https://www.cnblogs.com/qifengshi/p/6831055.html</a></div></div></div></div><br/><div><table bgcolor="#D4DDE5" border="0" width="100%"><tr><td><h1>Maven</h1><b>作者：</b> 958340585@qq.com<br/></td></tr></table></div><div><div>Maven包含几个项目构建phase，和对应的goal</div><div>常见的goal有 compile、test、 package、install、</div><div><br/></div><div>具体关系如下：</div><div>install包含 compile、test、package</div><div><br/></div><div><br/></div><div>Maven pom.xml的名字概念:</div><div><br/></div><div>scope</div></div><br/></div></span>
</div>
<hr>
<a name="1243"/>

<div>
<span><div>按实现原理分为：</div><div><br/></div><div>哈希索引</div><div>B树索引</div><div>全文索引：MyISAM支持 InnoDB不支持</div><div><br/></div><div>B树索引分类：</div><div><br/></div><div>聚簇索引 主键索引</div><div>辅助索引 二级索引</div><div>唯一索引</div><div><br/></div><div><br/></div></span>
</div>
<hr>
<a name="1245"/>

<div>
<span><div>TCP拥塞控制：包含几种机制</div><ul><li><div>慢启动算法</div></li></ul><ol><li><div><span style="-webkit-text-size-adjust: 100%;">cwnd 拥塞窗口 ssthresh slow start threshold 慢启动阈值</span></div></li><li><div><span style="-webkit-text-size-adjust: 100%;"></span><span style="-webkit-text-size-adjust: 100%;">当cwind 小于 ssthresh 执行慢启动算法，cwnd每经历一个ack，则翻倍，当cwnd大于ssthresh，则执行拥塞避免算法，将cwnd每次增加1；</span></div></li><li><div><span style="-webkit-text-size-adjust: 100%;">当网络出现拥塞，比如等待ack超时、收到某个重复的ack等，则将ssthresh降为cwnd的一半，cwnd变为1，执行慢启动算法；</span></div></li></ol><ul><li><div>拥塞避免：每次将cwnd增加1；</div></li><li><div>快速重传</div></li></ul><div><br/></div><div><br/></div></span>
</div>
<hr>
<a name="1247"/>

<div>
<span><ul><li><div>先来先服务</div></li><li><div>优先级调度</div></li><li><div>短作业优先</div></li></ul><div>高响应比优先 ：响应比=等待时间+要求服务时间/要求服务时间</div><div><br/></div><div>兼顾短作业和长作业</div><div><br/></div><ul><li><div>时间片轮转</div></li></ul><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 